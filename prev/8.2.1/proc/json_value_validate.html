<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="JSON-Fortran â€“ A Fortran 2008 JSON API">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>json_value_validate &ndash; JSON-Fortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">JSON-Fortran <small>8.2.1</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
        
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>json_value_validate
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     <li><i class="fa fa-pencil"></i> Jacob Williams</li>
     
     
    <li><i class="fa fa-calendar-o"></i> 5/2/2016</li>
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 2.6% of total for procedures.">180 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/json_value_module.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
     <li><a href='../sourcefile/json_value_module.f90.html'>json_value_module.F90</a></li>
    
     <li><a href='../module/json_value_module.html'>json_value_module</a></li>
    
  
     <li class="active">json_value_validate</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/json_value_validate.html#src">json_value_validate</a>
  </div>
</div>



</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
private subroutine json_value_validate(json, p, is_valid, error_msg)
    
    
   
</h2>
    
  


    
    <p>Validate a <a href="../type/json_value.html">json_value</a> linked list by checking to make sure
  all the pointers are properly associated, arrays and objects
  have the correct number of children, and the correct data is
  allocated for the variable types.</p>
<p>It recursively traverses the entire structure and checks every element.</p>
<h3 id="history">History</h3>
<ul>
<li>Jacob Williams, 8/26/2017 : added duplicate key check.</li>
</ul>
<p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>It will return on the first error it encounters.</p></div>
<p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>This routine does not check or throw any exceptions.
      If <code>json</code> is currently in a state of exception, it will
      remain so after calling this routine.</p></div>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-json%7E133"></span>class(<a href='../type/json_core.html'>json_core</a>),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>json</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-p%7E77"></span>type(<a href='../type/json_value.html'>json_value</a>),</td>
  <td>intent(in),</td>
  <td></td>
  
  <td>pointer</td><td>::</td>
  <td><strong>p</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-is_valid"></span>logical(kind=LK),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>is_valid</strong></td><td><p>True if the structure is valid.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-error_msg%7E2"></span>character(kind=CK,len=:),</td>
  <td>intent(out),</td>
  <td></td>
  
  <td>allocatable</td><td>::</td>
  <td><strong>error_msg</strong></td><td><p>if not valid, this will contain
 a description of the problem</p></td>
  
</tr>

</tbody>
</table>

    
    
    
    
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 





















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/json_value_validate.html#src">json_value_validate</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>    <span class="k">subroutine </span><span class="n">json_value_validate</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">is_valid</span><span class="p">,</span><span class="n">error_msg</span><span class="p">)</span>

    <span class="k">implicit none</span>

<span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">is_valid</span>  <span class="c">!! True if the structure is valid.</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">error_msg</span> <span class="c">!! if not valid, this will contain</span>
                                                                  <span class="c">!! a description of the problem</span>

    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span> <span class="c">!! to check for duplicate keys</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">path</span>  <span class="c">!! path to duplicate key</span>
    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">status_ok</span> <span class="c">!! to check for existing exception</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">exception_msg</span>  <span class="c">!! error message for an existing exception</span>
    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">exception_msg2</span>  <span class="c">!! error message for a new exception</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>

<span class="k">        </span><span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
        <span class="k">call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">is_valid</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">allow_duplicate_keys</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! if no errors so far, also check the</span>
            <span class="c">! entire structure for duplicate keys:</span>

            <span class="c">! note: check_for_duplicate_keys does call routines</span>
            <span class="c">! that check and throw exceptions, so let&#39;s clear any</span>
            <span class="c">! first. (save message for later)</span>
            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">status_ok</span><span class="p">,</span> <span class="n">exception_msg</span><span class="p">)</span>
            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>

            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">failed</span><span class="p">())</span> <span class="k">then</span>
                <span class="c">! if an exception was thrown during this call,</span>
                <span class="c">! then clear it but make that the error message</span>
                <span class="c">! returned by this routine. Normally this should</span>
                <span class="c">! never actually occur since we have already</span>
                <span class="c">! validated the structure.</span>
                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">is_valid</span><span class="p">,</span> <span class="n">exception_msg2</span><span class="p">)</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">exception_msg2</span>
                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
            <span class="k">else</span>
<span class="k">                if</span> <span class="p">(</span><span class="n">has_duplicate</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;duplicate key found: &#39;</span><span class="o">//</span><span class="n">path</span>
                    <span class="n">is_valid</span>  <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                <span class="k">end if</span>
<span class="k">            end if</span>

<span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
                <span class="c">! restore any existing exception if necessary</span>
                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">)</span>
            <span class="k">end if</span>

            <span class="c">! cleanup:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>           <span class="k">deallocate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">))</span>  <span class="k">deallocate</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">exception_msg2</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">exception_msg2</span><span class="p">)</span>

        <span class="k">end if</span>

<span class="k">    else</span>
<span class="k">        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;The pointer is not associated&#39;</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">end if</span>

<span class="k">    contains</span>

<span class="k">    recursive subroutine </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">require_parent</span><span class="p">)</span>

        <span class="k">implicit none</span>

<span class="k">        type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
        <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">require_parent</span> <span class="c">!! the first one may be a root (so no parent),</span>
                                             <span class="c">!! but all descendants must have a parent.</span>

        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="c">!! counter</span>
        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span>
        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">previous</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">is_valid</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>

            <span class="c">! data type:</span>
            <span class="k">select case</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
            <span class="k">case</span><span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_object</span><span class="p">,</span><span class="n">json_array</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for &#39;</span><span class="o">//</span><span class="p">&amp;</span>
                                <span class="s1">&#39;json_null, json_object, or json_array variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            case</span><span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;log_value should be allocated for json_logical variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_logical variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            case</span><span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;int_value should be allocated for json_integer variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_integer variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            case</span><span class="p">(</span><span class="n">json_real</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;dbl_value should be allocated for json_real variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_real variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            case</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;str_value should be allocated for json_string variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_string variable type&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>
<span class="k">            case </span><span class="n">default</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;invalid JSON variable type&#39;</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                <span class="k">return</span>
<span class="k">            end select</span>

<span class="k">            if</span> <span class="p">(</span><span class="n">require_parent</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;parent pointer is not associated&#39;</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                <span class="k">return</span>
<span class="k">            end if</span>

<span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_array</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;JSON variable must have a name if not an &#39;</span><span class="o">//</span><span class="p">&amp;</span>
                                    <span class="s1">&#39;array element or the root&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                end if</span>
<span class="k">            end if</span>

<span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">)</span> <span class="p">.</span><span class="n">neqv</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">tail</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;both children and tail pointers must be associated&#39;</span>
                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                <span class="k">return</span>
<span class="k">            end if</span>

            <span class="c">! now, check next one:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;circular linked list&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                else</span>
                    <span class="c">! if it&#39;s an element in an</span>
                    <span class="c">! array, then require a parent:</span>
                    <span class="k">call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
                <span class="k">end if</span>
<span class="k">            end if</span>

<span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>

<span class="k">                if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_array</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_object</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;only arrays and objects can have children&#39;</span>
                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                    <span class="k">return</span>
<span class="k">                end if</span>

                <span class="c">! first validate children pointers:</span>

                <span class="n">previous</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
                <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1_IK</span><span class="p">,</span> <span class="n">p</span><span class="p">%</span><span class="n">n_children</span>
                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">parent</span><span class="p">,</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;child&#39;&#39;s parent pointer not properly associated&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;first child shouldn&#39;&#39;t have a previous&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;not enough children&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;too many children&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                            </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;previous pointer not properly associated&#39;</span>
                            <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                            <span class="k">return</span>
<span class="k">                        end if</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
                        <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;parent&#39;&#39;s tail pointer not properly associated&#39;</span>
                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
                        <span class="k">return</span>
<span class="k">                    end if</span>
<span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span><span class="p">)</span> <span class="k">then</span>
                        <span class="c">!setup next case:</span>
                        <span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">element</span>
                        <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
                    <span class="k">end if</span>
<span class="k">                end do</span>

                <span class="c">!now check all the children:</span>
                <span class="k">call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>

            <span class="k">end if</span>

<span class="k">        end if</span>

<span class="k">    end subroutine </span><span class="n">check_if_valid</span>

    <span class="k">end subroutine </span><span class="n">json_value_validate</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>


    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2021 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2021-01-02 18:18  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> JSON-Fortran was developed by Jacob Williams</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>