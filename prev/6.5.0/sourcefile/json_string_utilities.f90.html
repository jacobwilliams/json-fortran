<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="JSON-Fortran â€“ A Fortran 2008 JSON API">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>json_string_utilities.F90 &ndash; JSON-Fortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">JSON-Fortran <small>6.5.0</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>json_string_utilities.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 6.5% of total for source files.">410 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/json_string_utilities.F90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">json_string_utilities.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_string_utilities.html">json_string_utilities</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html#src">json_string_utilities.F90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/json_file_module.f90.html">json_file_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_kinds.f90.html">json_kinds.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_module.f90.html">json_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_parameters.f90.html">json_parameters.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html">json_string_utilities.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_value_module.f90.html">json_value_module.F90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~json_string_utilities.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilejson_string_utilitiesf90EfferentGraph" width="406pt" height="52pt"
 viewBox="0.00 0.00 406.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~json_string_utilities.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-48 402,-48 402,4 -4,4"/>
<!-- sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node1" class="node"><title>sourcefile~json_string_utilities.f90</title>
<polygon fill="none" stroke="black" points="398,-44 274,-44 274,-20 398,-20 398,-44"/>
<text text-anchor="middle" x="336" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">json_string_utilities.F90</text>
</g>
<!-- sourcefile~json_kinds.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node2" class="node"><title>sourcefile~json_kinds.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/json_kinds.f90.html" xlink:title="json_kinds.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="85.5,-44 0.5,-44 0.5,-20 85.5,-20 85.5,-44"/>
<text text-anchor="middle" x="43" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_kinds.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M85.6935,-32.6333C97.4356,-32.7848 110.218,-32.9245 122,-33 173.554,-33.3305 186.445,-33.2657 238,-33 246.352,-32.9569 255.108,-32.893 263.799,-32.818"/>
<polygon fill="#ff0000" stroke="#ff0000" points="263.975,-36.3166 273.943,-32.7253 263.911,-29.3169 263.975,-36.3166"/>
</g>
<!-- sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node3" class="node"><title>sourcefile~json_parameters.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/json_parameters.f90.html" xlink:title="json_parameters.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="237.5,-24 122.5,-24 122.5,-0 237.5,-0 237.5,-24"/>
<text text-anchor="middle" x="180" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_parameters.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_parameters.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M85.606,-25.8361C94.1402,-24.5718 103.325,-23.2111 112.486,-21.8539"/>
<polygon fill="#00ffff" stroke="#00ffff" points="113.006,-25.3152 122.385,-20.3874 111.98,-18.3908 113.006,-25.3152"/>
</g>
<!-- sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M237.906,-19.3904C246.343,-20.4861 255.126,-21.6268 263.81,-22.7546"/>
<polygon fill="#ff0000" stroke="#ff0000" points="263.565,-26.252 273.932,-24.0691 264.466,-19.3103 263.565,-26.252"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~json_string_utilities.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilejson_string_utilitiesf90AfferentGraph" width="580pt" height="72pt"
 viewBox="0.00 0.00 580.00 72.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 68)">
<title>sourcefile~~json_string_utilities.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-68 576,-68 576,4 -4,4"/>
<!-- sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node1" class="node"><title>sourcefile~json_string_utilities.f90</title>
<polygon fill="none" stroke="black" points="124,-44 7.10543e-15,-44 7.10543e-15,-20 124,-20 124,-44"/>
<text text-anchor="middle" x="62" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">json_string_utilities.F90</text>
</g>
<!-- sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node2" class="node"><title>sourcefile~json_value_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/json_value_module.f90.html" xlink:title="json_value_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="287.5,-24 160.5,-24 160.5,-0 287.5,-0 287.5,-24"/>
<text text-anchor="middle" x="224" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_value_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge4" class="edge"><title>sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M124.403,-24.3247C132.89,-23.2637 141.674,-22.1658 150.341,-21.0824"/>
<polygon fill="#ff0000" stroke="#ff0000" points="150.949,-24.5336 160.438,-19.8202 150.081,-17.5877 150.949,-24.5336"/>
</g>
<!-- sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node3" class="node"><title>sourcefile~json_file_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/json_file_module.f90.html" xlink:title="json_file_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="439.5,-64 324.5,-64 324.5,-40 439.5,-40 439.5,-64"/>
<text text-anchor="middle" x="382" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_file_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge5" class="edge"><title>sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_file_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M124.314,-35.8562C178.769,-39.2811 258.184,-44.2757 314.23,-47.8006"/>
<polygon fill="#ff0000" stroke="#ff0000" points="314.211,-51.3063 324.411,-48.441 314.651,-44.3201 314.211,-51.3063"/>
</g>
<!-- sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_file_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M271.805,-24.0013C288.235,-28.2142 306.876,-32.9939 324.047,-37.3966"/>
<polygon fill="#ff0000" stroke="#ff0000" points="323.403,-40.8446 333.958,-39.9381 325.141,-34.0639 323.403,-40.8446"/>
</g>
<!-- sourcefile~json_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node4" class="node"><title>sourcefile~json_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node4"><a xlink:href="../sourcefile/json_module.f90.html" xlink:title="json_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="571.5,-44 476.5,-44 476.5,-20 571.5,-20 571.5,-44"/>
<text text-anchor="middle" x="524" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M287.834,-16.217C340.553,-19.7553 415.2,-24.7651 466.161,-28.1853"/>
<polygon fill="#ff0000" stroke="#ff0000" points="466.13,-31.691 476.342,-28.8686 466.598,-24.7067 466.13,-31.691"/>
</g>
<!-- sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_module.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M439.54,-43.9229C448.267,-42.6761 457.284,-41.3879 466.021,-40.1398"/>
<polygon fill="#00ffff" stroke="#00ffff" points="466.71,-43.5771 476.114,-38.698 465.72,-36.6474 466.71,-43.5771"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_string_utilities.html">json_string_utilities</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html#src">json_string_utilities.F90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-3"></a><span class="c">!  license: BSD</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">!  JSON-Fortran support module for string manipulation.</span>
<a name="ln-6"></a><span class="c">!</span>
<a name="ln-7"></a><span class="c">!## License</span>
<a name="ln-8"></a><span class="c">!  * JSON-Fortran is released under a BSD-style license.</span>
<a name="ln-9"></a><span class="c">!    See the [LICENSE](https://github.com/jacobwilliams/json-fortran/blob/master/LICENSE)</span>
<a name="ln-10"></a><span class="c">!    file for details.</span>
<a name="ln-11"></a>
<a name="ln-12"></a>    <span class="k">module </span><span class="n">json_string_utilities</span>
<a name="ln-13"></a>
<a name="ln-14"></a>    <span class="k">use </span><span class="n">json_kinds</span>
<a name="ln-15"></a>    <span class="k">use </span><span class="n">json_parameters</span>
<a name="ln-16"></a>
<a name="ln-17"></a>    <span class="k">implicit none</span>
<a name="ln-18"></a>
<a name="ln-19"></a><span class="k">    private</span>
<a name="ln-20"></a>
<a name="ln-21"></a>    <span class="c">!******************************************************</span>
<a name="ln-22"></a>    <span class="c">!&gt;</span>
<a name="ln-23"></a>    <span class="c">!  Convert a &#39;DEFAULT&#39; kind character input to</span>
<a name="ln-24"></a>    <span class="c">!  &#39;ISO_10646&#39; kind and return it</span>
<a name="ln-25"></a>    <span class="k">interface </span><span class="n">to_unicode</span>
<a name="ln-26"></a>        <span class="k">module procedure </span><span class="n">to_uni</span><span class="p">,</span> <span class="n">to_uni_vec</span>
<a name="ln-27"></a>    <span class="k">end interface</span>
<a name="ln-28"></a>    <span class="c">!******************************************************</span>
<a name="ln-29"></a>
<a name="ln-30"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-31"></a>    <span class="c">!******************************************************</span>
<a name="ln-32"></a>    <span class="c">!&gt;</span>
<a name="ln-33"></a>    <span class="c">! Provide a means to convert to UCS4 while</span>
<a name="ln-34"></a>    <span class="c">! concatenating UCS4 and default strings</span>
<a name="ln-35"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">)</span>
<a name="ln-36"></a>       <span class="k">module procedure </span><span class="n">ucs4_join_default</span><span class="p">,</span> <span class="n">default_join_ucs4</span>
<a name="ln-37"></a>    <span class="k">end interface</span>
<a name="ln-38"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">)</span>
<a name="ln-39"></a>    <span class="c">!******************************************************</span>
<a name="ln-40"></a>
<a name="ln-41"></a>    <span class="c">!******************************************************</span>
<a name="ln-42"></a>    <span class="c">!&gt;</span>
<a name="ln-43"></a>    <span class="c">! Provide a string `==` operator that works</span>
<a name="ln-44"></a>    <span class="c">! with mixed kinds</span>
<a name="ln-45"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">==</span><span class="p">)</span>
<a name="ln-46"></a>       <span class="k">module procedure </span><span class="n">ucs4_comp_default</span><span class="p">,</span> <span class="n">default_comp_ucs4</span>
<a name="ln-47"></a>    <span class="k">end interface</span>
<a name="ln-48"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">==</span><span class="p">)</span>
<a name="ln-49"></a>    <span class="c">!******************************************************</span>
<a name="ln-50"></a>
<a name="ln-51"></a>    <span class="c">!******************************************************</span>
<a name="ln-52"></a>    <span class="c">!&gt;</span>
<a name="ln-53"></a>    <span class="c">! Provide a string `/=` operator that works</span>
<a name="ln-54"></a>    <span class="c">! with mixed kinds</span>
<a name="ln-55"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">/=</span><span class="p">)</span>
<a name="ln-56"></a>       <span class="k">module procedure </span><span class="n">ucs4_neq_default</span><span class="p">,</span> <span class="n">default_neq_ucs4</span>
<a name="ln-57"></a>    <span class="k">end interface</span>
<a name="ln-58"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">/=</span><span class="p">)</span>
<a name="ln-59"></a>    <span class="c">!******************************************************</span>
<a name="ln-60"></a><span class="cp">#endif</span>
<a name="ln-61"></a>
<a name="ln-62"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">integer_to_string</span>
<a name="ln-63"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">real_to_string</span>
<a name="ln-64"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">string_to_integer</span>
<a name="ln-65"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">string_to_real</span>
<a name="ln-66"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">valid_json_hex</span>
<a name="ln-67"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">to_unicode</span>
<a name="ln-68"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">escape_string</span>
<a name="ln-69"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">unescape_string</span>
<a name="ln-70"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">lowercase_string</span>
<a name="ln-71"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">replace_string</span>
<a name="ln-72"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">decode_rfc6901</span>
<a name="ln-73"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">encode_rfc6901</span>
<a name="ln-74"></a>
<a name="ln-75"></a>    <span class="k">contains</span>
<a name="ln-76"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-77"></a>
<a name="ln-78"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-79"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-80"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-81"></a><span class="c">!</span>
<a name="ln-82"></a><span class="c">!  Convert an integer to a string.</span>
<a name="ln-83"></a>
<a name="ln-84"></a>    <span class="k">pure subroutine </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">ival</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a name="ln-85"></a>
<a name="ln-86"></a>    <span class="k">implicit none</span>
<a name="ln-87"></a>
<a name="ln-88"></a><span class="k">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">ival</span>    <span class="c">!! integer value.</span>
<a name="ln-89"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">int_fmt</span> <span class="c">!! format for integers</span>
<a name="ln-90"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>     <span class="c">!! `ival` converted to a string.</span>
<a name="ln-91"></a>
<a name="ln-92"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span>
<a name="ln-93"></a>
<a name="ln-94"></a>    <span class="k">write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">ival</span>
<a name="ln-95"></a>
<a name="ln-96"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-97"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-98"></a>    <span class="k">else</span>
<a name="ln-99"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">star</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a name="ln-100"></a>    <span class="k">end if</span>
<a name="ln-101"></a>
<a name="ln-102"></a><span class="k">    end subroutine </span><span class="n">integer_to_string</span>
<a name="ln-103"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-104"></a>
<a name="ln-105"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-106"></a><span class="c">!&gt;</span>
<a name="ln-107"></a><span class="c">!  Convert a string into an integer.</span>
<a name="ln-108"></a><span class="c">!</span>
<a name="ln-109"></a><span class="c">!# History</span>
<a name="ln-110"></a><span class="c">!  * Jacob Williams : 12/10/2013 : Rewrote original `parse_integer` routine.</span>
<a name="ln-111"></a><span class="c">!    Added error checking.</span>
<a name="ln-112"></a><span class="c">!  * Modified by Izaak Beekman</span>
<a name="ln-113"></a><span class="c">!  * Jacob Williams : 2/4/2017 : moved core logic to this routine.</span>
<a name="ln-114"></a>
<a name="ln-115"></a>    <span class="k">subroutine </span><span class="n">string_to_integer</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-116"></a>
<a name="ln-117"></a>    <span class="k">implicit none</span>
<a name="ln-118"></a>
<a name="ln-119"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>        <span class="c">!! the string to conver to an integer</span>
<a name="ln-120"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ival</span>       <span class="c">!! the integer value</span>
<a name="ln-121"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">status_ok</span>  <span class="c">!! true if there were no errors</span>
<a name="ln-122"></a>
<a name="ln-123"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="nb">digits</span>
<a name="ln-124"></a><span class="nb">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndigits_digits</span><span class="p">,</span><span class="n">ndigits</span><span class="p">,</span><span class="n">ierr</span>
<a name="ln-125"></a>
<a name="ln-126"></a>    <span class="c">! Compute how many digits we need to read</span>
<a name="ln-127"></a>    <span class="n">ndigits</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-128"></a>    <span class="n">ndigits_digits</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ndigits</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-129"></a>    <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">ndigits_digits</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">digits</span><span class="p">)</span>
<a name="ln-130"></a>    <span class="k">write</span><span class="p">(</span><span class="nb">digits</span><span class="p">,</span><span class="s1">&#39;(I0)&#39;</span><span class="p">)</span> <span class="n">ndigits</span> <span class="c">!gfortran will have a runtime error with * edit descriptor here</span>
<a name="ln-131"></a>    <span class="c">! gfortran bug: &#39;*&#39; edit descriptor for ISO_10646 strings does bad stuff.</span>
<a name="ln-132"></a>    <span class="k">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="s1">&#39;(I&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">digits</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span> <span class="n">ival</span>   <span class="c">!string to integer</span>
<a name="ln-133"></a>
<a name="ln-134"></a>    <span class="c">! error check:</span>
<a name="ln-135"></a>    <span class="n">status_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-136"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="n">ival</span> <span class="o">=</span> <span class="mi">0_IK</span>
<a name="ln-137"></a>
<a name="ln-138"></a>    <span class="k">end subroutine </span><span class="n">string_to_integer</span>
<a name="ln-139"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-140"></a>
<a name="ln-141"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-142"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-143"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-144"></a><span class="c">!</span>
<a name="ln-145"></a><span class="c">!  Convert a real value to a string.</span>
<a name="ln-146"></a><span class="c">!</span>
<a name="ln-147"></a><span class="c">!### Modified</span>
<a name="ln-148"></a><span class="c">!  * Izaak Beekman : 02/24/2015 : added the compact option.</span>
<a name="ln-149"></a><span class="c">!  * Jacob Williams : 10/27/2015 : added the star option.</span>
<a name="ln-150"></a>
<a name="ln-151"></a>    <span class="k">subroutine </span><span class="n">real_to_string</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span><span class="n">real_fmt</span><span class="p">,</span><span class="n">compact_real</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a name="ln-152"></a>
<a name="ln-153"></a>    <span class="k">implicit none</span>
<a name="ln-154"></a>
<a name="ln-155"></a><span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">rval</span>         <span class="c">!! real value.</span>
<a name="ln-156"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_fmt</span>     <span class="c">!! format for real numbers</span>
<a name="ln-157"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">compact_real</span> <span class="c">!! compact the string so that it is</span>
<a name="ln-158"></a>                                                         <span class="c">!! displayed with fewer characters</span>
<a name="ln-159"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>          <span class="c">!! `rval` converted to a string.</span>
<a name="ln-160"></a>
<a name="ln-161"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span>
<a name="ln-162"></a>
<a name="ln-163"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">real_fmt</span><span class="o">==</span><span class="n">star</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-164"></a><span class="k">        write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">rval</span>
<a name="ln-165"></a>    <span class="k">else</span>
<a name="ln-166"></a><span class="k">        write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">real_fmt</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">rval</span>
<a name="ln-167"></a>    <span class="k">end if</span>
<a name="ln-168"></a>
<a name="ln-169"></a><span class="k">    if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-170"></a>        <span class="c">!in this case, the default string will be compacted,</span>
<a name="ln-171"></a>        <span class="c">! so that the same value is displayed with fewer characters.</span>
<a name="ln-172"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">compact_real</span><span class="p">)</span> <span class="k">call </span><span class="n">compact_real_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-173"></a>    <span class="k">else</span>
<a name="ln-174"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">star</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a name="ln-175"></a>    <span class="k">end if</span>
<a name="ln-176"></a>
<a name="ln-177"></a><span class="k">    end subroutine </span><span class="n">real_to_string</span>
<a name="ln-178"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-179"></a>
<a name="ln-180"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-181"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-182"></a><span class="c">!  date: 1/19/2014</span>
<a name="ln-183"></a><span class="c">!</span>
<a name="ln-184"></a><span class="c">!  Convert a string into a `real(RK)`.</span>
<a name="ln-185"></a><span class="c">!</span>
<a name="ln-186"></a><span class="c">!# History</span>
<a name="ln-187"></a><span class="c">!  * Jacob Williams, 10/27/2015 : Now using `fmt=*`, rather than</span>
<a name="ln-188"></a><span class="c">!    `fmt=real_fmt`, since it doesn&#39;t work for some unusual cases</span>
<a name="ln-189"></a><span class="c">!    (e.g., when `str=&#39;1E-5&#39;`).</span>
<a name="ln-190"></a><span class="c">!  * Jacob Williams : 2/6/2017 : moved core logic to this routine.</span>
<a name="ln-191"></a>
<a name="ln-192"></a>    <span class="k">subroutine </span><span class="n">string_to_real</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">rval</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-193"></a>
<a name="ln-194"></a>    <span class="k">implicit none</span>
<a name="ln-195"></a>
<a name="ln-196"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-197"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rval</span>
<a name="ln-198"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">status_ok</span>  <span class="c">!! true if there were no errors</span>
<a name="ln-199"></a>
<a name="ln-200"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>  <span class="c">!! read iostat error code</span>
<a name="ln-201"></a>
<a name="ln-202"></a>    <span class="k">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span> <span class="n">rval</span>
<a name="ln-203"></a>    <span class="n">status_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-204"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="n">rval</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-205"></a>
<a name="ln-206"></a>    <span class="k">end subroutine </span><span class="n">string_to_real</span>
<a name="ln-207"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-208"></a>
<a name="ln-209"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-210"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-211"></a><span class="c">!  date: 02/24/2015</span>
<a name="ln-212"></a><span class="c">!</span>
<a name="ln-213"></a><span class="c">!  Compact a string representing a real number, so that</span>
<a name="ln-214"></a><span class="c">!  the same value is displayed with fewer characters.</span>
<a name="ln-215"></a><span class="c">!</span>
<a name="ln-216"></a><span class="c">!# See also</span>
<a name="ln-217"></a><span class="c">!  * [[real_to_string]]</span>
<a name="ln-218"></a>
<a name="ln-219"></a>    <span class="k">subroutine </span><span class="n">compact_real_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-220"></a>
<a name="ln-221"></a>    <span class="k">implicit none</span>
<a name="ln-222"></a>
<a name="ln-223"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>  <span class="c">!! string representation of a real number.</span>
<a name="ln-224"></a>
<a name="ln-225"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">significand</span>
<a name="ln-226"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">expnt</span>
<a name="ln-227"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">separator</span>
<a name="ln-228"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">exp_start</span>
<a name="ln-229"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">decimal_pos</span>
<a name="ln-230"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sig_trim</span>
<a name="ln-231"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">exp_trim</span>
<a name="ln-232"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a name="ln-233"></a>
<a name="ln-234"></a>    <span class="n">str</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-235"></a>    <span class="n">exp_start</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;eEdD&#39;</span><span class="p">)</span>
<a name="ln-236"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">exp_start</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;-+&#39;</span><span class="p">,</span><span class="n">back</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-237"></a>    <span class="n">decimal_pos</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a name="ln-238"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">separator</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="p">:</span><span class="n">exp_start</span><span class="p">)</span>
<a name="ln-239"></a>
<a name="ln-240"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">exp_start</span> <span class="o">&lt;</span> <span class="n">decimal_pos</span> <span class="p">)</span> <span class="k">then</span> <span class="c">!possibly signed, exponent-less float</span>
<a name="ln-241"></a>
<a name="ln-242"></a>        <span class="n">significand</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-243"></a>        <span class="n">sig_trim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">))</span>
<a name="ln-244"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">)),</span><span class="n">decimal_pos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="c">!look from right to left at 0s</span>
<a name="ln-245"></a>                                                       <span class="c">!but save one after the decimal place</span>
<a name="ln-246"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-247"></a><span class="k">                </span><span class="n">sig_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-248"></a>            <span class="k">else</span>
<a name="ln-249"></a><span class="k">                exit</span>
<a name="ln-250"></a><span class="k">            end if</span>
<a name="ln-251"></a><span class="k">        end do</span>
<a name="ln-252"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sig_trim</span><span class="p">))</span>
<a name="ln-253"></a>
<a name="ln-254"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">&gt;</span> <span class="n">decimal_pos</span><span class="p">)</span> <span class="k">then</span> <span class="c">!float has exponent</span>
<a name="ln-255"></a>
<a name="ln-256"></a>        <span class="n">significand</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">exp_start</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-257"></a>        <span class="n">sig_trim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">))</span>
<a name="ln-258"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">)),</span><span class="n">decimal_pos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="c">!look from right to left at 0s</span>
<a name="ln-259"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-260"></a><span class="k">                </span><span class="n">sig_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-261"></a>            <span class="k">else</span>
<a name="ln-262"></a><span class="k">                exit</span>
<a name="ln-263"></a><span class="k">            end if</span>
<a name="ln-264"></a><span class="k">        end do</span>
<a name="ln-265"></a><span class="k">        </span><span class="n">expnt</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="o">+</span><span class="mi">1</span><span class="p">:))</span>
<a name="ln-266"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-267"></a><span class="k">            </span><span class="n">separator</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">separator</span><span class="p">))</span><span class="o">//</span><span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-268"></a>            <span class="n">exp_start</span> <span class="o">=</span> <span class="n">exp_start</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-269"></a>            <span class="n">expnt</span>     <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="o">+</span><span class="mi">1</span><span class="p">:))</span>
<a name="ln-270"></a>        <span class="k">end if</span>
<a name="ln-271"></a><span class="k">        </span><span class="n">exp_trim</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-272"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">expnt</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!look at exponent leading zeros saving last</span>
<a name="ln-273"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-274"></a><span class="k">                </span><span class="n">exp_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-275"></a>            <span class="k">else</span>
<a name="ln-276"></a><span class="k">                exit</span>
<a name="ln-277"></a><span class="k">            end if</span>
<a name="ln-278"></a><span class="k">        end do</span>
<a name="ln-279"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sig_trim</span><span class="p">)))</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-280"></a>              <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">separator</span><span class="p">))</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-281"></a>              <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="n">exp_trim</span><span class="p">:)))</span>
<a name="ln-282"></a>
<a name="ln-283"></a>    <span class="c">!else ! mal-formed real, BUT this code should be unreachable</span>
<a name="ln-284"></a>
<a name="ln-285"></a>    <span class="k">end if</span>
<a name="ln-286"></a>
<a name="ln-287"></a><span class="k">    end subroutine </span><span class="n">compact_real_string</span>
<a name="ln-288"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-289"></a>
<a name="ln-290"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-291"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-292"></a><span class="c">!  date: 1/21/2014</span>
<a name="ln-293"></a><span class="c">!</span>
<a name="ln-294"></a><span class="c">!  Add the escape characters to a string for adding to JSON.</span>
<a name="ln-295"></a>
<a name="ln-296"></a>    <span class="k">subroutine </span><span class="n">escape_string</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span> <span class="n">str_out</span><span class="p">,</span> <span class="n">escape_solidus</span><span class="p">)</span>
<a name="ln-297"></a>
<a name="ln-298"></a>    <span class="k">implicit none</span>
<a name="ln-299"></a>
<a name="ln-300"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">str_in</span>
<a name="ln-301"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str_out</span>
<a name="ln-302"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">escape_solidus</span>  <span class="c">!! if the solidus (forward slash)</span>
<a name="ln-303"></a>                                              <span class="c">!! is also to be escaped</span>
<a name="ln-304"></a>
<a name="ln-305"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-306"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipos</span> <span class="c">!! accumulated string size</span>
<a name="ln-307"></a>                        <span class="c">!! (so we can allocate it in chunks for</span>
<a name="ln-308"></a>                        <span class="c">!! greater runtime efficiency)</span>
<a name="ln-309"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>  <span class="c">!! for reading `str_in` one character at a time.</span>
<a name="ln-310"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-311"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span> <span class="c">!! workaround for bug in gfortran 6.1</span>
<a name="ln-312"></a><span class="cp">#endif</span>
<a name="ln-313"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">to_be_escaped</span> <span class="c">!! if there are characters to be escaped</span>
<a name="ln-314"></a>
<a name="ln-315"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">specials_no_slash</span> <span class="o">=</span> <span class="n">quotation_mark</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-316"></a>                                                     <span class="n">backslash</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-317"></a>                                                     <span class="n">bspace</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-318"></a>                                                     <span class="n">formfeed</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-319"></a>                                                     <span class="n">newline</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-320"></a>                                                     <span class="n">carriage_return</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-321"></a>                                                     <span class="n">horizontal_tab</span>
<a name="ln-322"></a>
<a name="ln-323"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">specials</span> <span class="o">=</span> <span class="n">specials_no_slash</span><span class="o">//</span><span class="n">slash</span>
<a name="ln-324"></a>
<a name="ln-325"></a>
<a name="ln-326"></a>    <span class="c">!Do a quick scan for the special characters,</span>
<a name="ln-327"></a>    <span class="c">! if any are present, then process the string,</span>
<a name="ln-328"></a>    <span class="c">! otherwise, return the string as is.</span>
<a name="ln-329"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">escape_solidus</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-330"></a><span class="k">        </span><span class="n">to_be_escaped</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span><span class="n">specials</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<a name="ln-331"></a>    <span class="k">else</span>
<a name="ln-332"></a><span class="k">        </span><span class="n">to_be_escaped</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span><span class="n">specials_no_slash</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<a name="ln-333"></a>    <span class="k">end if</span>
<a name="ln-334"></a>
<a name="ln-335"></a><span class="k">    if</span> <span class="p">(</span><span class="n">to_be_escaped</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-336"></a>
<a name="ln-337"></a><span class="k">        </span><span class="n">str_out</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-338"></a>        <span class="n">ipos</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-339"></a>
<a name="ln-340"></a>        <span class="c">!go through the string and look for special characters:</span>
<a name="ln-341"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str_in</span><span class="p">)</span>
<a name="ln-342"></a>
<a name="ln-343"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>    <span class="c">!get next character in the input string</span>
<a name="ln-344"></a>
<a name="ln-345"></a>            <span class="c">!if the string is not big enough, then add another chunk:</span>
<a name="ln-346"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">+</span><span class="mi">3</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">str_out</span><span class="p">))</span> <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_out</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-347"></a>
<a name="ln-348"></a>            <span class="k">select case</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-349"></a>            <span class="k">case</span><span class="p">(</span><span class="n">backslash</span><span class="p">)</span>
<a name="ln-350"></a>
<a name="ln-351"></a>                <span class="c">!test for unicode sequence: &#39;\uXXXX&#39;</span>
<a name="ln-352"></a>                <span class="c">![don&#39;t add an extra &#39;\&#39; for those]</span>
<a name="ln-353"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">str_in</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-354"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">CK_</span><span class="s1">&#39;u&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-355"></a>                        <span class="n">valid_json_hex</span><span class="p">(</span><span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">)))</span> <span class="k">then</span>
<a name="ln-356"></a><span class="k">                        </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-357"></a>                        <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-358"></a>                        <span class="k">cycle</span>
<a name="ln-359"></a><span class="k">                    end if</span>
<a name="ln-360"></a><span class="k">                end if</span>
<a name="ln-361"></a>
<a name="ln-362"></a><span class="k">                </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a name="ln-363"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-364"></a>
<a name="ln-365"></a>            <span class="k">case</span><span class="p">(</span><span class="n">quotation_mark</span><span class="p">)</span>
<a name="ln-366"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a name="ln-367"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-368"></a>            <span class="k">case</span><span class="p">(</span><span class="n">slash</span><span class="p">)</span>
<a name="ln-369"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">escape_solidus</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-370"></a><span class="k">                    </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a name="ln-371"></a>                    <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-372"></a>                <span class="k">else</span>
<a name="ln-373"></a><span class="k">                    </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-374"></a>                    <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-375"></a>                <span class="k">end if</span>
<a name="ln-376"></a><span class="k">            case</span><span class="p">(</span><span class="n">bspace</span><span class="p">)</span>
<a name="ln-377"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\b&#39;</span>
<a name="ln-378"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-379"></a>            <span class="k">case</span><span class="p">(</span><span class="n">formfeed</span><span class="p">)</span>
<a name="ln-380"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\f&#39;</span>
<a name="ln-381"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-382"></a>            <span class="k">case</span><span class="p">(</span><span class="n">newline</span><span class="p">)</span>
<a name="ln-383"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span>
<a name="ln-384"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-385"></a>            <span class="k">case</span><span class="p">(</span><span class="n">carriage_return</span><span class="p">)</span>
<a name="ln-386"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\r&#39;</span>
<a name="ln-387"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-388"></a>            <span class="k">case</span><span class="p">(</span><span class="n">horizontal_tab</span><span class="p">)</span>
<a name="ln-389"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\t&#39;</span>
<a name="ln-390"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a name="ln-391"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-392"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-393"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-394"></a>            <span class="k">end select</span>
<a name="ln-395"></a>
<a name="ln-396"></a><span class="k">        end do</span>
<a name="ln-397"></a>
<a name="ln-398"></a>        <span class="c">!trim the string if necessary:</span>
<a name="ln-399"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-400"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-401"></a><span class="k">                </span><span class="n">str_out</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-402"></a>            <span class="k">else</span>
<a name="ln-403"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-404"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ipos</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>      <span class="c">!workaround for bug in gfortran 6.1</span>
<a name="ln-405"></a>                <span class="n">str_out</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-406"></a><span class="cp">#else</span>
<a name="ln-407"></a>                <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ipos</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c">!original</span>
<a name="ln-408"></a><span class="cp">#endif</span>
<a name="ln-409"></a>            <span class="k">end if</span>
<a name="ln-410"></a><span class="k">        end if</span>
<a name="ln-411"></a>
<a name="ln-412"></a><span class="k">    else</span>
<a name="ln-413"></a>
<a name="ln-414"></a><span class="k">        </span><span class="n">str_out</span> <span class="o">=</span> <span class="n">str_in</span>
<a name="ln-415"></a>
<a name="ln-416"></a>    <span class="k">end if</span>
<a name="ln-417"></a>
<a name="ln-418"></a><span class="k">    end subroutine </span><span class="n">escape_string</span>
<a name="ln-419"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-420"></a>
<a name="ln-421"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-422"></a><span class="c">!&gt;</span>
<a name="ln-423"></a><span class="c">!  Remove the escape characters from a JSON string and return it.</span>
<a name="ln-424"></a><span class="c">!</span>
<a name="ln-425"></a><span class="c">!  The escaped characters are denoted by the `\` character:</span>
<a name="ln-426"></a><span class="c">!</span>
<a name="ln-427"></a><span class="c">!  * `\&quot;`        - quotation mark</span>
<a name="ln-428"></a><span class="c">!  * `\\`        - reverse solidus</span>
<a name="ln-429"></a><span class="c">!  * `\/`        - solidus</span>
<a name="ln-430"></a><span class="c">!  * `\b`        - backspace</span>
<a name="ln-431"></a><span class="c">!  * `\f`        - formfeed</span>
<a name="ln-432"></a><span class="c">!  * `\n`        - newline (LF)</span>
<a name="ln-433"></a><span class="c">!  * `\r`        - carriage return (CR)</span>
<a name="ln-434"></a><span class="c">!  * `\t`        - horizontal tab</span>
<a name="ln-435"></a><span class="c">!  * `\uXXXX`    - 4 hexadecimal digits</span>
<a name="ln-436"></a>
<a name="ln-437"></a>    <span class="k">subroutine </span><span class="n">unescape_string</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span> <span class="n">str_out</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
<a name="ln-438"></a>
<a name="ln-439"></a>    <span class="k">implicit none</span>
<a name="ln-440"></a>
<a name="ln-441"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">str_in</span>  <span class="c">!! string as stored in a [[json_value]]</span>
<a name="ln-442"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str_out</span> <span class="c">!! decoded string</span>
<a name="ln-443"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">error_message</span> <span class="c">!! will be allocated if there was an error</span>
<a name="ln-444"></a>
<a name="ln-445"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>   <span class="c">!! counter</span>
<a name="ln-446"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span>   <span class="c">!! length of str_in</span>
<a name="ln-447"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">m</span>   <span class="c">!! length of str_out</span>
<a name="ln-448"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>  <span class="c">!! for scanning each character in string</span>
<a name="ln-449"></a>
<a name="ln-450"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-451"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! for GFortran bug workaround</span>
<a name="ln-452"></a><span class="cp">#endif</span>
<a name="ln-453"></a>
<a name="ln-454"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span><span class="n">backslash</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-455"></a>
<a name="ln-456"></a>        <span class="c">!there is at least one escape character, so process this string:</span>
<a name="ln-457"></a>
<a name="ln-458"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_in</span><span class="p">)</span>
<a name="ln-459"></a>        <span class="n">str_out</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="c">!size the output string (will be trimmed later)</span>
<a name="ln-460"></a>        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!counter in str_out</span>
<a name="ln-461"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!counter in str_in</span>
<a name="ln-462"></a>
<a name="ln-463"></a>        <span class="k">do</span>
<a name="ln-464"></a>
<a name="ln-465"></a><span class="k">            </span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-466"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">n</span><span class="p">)</span> <span class="k">exit</span> <span class="c">! finished</span>
<a name="ln-467"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="c">! get next character in the string</span>
<a name="ln-468"></a>
<a name="ln-469"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">backslash</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-470"></a>
<a name="ln-471"></a><span class="k">                if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-472"></a>
<a name="ln-473"></a><span class="k">                    </span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-474"></a>                    <span class="n">c</span> <span class="o">=</span> <span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="c">!character after the escape</span>
<a name="ln-475"></a>
<a name="ln-476"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="p">[</span><span class="n">quotation_mark</span><span class="p">,</span><span class="n">backslash</span><span class="p">,</span><span class="n">slash</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-477"></a>                         <span class="n">to_unicode</span><span class="p">([</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">])]))</span> <span class="k">then</span>
<a name="ln-478"></a>
<a name="ln-479"></a><span class="k">                        select case</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-480"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">quotation_mark</span><span class="p">,</span><span class="n">backslash</span><span class="p">,</span><span class="n">slash</span><span class="p">)</span>
<a name="ln-481"></a>                            <span class="c">!use d as is</span>
<a name="ln-482"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<a name="ln-483"></a>                             <span class="n">c</span> <span class="o">=</span> <span class="n">bspace</span>
<a name="ln-484"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
<a name="ln-485"></a>                             <span class="n">c</span> <span class="o">=</span> <span class="n">formfeed</span>
<a name="ln-486"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<a name="ln-487"></a>                             <span class="n">c</span> <span class="o">=</span> <span class="n">newline</span>
<a name="ln-488"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<a name="ln-489"></a>                             <span class="n">c</span> <span class="o">=</span> <span class="n">carriage_return</span>
<a name="ln-490"></a>                        <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<a name="ln-491"></a>                             <span class="n">c</span> <span class="o">=</span> <span class="n">horizontal_tab</span>
<a name="ln-492"></a>                        <span class="k">end select</span>
<a name="ln-493"></a>
<a name="ln-494"></a><span class="k">                        </span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-495"></a>                        <span class="n">str_out</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-496"></a>
<a name="ln-497"></a>                    <span class="k">else if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="c">!expecting 4 hexadecimal digits after</span>
<a name="ln-498"></a>                                            <span class="c">!the escape character    [\uXXXX]</span>
<a name="ln-499"></a>
<a name="ln-500"></a>                        <span class="c">!for now, we are just returning them as is</span>
<a name="ln-501"></a>                        <span class="c">![not checking to see if it is a valid hex value]</span>
<a name="ln-502"></a>                        <span class="c">!</span>
<a name="ln-503"></a>                        <span class="c">! Example:</span>
<a name="ln-504"></a>                        <span class="c">!   123456</span>
<a name="ln-505"></a>                        <span class="c">!   \uXXXX</span>
<a name="ln-506"></a>
<a name="ln-507"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-508"></a><span class="k">                            </span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-509"></a>                            <span class="n">str_out</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<a name="ln-510"></a>                            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span>
<a name="ln-511"></a>                            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">5</span>
<a name="ln-512"></a>                        <span class="k">else</span>
<a name="ln-513"></a><span class="k">                            </span><span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-514"></a>                                                 <span class="s1">&#39; Invalid hexadecimal sequence&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-515"></a>                                                 <span class="s1">&#39; in string: &#39;</span><span class="o">//</span><span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:)</span>
<a name="ln-516"></a>                            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_out</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a name="ln-517"></a>                            <span class="k">return</span>
<a name="ln-518"></a><span class="k">                        end if</span>
<a name="ln-519"></a>
<a name="ln-520"></a><span class="k">                    else</span>
<a name="ln-521"></a>                        <span class="c">!unknown escape character</span>
<a name="ln-522"></a>                        <span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-523"></a>                                             <span class="s1">&#39; unknown escape sequence in string &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-524"></a>                                             <span class="nb">trim</span><span class="p">(</span><span class="n">str_in</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot; [&#39;</span><span class="o">//</span><span class="n">backslash</span><span class="o">//</span><span class="n">c</span><span class="o">//</span><span class="s1">&#39;]&#39;</span>
<a name="ln-525"></a>                        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_out</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a name="ln-526"></a>                        <span class="k">return</span>
<a name="ln-527"></a><span class="k">                    end if</span>
<a name="ln-528"></a>
<a name="ln-529"></a><span class="k">                else</span>
<a name="ln-530"></a>                    <span class="c">!an escape character is the last character in</span>
<a name="ln-531"></a>                    <span class="c">! the string [this may not be valid syntax,</span>
<a name="ln-532"></a>                    <span class="c">! but just keep it]</span>
<a name="ln-533"></a>                    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-534"></a>                    <span class="n">str_out</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-535"></a>                <span class="k">end if</span>
<a name="ln-536"></a>
<a name="ln-537"></a><span class="k">            else</span>
<a name="ln-538"></a><span class="k">                </span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-539"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-540"></a>            <span class="k">end if</span>
<a name="ln-541"></a>
<a name="ln-542"></a><span class="k">        end do</span>
<a name="ln-543"></a>
<a name="ln-544"></a>        <span class="c">!trim trailing space:</span>
<a name="ln-545"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-546"></a>        <span class="c">! workaround for Gfortran 6.1.0 bug</span>
<a name="ln-547"></a>        <span class="n">tmp</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">)</span>
<a name="ln-548"></a>        <span class="n">str_out</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-549"></a><span class="cp">#else</span>
<a name="ln-550"></a>        <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">)</span>
<a name="ln-551"></a><span class="cp">#endif</span>
<a name="ln-552"></a>
<a name="ln-553"></a>    <span class="k">else</span>
<a name="ln-554"></a>        <span class="c">!there are no escape characters, so return as is:</span>
<a name="ln-555"></a>        <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_in</span>
<a name="ln-556"></a>    <span class="k">end if</span>
<a name="ln-557"></a>
<a name="ln-558"></a><span class="k">    end subroutine </span><span class="n">unescape_string</span>
<a name="ln-559"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-560"></a>
<a name="ln-561"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-562"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-563"></a><span class="c">!  date:6/14/2014</span>
<a name="ln-564"></a><span class="c">!</span>
<a name="ln-565"></a><span class="c">!  Returns true if the string is a valid 4-digit hex string.</span>
<a name="ln-566"></a><span class="c">!</span>
<a name="ln-567"></a><span class="c">!# Examples</span>
<a name="ln-568"></a><span class="c">!```fortran</span>
<a name="ln-569"></a><span class="c">!    valid_json_hex(&#39;0000&#39;)  !returns true</span>
<a name="ln-570"></a><span class="c">!    valid_json_hex(&#39;ABC4&#39;)  !returns true</span>
<a name="ln-571"></a><span class="c">!    valid_json_hex(&#39;AB&#39;)    !returns false (&lt; 4 characters)</span>
<a name="ln-572"></a><span class="c">!    valid_json_hex(&#39;WXYZ&#39;)  !returns false (invalid characters)</span>
<a name="ln-573"></a><span class="c">!```</span>
<a name="ln-574"></a>
<a name="ln-575"></a>    <span class="k">pure function </span><span class="n">valid_json_hex</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
<a name="ln-576"></a>
<a name="ln-577"></a>    <span class="k">implicit none</span>
<a name="ln-578"></a>
<a name="ln-579"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">valid</span>  <span class="c">!! is str a value 4-digit hex string</span>
<a name="ln-580"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! the string to check.</span>
<a name="ln-581"></a>
<a name="ln-582"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>  <span class="c">!! length of `str`</span>
<a name="ln-583"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a name="ln-584"></a>
<a name="ln-585"></a>    <span class="c">!&gt; an array of the valid hex characters</span>
<a name="ln-586"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">valid_chars</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-587"></a>        <span class="p">[</span> <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span><span class="mi">57</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">! decimal digits</span>
<a name="ln-588"></a>          <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span><span class="mi">70</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">! capital A-F</span>
<a name="ln-589"></a>          <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">97</span><span class="p">,</span><span class="mi">102</span><span class="p">)</span> <span class="p">]</span> <span class="c">! lowercase a-f</span>
<a name="ln-590"></a>
<a name="ln-591"></a>    <span class="c">!initialize</span>
<a name="ln-592"></a>    <span class="n">valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-593"></a>
<a name="ln-594"></a>    <span class="c">!check all the characters in the string:</span>
<a name="ln-595"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-596"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-597"></a><span class="k">        do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a name="ln-598"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="n">valid_chars</span><span class="p">))</span> <span class="k">return</span>
<a name="ln-599"></a><span class="k">        end do</span>
<a name="ln-600"></a><span class="k">        </span><span class="n">valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>    <span class="c">!all are in the set, so it is OK</span>
<a name="ln-601"></a>    <span class="k">end if</span>
<a name="ln-602"></a>
<a name="ln-603"></a><span class="k">    end function </span><span class="n">valid_json_hex</span>
<a name="ln-604"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-605"></a>
<a name="ln-606"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-607"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-608"></a><span class="c">!</span>
<a name="ln-609"></a><span class="c">!  Convert string to unicode (CDK to CK).</span>
<a name="ln-610"></a>
<a name="ln-611"></a>    <span class="k">pure function </span><span class="n">to_uni</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-612"></a>
<a name="ln-613"></a>    <span class="k">implicit none</span>
<a name="ln-614"></a>
<a name="ln-615"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-616"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>       <span class="kd">::</span> <span class="n">to_uni</span>
<a name="ln-617"></a>
<a name="ln-618"></a>    <span class="n">to_uni</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-619"></a>
<a name="ln-620"></a>    <span class="k">end function </span><span class="n">to_uni</span>
<a name="ln-621"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-622"></a>
<a name="ln-623"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-624"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-625"></a><span class="c">!</span>
<a name="ln-626"></a><span class="c">!  Convert array of strings to unicode (CDK to CK).</span>
<a name="ln-627"></a><span class="c">!</span>
<a name="ln-628"></a><span class="c">!@note JW: may be able to remove this by making [[to_uni]] PURE ELEMENTAL ?</span>
<a name="ln-629"></a>
<a name="ln-630"></a>    <span class="k">pure function </span><span class="n">to_uni_vec</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-631"></a>
<a name="ln-632"></a>    <span class="k">implicit none</span>
<a name="ln-633"></a>
<a name="ln-634"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">str</span>
<a name="ln-635"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">to_uni_vec</span>
<a name="ln-636"></a>
<a name="ln-637"></a>    <span class="n">to_uni_vec</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-638"></a>
<a name="ln-639"></a>    <span class="k">end function </span><span class="n">to_uni_vec</span>
<a name="ln-640"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-641"></a>
<a name="ln-642"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-643"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-644"></a><span class="c">!</span>
<a name="ln-645"></a><span class="c">!  `CK`//`CDK` operator.</span>
<a name="ln-646"></a>
<a name="ln-647"></a>    <span class="k">pure function </span><span class="n">ucs4_join_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-648"></a>
<a name="ln-649"></a>    <span class="k">implicit none</span>
<a name="ln-650"></a>
<a name="ln-651"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-652"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-653"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">def_str</span><span class="p">)))</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-654"></a>
<a name="ln-655"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">ucs4_str</span><span class="o">//</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span>
<a name="ln-656"></a>
<a name="ln-657"></a>    <span class="k">end function </span><span class="n">ucs4_join_default</span>
<a name="ln-658"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-659"></a>
<a name="ln-660"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-661"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-662"></a><span class="c">!</span>
<a name="ln-663"></a><span class="c">!  `CDK`//`CK` operator.</span>
<a name="ln-664"></a>
<a name="ln-665"></a>    <span class="k">pure function </span><span class="n">default_join_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-666"></a>
<a name="ln-667"></a>    <span class="k">implicit none</span>
<a name="ln-668"></a>
<a name="ln-669"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-670"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-671"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">)))</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-672"></a>
<a name="ln-673"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span><span class="o">//</span><span class="n">ucs4_str</span>
<a name="ln-674"></a>
<a name="ln-675"></a>    <span class="k">end function </span><span class="n">default_join_ucs4</span>
<a name="ln-676"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-677"></a>
<a name="ln-678"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-679"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-680"></a><span class="c">!</span>
<a name="ln-681"></a><span class="c">!  `CK`==`CDK` operator.</span>
<a name="ln-682"></a>
<a name="ln-683"></a>    <span class="k">pure elemental function </span><span class="n">ucs4_comp_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-684"></a>
<a name="ln-685"></a>    <span class="k">implicit none</span>
<a name="ln-686"></a>
<a name="ln-687"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-688"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-689"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-690"></a>
<a name="ln-691"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ucs4_str</span> <span class="o">==</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-692"></a>
<a name="ln-693"></a>    <span class="k">end function </span><span class="n">ucs4_comp_default</span>
<a name="ln-694"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-695"></a>
<a name="ln-696"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-697"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-698"></a><span class="c">!</span>
<a name="ln-699"></a><span class="c">!  `CDK`==`CK` operator.</span>
<a name="ln-700"></a>
<a name="ln-701"></a>    <span class="k">pure elemental function </span><span class="n">default_comp_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-702"></a>
<a name="ln-703"></a>    <span class="k">implicit none</span>
<a name="ln-704"></a>
<a name="ln-705"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-706"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-707"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-708"></a>
<a name="ln-709"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="o">==</span> <span class="n">ucs4_str</span><span class="p">)</span>
<a name="ln-710"></a>
<a name="ln-711"></a>    <span class="k">end function </span><span class="n">default_comp_ucs4</span>
<a name="ln-712"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-713"></a>
<a name="ln-714"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-715"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-716"></a><span class="c">!</span>
<a name="ln-717"></a><span class="c">!  `CK`/=`CDK` operator.</span>
<a name="ln-718"></a>
<a name="ln-719"></a>    <span class="k">pure elemental function </span><span class="n">ucs4_neq_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-720"></a>
<a name="ln-721"></a>    <span class="k">implicit none</span>
<a name="ln-722"></a>
<a name="ln-723"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-724"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-725"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-726"></a>
<a name="ln-727"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ucs4_str</span> <span class="o">/=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-728"></a>
<a name="ln-729"></a>    <span class="k">end function </span><span class="n">ucs4_neq_default</span>
<a name="ln-730"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-731"></a>
<a name="ln-732"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-733"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-734"></a><span class="c">!</span>
<a name="ln-735"></a><span class="c">!  `CDK`/=`CK` operator.</span>
<a name="ln-736"></a>
<a name="ln-737"></a>    <span class="k">pure elemental function </span><span class="n">default_neq_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a name="ln-738"></a>
<a name="ln-739"></a>    <span class="k">implicit none</span>
<a name="ln-740"></a>
<a name="ln-741"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a name="ln-742"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a name="ln-743"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a name="ln-744"></a>
<a name="ln-745"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="o">/=</span> <span class="n">ucs4_str</span><span class="p">)</span>
<a name="ln-746"></a>
<a name="ln-747"></a>    <span class="k">end function </span><span class="n">default_neq_ucs4</span>
<a name="ln-748"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-749"></a>
<a name="ln-750"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-751"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-752"></a><span class="c">!</span>
<a name="ln-753"></a><span class="c">!  Returns lowercase version of the `CK` string.</span>
<a name="ln-754"></a>
<a name="ln-755"></a>    <span class="k">pure elemental function </span><span class="n">lowercase_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">s_lower</span><span class="p">)</span>
<a name="ln-756"></a>
<a name="ln-757"></a>    <span class="k">implicit none</span>
<a name="ln-758"></a>
<a name="ln-759"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>      <span class="c">!! input string</span>
<a name="ln-760"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)))</span>   <span class="kd">::</span> <span class="n">s_lower</span>  <span class="c">!! lowercase version of the string</span>
<a name="ln-761"></a>
<a name="ln-762"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a name="ln-763"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">j</span>  <span class="c">!! index of uppercase character</span>
<a name="ln-764"></a>
<a name="ln-765"></a>    <span class="n">s_lower</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-766"></a>
<a name="ln-767"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-768"></a>        <span class="n">j</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span><span class="n">s_lower</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">))</span>
<a name="ln-769"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">s_lower</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span>
<a name="ln-770"></a>    <span class="k">end do</span>
<a name="ln-771"></a>
<a name="ln-772"></a><span class="k">    end function </span><span class="n">lowercase_string</span>
<a name="ln-773"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-774"></a>
<a name="ln-775"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-776"></a><span class="c">!&gt;</span>
<a name="ln-777"></a><span class="c">!  Replace all occurrences of `s1` in `str` with `s2`.</span>
<a name="ln-778"></a><span class="c">!</span>
<a name="ln-779"></a><span class="c">!  A case-sensitive match is used.</span>
<a name="ln-780"></a><span class="c">!</span>
<a name="ln-781"></a><span class="c">!@note `str` must be allocated.</span>
<a name="ln-782"></a>
<a name="ln-783"></a>    <span class="k">pure subroutine </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span>
<a name="ln-784"></a>
<a name="ln-785"></a>    <span class="k">implicit none</span>
<a name="ln-786"></a>
<a name="ln-787"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-788"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s1</span>
<a name="ln-789"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s2</span>
<a name="ln-790"></a>
<a name="ln-791"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! temporary string for accumulating result</span>
<a name="ln-792"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>      <span class="c">!! counter</span>
<a name="ln-793"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>      <span class="c">!! for accumulating the string</span>
<a name="ln-794"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen</span>   <span class="c">!! length of `str` string</span>
<a name="ln-795"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen1</span>  <span class="c">!! length of `s1` string</span>
<a name="ln-796"></a>
<a name="ln-797"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-798"></a>
<a name="ln-799"></a><span class="k">        </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>  <span class="c">! initialize</span>
<a name="ln-800"></a>        <span class="n">ilen1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<a name="ln-801"></a>
<a name="ln-802"></a>        <span class="c">!     .</span>
<a name="ln-803"></a>        <span class="c">! &#39;123ab789&#39;</span>
<a name="ln-804"></a>
<a name="ln-805"></a>        <span class="k">do</span>
<a name="ln-806"></a><span class="k">            </span><span class="n">ilen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-807"></a>            <span class="n">i</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span>
<a name="ln-808"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-809"></a><span class="k">                if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">str</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-810"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">s2</span> <span class="c">! replace s1 with s2 in new string</span>
<a name="ln-811"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">ilen1</span>   <span class="c">! start of remainder of str to keep</span>
<a name="ln-812"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="n">ilen</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-813"></a><span class="k">                    </span><span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-814"></a>                <span class="k">else</span>
<a name="ln-815"></a>                    <span class="c">! done</span>
<a name="ln-816"></a>                    <span class="k">exit</span>
<a name="ln-817"></a><span class="k">                end if</span>
<a name="ln-818"></a><span class="k">            else</span>
<a name="ln-819"></a>                <span class="c">! done: get remainder of string</span>
<a name="ln-820"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">str</span>
<a name="ln-821"></a>                <span class="k">exit</span>
<a name="ln-822"></a><span class="k">            end if</span>
<a name="ln-823"></a><span class="k">        end do</span>
<a name="ln-824"></a>
<a name="ln-825"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-826"></a>
<a name="ln-827"></a>    <span class="k">end if</span>
<a name="ln-828"></a>
<a name="ln-829"></a><span class="k">    end subroutine </span><span class="n">replace_string</span>
<a name="ln-830"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-831"></a>
<a name="ln-832"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-833"></a><span class="c">!&gt;</span>
<a name="ln-834"></a><span class="c">!  Decode a string from the &quot;JSON Pointer&quot; RFC 6901 format.</span>
<a name="ln-835"></a><span class="c">!</span>
<a name="ln-836"></a><span class="c">!  It replaces `~1` with `/` and `~0` with `~`.</span>
<a name="ln-837"></a>
<a name="ln-838"></a>    <span class="k">pure function </span><span class="n">decode_rfc6901</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a name="ln-839"></a>
<a name="ln-840"></a>    <span class="k">implicit none</span>
<a name="ln-841"></a>
<a name="ln-842"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-843"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_out</span>
<a name="ln-844"></a>
<a name="ln-845"></a>    <span class="n">str_out</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-846"></a>
<a name="ln-847"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">slash</span><span class="p">)</span>
<a name="ln-848"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">tilde</span><span class="p">)</span>
<a name="ln-849"></a>
<a name="ln-850"></a>    <span class="k">end function </span><span class="n">decode_rfc6901</span>
<a name="ln-851"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-852"></a>
<a name="ln-853"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-854"></a><span class="c">!&gt;</span>
<a name="ln-855"></a><span class="c">!  Encode a string into the &quot;JSON Pointer&quot; RFC 6901 format.</span>
<a name="ln-856"></a><span class="c">!</span>
<a name="ln-857"></a><span class="c">!  It replaces `~` with `~0` and `/` with `~1`.</span>
<a name="ln-858"></a>
<a name="ln-859"></a>    <span class="k">pure function </span><span class="n">encode_rfc6901</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a name="ln-860"></a>
<a name="ln-861"></a>    <span class="k">implicit none</span>
<a name="ln-862"></a>
<a name="ln-863"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-864"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_out</span>
<a name="ln-865"></a>
<a name="ln-866"></a>    <span class="n">str_out</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-867"></a>
<a name="ln-868"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<a name="ln-869"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">slash</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<a name="ln-870"></a>
<a name="ln-871"></a>    <span class="k">end function </span><span class="n">encode_rfc6901</span>
<a name="ln-872"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-873"></a>
<a name="ln-874"></a>    <span class="k">end module </span><span class="n">json_string_utilities</span>
<a name="ln-875"></a><span class="c">!*****************************************************************************************</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/json_file_module.f90.html">json_file_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_kinds.f90.html">json_kinds.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_module.f90.html">json_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_parameters.f90.html">json_parameters.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html">json_string_utilities.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_value_module.f90.html">json_value_module.F90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2018-06-24 04:27  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> JSON-Fortran was developed by Jacob Williams</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>