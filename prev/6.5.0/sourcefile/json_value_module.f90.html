<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="JSON-Fortran â€“ A Fortran 2008 JSON API">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>json_value_module.F90 &ndash; JSON-Fortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">JSON-Fortran <small>6.5.0</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>json_value_module.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title="79.1% of total for source files.">5005 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/json_value_module.F90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">json_value_module.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_value_module.html">json_value_module</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_value_module.f90.html#src">json_value_module.F90</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-0">All Source Files</a></h3></div>
  <div id="allfiles-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/json_file_module.f90.html">json_file_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_kinds.f90.html">json_kinds.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_module.f90.html">json_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_parameters.f90.html">json_parameters.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html">json_string_utilities.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_value_module.f90.html">json_value_module.F90</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    <div class="col-md-9" id='text'>
    
    
    <h3>This File Depends On</h3>
    
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~json_value_module.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilejson_value_modulef90EfferentGraph" width="570pt" height="74pt"
 viewBox="0.00 0.00 570.00 73.78" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_value_module.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 69.7847)">
<title>sourcefile~~json_value_module.f90~~EfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-69.7847 566,-69.7847 566,4 -4,4"/>
<!-- sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_node1" class="node"><title>sourcefile~json_value_module.f90</title>
<polygon fill="none" stroke="black" points="561.5,-57.7513 434.5,-57.7513 434.5,-33.7513 561.5,-33.7513 561.5,-57.7513"/>
<text text-anchor="middle" x="498" y="-43.3513" font-family="Helvetica,sans-Serif" font-size="10.50">json_value_module.F90</text>
</g>
<!-- sourcefile~json_kinds.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_node2" class="node"><title>sourcefile~json_kinds.f90</title>
<g id="a_sourcefile~~json_value_module.f90~~EfferentGraph_node2"><a xlink:href="../sourcefile/json_kinds.f90.html" xlink:title="json_kinds.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="85.5,-37.7513 0.5,-37.7513 0.5,-13.7513 85.5,-13.7513 85.5,-37.7513"/>
<text text-anchor="middle" x="43" y="-23.3513" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_kinds.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge4" class="edge"><title>sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M83.3797,-37.7832C95.6509,-41.1451 109.297,-44.4925 122,-46.7513 215.575,-63.3908 239.958,-65.5292 335,-65.7513"/>
</g>
<!-- sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_node3" class="node"><title>sourcefile~json_parameters.f90</title>
<g id="a_sourcefile~~json_value_module.f90~~EfferentGraph_node3"><a xlink:href="../sourcefile/json_parameters.f90.html" xlink:title="json_parameters.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="237.5,-37.7513 122.5,-37.7513 122.5,-13.7513 237.5,-13.7513 237.5,-37.7513"/>
<text text-anchor="middle" x="180" y="-23.3513" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_parameters.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge1" class="edge"><title>sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_parameters.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M85.606,-25.7513C94.0494,-25.7513 103.13,-25.7513 112.194,-25.7513"/>
<polygon fill="#00ff00" stroke="#00ff00" points="112.385,-29.2514 122.385,-25.7513 112.385,-22.2514 112.385,-29.2514"/>
</g>
<!-- sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_node4" class="node"><title>sourcefile~json_string_utilities.f90</title>
<g id="a_sourcefile~~json_value_module.f90~~EfferentGraph_node4"><a xlink:href="../sourcefile/json_string_utilities.f90.html" xlink:title="json_string_utilities.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="398,-37.7513 274,-37.7513 274,-13.7513 398,-13.7513 398,-37.7513"/>
<text text-anchor="middle" x="336" y="-23.3513" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_string_utilities.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge2" class="edge"><title>sourcefile~json_kinds.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M80.8901,-13.6868C93.7514,-10.0532 108.375,-6.55335 122,-4.75133 173.11,2.00857 186.737,0.734202 238,-4.75133 251.379,-6.18304 265.623,-8.69547 278.957,-11.496"/>
<polygon fill="#0000ff" stroke="#0000ff" points="278.431,-14.9636 288.948,-13.6807 279.927,-8.12521 278.431,-14.9636"/>
</g>
<!-- sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge5" class="edge"><title>sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M209.659,-37.8192C240.16,-49.5576 290.112,-65.6464 335,-65.7513"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M337,-65.7513C365.546,-65.8181 396.737,-62.6583 423.937,-58.8318"/>
<polygon fill="#ff0000" stroke="#ff0000" points="424.764,-62.2482 434.153,-57.338 423.751,-55.3219 424.764,-62.2482"/>
</g>
<!-- sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge3" class="edge"><title>sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M237.906,-25.7513C246.343,-25.7513 255.126,-25.7513 263.81,-25.7513"/>
<polygon fill="#0000ff" stroke="#0000ff" points="263.932,-29.2514 273.932,-25.7513 263.932,-22.2514 263.932,-29.2514"/>
</g>
<!-- sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~EfferentGraph_edge6" class="edge"><title>sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M398.403,-33.4267C406.89,-34.4876 415.674,-35.5855 424.341,-36.669"/>
<polygon fill="#ff0000" stroke="#ff0000" points="424.081,-40.1636 434.438,-37.9311 424.949,-33.2177 424.081,-40.1636"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
    
      
      <h3>Files Dependent On This One</h3>
      
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: sourcefile~~json_value_module.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilejson_value_modulef90AfferentGraph" width="420pt" height="52pt"
 viewBox="0.00 0.00 420.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_value_module.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~json_value_module.f90~~AfferentGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-48 416,-48 416,4 -4,4"/>
<!-- sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_node1" class="node"><title>sourcefile~json_value_module.f90</title>
<polygon fill="none" stroke="black" points="127.5,-44 0.5,-44 0.5,-20 127.5,-20 127.5,-44"/>
<text text-anchor="middle" x="64" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">json_value_module.F90</text>
</g>
<!-- sourcefile~json_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_node2" class="node"><title>sourcefile~json_module.f90</title>
<g id="a_sourcefile~~json_value_module.f90~~AfferentGraph_node2"><a xlink:href="../sourcefile/json_module.f90.html" xlink:title="json_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="411.5,-44 316.5,-44 316.5,-20 411.5,-20 411.5,-44"/>
<text text-anchor="middle" x="364" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_edge2" class="edge"><title>sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M127.581,-32.7278C139.665,-32.8413 152.226,-32.9405 164,-33 215.555,-33.2604 228.445,-33.3106 280,-33 288.493,-32.9488 297.475,-32.8682 306.27,-32.7744"/>
<polygon fill="#ff0000" stroke="#ff0000" points="306.509,-36.2721 316.469,-32.6593 306.43,-29.2725 306.509,-36.2721"/>
</g>
<!-- sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_node3" class="node"><title>sourcefile~json_file_module.f90</title>
<g id="a_sourcefile~~json_value_module.f90~~AfferentGraph_node3"><a xlink:href="../sourcefile/json_file_module.f90.html" xlink:title="json_file_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="279.5,-24 164.5,-24 164.5,-0 279.5,-0 279.5,-24"/>
<text text-anchor="middle" x="222" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_file_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_edge3" class="edge"><title>sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_file_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M127.552,-23.9805C136.421,-22.8435 145.567,-21.6709 154.507,-20.5247"/>
<polygon fill="#ff0000" stroke="#ff0000" points="155.014,-23.9885 164.487,-19.2452 154.124,-17.0453 155.014,-23.9885"/>
</g>
<!-- sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_module.f90 -->
<g id="sourcefile~~json_value_module.f90~~AfferentGraph_edge1" class="edge"><title>sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_module.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M279.54,-20.0771C288.267,-21.3239 297.284,-22.6121 306.021,-23.8602"/>
<polygon fill="#00ffff" stroke="#00ffff" points="305.72,-27.3526 316.114,-25.302 306.71,-20.4229 305.72,-27.3526"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="189pt" height="32pt"
 viewBox="0.00 0.00 189.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 185,-28 185,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node"><title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66.25,-24 -0.25,-24 -0.25,-0 66.25,-0 66.25,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="181.25,-24 84.75,-24 84.75,-0 181.25,-0 181.25,-24"/>
<text text-anchor="middle" x="133" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which depends upon it. A file 
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_value_module.html">json_value_module</a>
      
    </div>
  </div>
</div>















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_value_module.f90.html#src">json_value_module.F90</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-3"></a><span class="c">!  license: BSD</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">!  This module provides a low-level interface for manipulation of JSON data.</span>
<a name="ln-6"></a><span class="c">!  The two public entities are [[json_value]], and [[json_core(type)]].</span>
<a name="ln-7"></a><span class="c">!  The [[json_file_module]] provides a higher-level interface to some</span>
<a name="ln-8"></a><span class="c">!  of these routines.</span>
<a name="ln-9"></a><span class="c">!</span>
<a name="ln-10"></a><span class="c">!## License</span>
<a name="ln-11"></a><span class="c">!  * JSON-Fortran is released under a BSD-style license.</span>
<a name="ln-12"></a><span class="c">!    See the [LICENSE](https://github.com/jacobwilliams/json-fortran/blob/master/LICENSE)</span>
<a name="ln-13"></a><span class="c">!    file for details.</span>
<a name="ln-14"></a>
<a name="ln-15"></a>    <span class="k">module </span><span class="n">json_value_module</span>
<a name="ln-16"></a>
<a name="ln-17"></a>    <span class="k">use</span><span class="p">,</span><span class="k">intrinsic</span> <span class="kd">::</span> <span class="n">iso_fortran_env</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">iostat_end</span><span class="p">,</span><span class="n">error_unit</span><span class="p">,</span><span class="n">output_unit</span>
<a name="ln-18"></a>    <span class="k">use </span><span class="n">json_kinds</span>
<a name="ln-19"></a>    <span class="k">use </span><span class="n">json_parameters</span>
<a name="ln-20"></a>    <span class="k">use </span><span class="n">json_string_utilities</span>
<a name="ln-21"></a>
<a name="ln-22"></a>    <span class="k">implicit none</span>
<a name="ln-23"></a>
<a name="ln-24"></a><span class="k">    private</span>
<a name="ln-25"></a>
<a name="ln-26"></a><span class="cp">#include &quot;json_macros.inc&quot;</span>
<a name="ln-27"></a>
<a name="ln-28"></a>    <span class="c">!*********************************************************</span>
<a name="ln-29"></a>    <span class="c">!&gt;</span>
<a name="ln-30"></a>    <span class="c">!  If Unicode is not enabled, then</span>
<a name="ln-31"></a>    <span class="c">!  JSON files are opened using access=&#39;STREAM&#39; and</span>
<a name="ln-32"></a>    <span class="c">!  form=&#39;UNFORMATTED&#39;.  This allows the file to</span>
<a name="ln-33"></a>    <span class="c">!  be read faster.</span>
<a name="ln-34"></a>    <span class="c">!</span>
<a name="ln-35"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-36"></a>    <span class="kt">logical</span><span class="p">,</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">use_unformatted_stream</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-37"></a><span class="cp">#else</span>
<a name="ln-38"></a>    <span class="kt">logical</span><span class="p">,</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">use_unformatted_stream</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-39"></a><span class="cp">#endif</span>
<a name="ln-40"></a>    <span class="c">!*********************************************************</span>
<a name="ln-41"></a>
<a name="ln-42"></a>    <span class="c">!*********************************************************</span>
<a name="ln-43"></a>    <span class="c">!&gt;</span>
<a name="ln-44"></a>    <span class="c">!  If Unicode is not enabled, then</span>
<a name="ln-45"></a>    <span class="c">!  JSON files are opened using access=&#39;STREAM&#39; and</span>
<a name="ln-46"></a>    <span class="c">!  form=&#39;UNFORMATTED&#39;.  This allows the file to</span>
<a name="ln-47"></a>    <span class="c">!  be read faster.</span>
<a name="ln-48"></a>    <span class="c">!</span>
<a name="ln-49"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-50"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">access_spec</span> <span class="o">=</span> <span class="s1">&#39;SEQUENTIAL&#39;</span>
<a name="ln-51"></a><span class="cp">#else</span>
<a name="ln-52"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">access_spec</span> <span class="o">=</span> <span class="s1">&#39;STREAM&#39;</span>
<a name="ln-53"></a><span class="cp">#endif</span>
<a name="ln-54"></a>    <span class="c">!*********************************************************</span>
<a name="ln-55"></a>
<a name="ln-56"></a>    <span class="c">!*********************************************************</span>
<a name="ln-57"></a>    <span class="c">!&gt;</span>
<a name="ln-58"></a>    <span class="c">!  If Unicode is not enabled, then</span>
<a name="ln-59"></a>    <span class="c">!  JSON files are opened using access=&#39;STREAM&#39; and</span>
<a name="ln-60"></a>    <span class="c">!  form=&#39;UNFORMATTED&#39;.  This allows the file to</span>
<a name="ln-61"></a>    <span class="c">!  be read faster.</span>
<a name="ln-62"></a>    <span class="c">!</span>
<a name="ln-63"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-64"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">form_spec</span>   <span class="o">=</span> <span class="s1">&#39;FORMATTED&#39;</span>
<a name="ln-65"></a><span class="cp">#else</span>
<a name="ln-66"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">form_spec</span>   <span class="o">=</span> <span class="s1">&#39;UNFORMATTED&#39;</span>
<a name="ln-67"></a><span class="cp">#endif</span>
<a name="ln-68"></a>    <span class="c">!*********************************************************</span>
<a name="ln-69"></a>
<a name="ln-70"></a>    <span class="c">!*********************************************************</span>
<a name="ln-71"></a>    <span class="c">!&gt;</span>
<a name="ln-72"></a>    <span class="c">!  Type used to construct the linked-list JSON structure.</span>
<a name="ln-73"></a>    <span class="c">!  Normally, this should always be a pointer variable.</span>
<a name="ln-74"></a>    <span class="c">!  This type should only be used by an instance of [[json_core(type)]].</span>
<a name="ln-75"></a>    <span class="c">!</span>
<a name="ln-76"></a>    <span class="c">!### Example</span>
<a name="ln-77"></a>    <span class="c">!</span>
<a name="ln-78"></a>    <span class="c">!  The following test program:</span>
<a name="ln-79"></a>    <span class="c">!</span>
<a name="ln-80"></a>    <span class="c">!````fortran</span>
<a name="ln-81"></a>    <span class="c">!    program test</span>
<a name="ln-82"></a>    <span class="c">!     use json_module</span>
<a name="ln-83"></a>    <span class="c">!     implicit none</span>
<a name="ln-84"></a>    <span class="c">!     type(json_core) :: json</span>
<a name="ln-85"></a>    <span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-86"></a>    <span class="c">!     call json%create_object(p,&#39;&#39;)   !create the root</span>
<a name="ln-87"></a>    <span class="c">!     call json%add(p,&#39;year&#39;,1805)    !add some data</span>
<a name="ln-88"></a>    <span class="c">!     call json%add(p,&#39;value&#39;,1.0_RK) !add some data</span>
<a name="ln-89"></a>    <span class="c">!     call json%print(p,&#39;test.json&#39;)  !write it to a file</span>
<a name="ln-90"></a>    <span class="c">!     call json%destroy(p)            !cleanup</span>
<a name="ln-91"></a>    <span class="c">!    end program test</span>
<a name="ln-92"></a>    <span class="c">!````</span>
<a name="ln-93"></a>    <span class="c">!</span>
<a name="ln-94"></a>    <span class="c">!  Produces the JSON file **test.json**:</span>
<a name="ln-95"></a>    <span class="c">!</span>
<a name="ln-96"></a>    <span class="c">!````json</span>
<a name="ln-97"></a>    <span class="c">!    {</span>
<a name="ln-98"></a>    <span class="c">!      &quot;year&quot;: 1805,</span>
<a name="ln-99"></a>    <span class="c">!      &quot;value&quot;: 0.1E+1</span>
<a name="ln-100"></a>    <span class="c">!    }</span>
<a name="ln-101"></a>    <span class="c">!````</span>
<a name="ln-102"></a>    <span class="k">type</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">json_value</span>
<a name="ln-103"></a>
<a name="ln-104"></a>        <span class="c">!force the constituents to be stored contiguously</span>
<a name="ln-105"></a>        <span class="c">![note: on Intel, the order of the variables below</span>
<a name="ln-106"></a>        <span class="c">! is significant to avoid the misaligned field warnings]</span>
<a name="ln-107"></a>        <span class="k">sequence</span>
<a name="ln-108"></a>
<a name="ln-109"></a><span class="k">        private</span>
<a name="ln-110"></a>
<a name="ln-111"></a>        <span class="c">!for the linked list:</span>
<a name="ln-112"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">previous</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!! previous item in the list</span>
<a name="ln-113"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">next</span>     <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!! next item in the list</span>
<a name="ln-114"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">parent</span>   <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!! parent item of this</span>
<a name="ln-115"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">children</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!! first child item of this</span>
<a name="ln-116"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tail</span>     <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!! last child item of this</span>
<a name="ln-117"></a>
<a name="ln-118"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name (unescaped)</span>
<a name="ln-119"></a>
<a name="ln-120"></a>        <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">allocatable</span>                 <span class="kd">::</span> <span class="n">dbl_value</span>  <span class="c">!! real data for this variable</span>
<a name="ln-121"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">allocatable</span>              <span class="kd">::</span> <span class="n">log_value</span>  <span class="c">!! logical data for this variable</span>
<a name="ln-122"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_value</span>  <span class="c">!! string data for this variable</span>
<a name="ln-123"></a>                                                           <span class="c">!! (unescaped)</span>
<a name="ln-124"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">allocatable</span>              <span class="kd">::</span> <span class="n">int_value</span>  <span class="c">!! integer data for this variable</span>
<a name="ln-125"></a>
<a name="ln-126"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span> <span class="o">=</span> <span class="n">json_unknown</span>  <span class="c">!! variable type</span>
<a name="ln-127"></a>
<a name="ln-128"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">private</span> <span class="kd">::</span> <span class="n">n_children</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c">!! number of children</span>
<a name="ln-129"></a>
<a name="ln-130"></a>    <span class="k">end type </span><span class="n">json_value</span>
<a name="ln-131"></a>    <span class="c">!*********************************************************</span>
<a name="ln-132"></a>
<a name="ln-133"></a>    <span class="c">!*********************************************************</span>
<a name="ln-134"></a>    <span class="c">!&gt;</span>
<a name="ln-135"></a>    <span class="c">!  To access the core routines for manipulation</span>
<a name="ln-136"></a>    <span class="c">!  of [[json_value]] pointer variables. This class allows</span>
<a name="ln-137"></a>    <span class="c">!  for thread safe use of the module.</span>
<a name="ln-138"></a>    <span class="c">!</span>
<a name="ln-139"></a>    <span class="c">!### Usage</span>
<a name="ln-140"></a>    <span class="c">!````fortran</span>
<a name="ln-141"></a>    <span class="c">!    program test</span>
<a name="ln-142"></a>    <span class="c">!     use json_module</span>
<a name="ln-143"></a>    <span class="c">!     implicit none</span>
<a name="ln-144"></a>    <span class="c">!     type(json_core) :: json     !&lt;--have to declare this</span>
<a name="ln-145"></a>    <span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-146"></a>    <span class="c">!     call json%create_object(p,&#39;&#39;)   !create the root</span>
<a name="ln-147"></a>    <span class="c">!     call json%add(p,&#39;year&#39;,1805)    !add some data</span>
<a name="ln-148"></a>    <span class="c">!     call json%add(p,&#39;value&#39;,1.0_RK) !add some data</span>
<a name="ln-149"></a>    <span class="c">!     call json%print(p,&#39;test.json&#39;)  !write it to a file</span>
<a name="ln-150"></a>    <span class="c">!     call json%destroy(p)            !cleanup</span>
<a name="ln-151"></a>    <span class="c">!    end program test</span>
<a name="ln-152"></a>    <span class="c">!````</span>
<a name="ln-153"></a>    <span class="k">type</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">json_core</span>
<a name="ln-154"></a>
<a name="ln-155"></a>        <span class="k">private</span>
<a name="ln-156"></a>
<a name="ln-157"></a><span class="k">        </span><span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">spaces_per_tab</span> <span class="o">=</span> <span class="mi">2</span>    <span class="c">!! number of spaces for indenting</span>
<a name="ln-158"></a>
<a name="ln-159"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compact_real</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!! to use the &quot;compact&quot; form of real</span>
<a name="ln-160"></a>                                              <span class="c">!! numbers for output</span>
<a name="ln-161"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">real_fmt</span>   <span class="c">!! the format string to use</span>
<a name="ln-162"></a>                                                            <span class="c">!! for converting real numbers to strings.</span>
<a name="ln-163"></a>                                                            <span class="c">!! It can be set in [[json_initialize]],</span>
<a name="ln-164"></a>                                                            <span class="c">!! and used in [[json_value_print]]</span>
<a name="ln-165"></a>                                                            <span class="c">!! If not set, then `default_real_fmt`</span>
<a name="ln-166"></a>                                                            <span class="c">!! is used instead.</span>
<a name="ln-167"></a>
<a name="ln-168"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">is_verbose</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>        <span class="c">!! if true, all exceptions are</span>
<a name="ln-169"></a>                                                   <span class="c">!! immediately printed to console.</span>
<a name="ln-170"></a>
<a name="ln-171"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">stop_on_error</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>    <span class="c">!! if true, then the program is</span>
<a name="ln-172"></a>                                                   <span class="c">!! stopped immediately when an</span>
<a name="ln-173"></a>                                                   <span class="c">!! exception is raised.</span>
<a name="ln-174"></a>
<a name="ln-175"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">exception_thrown</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>  <span class="c">!! The error flag. Will be set to true</span>
<a name="ln-176"></a>                                                   <span class="c">!! when an error is thrown in the class.</span>
<a name="ln-177"></a>                                                   <span class="c">!! Many of the methods will check this</span>
<a name="ln-178"></a>                                                   <span class="c">!! and return immediately if it is true.</span>
<a name="ln-179"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">err_message</span> <span class="c">!! the error message</span>
<a name="ln-180"></a>
<a name="ln-181"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">char_count</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c">!! character position in the current line</span>
<a name="ln-182"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line_count</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c">!! lines read counter</span>
<a name="ln-183"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pushed_index</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!! used when parsing lines in file</span>
<a name="ln-184"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">pushed_char_size</span><span class="p">)</span> <span class="kd">::</span> <span class="n">pushed_char</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>  <span class="c">!! used when parsing</span>
<a name="ln-185"></a>                                                                        <span class="c">!! lines in file</span>
<a name="ln-186"></a>
<a name="ln-187"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipos</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c">!! for allocatable strings: next character to read</span>
<a name="ln-188"></a>
<a name="ln-189"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">strict_type_checking</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!! if true, then no type conversions are done</span>
<a name="ln-190"></a>                                                      <span class="c">!! in the `get` routines if the actual variable</span>
<a name="ln-191"></a>                                                      <span class="c">!! type is different from the return type (for</span>
<a name="ln-192"></a>                                                      <span class="c">!! example, integer to double).</span>
<a name="ln-193"></a>
<a name="ln-194"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">trailing_spaces_significant</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>    <span class="c">!! for name and path comparisons, if trailing</span>
<a name="ln-195"></a>                                                                <span class="c">!! space is to be considered significant.</span>
<a name="ln-196"></a>
<a name="ln-197"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">case_sensitive_keys</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>    <span class="c">!! if name and path comparisons</span>
<a name="ln-198"></a>                                                       <span class="c">!! are case sensitive.</span>
<a name="ln-199"></a>
<a name="ln-200"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">no_whitespace</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!! when printing a JSON string, don&#39;t include</span>
<a name="ln-201"></a>                                               <span class="c">!! non-significant spaces or line breaks.</span>
<a name="ln-202"></a>                                               <span class="c">!! If true, the entire structure will be</span>
<a name="ln-203"></a>                                               <span class="c">!! printed on one line.</span>
<a name="ln-204"></a>
<a name="ln-205"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">unescaped_strings</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!! If false, then the escaped</span>
<a name="ln-206"></a>                                                   <span class="c">!! string is returned from [[json_get_string]]</span>
<a name="ln-207"></a>                                                   <span class="c">!! and similar routines. If true [default],</span>
<a name="ln-208"></a>                                                   <span class="c">!! then the string is returned unescaped.</span>
<a name="ln-209"></a>
<a name="ln-210"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">allow_comments</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!! if true, any comments will be ignored when</span>
<a name="ln-211"></a>                                                <span class="c">!! parsing a file. The comment token is defined</span>
<a name="ln-212"></a>                                                <span class="c">!! by the `comment_char` character variable.</span>
<a name="ln-213"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">comment_char</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;!&#39;</span>  <span class="c">!! comment token when</span>
<a name="ln-214"></a>                                                           <span class="c">!! `allow_comments` is true.</span>
<a name="ln-215"></a>                                                           <span class="c">!! Examples: &#39;`!`&#39; or &#39;`#`&#39;.</span>
<a name="ln-216"></a>
<a name="ln-217"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path_mode</span> <span class="o">=</span> <span class="mi">1_IK</span>  <span class="c">!! How the path strings are interpreted in the</span>
<a name="ln-218"></a>                                         <span class="c">!! `get_by_path` routines:</span>
<a name="ln-219"></a>                                         <span class="c">!!</span>
<a name="ln-220"></a>                                         <span class="c">!! * 1 -- Default mode (see [[json_get_by_path_default]])</span>
<a name="ln-221"></a>                                         <span class="c">!! * 2 -- as RFC 6901 &quot;JSON Pointer&quot; paths</span>
<a name="ln-222"></a>                                         <span class="c">!!   (see [[json_get_by_path_rfc6901]])</span>
<a name="ln-223"></a>                                         <span class="c">!! * 3 -- JSONPath &quot;bracket-notation&quot;</span>
<a name="ln-224"></a>                                         <span class="c">!!   see [[json_get_by_path_jsonpath_bracket]])</span>
<a name="ln-225"></a>
<a name="ln-226"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path_separator</span> <span class="o">=</span> <span class="n">dot</span> <span class="c">!! The `path` separator to use</span>
<a name="ln-227"></a>                                                         <span class="c">!! in the &quot;default&quot; mode for</span>
<a name="ln-228"></a>                                                         <span class="c">!! the paths in the various</span>
<a name="ln-229"></a>                                                         <span class="c">!! `get_by_path` routines.</span>
<a name="ln-230"></a>                                                         <span class="c">!! Note: if `path_mode/=1`</span>
<a name="ln-231"></a>                                                         <span class="c">!! then this is ignored.</span>
<a name="ln-232"></a>
<a name="ln-233"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">compress_vectors</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!! If true, then arrays of integers,</span>
<a name="ln-234"></a>                                                  <span class="c">!! nulls, doubles, &amp; logicals are</span>
<a name="ln-235"></a>                                                  <span class="c">!! printed all on one line.</span>
<a name="ln-236"></a>                                                  <span class="c">!! [Note: `no_whitespace` will</span>
<a name="ln-237"></a>                                                  <span class="c">!! override this option if necessary]</span>
<a name="ln-238"></a>
<a name="ln-239"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">allow_duplicate_keys</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span> <span class="c">!! If False, then after parsing, if any</span>
<a name="ln-240"></a>                                                     <span class="c">!! duplicate keys are found, an error is</span>
<a name="ln-241"></a>                                                     <span class="c">!! thrown. A call to [[json_value_validate]]</span>
<a name="ln-242"></a>                                                     <span class="c">!! will also check for duplicates. If True</span>
<a name="ln-243"></a>                                                     <span class="c">!! [default] then no special checks are done</span>
<a name="ln-244"></a>
<a name="ln-245"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">escape_solidus</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>   <span class="c">!! If True then the solidus &quot;`/`&quot; is always escaped</span>
<a name="ln-246"></a>                                                  <span class="c">!! (&quot;`\/`&quot;) when serializing JSON.</span>
<a name="ln-247"></a>                                                  <span class="c">!! If False [default], then it is not escaped.</span>
<a name="ln-248"></a>                                                  <span class="c">!! Note that this option does not affect parsing</span>
<a name="ln-249"></a>                                                  <span class="c">!! (both escaped and unescaped versions are still</span>
<a name="ln-250"></a>                                                  <span class="c">!! valid in all cases).</span>
<a name="ln-251"></a>
<a name="ln-252"></a>        <span class="k">contains</span>
<a name="ln-253"></a>
<a name="ln-254"></a><span class="k">        private</span>
<a name="ln-255"></a>
<a name="ln-256"></a>        <span class="c">!&gt;</span>
<a name="ln-257"></a>        <span class="c">!  Return a child of a [[json_value]] structure.</span>
<a name="ln-258"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_child</span> <span class="o">=&gt;</span> <span class="n">json_value_get_child_by_index</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-259"></a>                                       <span class="n">json_value_get_child</span><span class="p">,&amp;</span>
<a name="ln-260"></a>                                       <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_get_child_by_name</span><span class="p">)</span>
<a name="ln-261"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_get_child_by_index</span>
<a name="ln-262"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_get_child_by_name</span><span class="p">)</span>
<a name="ln-263"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_get_child</span>
<a name="ln-264"></a>
<a name="ln-265"></a>        <span class="c">!&gt;</span>
<a name="ln-266"></a>        <span class="c">!  Add objects to a linked list of [[json_value]]s.</span>
<a name="ln-267"></a>        <span class="c">!</span>
<a name="ln-268"></a>        <span class="c">!@note It might make more sense to call this `add_child`.</span>
<a name="ln-269"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">add</span> <span class="o">=&gt;</span> <span class="n">json_value_add_member</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-270"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_null</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-271"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_integer</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-272"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_integer_vec</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-273"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_double</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-274"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_double_vec</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-275"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_logical</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-276"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_logical_vec</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-277"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_string</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-278"></a>                                 <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_string_vec</span><span class="p">)</span>
<a name="ln-279"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-280"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">add</span> <span class="o">=&gt;</span> <span class="n">json_value_add_string_name_ascii</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-281"></a>                                 <span class="n">json_value_add_string_val_ascii</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-282"></a>                                 <span class="n">json_value_add_string_vec_name_ascii</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-283"></a>                                 <span class="n">json_value_add_string_vec_val_ascii</span>
<a name="ln-284"></a><span class="cp">#endif</span>
<a name="ln-285"></a>
<a name="ln-286"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_add_member</span>
<a name="ln-287"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_integer</span><span class="p">)</span>
<a name="ln-288"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_null</span><span class="p">)</span>
<a name="ln-289"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_integer_vec</span><span class="p">)</span>
<a name="ln-290"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_double</span><span class="p">)</span>
<a name="ln-291"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_double_vec</span><span class="p">)</span>
<a name="ln-292"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_logical</span><span class="p">)</span>
<a name="ln-293"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_logical_vec</span><span class="p">)</span>
<a name="ln-294"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_string</span><span class="p">)</span>
<a name="ln-295"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_add_string_vec</span><span class="p">)</span>
<a name="ln-296"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-297"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_add_string_name_ascii</span>
<a name="ln-298"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_add_string_val_ascii</span>
<a name="ln-299"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_add_string_vec_name_ascii</span>
<a name="ln-300"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_value_add_string_vec_val_ascii</span>
<a name="ln-301"></a><span class="cp">#endif</span>
<a name="ln-302"></a>
<a name="ln-303"></a>        <span class="c">!&gt;</span>
<a name="ln-304"></a>        <span class="c">!  These are like the `add` methods, except if a variable with the</span>
<a name="ln-305"></a>        <span class="c">!  same path is already present, then its value is simply updated.</span>
<a name="ln-306"></a>        <span class="c">!  Note that currently, these only work for scalar variables.</span>
<a name="ln-307"></a>        <span class="c">!  These routines can also change the variable&#39;s type (but an error will be</span>
<a name="ln-308"></a>        <span class="c">!  thrown if the existing variable is not a scalar).</span>
<a name="ln-309"></a>        <span class="c">!</span>
<a name="ln-310"></a>        <span class="c">!### See also</span>
<a name="ln-311"></a>        <span class="c">!  * [[json_core(type):add_by_path]] - this one can be used to change</span>
<a name="ln-312"></a>        <span class="c">!    arrays and objects to scalars if so desired.</span>
<a name="ln-313"></a>        <span class="c">!</span>
<a name="ln-314"></a>        <span class="c">!@note Unlike some routines, the `found` output is not optional,</span>
<a name="ln-315"></a>        <span class="c">!      so it doesn&#39;t present exceptions from being thrown.</span>
<a name="ln-316"></a>        <span class="c">!</span>
<a name="ln-317"></a>        <span class="c">!@note These have been mostly supplanted by the [[json_core(type):add_by_path]]</span>
<a name="ln-318"></a>        <span class="c">!      methods, which do a similar thing (and can be used for</span>
<a name="ln-319"></a>        <span class="c">!      scalars and vectors, etc.)</span>
<a name="ln-320"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">update</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_logical</span><span class="p">),&amp;</span>
<a name="ln-321"></a>                                    <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_double</span><span class="p">),&amp;</span>
<a name="ln-322"></a>                                    <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_integer</span><span class="p">),&amp;</span>
<a name="ln-323"></a>                                    <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_string</span><span class="p">)</span>
<a name="ln-324"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-325"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">update</span> <span class="o">=&gt;</span> <span class="n">json_update_string_name_ascii</span><span class="p">,&amp;</span>
<a name="ln-326"></a>                                    <span class="n">json_update_string_val_ascii</span>
<a name="ln-327"></a><span class="cp">#endif</span>
<a name="ln-328"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_logical</span><span class="p">)</span>
<a name="ln-329"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_double</span><span class="p">)</span>
<a name="ln-330"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_integer</span><span class="p">)</span>
<a name="ln-331"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_update_string</span><span class="p">)</span>
<a name="ln-332"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-333"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_update_string_name_ascii</span>
<a name="ln-334"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_update_string_val_ascii</span>
<a name="ln-335"></a><span class="cp">#endif</span>
<a name="ln-336"></a>
<a name="ln-337"></a>        <span class="c">!&gt;</span>
<a name="ln-338"></a>        <span class="c">!  Add variables to a [[json_value]] linked list</span>
<a name="ln-339"></a>        <span class="c">!  by specifying their paths.</span>
<a name="ln-340"></a>        <span class="c">!</span>
<a name="ln-341"></a>        <span class="c">!### Example</span>
<a name="ln-342"></a>        <span class="c">!</span>
<a name="ln-343"></a>        <span class="c">!````fortran</span>
<a name="ln-344"></a>        <span class="c">!    use, intrinsic :: iso_fortran_env, only: output_unit, wp=&gt;real64</span>
<a name="ln-345"></a>        <span class="c">!    use json_module</span>
<a name="ln-346"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-347"></a>        <span class="c">!    type(json_value) :: p</span>
<a name="ln-348"></a>        <span class="c">!    call json%create_object(p,&#39;root&#39;) ! create the root</span>
<a name="ln-349"></a>        <span class="c">!    ! now add some variables using the paths:</span>
<a name="ln-350"></a>        <span class="c">!    call json%add_by_path(p,&#39;inputs.t&#39;,    0.0_wp  )</span>
<a name="ln-351"></a>        <span class="c">!    call json%add_by_path(p,&#39;inputs.x(1)&#39;, 100.0_wp)</span>
<a name="ln-352"></a>        <span class="c">!    call json%add_by_path(p,&#39;inputs.x(2)&#39;, 200.0_wp)</span>
<a name="ln-353"></a>        <span class="c">!    call json%print(p,output_unit)  ! now print to console</span>
<a name="ln-354"></a>        <span class="c">!````</span>
<a name="ln-355"></a>        <span class="c">!</span>
<a name="ln-356"></a>        <span class="c">!### Notes</span>
<a name="ln-357"></a>        <span class="c">!  * This uses [[json_create_by_path]]</span>
<a name="ln-358"></a>        <span class="c">!</span>
<a name="ln-359"></a>        <span class="c">!### See also</span>
<a name="ln-360"></a>        <span class="c">!  * The `json_core%update` methods.</span>
<a name="ln-361"></a>        <span class="c">!  * [[json_create_by_path]]</span>
<a name="ln-362"></a>
<a name="ln-363"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">add_by_path</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_member_by_path</span><span class="p">),&amp;</span>
<a name="ln-364"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_integer_by_path</span><span class="p">),&amp;</span>
<a name="ln-365"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_double_by_path</span><span class="p">),&amp;</span>
<a name="ln-366"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_logical_by_path</span><span class="p">),&amp;</span>
<a name="ln-367"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_string_by_path</span><span class="p">),&amp;</span>
<a name="ln-368"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_integer_vec_by_path</span><span class="p">),&amp;</span>
<a name="ln-369"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_double_vec_by_path</span><span class="p">),&amp;</span>
<a name="ln-370"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_logical_vec_by_path</span><span class="p">),&amp;</span>
<a name="ln-371"></a>                                         <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_string_vec_by_path</span><span class="p">)</span>
<a name="ln-372"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-373"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">add_by_path</span> <span class="o">=&gt;</span> <span class="n">json_add_string_by_path_value_ascii</span><span class="p">,&amp;</span>
<a name="ln-374"></a>                                         <span class="n">json_add_string_by_path_path_ascii</span><span class="p">,&amp;</span>
<a name="ln-375"></a>                                         <span class="n">json_add_string_vec_by_path_value_ascii</span><span class="p">,&amp;</span>
<a name="ln-376"></a>                                         <span class="n">json_add_string_vec_by_path_path_ascii</span>
<a name="ln-377"></a><span class="cp">#endif</span>
<a name="ln-378"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_member_by_path</span><span class="p">)</span>
<a name="ln-379"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_integer_by_path</span><span class="p">)</span>
<a name="ln-380"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_double_by_path</span><span class="p">)</span>
<a name="ln-381"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_logical_by_path</span><span class="p">)</span>
<a name="ln-382"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_string_by_path</span><span class="p">)</span>
<a name="ln-383"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_integer_vec_by_path</span><span class="p">)</span>
<a name="ln-384"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_double_vec_by_path</span><span class="p">)</span>
<a name="ln-385"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_logical_vec_by_path</span><span class="p">)</span>
<a name="ln-386"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_add_string_vec_by_path</span><span class="p">)</span>
<a name="ln-387"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-388"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_add_string_by_path_value_ascii</span>
<a name="ln-389"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_add_string_by_path_path_ascii</span>
<a name="ln-390"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_add_string_vec_by_path_value_ascii</span>
<a name="ln-391"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_add_string_vec_by_path_path_ascii</span>
<a name="ln-392"></a><span class="cp">#endif</span>
<a name="ln-393"></a>
<a name="ln-394"></a>        <span class="c">!&gt;</span>
<a name="ln-395"></a>        <span class="c">!  Create a [[json_value]] linked list using the</span>
<a name="ln-396"></a>        <span class="c">!  path to the variables. Optionally return a</span>
<a name="ln-397"></a>        <span class="c">!  pointer to the variable.</span>
<a name="ln-398"></a>        <span class="c">!</span>
<a name="ln-399"></a>        <span class="c">!  (This will create a `null` variable)</span>
<a name="ln-400"></a>        <span class="c">!</span>
<a name="ln-401"></a>        <span class="c">!### See also</span>
<a name="ln-402"></a>        <span class="c">!  * [[json_core(type):add_by_path]]</span>
<a name="ln-403"></a>
<a name="ln-404"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_create_by_path</span><span class="p">)</span>
<a name="ln-405"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_create_by_path</span><span class="p">)</span>
<a name="ln-406"></a>
<a name="ln-407"></a>        <span class="c">!&gt;</span>
<a name="ln-408"></a>        <span class="c">!  Get data from a [[json_value]] linked list.</span>
<a name="ln-409"></a>        <span class="c">!</span>
<a name="ln-410"></a>        <span class="c">!@note There are two versions (e.g. [[json_get_integer]] and [[json_get_integer_by_path]]).</span>
<a name="ln-411"></a>        <span class="c">!      The first one gets the value from the [[json_value]] passed into the routine,</span>
<a name="ln-412"></a>        <span class="c">!      while the second one gets the value from the [[json_value]] found by parsing the</span>
<a name="ln-413"></a>        <span class="c">!      path.  The path version is split up into unicode and non-unicode versions.</span>
<a name="ln-414"></a>
<a name="ln-415"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get</span> <span class="o">=&gt;</span> <span class="p">&amp;</span>
<a name="ln-416"></a>                                  <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_by_path</span><span class="p">),</span>             <span class="p">&amp;</span>
<a name="ln-417"></a>            <span class="n">json_get_integer</span><span class="p">,</span>     <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_integer_by_path</span><span class="p">),</span>     <span class="p">&amp;</span>
<a name="ln-418"></a>            <span class="n">json_get_integer_vec</span><span class="p">,</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_integer_vec_by_path</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-419"></a>            <span class="n">json_get_double</span><span class="p">,</span>      <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_double_by_path</span><span class="p">),</span>      <span class="p">&amp;</span>
<a name="ln-420"></a>            <span class="n">json_get_double_vec</span><span class="p">,</span>  <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_double_vec_by_path</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-421"></a>            <span class="n">json_get_logical</span><span class="p">,</span>     <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_logical_by_path</span><span class="p">),</span>     <span class="p">&amp;</span>
<a name="ln-422"></a>            <span class="n">json_get_logical_vec</span><span class="p">,</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_logical_vec_by_path</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-423"></a>            <span class="n">json_get_string</span><span class="p">,</span>      <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_string_by_path</span><span class="p">),</span>      <span class="p">&amp;</span>
<a name="ln-424"></a>            <span class="n">json_get_string_vec</span><span class="p">,</span>  <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_string_vec_by_path</span><span class="p">),</span>  <span class="p">&amp;</span>
<a name="ln-425"></a>            <span class="n">json_get_alloc_string_vec</span><span class="p">,</span><span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_alloc_string_vec_by_path</span><span class="p">),&amp;</span>
<a name="ln-426"></a>            <span class="n">json_get_array</span><span class="p">,</span>       <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_array_by_path</span><span class="p">)</span>
<a name="ln-427"></a>
<a name="ln-428"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_integer</span>
<a name="ln-429"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_integer_vec</span>
<a name="ln-430"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_double</span>
<a name="ln-431"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_double_vec</span>
<a name="ln-432"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_logical</span>
<a name="ln-433"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_logical_vec</span>
<a name="ln-434"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_string</span>
<a name="ln-435"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_string_vec</span>
<a name="ln-436"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_alloc_string_vec</span>
<a name="ln-437"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_array</span>
<a name="ln-438"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_by_path</span><span class="p">)</span>
<a name="ln-439"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_integer_by_path</span><span class="p">)</span>
<a name="ln-440"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_integer_vec_by_path</span><span class="p">)</span>
<a name="ln-441"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_double_by_path</span><span class="p">)</span>
<a name="ln-442"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_double_vec_by_path</span><span class="p">)</span>
<a name="ln-443"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_logical_by_path</span><span class="p">)</span>
<a name="ln-444"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_logical_vec_by_path</span><span class="p">)</span>
<a name="ln-445"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_string_by_path</span><span class="p">)</span>
<a name="ln-446"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_string_vec_by_path</span><span class="p">)</span>
<a name="ln-447"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_array_by_path</span><span class="p">)</span>
<a name="ln-448"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_alloc_string_vec_by_path</span><span class="p">)</span>
<a name="ln-449"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_by_path_default</span>
<a name="ln-450"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_by_path_rfc6901</span>
<a name="ln-451"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">private</span> <span class="kd">::</span> <span class="n">json_get_by_path_jsonpath_bracket</span>
<a name="ln-452"></a>
<a name="ln-453"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">print_to_string</span> <span class="o">=&gt;</span> <span class="n">json_value_to_string</span> <span class="c">!! Print the [[json_value]]</span>
<a name="ln-454"></a>                                                                    <span class="c">!! structure to an allocatable</span>
<a name="ln-455"></a>                                                                    <span class="c">!! string</span>
<a name="ln-456"></a>
<a name="ln-457"></a>        <span class="c">!&gt;</span>
<a name="ln-458"></a>        <span class="c">!  Print the [[json_value]] to a file.</span>
<a name="ln-459"></a>        <span class="c">!</span>
<a name="ln-460"></a>        <span class="c">!### Example</span>
<a name="ln-461"></a>        <span class="c">!</span>
<a name="ln-462"></a>        <span class="c">!````fortran</span>
<a name="ln-463"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-464"></a>        <span class="c">!    type(json_value) :: p</span>
<a name="ln-465"></a>        <span class="c">!    !...</span>
<a name="ln-466"></a>        <span class="c">!    call json%print(p,&#39;test.json&#39;)  !this is [[json_print_2]]</span>
<a name="ln-467"></a>        <span class="c">!````</span>
<a name="ln-468"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="k">print</span> <span class="o">=&gt;</span> <span class="n">json_print_1</span><span class="p">,</span><span class="n">json_print_2</span>
<a name="ln-469"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_print_1</span>
<a name="ln-470"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_print_2</span>
<a name="ln-471"></a>
<a name="ln-472"></a>        <span class="c">!&gt;</span>
<a name="ln-473"></a>        <span class="c">!  Destructor routine for a [[json_value]] pointer.</span>
<a name="ln-474"></a>        <span class="c">!  This must be called explicitly if it is no longer needed,</span>
<a name="ln-475"></a>        <span class="c">!  before it goes out of scope.  Otherwise, a memory leak will result.</span>
<a name="ln-476"></a>        <span class="c">!</span>
<a name="ln-477"></a>        <span class="c">!### Example</span>
<a name="ln-478"></a>        <span class="c">!</span>
<a name="ln-479"></a>        <span class="c">!  Destroy the [[json_value]] pointer before the variable goes out of scope:</span>
<a name="ln-480"></a>        <span class="c">!````fortran</span>
<a name="ln-481"></a>        <span class="c">!     subroutine example1()</span>
<a name="ln-482"></a>        <span class="c">!     type(json_core) :: json</span>
<a name="ln-483"></a>        <span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-484"></a>        <span class="c">!     call json%create_object(p,&#39;&#39;)</span>
<a name="ln-485"></a>        <span class="c">!     call json%add(p,&#39;year&#39;,2015)</span>
<a name="ln-486"></a>        <span class="c">!     call json%print(p)</span>
<a name="ln-487"></a>        <span class="c">!     call json%destroy(p)</span>
<a name="ln-488"></a>        <span class="c">!     end subroutine example1</span>
<a name="ln-489"></a>        <span class="c">!````</span>
<a name="ln-490"></a>        <span class="c">!</span>
<a name="ln-491"></a>        <span class="c">!  Note: it should NOT be called for a [[json_value]] pointer than has already been</span>
<a name="ln-492"></a>        <span class="c">!  added to another [[json_value]] structure, since doing so may render the</span>
<a name="ln-493"></a>        <span class="c">!  other structure invalid.  Consider the following example:</span>
<a name="ln-494"></a>        <span class="c">!````fortran</span>
<a name="ln-495"></a>        <span class="c">!     subroutine example2(p)</span>
<a name="ln-496"></a>        <span class="c">!     type(json_core) :: json</span>
<a name="ln-497"></a>        <span class="c">!     type(json_value),pointer,intent(out) :: p</span>
<a name="ln-498"></a>        <span class="c">!     type(json_value),pointer :: q</span>
<a name="ln-499"></a>        <span class="c">!     call json%create_object(p,&#39;&#39;)</span>
<a name="ln-500"></a>        <span class="c">!     call json%add(p,&#39;year&#39;,2015)</span>
<a name="ln-501"></a>        <span class="c">!     call json%create_object(q,&#39;q&#39;)</span>
<a name="ln-502"></a>        <span class="c">!     call json%add(q,&#39;val&#39;,1)</span>
<a name="ln-503"></a>        <span class="c">!     call json%add(p, q)  !add q to p structure</span>
<a name="ln-504"></a>        <span class="c">!     ! do NOT call json%destroy(q) here, because q is</span>
<a name="ln-505"></a>        <span class="c">!     ! now part of the output structure p.  p should be destroyed</span>
<a name="ln-506"></a>        <span class="c">!     ! somewhere upstream by the caller of this routine.</span>
<a name="ln-507"></a>        <span class="c">!     nullify(q) !OK, but not strictly necessary</span>
<a name="ln-508"></a>        <span class="c">!     end subroutine example2</span>
<a name="ln-509"></a>        <span class="c">!````</span>
<a name="ln-510"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">destroy</span> <span class="o">=&gt;</span> <span class="n">json_value_destroy</span><span class="p">,</span><span class="n">destroy_json_core</span>
<a name="ln-511"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_value_destroy</span>
<a name="ln-512"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">destroy_json_core</span>
<a name="ln-513"></a>
<a name="ln-514"></a>        <span class="c">!&gt;</span>
<a name="ln-515"></a>        <span class="c">!  If the child variable is present, then remove it.</span>
<a name="ln-516"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">remove_if_present</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_remove_if_present</span><span class="p">)</span>
<a name="ln-517"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_remove_if_present</span><span class="p">)</span>
<a name="ln-518"></a>
<a name="ln-519"></a>        <span class="c">!&gt;</span>
<a name="ln-520"></a>        <span class="c">!  Allocate a [[json_value]] pointer and make it a double variable.</span>
<a name="ln-521"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-522"></a>        <span class="c">!</span>
<a name="ln-523"></a>        <span class="c">!### Example</span>
<a name="ln-524"></a>        <span class="c">!</span>
<a name="ln-525"></a>        <span class="c">!````fortran</span>
<a name="ln-526"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-527"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-528"></a>        <span class="c">!    call json%create_double(p,&#39;value&#39;,1.0_RK)</span>
<a name="ln-529"></a>        <span class="c">!````</span>
<a name="ln-530"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_double</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_double</span><span class="p">)</span>
<a name="ln-531"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_double</span><span class="p">)</span>
<a name="ln-532"></a>
<a name="ln-533"></a>        <span class="c">!&gt;</span>
<a name="ln-534"></a>        <span class="c">!  Allocate a [[json_value]] pointer and make it an array variable.</span>
<a name="ln-535"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-536"></a>        <span class="c">!</span>
<a name="ln-537"></a>        <span class="c">!### Example</span>
<a name="ln-538"></a>        <span class="c">!</span>
<a name="ln-539"></a>        <span class="c">!````fortran</span>
<a name="ln-540"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-541"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-542"></a>        <span class="c">!    call json%create_array(p,&#39;arrayname&#39;)</span>
<a name="ln-543"></a>        <span class="c">!````</span>
<a name="ln-544"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_array</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_array</span><span class="p">)</span>
<a name="ln-545"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_array</span><span class="p">)</span>
<a name="ln-546"></a>
<a name="ln-547"></a>        <span class="c">!&gt;</span>
<a name="ln-548"></a>        <span class="c">!  Allocate a [[json_value]] pointer and make it an object variable.</span>
<a name="ln-549"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-550"></a>        <span class="c">!</span>
<a name="ln-551"></a>        <span class="c">!### Example</span>
<a name="ln-552"></a>        <span class="c">!</span>
<a name="ln-553"></a>        <span class="c">!````fortran</span>
<a name="ln-554"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-555"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-556"></a>        <span class="c">!    call json%create_object(p,&#39;objectname&#39;)</span>
<a name="ln-557"></a>        <span class="c">!````</span>
<a name="ln-558"></a>        <span class="c">!</span>
<a name="ln-559"></a>        <span class="c">!@note The name is not significant for the root structure or an array element.</span>
<a name="ln-560"></a>        <span class="c">!      In those cases, an empty string can be used.</span>
<a name="ln-561"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_object</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_object</span><span class="p">)</span>
<a name="ln-562"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_object</span><span class="p">)</span>
<a name="ln-563"></a>
<a name="ln-564"></a>        <span class="c">!&gt;</span>
<a name="ln-565"></a>        <span class="c">!  Allocate a json_value pointer and make it a null variable.</span>
<a name="ln-566"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-567"></a>        <span class="c">!</span>
<a name="ln-568"></a>        <span class="c">!### Example</span>
<a name="ln-569"></a>        <span class="c">!</span>
<a name="ln-570"></a>        <span class="c">!````fortran</span>
<a name="ln-571"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-572"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-573"></a>        <span class="c">!    call json%create_null(p,&#39;value&#39;)</span>
<a name="ln-574"></a>        <span class="c">!````</span>
<a name="ln-575"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_null</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_null</span><span class="p">)</span>
<a name="ln-576"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_null</span><span class="p">)</span>
<a name="ln-577"></a>
<a name="ln-578"></a>        <span class="c">!&gt;</span>
<a name="ln-579"></a>        <span class="c">!  Allocate a json_value pointer and make it a string variable.</span>
<a name="ln-580"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-581"></a>        <span class="c">!</span>
<a name="ln-582"></a>        <span class="c">!### Example</span>
<a name="ln-583"></a>        <span class="c">!</span>
<a name="ln-584"></a>        <span class="c">!````fortran</span>
<a name="ln-585"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-586"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-587"></a>        <span class="c">!    call json%create_string(p,&#39;value&#39;,&#39;foobar&#39;)</span>
<a name="ln-588"></a>        <span class="c">!````</span>
<a name="ln-589"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_string</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_string</span><span class="p">)</span>
<a name="ln-590"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_string</span><span class="p">)</span>
<a name="ln-591"></a>
<a name="ln-592"></a>        <span class="c">!&gt;</span>
<a name="ln-593"></a>        <span class="c">!  Allocate a json_value pointer and make it an integer variable.</span>
<a name="ln-594"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-595"></a>        <span class="c">!</span>
<a name="ln-596"></a>        <span class="c">!### Example</span>
<a name="ln-597"></a>        <span class="c">!</span>
<a name="ln-598"></a>        <span class="c">!````fortran</span>
<a name="ln-599"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-600"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-601"></a>        <span class="c">!    call json%create_integer(p,42,&#39;value&#39;)</span>
<a name="ln-602"></a>        <span class="c">!````</span>
<a name="ln-603"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_integer</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_integer</span><span class="p">)</span>
<a name="ln-604"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_integer</span><span class="p">)</span>
<a name="ln-605"></a>
<a name="ln-606"></a>        <span class="c">!&gt;</span>
<a name="ln-607"></a>        <span class="c">!  Allocate a json_value pointer and make it a logical variable.</span>
<a name="ln-608"></a>        <span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-609"></a>        <span class="c">!</span>
<a name="ln-610"></a>        <span class="c">!### Example</span>
<a name="ln-611"></a>        <span class="c">!</span>
<a name="ln-612"></a>        <span class="c">!````fortran</span>
<a name="ln-613"></a>        <span class="c">!    type(json_core) :: json</span>
<a name="ln-614"></a>        <span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-615"></a>        <span class="c">!    call json%create_logical(p,&#39;value&#39;,.true.)</span>
<a name="ln-616"></a>        <span class="c">!````</span>
<a name="ln-617"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">create_logical</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_logical</span><span class="p">)</span>
<a name="ln-618"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_create_logical</span><span class="p">)</span>
<a name="ln-619"></a>
<a name="ln-620"></a>        <span class="c">!&gt;</span>
<a name="ln-621"></a>        <span class="c">!  Parse the JSON file and populate the [[json_value]] tree.</span>
<a name="ln-622"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">parse</span> <span class="o">=&gt;</span> <span class="n">json_parse_file</span><span class="p">,</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_parse_string</span><span class="p">)</span>
<a name="ln-623"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_parse_file</span>
<a name="ln-624"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_parse_string</span><span class="p">)</span>
<a name="ln-625"></a>
<a name="ln-626"></a>        <span class="c">!&gt;</span>
<a name="ln-627"></a>        <span class="c">!  Throw an exception.</span>
<a name="ln-628"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">throw_exception</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_throw_exception</span><span class="p">)</span>
<a name="ln-629"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_throw_exception</span><span class="p">)</span>
<a name="ln-630"></a>
<a name="ln-631"></a>        <span class="c">!&gt;</span>
<a name="ln-632"></a>        <span class="c">!  Rename a [[json_value]] variable.</span>
<a name="ln-633"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="nb">rename</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_rename</span><span class="p">),&amp;</span>
<a name="ln-634"></a>                                    <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_rename_by_path</span><span class="p">)</span>
<a name="ln-635"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_value_rename</span><span class="p">)</span>
<a name="ln-636"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_rename_by_path</span><span class="p">)</span>
<a name="ln-637"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-638"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="nb">rename</span> <span class="o">=&gt;</span> <span class="n">json_rename_by_path_name_ascii</span><span class="p">,&amp;</span>
<a name="ln-639"></a>                                    <span class="n">json_rename_by_path_path_ascii</span>
<a name="ln-640"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_rename_by_path_name_ascii</span>
<a name="ln-641"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_rename_by_path_path_ascii</span>
<a name="ln-642"></a><span class="cp">#endif</span>
<a name="ln-643"></a>
<a name="ln-644"></a>        <span class="c">!&gt;</span>
<a name="ln-645"></a>        <span class="c">!  get info about a [[json_value]]</span>
<a name="ln-646"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">info</span> <span class="o">=&gt;</span> <span class="n">json_info</span><span class="p">,</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_info_by_path</span><span class="p">)</span>
<a name="ln-647"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_info</span>
<a name="ln-648"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_info_by_path</span><span class="p">)</span>
<a name="ln-649"></a>
<a name="ln-650"></a>        <span class="c">!&gt;</span>
<a name="ln-651"></a>        <span class="c">!  get string info about a [[json_value]]</span>
<a name="ln-652"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">string_info</span> <span class="o">=&gt;</span> <span class="n">json_string_info</span>
<a name="ln-653"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_string_info</span>
<a name="ln-654"></a>
<a name="ln-655"></a>        <span class="c">!&gt;</span>
<a name="ln-656"></a>        <span class="c">!  get matrix info about a [[json_value]]</span>
<a name="ln-657"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">matrix_info</span> <span class="o">=&gt;</span> <span class="n">json_matrix_info</span><span class="p">,</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_matrix_info_by_path</span><span class="p">)</span>
<a name="ln-658"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_matrix_info</span>
<a name="ln-659"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_matrix_info_by_path</span><span class="p">)</span>
<a name="ln-660"></a>
<a name="ln-661"></a>        <span class="c">!&gt;</span>
<a name="ln-662"></a>        <span class="c">!  insert a new element after an existing one,</span>
<a name="ln-663"></a>        <span class="c">!  updating the JSON structure accordingly</span>
<a name="ln-664"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">insert_after</span> <span class="o">=&gt;</span> <span class="n">json_value_insert_after</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-665"></a>                                          <span class="n">json_value_insert_after_child_by_index</span>
<a name="ln-666"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_value_insert_after</span>
<a name="ln-667"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_value_insert_after_child_by_index</span>
<a name="ln-668"></a>
<a name="ln-669"></a>        <span class="c">!&gt;</span>
<a name="ln-670"></a>        <span class="c">!  get the path to a JSON variable in a structure:</span>
<a name="ln-671"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_path</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_path</span><span class="p">)</span>
<a name="ln-672"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_get_path</span><span class="p">)</span>
<a name="ln-673"></a>
<a name="ln-674"></a>        <span class="c">!&gt;</span>
<a name="ln-675"></a>        <span class="c">!  verify if a path is valid</span>
<a name="ln-676"></a>        <span class="c">!  (i.e., a variable with this path exists in the file).</span>
<a name="ln-677"></a>        <span class="k">generic</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">valid_path</span> <span class="o">=&gt;</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_valid_path</span><span class="p">)</span>
<a name="ln-678"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">MAYBEWRAP</span><span class="p">(</span><span class="n">json_valid_path</span><span class="p">)</span>
<a name="ln-679"></a>
<a name="ln-680"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">remove</span>              <span class="o">=&gt;</span> <span class="n">json_value_remove</span>        <span class="c">!! Remove a [[json_value]] from a</span>
<a name="ln-681"></a>                                                                            <span class="c">!! linked-list structure.</span>
<a name="ln-682"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">replace</span>             <span class="o">=&gt;</span> <span class="n">json_value_replace</span>       <span class="c">!! Replace a [[json_value]] in a</span>
<a name="ln-683"></a>                                                                            <span class="c">!! linked-list structure.</span>
<a name="ln-684"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">reverse</span>             <span class="o">=&gt;</span> <span class="n">json_value_reverse</span>       <span class="c">!! Reverse the order of the children</span>
<a name="ln-685"></a>                                                                            <span class="c">!! of an array of object.</span>
<a name="ln-686"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">check_for_errors</span>    <span class="o">=&gt;</span> <span class="n">json_check_for_errors</span>    <span class="c">!! check for error and get error message</span>
<a name="ln-687"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">clear_exceptions</span>    <span class="o">=&gt;</span> <span class="n">json_clear_exceptions</span>    <span class="c">!! clear exceptions</span>
<a name="ln-688"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="nb">count</span>               <span class="o">=&gt;</span> <span class="n">json_count</span>               <span class="c">!! count the number of children</span>
<a name="ln-689"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">clone</span>               <span class="o">=&gt;</span> <span class="n">json_clone</span>               <span class="c">!! clone a JSON structure (deep copy)</span>
<a name="ln-690"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">failed</span>              <span class="o">=&gt;</span> <span class="n">json_failed</span>              <span class="c">!! check for error</span>
<a name="ln-691"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_parent</span>          <span class="o">=&gt;</span> <span class="n">json_get_parent</span>          <span class="c">!! get pointer to json_value parent</span>
<a name="ln-692"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_next</span>            <span class="o">=&gt;</span> <span class="n">json_get_next</span>            <span class="c">!! get pointer to json_value next</span>
<a name="ln-693"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_previous</span>        <span class="o">=&gt;</span> <span class="n">json_get_previous</span>        <span class="c">!! get pointer to json_value previous</span>
<a name="ln-694"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">get_tail</span>            <span class="o">=&gt;</span> <span class="n">json_get_tail</span>            <span class="c">!! get pointer to json_value tail</span>
<a name="ln-695"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">initialize</span>          <span class="o">=&gt;</span> <span class="n">json_initialize</span>          <span class="c">!! to initialize some parsing parameters</span>
<a name="ln-696"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">traverse</span>            <span class="o">=&gt;</span> <span class="n">json_traverse</span>            <span class="c">!! to traverse all elements of a JSON</span>
<a name="ln-697"></a>                                                                            <span class="c">!! structure</span>
<a name="ln-698"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">print_error_message</span> <span class="o">=&gt;</span> <span class="n">json_print_error_message</span> <span class="c">!! simply routine to print error</span>
<a name="ln-699"></a>                                                                            <span class="c">!! messages</span>
<a name="ln-700"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">swap</span>                <span class="o">=&gt;</span> <span class="n">json_value_swap</span>          <span class="c">!! Swap two [[json_value]] pointers</span>
<a name="ln-701"></a>                                                                            <span class="c">!! in a structure (or two different</span>
<a name="ln-702"></a>                                                                            <span class="c">!! structures).</span>
<a name="ln-703"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">is_child_of</span>         <span class="o">=&gt;</span> <span class="n">json_value_is_child_of</span>   <span class="c">!! Check if a [[json_value]] is a</span>
<a name="ln-704"></a>                                                                            <span class="c">!! descendant of another.</span>
<a name="ln-705"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">validate</span>            <span class="o">=&gt;</span> <span class="n">json_value_validate</span>      <span class="c">!! Check that a [[json_value]] linked</span>
<a name="ln-706"></a>                                                                            <span class="c">!! list is valid (i.e., is properly</span>
<a name="ln-707"></a>                                                                            <span class="c">!! constructed). This may be useful</span>
<a name="ln-708"></a>                                                                            <span class="c">!! if it has been constructed externally.</span>
<a name="ln-709"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">check_for_duplicate_keys</span> <span class="p">&amp;</span>
<a name="ln-710"></a>                                <span class="o">=&gt;</span> <span class="n">json_check_all_for_duplicate_keys</span>  <span class="c">!! Check entire JSON structure</span>
<a name="ln-711"></a>                                                                      <span class="c">!! for duplicate keys (recursively)</span>
<a name="ln-712"></a>        <span class="k">procedure</span><span class="p">,</span><span class="k">public</span> <span class="kd">::</span> <span class="n">check_children_for_duplicate_keys</span> <span class="p">&amp;</span>
<a name="ln-713"></a>                                <span class="o">=&gt;</span> <span class="n">json_check_children_for_duplicate_keys</span>  <span class="c">!! Check a `json_value` object&#39;s</span>
<a name="ln-714"></a>                                                                           <span class="c">!! children for duplicate keys</span>
<a name="ln-715"></a>
<a name="ln-716"></a>        <span class="c">!other private routines:</span>
<a name="ln-717"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">name_equal</span>
<a name="ln-718"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">name_strings_equal</span>
<a name="ln-719"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">json_value_print</span>
<a name="ln-720"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">string_to_int</span>
<a name="ln-721"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">string_to_dble</span>
<a name="ln-722"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_value</span>
<a name="ln-723"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_number</span>
<a name="ln-724"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_string</span>
<a name="ln-725"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_for_chars</span>
<a name="ln-726"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_object</span>
<a name="ln-727"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">parse_array</span>
<a name="ln-728"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">annotate_invalid_json</span>
<a name="ln-729"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">pop_char</span>
<a name="ln-730"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">push_char</span>
<a name="ln-731"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">get_current_line_from_file_stream</span>
<a name="ln-732"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">get_current_line_from_file_sequential</span>
<a name="ln-733"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">convert</span>
<a name="ln-734"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_string</span>
<a name="ln-735"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_logical</span>
<a name="ln-736"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_integer</span>
<a name="ln-737"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_double</span>
<a name="ln-738"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_null</span>
<a name="ln-739"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_object</span>
<a name="ln-740"></a>        <span class="k">procedure</span> <span class="kd">::</span> <span class="n">to_array</span>
<a name="ln-741"></a>
<a name="ln-742"></a>    <span class="k">end type </span><span class="n">json_core</span>
<a name="ln-743"></a>    <span class="c">!*********************************************************</span>
<a name="ln-744"></a>
<a name="ln-745"></a>    <span class="c">!*********************************************************</span>
<a name="ln-746"></a>    <span class="c">!&gt;</span>
<a name="ln-747"></a>    <span class="c">!  Structure constructor to initialize a</span>
<a name="ln-748"></a>    <span class="c">!  [[json_core(type)]] object</span>
<a name="ln-749"></a>    <span class="c">!</span>
<a name="ln-750"></a>    <span class="c">!### Example</span>
<a name="ln-751"></a>    <span class="c">!</span>
<a name="ln-752"></a>    <span class="c">!```fortran</span>
<a name="ln-753"></a>    <span class="c">! type(json_file)  :: json_core</span>
<a name="ln-754"></a>    <span class="c">! json_core = json_core()</span>
<a name="ln-755"></a>    <span class="c">!```</span>
<a name="ln-756"></a>    <span class="k">interface </span><span class="n">json_core</span>
<a name="ln-757"></a>       <span class="k">module procedure </span><span class="n">initialize_json_core</span>
<a name="ln-758"></a>    <span class="k">end interface</span>
<a name="ln-759"></a>    <span class="c">!*********************************************************</span>
<a name="ln-760"></a>
<a name="ln-761"></a>    <span class="c">!*************************************************************************************</span>
<a name="ln-762"></a>    <span class="k">abstract interface</span>
<a name="ln-763"></a>
<a name="ln-764"></a><span class="k">        subroutine </span><span class="n">json_array_callback_func</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-765"></a>            <span class="c">!! Array element callback function.  Used by [[json_get_array]]</span>
<a name="ln-766"></a>            <span class="k">import</span> <span class="kd">::</span> <span class="n">json_value</span><span class="p">,</span><span class="n">json_core</span><span class="p">,</span><span class="n">IK</span>
<a name="ln-767"></a>            <span class="k">implicit none</span>
<a name="ln-768"></a><span class="k">            class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-769"></a>            <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">element</span>
<a name="ln-770"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-771"></a>            <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-772"></a>        <span class="k">end subroutine </span><span class="n">json_array_callback_func</span>
<a name="ln-773"></a>
<a name="ln-774"></a>        <span class="k">subroutine </span><span class="n">json_traverse_callback_func</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">finished</span><span class="p">)</span>
<a name="ln-775"></a>            <span class="c">!! Callback function used by [[json_traverse]]</span>
<a name="ln-776"></a>            <span class="k">import</span> <span class="kd">::</span> <span class="n">json_value</span><span class="p">,</span><span class="n">json_core</span><span class="p">,</span><span class="n">LK</span>
<a name="ln-777"></a>            <span class="k">implicit none</span>
<a name="ln-778"></a><span class="k">            class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-779"></a>            <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-780"></a>            <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">finished</span>  <span class="c">!! set true to stop traversing</span>
<a name="ln-781"></a>        <span class="k">end subroutine </span><span class="n">json_traverse_callback_func</span>
<a name="ln-782"></a>
<a name="ln-783"></a>    <span class="k">end interface</span>
<a name="ln-784"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">json_array_callback_func</span>
<a name="ln-785"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">json_traverse_callback_func</span>
<a name="ln-786"></a>    <span class="c">!*************************************************************************************</span>
<a name="ln-787"></a>
<a name="ln-788"></a>    <span class="k">contains</span>
<a name="ln-789"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-790"></a>
<a name="ln-791"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-792"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-793"></a><span class="c">!  date: 4/17/2016</span>
<a name="ln-794"></a><span class="c">!</span>
<a name="ln-795"></a><span class="c">!  Destructor for the [[json_core(type)]] type.</span>
<a name="ln-796"></a>
<a name="ln-797"></a>    <span class="k">subroutine </span><span class="n">destroy_json_core</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
<a name="ln-798"></a>
<a name="ln-799"></a>    <span class="k">implicit none</span>
<a name="ln-800"></a>
<a name="ln-801"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-802"></a>
<a name="ln-803"></a>    <span class="k">end subroutine </span><span class="n">destroy_json_core</span>
<a name="ln-804"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-805"></a>
<a name="ln-806"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-807"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-808"></a><span class="c">!  date: 4/26/2016</span>
<a name="ln-809"></a><span class="c">!</span>
<a name="ln-810"></a><span class="c">!  Function constructor for a [[json_core(type)]].</span>
<a name="ln-811"></a><span class="c">!  This is just a wrapper for [[json_initialize]].</span>
<a name="ln-812"></a><span class="c">!</span>
<a name="ln-813"></a><span class="c">!@note [[initialize_json_core]], [[json_initialize]],</span>
<a name="ln-814"></a><span class="c">!      [[initialize_json_core_in_file]], and [[initialize_json_file]]</span>
<a name="ln-815"></a><span class="c">!      all have a similar interface.</span>
<a name="ln-816"></a>
<a name="ln-817"></a>    <span class="k">function </span><span class="n">initialize_json_core</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span><span class="n">compact_reals</span><span class="p">,&amp;</span>
<a name="ln-818"></a>                                  <span class="n">print_signs</span><span class="p">,</span><span class="n">real_format</span><span class="p">,</span><span class="n">spaces_per_tab</span><span class="p">,&amp;</span>
<a name="ln-819"></a>                                  <span class="n">strict_type_checking</span><span class="p">,&amp;</span>
<a name="ln-820"></a>                                  <span class="n">trailing_spaces_significant</span><span class="p">,&amp;</span>
<a name="ln-821"></a>                                  <span class="n">case_sensitive_keys</span><span class="p">,&amp;</span>
<a name="ln-822"></a>                                  <span class="n">no_whitespace</span><span class="p">,&amp;</span>
<a name="ln-823"></a>                                  <span class="n">unescape_strings</span><span class="p">,&amp;</span>
<a name="ln-824"></a>                                  <span class="n">comment_char</span><span class="p">,&amp;</span>
<a name="ln-825"></a>                                  <span class="n">path_mode</span><span class="p">,&amp;</span>
<a name="ln-826"></a>                                  <span class="n">path_separator</span><span class="p">,&amp;</span>
<a name="ln-827"></a>                                  <span class="n">compress_vectors</span><span class="p">,&amp;</span>
<a name="ln-828"></a>                                  <span class="n">allow_duplicate_keys</span><span class="p">,&amp;</span>
<a name="ln-829"></a>                                  <span class="n">escape_solidus</span><span class="p">,&amp;</span>
<a name="ln-830"></a>                                  <span class="n">stop_on_error</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">json_core_object</span><span class="p">)</span>
<a name="ln-831"></a>
<a name="ln-832"></a>    <span class="k">implicit none</span>
<a name="ln-833"></a>
<a name="ln-834"></a><span class="k">    type</span><span class="p">(</span><span class="n">json_core</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json_core_object</span>
<a name="ln-835"></a><span class="cp">#include &quot;json_initialize_arguments.inc&quot;</span>
<a name="ln-836"></a>
<a name="ln-837"></a>    <span class="k">call </span><span class="n">json_core_object</span><span class="p">%</span><span class="n">initialize</span><span class="p">(</span><span class="n">verbose</span><span class="p">,</span><span class="n">compact_reals</span><span class="p">,&amp;</span>
<a name="ln-838"></a>                                <span class="n">print_signs</span><span class="p">,</span><span class="n">real_format</span><span class="p">,</span><span class="n">spaces_per_tab</span><span class="p">,&amp;</span>
<a name="ln-839"></a>                                <span class="n">strict_type_checking</span><span class="p">,&amp;</span>
<a name="ln-840"></a>                                <span class="n">trailing_spaces_significant</span><span class="p">,&amp;</span>
<a name="ln-841"></a>                                <span class="n">case_sensitive_keys</span><span class="p">,&amp;</span>
<a name="ln-842"></a>                                <span class="n">no_whitespace</span><span class="p">,&amp;</span>
<a name="ln-843"></a>                                <span class="n">unescape_strings</span><span class="p">,&amp;</span>
<a name="ln-844"></a>                                <span class="n">comment_char</span><span class="p">,&amp;</span>
<a name="ln-845"></a>                                <span class="n">path_mode</span><span class="p">,&amp;</span>
<a name="ln-846"></a>                                <span class="n">path_separator</span><span class="p">,&amp;</span>
<a name="ln-847"></a>                                <span class="n">compress_vectors</span><span class="p">,&amp;</span>
<a name="ln-848"></a>                                <span class="n">allow_duplicate_keys</span><span class="p">,&amp;</span>
<a name="ln-849"></a>                                <span class="n">escape_solidus</span><span class="p">,&amp;</span>
<a name="ln-850"></a>                                <span class="n">stop_on_error</span><span class="p">)</span>
<a name="ln-851"></a>
<a name="ln-852"></a>    <span class="k">end function </span><span class="n">initialize_json_core</span>
<a name="ln-853"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-854"></a>
<a name="ln-855"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-856"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-857"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-858"></a><span class="c">!</span>
<a name="ln-859"></a><span class="c">!  Initialize the [[json_core(type)]] instance.</span>
<a name="ln-860"></a><span class="c">!</span>
<a name="ln-861"></a><span class="c">!  The routine may be called before any of the [[json_core(type)]] methods are used in</span>
<a name="ln-862"></a><span class="c">!  order to specify certain parameters. If it is not called, then the defaults</span>
<a name="ln-863"></a><span class="c">!  are used. This routine is also called internally by various routines.</span>
<a name="ln-864"></a><span class="c">!  It can also be called to clear exceptions, or to reset some</span>
<a name="ln-865"></a><span class="c">!  of the variables (note that only the arguments present are changed).</span>
<a name="ln-866"></a><span class="c">!</span>
<a name="ln-867"></a><span class="c">!### Modified</span>
<a name="ln-868"></a><span class="c">!  * Izaak Beekman : 02/24/2015</span>
<a name="ln-869"></a><span class="c">!</span>
<a name="ln-870"></a><span class="c">!@note [[initialize_json_core]], [[json_initialize]],</span>
<a name="ln-871"></a><span class="c">!      [[initialize_json_core_in_file]], and [[initialize_json_file]]</span>
<a name="ln-872"></a><span class="c">!      all have a similar interface.</span>
<a name="ln-873"></a>
<a name="ln-874"></a>    <span class="k">subroutine </span><span class="n">json_initialize</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">verbose</span><span class="p">,</span><span class="n">compact_reals</span><span class="p">,&amp;</span>
<a name="ln-875"></a>                               <span class="n">print_signs</span><span class="p">,</span><span class="n">real_format</span><span class="p">,</span><span class="n">spaces_per_tab</span><span class="p">,&amp;</span>
<a name="ln-876"></a>                               <span class="n">strict_type_checking</span><span class="p">,&amp;</span>
<a name="ln-877"></a>                               <span class="n">trailing_spaces_significant</span><span class="p">,&amp;</span>
<a name="ln-878"></a>                               <span class="n">case_sensitive_keys</span><span class="p">,&amp;</span>
<a name="ln-879"></a>                               <span class="n">no_whitespace</span><span class="p">,&amp;</span>
<a name="ln-880"></a>                               <span class="n">unescape_strings</span><span class="p">,&amp;</span>
<a name="ln-881"></a>                               <span class="n">comment_char</span><span class="p">,&amp;</span>
<a name="ln-882"></a>                               <span class="n">path_mode</span><span class="p">,&amp;</span>
<a name="ln-883"></a>                               <span class="n">path_separator</span><span class="p">,&amp;</span>
<a name="ln-884"></a>                               <span class="n">compress_vectors</span><span class="p">,&amp;</span>
<a name="ln-885"></a>                               <span class="n">allow_duplicate_keys</span><span class="p">,&amp;</span>
<a name="ln-886"></a>                               <span class="n">escape_solidus</span><span class="p">,&amp;</span>
<a name="ln-887"></a>                               <span class="n">stop_on_error</span><span class="p">)</span>
<a name="ln-888"></a>
<a name="ln-889"></a>    <span class="k">implicit none</span>
<a name="ln-890"></a>
<a name="ln-891"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-892"></a><span class="cp">#include &quot;json_initialize_arguments.inc&quot;</span>
<a name="ln-893"></a>
<a name="ln-894"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">w</span>            <span class="c">!! max string length</span>
<a name="ln-895"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>            <span class="c">!! real precision digits</span>
<a name="ln-896"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">e</span>            <span class="c">!! real exponent digits</span>
<a name="ln-897"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">sgn</span>          <span class="c">!! sign flag: `ss` or `sp`</span>
<a name="ln-898"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">rl_edit_desc</span> <span class="c">!! `G`, `E`, `EN`, or `ES`</span>
<a name="ln-899"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">istat</span>        <span class="c">!! `iostat` flag for</span>
<a name="ln-900"></a>                                               <span class="c">!! write statements</span>
<a name="ln-901"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">sgn_prnt</span>     <span class="c">!! print sign flag</span>
<a name="ln-902"></a>
<a name="ln-903"></a>    <span class="c">!reset exception to false:</span>
<a name="ln-904"></a>    <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-905"></a>
<a name="ln-906"></a>    <span class="c">!Just in case, clear these global variables also:</span>
<a name="ln-907"></a>    <span class="n">me</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-908"></a>    <span class="n">me</span><span class="p">%</span><span class="n">pushed_char</span>  <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-909"></a>    <span class="n">me</span><span class="p">%</span><span class="n">char_count</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-910"></a>    <span class="n">me</span><span class="p">%</span><span class="n">line_count</span>   <span class="o">=</span> <span class="mi">1</span>
<a name="ln-911"></a>    <span class="n">me</span><span class="p">%</span><span class="n">ipos</span>         <span class="o">=</span> <span class="mi">1</span>
<a name="ln-912"></a>
<a name="ln-913"></a><span class="cp">#ifdef USE_UCS4</span>
<a name="ln-914"></a>    <span class="c">! reopen stdout and stderr with utf-8 encoding</span>
<a name="ln-915"></a>    <span class="k">open</span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a name="ln-916"></a>    <span class="k">open</span><span class="p">(</span><span class="n">error_unit</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a name="ln-917"></a><span class="cp">#endif</span>
<a name="ln-918"></a>
<a name="ln-919"></a>    <span class="c">!various optional inputs:</span>
<a name="ln-920"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">spaces_per_tab</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-921"></a>        <span class="n">me</span><span class="p">%</span><span class="n">spaces_per_tab</span> <span class="o">=</span> <span class="n">spaces_per_tab</span>
<a name="ln-922"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">stop_on_error</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-923"></a>        <span class="n">me</span><span class="p">%</span><span class="n">stop_on_error</span> <span class="o">=</span> <span class="n">stop_on_error</span>
<a name="ln-924"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">verbose</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-925"></a>        <span class="n">me</span><span class="p">%</span><span class="n">is_verbose</span> <span class="o">=</span> <span class="n">verbose</span>
<a name="ln-926"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">strict_type_checking</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-927"></a>        <span class="n">me</span><span class="p">%</span><span class="n">strict_type_checking</span> <span class="o">=</span> <span class="n">strict_type_checking</span>
<a name="ln-928"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">trailing_spaces_significant</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-929"></a>        <span class="n">me</span><span class="p">%</span><span class="n">trailing_spaces_significant</span> <span class="o">=</span> <span class="n">trailing_spaces_significant</span>
<a name="ln-930"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">case_sensitive_keys</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-931"></a>        <span class="n">me</span><span class="p">%</span><span class="n">case_sensitive_keys</span> <span class="o">=</span> <span class="n">case_sensitive_keys</span>
<a name="ln-932"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">no_whitespace</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-933"></a>        <span class="n">me</span><span class="p">%</span><span class="n">no_whitespace</span> <span class="o">=</span> <span class="n">no_whitespace</span>
<a name="ln-934"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">unescape_strings</span><span class="p">))</span> <span class="p">&amp;</span>
<a name="ln-935"></a>        <span class="n">me</span><span class="p">%</span><span class="n">unescaped_strings</span> <span class="o">=</span> <span class="n">unescape_strings</span>
<a name="ln-936"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">path_mode</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-937"></a><span class="k">        if</span> <span class="p">(</span><span class="n">path_mode</span><span class="o">==</span><span class="mi">1_IK</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">path_mode</span><span class="o">==</span><span class="mi">2_IK</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">path_mode</span><span class="o">==</span><span class="mi">3_IK</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-938"></a><span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">path_mode</span> <span class="o">=</span> <span class="n">path_mode</span>
<a name="ln-939"></a>        <span class="k">else</span>
<a name="ln-940"></a><span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">path_mode</span> <span class="o">=</span> <span class="mi">1_IK</span>  <span class="c">! just to have a valid value</span>
<a name="ln-941"></a>            <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Invalid path_mode.&#39;</span><span class="p">)</span>
<a name="ln-942"></a>        <span class="k">end if</span>
<a name="ln-943"></a><span class="k">    end if</span>
<a name="ln-944"></a>
<a name="ln-945"></a>    <span class="c">! if we are allowing comments in the file:</span>
<a name="ln-946"></a>    <span class="c">! [an empty string disables comments]</span>
<a name="ln-947"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">comment_char</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-948"></a><span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">allow_comments</span> <span class="o">=</span> <span class="n">comment_char</span><span class="o">/=</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-949"></a>        <span class="n">me</span><span class="p">%</span><span class="n">comment_char</span> <span class="o">=</span> <span class="n">comment_char</span>
<a name="ln-950"></a>    <span class="k">end if</span>
<a name="ln-951"></a>
<a name="ln-952"></a>    <span class="c">! path separator:</span>
<a name="ln-953"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">path_separator</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-954"></a><span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">path_separator</span> <span class="o">=</span> <span class="n">path_separator</span>
<a name="ln-955"></a>    <span class="k">end if</span>
<a name="ln-956"></a>
<a name="ln-957"></a>    <span class="c">! printing vectors in compressed form:</span>
<a name="ln-958"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">compress_vectors</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-959"></a><span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">compress_vectors</span> <span class="o">=</span> <span class="n">compress_vectors</span>
<a name="ln-960"></a>    <span class="k">end if</span>
<a name="ln-961"></a>
<a name="ln-962"></a>    <span class="c">! checking for duplicate keys:</span>
<a name="ln-963"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">allow_duplicate_keys</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-964"></a><span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">allow_duplicate_keys</span> <span class="o">=</span> <span class="n">allow_duplicate_keys</span>
<a name="ln-965"></a>    <span class="k">end if</span>
<a name="ln-966"></a>
<a name="ln-967"></a>    <span class="c">! if escaping the forward slash:</span>
<a name="ln-968"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">escape_solidus</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-969"></a><span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">escape_solidus</span> <span class="o">=</span> <span class="n">escape_solidus</span>
<a name="ln-970"></a>    <span class="k">end if</span>
<a name="ln-971"></a>
<a name="ln-972"></a>    <span class="c">!Set the format for real numbers:</span>
<a name="ln-973"></a>    <span class="c">! [if not changing it, then it remains the same]</span>
<a name="ln-974"></a>
<a name="ln-975"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">real_fmt</span><span class="p">))</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>  <span class="c">! if this hasn&#39;t been done yet</span>
<a name="ln-976"></a>          <span class="nb">present</span><span class="p">(</span><span class="n">compact_reals</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-977"></a>          <span class="nb">present</span><span class="p">(</span><span class="n">print_signs</span><span class="p">)</span>   <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-978"></a>          <span class="nb">present</span><span class="p">(</span><span class="n">real_format</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-979"></a>
<a name="ln-980"></a>        <span class="c">!allow the special case where real format is &#39;*&#39;:</span>
<a name="ln-981"></a>        <span class="c">! [this overrides the other options]</span>
<a name="ln-982"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">real_format</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-983"></a><span class="k">            if</span> <span class="p">(</span><span class="n">real_format</span><span class="o">==</span><span class="n">star</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-984"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">compact_reals</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-985"></a>                    <span class="c">! we will also allow for compact reals with</span>
<a name="ln-986"></a>                    <span class="c">! &#39;*&#39; format, if both arguments are present.</span>
<a name="ln-987"></a>                    <span class="n">me</span><span class="p">%</span><span class="n">compact_real</span> <span class="o">=</span> <span class="n">compact_reals</span>
<a name="ln-988"></a>                <span class="k">else</span>
<a name="ln-989"></a><span class="k">                    </span><span class="n">me</span><span class="p">%</span><span class="n">compact_real</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-990"></a>                <span class="k">end if</span>
<a name="ln-991"></a><span class="k">                </span><span class="n">me</span><span class="p">%</span><span class="n">real_fmt</span> <span class="o">=</span> <span class="n">star</span>
<a name="ln-992"></a>                <span class="k">return</span>
<a name="ln-993"></a><span class="k">            end if</span>
<a name="ln-994"></a><span class="k">        end if</span>
<a name="ln-995"></a>
<a name="ln-996"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">compact_reals</span><span class="p">))</span> <span class="n">me</span><span class="p">%</span><span class="n">compact_real</span> <span class="o">=</span> <span class="n">compact_reals</span>
<a name="ln-997"></a>
<a name="ln-998"></a>        <span class="c">!set defaults</span>
<a name="ln-999"></a>        <span class="n">sgn_prnt</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1000"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span> <span class="n">print_signs</span><span class="p">)</span> <span class="p">)</span> <span class="n">sgn_prnt</span> <span class="o">=</span> <span class="n">print_signs</span>
<a name="ln-1001"></a>        <span class="k">if</span> <span class="p">(</span> <span class="n">sgn_prnt</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-1002"></a><span class="k">           </span><span class="n">sgn</span> <span class="o">=</span> <span class="s1">&#39;sp&#39;</span>
<a name="ln-1003"></a>        <span class="k">else</span>
<a name="ln-1004"></a><span class="k">           </span><span class="n">sgn</span> <span class="o">=</span> <span class="s1">&#39;ss&#39;</span>
<a name="ln-1005"></a>        <span class="k">end if</span>
<a name="ln-1006"></a>
<a name="ln-1007"></a><span class="k">        </span><span class="n">rl_edit_desc</span> <span class="o">=</span> <span class="s1">&#39;E&#39;</span>
<a name="ln-1008"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span> <span class="n">real_format</span> <span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-1009"></a><span class="k">           select case</span> <span class="p">(</span> <span class="n">real_format</span> <span class="p">)</span>
<a name="ln-1010"></a>           <span class="k">case</span> <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;en&#39;</span><span class="p">,</span><span class="s1">&#39;EN&#39;</span><span class="p">,</span><span class="s1">&#39;es&#39;</span><span class="p">,</span><span class="s1">&#39;ES&#39;</span><span class="p">)</span>
<a name="ln-1011"></a>              <span class="n">rl_edit_desc</span> <span class="o">=</span> <span class="n">real_format</span>
<a name="ln-1012"></a>           <span class="k">case </span><span class="n">default</span>
<a name="ln-1013"></a>              <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Invalid real format, &quot;&#39;</span> <span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-1014"></a>                        <span class="nb">trim</span><span class="p">(</span><span class="n">real_format</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;&quot;, passed to json_initialize.&#39;</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-1015"></a>                        <span class="nb">new_line</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;Acceptable formats are: &quot;G&quot;, &quot;E&quot;, &quot;EN&quot;, and &quot;ES&quot;.&#39;</span> <span class="p">)</span>
<a name="ln-1016"></a>           <span class="k">end select</span>
<a name="ln-1017"></a><span class="k">        end if</span>
<a name="ln-1018"></a>
<a name="ln-1019"></a>        <span class="c">! set the default output/input format for reals:</span>
<a name="ln-1020"></a>                      <span class="k">write</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s1">&#39;(ss,I0)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">max_numeric_str_len</span>
<a name="ln-1021"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;(ss,I0)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">real_precision</span>
<a name="ln-1022"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">write</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="s1">&#39;(ss,I0)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">real_exponent_digits</span>
<a name="ln-1023"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1024"></a><span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">real_fmt</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">//</span> <span class="n">sgn</span> <span class="o">//</span> <span class="s1">&#39;,&#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">rl_edit_desc</span><span class="p">)</span> <span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1025"></a>                            <span class="nb">trim</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;.&#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;E&#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">//</span> <span class="s1">&#39;)&#39;</span>
<a name="ln-1026"></a>        <span class="k">else</span>
<a name="ln-1027"></a><span class="k">            </span><span class="n">me</span><span class="p">%</span><span class="n">real_fmt</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">//</span> <span class="n">sgn</span> <span class="o">//</span> <span class="s1">&#39;,&#39;</span> <span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">rl_edit_desc</span><span class="p">)</span> <span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-1028"></a>                            <span class="s1">&#39;27.17E4)&#39;</span>  <span class="c">!just use this one (should never happen)</span>
<a name="ln-1029"></a>        <span class="k">end if</span>
<a name="ln-1030"></a>
<a name="ln-1031"></a><span class="k">    end if</span>
<a name="ln-1032"></a>
<a name="ln-1033"></a><span class="k">    end subroutine </span><span class="n">json_initialize</span>
<a name="ln-1034"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1035"></a>
<a name="ln-1036"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1037"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1038"></a><span class="c">!</span>
<a name="ln-1039"></a><span class="c">!  Returns true if `name` is equal to `p%name`, using the specified</span>
<a name="ln-1040"></a><span class="c">!  settings for case sensitivity and trailing whitespace.</span>
<a name="ln-1041"></a><span class="c">!</span>
<a name="ln-1042"></a><span class="c">!### History</span>
<a name="ln-1043"></a><span class="c">!  * 4/30/2016 : original version</span>
<a name="ln-1044"></a><span class="c">!  * 8/25/2017 : now just a wrapper for [[name_strings_equal]]</span>
<a name="ln-1045"></a>
<a name="ln-1046"></a>    <span class="k">function </span><span class="n">name_equal</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">is_equal</span><span class="p">)</span>
<a name="ln-1047"></a>
<a name="ln-1048"></a>    <span class="k">implicit none</span>
<a name="ln-1049"></a>
<a name="ln-1050"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1051"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">p</span>        <span class="c">!! the json object</span>
<a name="ln-1052"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>     <span class="c">!! the name to check for</span>
<a name="ln-1053"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">is_equal</span> <span class="c">!! true if the string are</span>
<a name="ln-1054"></a>                                                    <span class="c">!! lexically equal</span>
<a name="ln-1055"></a>
<a name="ln-1056"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1057"></a>        <span class="c">! call the low-level routines for the name strings:</span>
<a name="ln-1058"></a>        <span class="n">is_equal</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">name_strings_equal</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1059"></a>    <span class="k">else</span>
<a name="ln-1060"></a><span class="k">        </span><span class="n">is_equal</span> <span class="o">=</span> <span class="n">name</span> <span class="o">==</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span> <span class="c">! check a blank name</span>
<a name="ln-1061"></a>    <span class="k">end if</span>
<a name="ln-1062"></a>
<a name="ln-1063"></a><span class="k">    end function </span><span class="n">name_equal</span>
<a name="ln-1064"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1065"></a>
<a name="ln-1066"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1067"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1068"></a><span class="c">!  date: 8/25/2017</span>
<a name="ln-1069"></a><span class="c">!</span>
<a name="ln-1070"></a><span class="c">!  Returns true if the name strings `name1` is equal to `name2`, using</span>
<a name="ln-1071"></a><span class="c">!  the specified settings for case sensitivity and trailing whitespace.</span>
<a name="ln-1072"></a>
<a name="ln-1073"></a>    <span class="k">function </span><span class="n">name_strings_equal</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">name1</span><span class="p">,</span><span class="n">name2</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">is_equal</span><span class="p">)</span>
<a name="ln-1074"></a>
<a name="ln-1075"></a>    <span class="k">implicit none</span>
<a name="ln-1076"></a>
<a name="ln-1077"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1078"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name1</span>     <span class="c">!! the name to check</span>
<a name="ln-1079"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name2</span>     <span class="c">!! the name to check</span>
<a name="ln-1080"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">is_equal</span>  <span class="c">!! true if the string are</span>
<a name="ln-1081"></a>                                                     <span class="c">!! lexically equal</span>
<a name="ln-1082"></a>
<a name="ln-1083"></a>    <span class="c">!must be the same length if we are treating</span>
<a name="ln-1084"></a>    <span class="c">!trailing spaces as significant, so do a</span>
<a name="ln-1085"></a>    <span class="c">!quick test of this first:</span>
<a name="ln-1086"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1087"></a><span class="k">        </span><span class="n">is_equal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">name1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">name2</span><span class="p">)</span>
<a name="ln-1088"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_equal</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1089"></a><span class="k">    end if</span>
<a name="ln-1090"></a>
<a name="ln-1091"></a><span class="k">    if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">case_sensitive_keys</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1092"></a><span class="k">        </span><span class="n">is_equal</span> <span class="o">=</span> <span class="n">name1</span> <span class="o">==</span> <span class="n">name2</span>
<a name="ln-1093"></a>    <span class="k">else</span>
<a name="ln-1094"></a><span class="k">        </span><span class="n">is_equal</span> <span class="o">=</span> <span class="n">lowercase_string</span><span class="p">(</span><span class="n">name1</span><span class="p">)</span> <span class="o">==</span> <span class="n">lowercase_string</span><span class="p">(</span><span class="n">name2</span><span class="p">)</span>
<a name="ln-1095"></a>    <span class="k">end if</span>
<a name="ln-1096"></a>
<a name="ln-1097"></a><span class="k">    end function </span><span class="n">name_strings_equal</span>
<a name="ln-1098"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1099"></a>
<a name="ln-1100"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1101"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1102"></a><span class="c">!  date: 10/31/2015</span>
<a name="ln-1103"></a><span class="c">!</span>
<a name="ln-1104"></a><span class="c">!  Create a deep copy of a [[json_value]] linked-list structure.</span>
<a name="ln-1105"></a><span class="c">!</span>
<a name="ln-1106"></a><span class="c">!### Example</span>
<a name="ln-1107"></a><span class="c">!</span>
<a name="ln-1108"></a><span class="c">!````fortran</span>
<a name="ln-1109"></a><span class="c">!    program test</span>
<a name="ln-1110"></a><span class="c">!     use json_module</span>
<a name="ln-1111"></a><span class="c">!     implicit none</span>
<a name="ln-1112"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-1113"></a><span class="c">!     type(json_value),pointer :: j1, j2</span>
<a name="ln-1114"></a><span class="c">!     call json%parse(&#39;../files/inputs/test1.json&#39;,j1)</span>
<a name="ln-1115"></a><span class="c">!     call json%clone(j1,j2) !now have two independent copies</span>
<a name="ln-1116"></a><span class="c">!     call json%destroy(j1)  !destroys j1, but j2 remains</span>
<a name="ln-1117"></a><span class="c">!     call json%print(j2,&#39;j2.json&#39;)</span>
<a name="ln-1118"></a><span class="c">!     call json%destroy(j2)</span>
<a name="ln-1119"></a><span class="c">!    end program test</span>
<a name="ln-1120"></a><span class="c">!````</span>
<a name="ln-1121"></a>
<a name="ln-1122"></a>    <span class="k">subroutine </span><span class="n">json_clone</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">from</span><span class="p">,</span><span class="n">to</span><span class="p">)</span>
<a name="ln-1123"></a>
<a name="ln-1124"></a>    <span class="k">implicit none</span>
<a name="ln-1125"></a>
<a name="ln-1126"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1127"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">from</span>  <span class="c">!! this is the structure to clone</span>
<a name="ln-1128"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">to</span>    <span class="c">!! the clone is put here</span>
<a name="ln-1129"></a>                                      <span class="c">!! (it must not already be associated)</span>
<a name="ln-1130"></a>
<a name="ln-1131"></a>    <span class="c">!call the main function:</span>
<a name="ln-1132"></a>    <span class="c">! [note: this is not part of json_core class]</span>
<a name="ln-1133"></a>    <span class="k">call </span><span class="n">json_value_clone_func</span><span class="p">(</span><span class="n">from</span><span class="p">,</span><span class="n">to</span><span class="p">)</span>
<a name="ln-1134"></a>
<a name="ln-1135"></a>    <span class="k">end subroutine </span><span class="n">json_clone</span>
<a name="ln-1136"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1137"></a>
<a name="ln-1138"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1139"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1140"></a><span class="c">!  date: 10/31/2015</span>
<a name="ln-1141"></a><span class="c">!</span>
<a name="ln-1142"></a><span class="c">!  Recursive deep copy function called by [[json_clone]].</span>
<a name="ln-1143"></a><span class="c">!</span>
<a name="ln-1144"></a><span class="c">!@note If new data is added to the [[json_value]] type,</span>
<a name="ln-1145"></a><span class="c">!      then this would need to be updated.</span>
<a name="ln-1146"></a>
<a name="ln-1147"></a>    <span class="k">recursive subroutine </span><span class="n">json_value_clone_func</span><span class="p">(</span><span class="n">from</span><span class="p">,</span><span class="n">to</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">previous</span><span class="p">,</span><span class="n">next</span><span class="p">,</span><span class="n">children</span><span class="p">,</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-1148"></a>
<a name="ln-1149"></a>    <span class="k">implicit none</span>
<a name="ln-1150"></a>
<a name="ln-1151"></a><span class="k">    type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>          <span class="kd">::</span> <span class="n">from</span>     <span class="c">!! this is the structure to clone</span>
<a name="ln-1152"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>          <span class="kd">::</span> <span class="n">to</span>       <span class="c">!! the clone is put here (it</span>
<a name="ln-1153"></a>                                                  <span class="c">!! must not already be associated)</span>
<a name="ln-1154"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">parent</span>   <span class="c">!! to%parent</span>
<a name="ln-1155"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">previous</span> <span class="c">!! to%previous</span>
<a name="ln-1156"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">next</span>     <span class="c">!! to%next</span>
<a name="ln-1157"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">children</span> <span class="c">!! to%children</span>
<a name="ln-1158"></a>    <span class="kt">logical</span><span class="p">,</span><span class="k">optional</span>                  <span class="kd">::</span> <span class="n">tail</span>     <span class="c">!! if &quot;to&quot; is the tail of</span>
<a name="ln-1159"></a>                                                  <span class="c">!! its parent&#39;s children</span>
<a name="ln-1160"></a>
<a name="ln-1161"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
<a name="ln-1162"></a>
<a name="ln-1163"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">from</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1164"></a>
<a name="ln-1165"></a><span class="k">        allocate</span><span class="p">(</span><span class="n">to</span><span class="p">)</span>
<a name="ln-1166"></a>
<a name="ln-1167"></a>        <span class="c">!copy over the data variables:</span>
<a name="ln-1168"></a>        <span class="c">! [note: the allocate() statements don&#39;t work here for the</span>
<a name="ln-1169"></a>        <span class="c">!  deferred-length characters in gfortran-4.9]</span>
<a name="ln-1170"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">name</span><span class="p">))</span>      <span class="n">to</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">from</span><span class="p">%</span><span class="n">name</span>
<a name="ln-1171"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">to</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">from</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span>
<a name="ln-1172"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">log_value</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">to</span><span class="p">%</span><span class="n">log_value</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">from</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span>
<a name="ln-1173"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="n">to</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="n">from</span><span class="p">%</span><span class="n">str_value</span>
<a name="ln-1174"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">int_value</span><span class="p">))</span> <span class="k">allocate</span><span class="p">(</span><span class="n">to</span><span class="p">%</span><span class="n">int_value</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">from</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span>
<a name="ln-1175"></a>        <span class="n">to</span><span class="p">%</span><span class="n">var_type</span>   <span class="o">=</span> <span class="n">from</span><span class="p">%</span><span class="n">var_type</span>
<a name="ln-1176"></a>        <span class="n">to</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="n">from</span><span class="p">%</span><span class="n">n_children</span>
<a name="ln-1177"></a>
<a name="ln-1178"></a>        <span class="c">!allocate and associate the pointers as necessary:</span>
<a name="ln-1179"></a>
<a name="ln-1180"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>      <span class="n">to</span><span class="p">%</span><span class="n">parent</span>      <span class="o">=&gt;</span> <span class="n">parent</span>
<a name="ln-1181"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">previous</span><span class="p">))</span>    <span class="n">to</span><span class="p">%</span><span class="n">previous</span>    <span class="o">=&gt;</span> <span class="n">previous</span>
<a name="ln-1182"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">next</span><span class="p">))</span>        <span class="n">to</span><span class="p">%</span><span class="n">next</span>        <span class="o">=&gt;</span> <span class="n">next</span>
<a name="ln-1183"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">children</span><span class="p">))</span>    <span class="n">to</span><span class="p">%</span><span class="n">children</span>    <span class="o">=&gt;</span> <span class="n">children</span>
<a name="ln-1184"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">tail</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1185"></a><span class="k">            if</span> <span class="p">(</span><span class="n">tail</span><span class="p">)</span> <span class="n">to</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">to</span>
<a name="ln-1186"></a>        <span class="k">end if</span>
<a name="ln-1187"></a>
<a name="ln-1188"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1189"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">to</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-1190"></a>            <span class="k">call </span><span class="n">json_value_clone_func</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">next</span><span class="p">,&amp;</span>
<a name="ln-1191"></a>                                       <span class="n">to</span><span class="p">%</span><span class="n">next</span><span class="p">,&amp;</span>
<a name="ln-1192"></a>                                       <span class="n">previous</span><span class="o">=</span><span class="n">to</span><span class="p">,&amp;</span>
<a name="ln-1193"></a>                                       <span class="n">parent</span><span class="o">=</span><span class="n">to</span><span class="p">%</span><span class="n">parent</span><span class="p">,&amp;</span>
<a name="ln-1194"></a>                                       <span class="n">tail</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">next</span><span class="p">%</span><span class="n">next</span><span class="p">)))</span>
<a name="ln-1195"></a>        <span class="k">end if</span>
<a name="ln-1196"></a>
<a name="ln-1197"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1198"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">to</span><span class="p">%</span><span class="n">children</span><span class="p">)</span>
<a name="ln-1199"></a>            <span class="k">call </span><span class="n">json_value_clone_func</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">children</span><span class="p">,&amp;</span>
<a name="ln-1200"></a>                                       <span class="n">to</span><span class="p">%</span><span class="n">children</span><span class="p">,&amp;</span>
<a name="ln-1201"></a>                                       <span class="n">parent</span><span class="o">=</span><span class="n">to</span><span class="p">,&amp;</span>
<a name="ln-1202"></a>                                       <span class="n">tail</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">from</span><span class="p">%</span><span class="n">children</span><span class="p">%</span><span class="n">next</span><span class="p">)))</span>
<a name="ln-1203"></a>        <span class="k">end if</span>
<a name="ln-1204"></a>
<a name="ln-1205"></a><span class="k">    end if</span>
<a name="ln-1206"></a>
<a name="ln-1207"></a><span class="k">    end subroutine </span><span class="n">json_value_clone_func</span>
<a name="ln-1208"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1209"></a>
<a name="ln-1210"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1211"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1212"></a><span class="c">!</span>
<a name="ln-1213"></a><span class="c">!  Destroy the data within a [[json_value]], and reset type to `json_unknown`.</span>
<a name="ln-1214"></a>
<a name="ln-1215"></a>    <span class="k">subroutine </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<a name="ln-1216"></a>
<a name="ln-1217"></a>    <span class="k">implicit none</span>
<a name="ln-1218"></a>
<a name="ln-1219"></a><span class="k">    type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">d</span>
<a name="ln-1220"></a>
<a name="ln-1221"></a>    <span class="n">d</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_unknown</span>
<a name="ln-1222"></a>
<a name="ln-1223"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">log_value</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span>
<a name="ln-1224"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">int_value</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span>
<a name="ln-1225"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span>
<a name="ln-1226"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">d</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span>
<a name="ln-1227"></a>
<a name="ln-1228"></a>    <span class="k">end subroutine </span><span class="n">destroy_json_data</span>
<a name="ln-1229"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1230"></a>
<a name="ln-1231"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1232"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1233"></a><span class="c">!  date: 2/13/2014</span>
<a name="ln-1234"></a><span class="c">!</span>
<a name="ln-1235"></a><span class="c">!  Returns information about a [[json_value]].</span>
<a name="ln-1236"></a>
<a name="ln-1237"></a>    <span class="k">subroutine </span><span class="n">json_info</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1238"></a>
<a name="ln-1239"></a>    <span class="k">implicit none</span>
<a name="ln-1240"></a>
<a name="ln-1241"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1242"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>         <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1243"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">var_type</span>   <span class="c">!! variable type</span>
<a name="ln-1244"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">n_children</span> <span class="c">!! number of children</span>
<a name="ln-1245"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1246"></a>
<a name="ln-1247"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span>    <span class="n">var_type</span>   <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span>
<a name="ln-1248"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">n_children</span><span class="p">))</span>  <span class="n">n_children</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-1249"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1250"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1251"></a><span class="k">            </span><span class="n">name</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">name</span>
<a name="ln-1252"></a>        <span class="k">else</span>
<a name="ln-1253"></a><span class="k">            </span><span class="n">name</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1254"></a>        <span class="k">end if</span>
<a name="ln-1255"></a><span class="k">    end if</span>
<a name="ln-1256"></a>
<a name="ln-1257"></a><span class="k">    end subroutine </span><span class="n">json_info</span>
<a name="ln-1258"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1259"></a>
<a name="ln-1260"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1261"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1262"></a><span class="c">!  date: 12/18/2016</span>
<a name="ln-1263"></a><span class="c">!</span>
<a name="ln-1264"></a><span class="c">!  Returns information about character strings returned from a [[json_value]].</span>
<a name="ln-1265"></a>
<a name="ln-1266"></a>    <span class="k">subroutine </span><span class="n">json_string_info</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">max_str_len</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-1267"></a>
<a name="ln-1268"></a>    <span class="k">implicit none</span>
<a name="ln-1269"></a>
<a name="ln-1270"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1271"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>         <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1272"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! if `p` is an array, this</span>
<a name="ln-1273"></a>                                                                      <span class="c">!! is the actual length</span>
<a name="ln-1274"></a>                                                                      <span class="c">!! of each character</span>
<a name="ln-1275"></a>                                                                      <span class="c">!! string in the array.</span>
<a name="ln-1276"></a>                                                                      <span class="c">!! if not an array, this</span>
<a name="ln-1277"></a>                                                                      <span class="c">!! is returned unallocated.</span>
<a name="ln-1278"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">max_str_len</span> <span class="c">!! The maximum length required to</span>
<a name="ln-1279"></a>                                                    <span class="c">!! hold the string representation returned</span>
<a name="ln-1280"></a>                                                    <span class="c">!! by a call to a `get` routine. If a scalar,</span>
<a name="ln-1281"></a>                                                    <span class="c">!! this is just the length of the scalar. If</span>
<a name="ln-1282"></a>                                                    <span class="c">!! a vector, this is the maximum length of</span>
<a name="ln-1283"></a>                                                    <span class="c">!! any element.</span>
<a name="ln-1284"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">found</span>   <span class="c">!! true if there were no errors.</span>
<a name="ln-1285"></a>                                                <span class="c">!! if not present, an error will</span>
<a name="ln-1286"></a>                                                <span class="c">!! throw an exception</span>
<a name="ln-1287"></a>
<a name="ln-1288"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">cval</span> <span class="c">!! for getting values as strings.</span>
<a name="ln-1289"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span> <span class="c">!! if the output array has been sized</span>
<a name="ln-1290"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">get_max_len</span> <span class="c">!! if we are returning the `max_str_len`</span>
<a name="ln-1291"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">get_ilen</span>    <span class="c">!! if we are returning the `ilen` array</span>
<a name="ln-1292"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>    <span class="c">!! variable type</span>
<a name="ln-1293"></a>
<a name="ln-1294"></a>    <span class="n">get_max_len</span> <span class="o">=</span> <span class="nb">present</span><span class="p">(</span><span class="n">max_str_len</span><span class="p">)</span>
<a name="ln-1295"></a>    <span class="n">get_ilen</span>    <span class="o">=</span> <span class="nb">present</span><span class="p">(</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-1296"></a>
<a name="ln-1297"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1298"></a>
<a name="ln-1299"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1300"></a>        <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1301"></a>
<a name="ln-1302"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">get_max_len</span><span class="p">)</span> <span class="n">max_str_len</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1303"></a>
<a name="ln-1304"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-1305"></a>
<a name="ln-1306"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span> <span class="c">! it&#39;s an array</span>
<a name="ln-1307"></a>
<a name="ln-1308"></a>            <span class="c">! call routine for each element</span>
<a name="ln-1309"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_string_lengths</span><span class="p">)</span>
<a name="ln-1310"></a>
<a name="ln-1311"></a>        <span class="k">case </span><span class="n">default</span> <span class="c">! not an array</span>
<a name="ln-1312"></a>
<a name="ln-1313"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1314"></a>                <span class="c">! only allowing strings to be returned</span>
<a name="ln-1315"></a>                <span class="c">! as strings, so we can check size directly</span>
<a name="ln-1316"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-1317"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_string</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1318"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">get_max_len</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1319"></a>                        <span class="n">max_str_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span>
<a name="ln-1320"></a>                <span class="k">else</span>
<a name="ln-1321"></a>                    <span class="c">! it isn&#39;t a string, so there is no length</span>
<a name="ln-1322"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_string_info: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1323"></a>                                              <span class="s1">&#39;When strict_type_checking is true &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1324"></a>                                              <span class="s1">&#39;the variable must be a character string.&#39;</span><span class="p">)</span>
<a name="ln-1325"></a>                <span class="k">end if</span>
<a name="ln-1326"></a><span class="k">            else</span>
<a name="ln-1327"></a>                <span class="c">! in this case, we have to get the value</span>
<a name="ln-1328"></a>                <span class="c">! as a string to know what size it is.</span>
<a name="ln-1329"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-1330"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1331"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">get_max_len</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1332"></a>                        <span class="n">max_str_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-1333"></a>                <span class="k">end if</span>
<a name="ln-1334"></a><span class="k">            end if</span>
<a name="ln-1335"></a>
<a name="ln-1336"></a><span class="k">        end select</span>
<a name="ln-1337"></a>
<a name="ln-1338"></a><span class="k">    end if</span>
<a name="ln-1339"></a>
<a name="ln-1340"></a><span class="k">    if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1341"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1342"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-1343"></a>            <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1344"></a>        <span class="k">end if</span>
<a name="ln-1345"></a><span class="k">        if</span> <span class="p">(</span><span class="n">get_max_len</span><span class="p">)</span> <span class="n">max_str_len</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1346"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1347"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">ilen</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-1348"></a>        <span class="k">end if</span>
<a name="ln-1349"></a><span class="k">    end if</span>
<a name="ln-1350"></a>
<a name="ln-1351"></a><span class="k">    contains</span>
<a name="ln-1352"></a>
<a name="ln-1353"></a><span class="k">        subroutine </span><span class="n">get_string_lengths</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-1354"></a>
<a name="ln-1355"></a>        <span class="c">!! callback function to call for each element in the array.</span>
<a name="ln-1356"></a>
<a name="ln-1357"></a>        <span class="k">implicit none</span>
<a name="ln-1358"></a>
<a name="ln-1359"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1360"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-1361"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-1362"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-1363"></a>
<a name="ln-1364"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">cval</span>
<a name="ln-1365"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>
<a name="ln-1366"></a>
<a name="ln-1367"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1368"></a>
<a name="ln-1369"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1370"></a><span class="k">            if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="k">allocate</span><span class="p">(</span><span class="n">ilen</span><span class="p">(</span><span class="nb">count</span><span class="p">))</span>
<a name="ln-1371"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1372"></a>        <span class="k">end if</span>
<a name="ln-1373"></a>
<a name="ln-1374"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1375"></a>            <span class="c">! only allowing strings to be returned</span>
<a name="ln-1376"></a>            <span class="c">! as strings, so we can check size directly</span>
<a name="ln-1377"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-1378"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_string</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1379"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1380"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">get_max_len</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1381"></a><span class="k">                        if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span><span class="o">&gt;</span><span class="n">max_str_len</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-1382"></a>                                <span class="n">max_str_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span>
<a name="ln-1383"></a>                    <span class="k">end if</span>
<a name="ln-1384"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span>
<a name="ln-1385"></a>                <span class="k">else</span>
<a name="ln-1386"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1387"></a>                <span class="k">end if</span>
<a name="ln-1388"></a><span class="k">            else</span>
<a name="ln-1389"></a>                <span class="c">! it isn&#39;t a string, so there is no length</span>
<a name="ln-1390"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_string_info: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1391"></a>                                            <span class="s1">&#39;When strict_type_checking is true &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1392"></a>                                            <span class="s1">&#39;the array must contain only &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1393"></a>                                            <span class="s1">&#39;character strings.&#39;</span><span class="p">)</span>
<a name="ln-1394"></a>            <span class="k">end if</span>
<a name="ln-1395"></a><span class="k">        else</span>
<a name="ln-1396"></a>            <span class="c">! in this case, we have to get the value</span>
<a name="ln-1397"></a>            <span class="c">! as a string to know what size it is.</span>
<a name="ln-1398"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-1399"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-1400"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">cval</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1401"></a><span class="k">                if</span> <span class="p">(</span><span class="n">get_max_len</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1402"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span><span class="o">&gt;</span><span class="n">max_str_len</span><span class="p">)</span> <span class="n">max_str_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-1403"></a>                <span class="k">end if</span>
<a name="ln-1404"></a><span class="k">                if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-1405"></a>            <span class="k">else</span>
<a name="ln-1406"></a><span class="k">                if</span> <span class="p">(</span><span class="n">get_ilen</span><span class="p">)</span> <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1407"></a>            <span class="k">end if</span>
<a name="ln-1408"></a><span class="k">        end if</span>
<a name="ln-1409"></a>
<a name="ln-1410"></a><span class="k">        end subroutine </span><span class="n">get_string_lengths</span>
<a name="ln-1411"></a>
<a name="ln-1412"></a>    <span class="k">end subroutine </span><span class="n">json_string_info</span>
<a name="ln-1413"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1414"></a>
<a name="ln-1415"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1416"></a><span class="c">!</span>
<a name="ln-1417"></a><span class="c">!  Returns information about a [[json_value]], given the path.</span>
<a name="ln-1418"></a><span class="c">!</span>
<a name="ln-1419"></a><span class="c">!### See also</span>
<a name="ln-1420"></a><span class="c">!  * [[json_info]]</span>
<a name="ln-1421"></a><span class="c">!</span>
<a name="ln-1422"></a><span class="c">!@note If `found` is present, no exceptions will be thrown if an</span>
<a name="ln-1423"></a><span class="c">!      error occurs. Otherwise, an exception will be thrown if the</span>
<a name="ln-1424"></a><span class="c">!      variable is not found.</span>
<a name="ln-1425"></a>
<a name="ln-1426"></a>    <span class="k">subroutine </span><span class="n">json_info_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1427"></a>
<a name="ln-1428"></a>    <span class="k">implicit none</span>
<a name="ln-1429"></a>
<a name="ln-1430"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1431"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-1432"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>       <span class="c">!! path to the variable</span>
<a name="ln-1433"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>      <span class="c">!! true if it was found</span>
<a name="ln-1434"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">var_type</span>   <span class="c">!! variable type</span>
<a name="ln-1435"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">n_children</span> <span class="c">!! number of children</span>
<a name="ln-1436"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1437"></a>
<a name="ln-1438"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>  <span class="c">!! temporary pointer</span>
<a name="ln-1439"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ok</span>  <span class="c">!! if the variable was found</span>
<a name="ln-1440"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1441"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">p_name</span>  <span class="c">!! temporary variable for getting name</span>
<a name="ln-1442"></a><span class="cp">#endif</span>
<a name="ln-1443"></a>
<a name="ln-1444"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-1445"></a>
<a name="ln-1446"></a>    <span class="c">!check if it was found:</span>
<a name="ln-1447"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1448"></a><span class="k">        </span><span class="n">ok</span> <span class="o">=</span> <span class="n">found</span>
<a name="ln-1449"></a>    <span class="k">else</span>
<a name="ln-1450"></a><span class="k">        </span><span class="n">ok</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span>
<a name="ln-1451"></a>    <span class="k">end if</span>
<a name="ln-1452"></a>
<a name="ln-1453"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1454"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span>   <span class="n">var_type</span>   <span class="o">=</span> <span class="n">json_unknown</span>
<a name="ln-1455"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">n_children</span><span class="p">))</span> <span class="n">n_children</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1456"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>       <span class="n">name</span>       <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1457"></a>    <span class="k">else</span>
<a name="ln-1458"></a>        <span class="c">!get info:</span>
<a name="ln-1459"></a>
<a name="ln-1460"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1461"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">)</span>
<a name="ln-1462"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span> <span class="c">!workaround for gfortran bug</span>
<a name="ln-1463"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p_var</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1464"></a><span class="k">                </span><span class="n">p_name</span> <span class="o">=</span> <span class="n">p_var</span><span class="p">%</span><span class="n">name</span>
<a name="ln-1465"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">p_name</span>
<a name="ln-1466"></a>            <span class="k">else</span>
<a name="ln-1467"></a><span class="k">                </span><span class="n">name</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1468"></a>            <span class="k">end if</span>
<a name="ln-1469"></a><span class="k">        end if</span>
<a name="ln-1470"></a><span class="cp">#else</span>
<a name="ln-1471"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1472"></a><span class="cp">#endif</span>
<a name="ln-1473"></a>
<a name="ln-1474"></a>    <span class="k">end if</span>
<a name="ln-1475"></a>
<a name="ln-1476"></a><span class="k">    end subroutine </span><span class="n">json_info_by_path</span>
<a name="ln-1477"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1478"></a>
<a name="ln-1479"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1480"></a><span class="c">!&gt;</span>
<a name="ln-1481"></a><span class="c">!  Alternate version of [[json_info_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-1482"></a>
<a name="ln-1483"></a>    <span class="k">subroutine </span><span class="n">wrap_json_info_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1484"></a>
<a name="ln-1485"></a>    <span class="k">implicit none</span>
<a name="ln-1486"></a>
<a name="ln-1487"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1488"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-1489"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>       <span class="c">!! path to the variable</span>
<a name="ln-1490"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>      <span class="c">!! true if it was found</span>
<a name="ln-1491"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">var_type</span>   <span class="c">!! variable type</span>
<a name="ln-1492"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">n_children</span> <span class="c">!! number of children</span>
<a name="ln-1493"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1494"></a>
<a name="ln-1495"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">found</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1496"></a>
<a name="ln-1497"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_info_by_path</span>
<a name="ln-1498"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1499"></a>
<a name="ln-1500"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1501"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1502"></a><span class="c">!  date: 10/16/2015</span>
<a name="ln-1503"></a><span class="c">!</span>
<a name="ln-1504"></a><span class="c">!  Alternate version of [[json_info]] that returns matrix</span>
<a name="ln-1505"></a><span class="c">!  information about a [[json_value]].</span>
<a name="ln-1506"></a><span class="c">!</span>
<a name="ln-1507"></a><span class="c">!  A [[json_value]] is a valid rank 2 matrix if all of the following are true:</span>
<a name="ln-1508"></a><span class="c">!</span>
<a name="ln-1509"></a><span class="c">!  * The var_type is *json_array*</span>
<a name="ln-1510"></a><span class="c">!  * Each child is also a *json_array*, each of which has the same number of elements</span>
<a name="ln-1511"></a><span class="c">!  * Each individual element has the same variable type (integer, logical, etc.)</span>
<a name="ln-1512"></a><span class="c">!</span>
<a name="ln-1513"></a><span class="c">!  The idea here is that if it is a valid matrix, it can be interoperable with</span>
<a name="ln-1514"></a><span class="c">!  a Fortran rank 2 array of the same type.</span>
<a name="ln-1515"></a><span class="c">!</span>
<a name="ln-1516"></a><span class="c">!### Example</span>
<a name="ln-1517"></a><span class="c">!</span>
<a name="ln-1518"></a><span class="c">!  The following example is an array with `var_type=json_integer`,</span>
<a name="ln-1519"></a><span class="c">!  `n_sets=3`, and `set_size=4`</span>
<a name="ln-1520"></a><span class="c">!</span>
<a name="ln-1521"></a><span class="c">!```json</span>
<a name="ln-1522"></a><span class="c">!    {</span>
<a name="ln-1523"></a><span class="c">!        &quot;matrix&quot;: [</span>
<a name="ln-1524"></a><span class="c">!            [1,2,3,4],</span>
<a name="ln-1525"></a><span class="c">!            [5,6,7,8],</span>
<a name="ln-1526"></a><span class="c">!            [9,10,11,12]</span>
<a name="ln-1527"></a><span class="c">!        ]</span>
<a name="ln-1528"></a><span class="c">!    }</span>
<a name="ln-1529"></a><span class="c">!```</span>
<a name="ln-1530"></a>
<a name="ln-1531"></a>    <span class="k">subroutine </span><span class="n">json_matrix_info</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1532"></a>
<a name="ln-1533"></a>    <span class="k">implicit none</span>
<a name="ln-1534"></a>
<a name="ln-1535"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1536"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>         <span class="kd">::</span> <span class="n">p</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-1537"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">is_matrix</span>  <span class="c">!! true if it is a valid matrix</span>
<a name="ln-1538"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">var_type</span>   <span class="c">!! variable type of data in the matrix</span>
<a name="ln-1539"></a>                                                   <span class="c">!! (if all elements have the same type)</span>
<a name="ln-1540"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">n_sets</span>     <span class="c">!! number of data sets (i.e., matrix</span>
<a name="ln-1541"></a>                                                   <span class="c">!! rows if using row-major order)</span>
<a name="ln-1542"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">set_size</span>   <span class="c">!! size of each data set (i.e., matrix</span>
<a name="ln-1543"></a>                                                   <span class="c">!! cols if using row-major order)</span>
<a name="ln-1544"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1545"></a>
<a name="ln-1546"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_row</span>       <span class="c">!! for getting a set</span>
<a name="ln-1547"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_element</span>   <span class="c">!! for getting an element in a set</span>
<a name="ln-1548"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vartype</span>         <span class="c">!! json variable type of `p`</span>
<a name="ln-1549"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">row_vartype</span>     <span class="c">!! json variable type of a row</span>
<a name="ln-1550"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element_vartype</span> <span class="c">!! json variable type of an element in a row</span>
<a name="ln-1551"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nr</span>              <span class="c">!! number of children of `p`</span>
<a name="ln-1552"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nc</span>              <span class="c">!! number of elements in first child of `p`</span>
<a name="ln-1553"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">icount</span>          <span class="c">!! number of elements in a set</span>
<a name="ln-1554"></a>    <span class="kt">integer</span>     <span class="kd">::</span> <span class="n">i</span>               <span class="c">!! counter</span>
<a name="ln-1555"></a>    <span class="kt">integer</span>     <span class="kd">::</span> <span class="n">j</span>               <span class="c">!! counter</span>
<a name="ln-1556"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1557"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">p_name</span>  <span class="c">!! temporary variable for getting name</span>
<a name="ln-1558"></a><span class="cp">#endif</span>
<a name="ln-1559"></a>
<a name="ln-1560"></a>    <span class="c">!get info about the variable:</span>
<a name="ln-1561"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1562"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vartype</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span>
<a name="ln-1563"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span> <span class="c">!workaround for gfortran bug</span>
<a name="ln-1564"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1565"></a><span class="k">            </span><span class="n">p_name</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">name</span>
<a name="ln-1566"></a>            <span class="n">name</span> <span class="o">=</span> <span class="n">p_name</span>
<a name="ln-1567"></a>        <span class="k">else</span>
<a name="ln-1568"></a><span class="k">            </span><span class="n">name</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1569"></a>        <span class="k">end if</span>
<a name="ln-1570"></a><span class="k">    end if</span>
<a name="ln-1571"></a><span class="cp">#else</span>
<a name="ln-1572"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">vartype</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1573"></a><span class="cp">#endif</span>
<a name="ln-1574"></a>
<a name="ln-1575"></a>    <span class="n">is_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">vartype</span><span class="o">==</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-1576"></a>
<a name="ln-1577"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">is_matrix</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1578"></a>
<a name="ln-1579"></a><span class="k">        </span><span class="n">main</span> <span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span>
<a name="ln-1580"></a>
<a name="ln-1581"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">p_row</span><span class="p">)</span>
<a name="ln-1582"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">p_row</span><span class="p">)</span>
<a name="ln-1583"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p_row</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1584"></a><span class="k">                </span><span class="n">is_matrix</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1585"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_matrix_info: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1586"></a>                                          <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-1587"></a>                <span class="k">exit </span><span class="n">main</span>
<a name="ln-1588"></a>            <span class="k">end if</span>
<a name="ln-1589"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_row</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">row_vartype</span><span class="p">,</span><span class="n">n_children</span><span class="o">=</span><span class="n">icount</span><span class="p">)</span>
<a name="ln-1590"></a>
<a name="ln-1591"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">row_vartype</span><span class="o">==</span><span class="n">json_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1592"></a><span class="k">                if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">icount</span>  <span class="c">!number of columns in first row</span>
<a name="ln-1593"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">icount</span><span class="o">==</span><span class="n">nc</span><span class="p">)</span> <span class="k">then</span>   <span class="c">!make sure each row has the same number of columns</span>
<a name="ln-1594"></a>                    <span class="c">!see if all the variables in this row are the same type:</span>
<a name="ln-1595"></a>                    <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">icount</span>
<a name="ln-1596"></a>                        <span class="k">nullify</span><span class="p">(</span><span class="n">p_element</span><span class="p">)</span>
<a name="ln-1597"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p_row</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">p_element</span><span class="p">)</span>
<a name="ln-1598"></a>                        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p_element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1599"></a><span class="k">                            </span><span class="n">is_matrix</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1600"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_matrix_info: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-1601"></a>                                                      <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-1602"></a>                            <span class="k">exit </span><span class="n">main</span>
<a name="ln-1603"></a>                        <span class="k">end if</span>
<a name="ln-1604"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_element</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">element_vartype</span><span class="p">)</span>
<a name="ln-1605"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">j</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="n">vartype</span> <span class="o">=</span> <span class="n">element_vartype</span>  <span class="c">!type of first element</span>
<a name="ln-1606"></a>                                                                        <span class="c">!in the row</span>
<a name="ln-1607"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">vartype</span><span class="o">/=</span><span class="n">element_vartype</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1608"></a>                            <span class="c">!not all variables are the same time</span>
<a name="ln-1609"></a>                            <span class="n">is_matrix</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1610"></a>                            <span class="k">exit </span><span class="n">main</span>
<a name="ln-1611"></a>                        <span class="k">end if</span>
<a name="ln-1612"></a><span class="k">                    end do</span>
<a name="ln-1613"></a><span class="k">                else</span>
<a name="ln-1614"></a><span class="k">                    </span><span class="n">is_matrix</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1615"></a>                    <span class="k">exit </span><span class="n">main</span>
<a name="ln-1616"></a>                <span class="k">end if</span>
<a name="ln-1617"></a><span class="k">            else</span>
<a name="ln-1618"></a><span class="k">                </span><span class="n">is_matrix</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1619"></a>                <span class="k">exit </span><span class="n">main</span>
<a name="ln-1620"></a>            <span class="k">end if</span>
<a name="ln-1621"></a>
<a name="ln-1622"></a><span class="k">        end do </span><span class="n">main</span>
<a name="ln-1623"></a>
<a name="ln-1624"></a>    <span class="k">end if</span>
<a name="ln-1625"></a>
<a name="ln-1626"></a><span class="k">    if</span> <span class="p">(</span><span class="n">is_matrix</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1627"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span> <span class="n">var_type</span> <span class="o">=</span> <span class="n">vartype</span>
<a name="ln-1628"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">n_sets</span><span class="p">))</span>   <span class="n">n_sets</span>   <span class="o">=</span> <span class="n">nr</span>
<a name="ln-1629"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">set_size</span><span class="p">))</span> <span class="n">set_size</span> <span class="o">=</span> <span class="n">nc</span>
<a name="ln-1630"></a>    <span class="k">else</span>
<a name="ln-1631"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span> <span class="n">var_type</span> <span class="o">=</span> <span class="n">json_unknown</span>
<a name="ln-1632"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">n_sets</span><span class="p">))</span>   <span class="n">n_sets</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1633"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">set_size</span><span class="p">))</span> <span class="n">set_size</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1634"></a>    <span class="k">end if</span>
<a name="ln-1635"></a>
<a name="ln-1636"></a><span class="k">    end subroutine </span><span class="n">json_matrix_info</span>
<a name="ln-1637"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1638"></a>
<a name="ln-1639"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1640"></a><span class="c">!&gt;</span>
<a name="ln-1641"></a><span class="c">!  Returns matrix information about a [[json_value]], given the path.</span>
<a name="ln-1642"></a><span class="c">!</span>
<a name="ln-1643"></a><span class="c">!### See also</span>
<a name="ln-1644"></a><span class="c">!  * [[json_matrix_info]]</span>
<a name="ln-1645"></a><span class="c">!</span>
<a name="ln-1646"></a><span class="c">!@note If `found` is present, no exceptions will be thrown if an</span>
<a name="ln-1647"></a><span class="c">!      error occurs. Otherwise, an exception will be thrown if the</span>
<a name="ln-1648"></a><span class="c">!      variable is not found.</span>
<a name="ln-1649"></a>
<a name="ln-1650"></a>    <span class="k">subroutine </span><span class="n">json_matrix_info_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-1651"></a>                                        <span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1652"></a>
<a name="ln-1653"></a>    <span class="k">implicit none</span>
<a name="ln-1654"></a>
<a name="ln-1655"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1656"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>         <span class="c">!! a JSON linked list</span>
<a name="ln-1657"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>      <span class="c">!! path to the variable</span>
<a name="ln-1658"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">is_matrix</span> <span class="c">!! true if it is a valid matrix</span>
<a name="ln-1659"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>     <span class="c">!! true if it was found</span>
<a name="ln-1660"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">var_type</span>  <span class="c">!! variable type of data in</span>
<a name="ln-1661"></a>                                                     <span class="c">!! the matrix (if all elements have</span>
<a name="ln-1662"></a>                                                     <span class="c">!! the same type)</span>
<a name="ln-1663"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">n_sets</span>    <span class="c">!! number of data sets (i.e., matrix</span>
<a name="ln-1664"></a>                                                     <span class="c">!! rows if using row-major order)</span>
<a name="ln-1665"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">set_size</span>  <span class="c">!! size of each data set (i.e., matrix</span>
<a name="ln-1666"></a>                                                     <span class="c">!! cols if using row-major order)</span>
<a name="ln-1667"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1668"></a>
<a name="ln-1669"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-1670"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ok</span>
<a name="ln-1671"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1672"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">p_name</span>  <span class="c">!! temporary variable for getting name</span>
<a name="ln-1673"></a><span class="cp">#endif</span>
<a name="ln-1674"></a>
<a name="ln-1675"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-1676"></a>
<a name="ln-1677"></a>    <span class="c">!check if it was found:</span>
<a name="ln-1678"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1679"></a><span class="k">        </span><span class="n">ok</span> <span class="o">=</span> <span class="n">found</span>
<a name="ln-1680"></a>    <span class="k">else</span>
<a name="ln-1681"></a><span class="k">        </span><span class="n">ok</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span>
<a name="ln-1682"></a>    <span class="k">end if</span>
<a name="ln-1683"></a>
<a name="ln-1684"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1685"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">var_type</span><span class="p">))</span> <span class="n">var_type</span> <span class="o">=</span> <span class="n">json_unknown</span>
<a name="ln-1686"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">n_sets</span><span class="p">))</span>   <span class="n">n_sets</span>   <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1687"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">set_size</span><span class="p">))</span> <span class="n">set_size</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-1688"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>     <span class="n">name</span>     <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1689"></a>    <span class="k">else</span>
<a name="ln-1690"></a>
<a name="ln-1691"></a>        <span class="c">!get info about the variable:</span>
<a name="ln-1692"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-1693"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">matrix_info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">)</span>
<a name="ln-1694"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span> <span class="c">!workaround for gfortran bug</span>
<a name="ln-1695"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p_var</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1696"></a><span class="k">                </span><span class="n">p_name</span> <span class="o">=</span> <span class="n">p_var</span><span class="p">%</span><span class="n">name</span>
<a name="ln-1697"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">p_name</span>
<a name="ln-1698"></a>            <span class="k">else</span>
<a name="ln-1699"></a><span class="k">                </span><span class="n">name</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1700"></a>            <span class="k">end if</span>
<a name="ln-1701"></a><span class="k">        end if</span>
<a name="ln-1702"></a><span class="cp">#else</span>
<a name="ln-1703"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">matrix_info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1704"></a><span class="cp">#endif</span>
<a name="ln-1705"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1706"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1707"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-1708"></a>        <span class="k">end if</span>
<a name="ln-1709"></a><span class="k">    end if</span>
<a name="ln-1710"></a>
<a name="ln-1711"></a><span class="k">    end subroutine </span><span class="n">json_matrix_info_by_path</span>
<a name="ln-1712"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1713"></a>
<a name="ln-1714"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1715"></a><span class="c">!&gt;</span>
<a name="ln-1716"></a><span class="c">!  Alternate version of [[json_matrix_info_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-1717"></a>
<a name="ln-1718"></a>    <span class="k">subroutine </span><span class="n">wrap_json_matrix_info_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-1719"></a>                                             <span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1720"></a>
<a name="ln-1721"></a>    <span class="k">implicit none</span>
<a name="ln-1722"></a>
<a name="ln-1723"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1724"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-1725"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>       <span class="c">!! path to the variable</span>
<a name="ln-1726"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">is_matrix</span>  <span class="c">!! true if it is a valid matrix</span>
<a name="ln-1727"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>      <span class="c">!! true if it was found</span>
<a name="ln-1728"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">var_type</span>   <span class="c">!! variable type of data in</span>
<a name="ln-1729"></a>                                                       <span class="c">!! the matrix (if all elements have</span>
<a name="ln-1730"></a>                                                       <span class="c">!! the same type)</span>
<a name="ln-1731"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">n_sets</span>     <span class="c">!! number of data sets (i.e., matrix</span>
<a name="ln-1732"></a>                                                       <span class="c">!! rows if using row-major order)</span>
<a name="ln-1733"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">set_size</span>   <span class="c">!! size of each data set (i.e., matrix</span>
<a name="ln-1734"></a>                                                       <span class="c">!! cols if using row-major order)</span>
<a name="ln-1735"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! variable name</span>
<a name="ln-1736"></a>
<a name="ln-1737"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">matrix_info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">is_matrix</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">var_type</span><span class="p">,</span><span class="n">n_sets</span><span class="p">,</span><span class="n">set_size</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1738"></a>
<a name="ln-1739"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_matrix_info_by_path</span>
<a name="ln-1740"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1741"></a>
<a name="ln-1742"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1743"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1744"></a><span class="c">!  date: 4/29/2016</span>
<a name="ln-1745"></a><span class="c">!</span>
<a name="ln-1746"></a><span class="c">!  Rename a [[json_value]].</span>
<a name="ln-1747"></a>
<a name="ln-1748"></a>    <span class="k">subroutine </span><span class="n">json_value_rename</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1749"></a>
<a name="ln-1750"></a>    <span class="k">implicit none</span>
<a name="ln-1751"></a>
<a name="ln-1752"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1753"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1754"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! new variable name</span>
<a name="ln-1755"></a>
<a name="ln-1756"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1757"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
<a name="ln-1758"></a>    <span class="k">else</span>
<a name="ln-1759"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1760"></a>    <span class="k">end if</span>
<a name="ln-1761"></a>
<a name="ln-1762"></a><span class="k">    end subroutine </span><span class="n">json_value_rename</span>
<a name="ln-1763"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1764"></a>
<a name="ln-1765"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1766"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1767"></a><span class="c">!  date: 4/29/2016</span>
<a name="ln-1768"></a><span class="c">!</span>
<a name="ln-1769"></a><span class="c">!  Alternate version of [[json_value_rename]], where `name` is kind=CDK.</span>
<a name="ln-1770"></a>
<a name="ln-1771"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_rename</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-1772"></a>
<a name="ln-1773"></a>    <span class="k">implicit none</span>
<a name="ln-1774"></a>
<a name="ln-1775"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1776"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>
<a name="ln-1777"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! new variable name</span>
<a name="ln-1778"></a>
<a name="ln-1779"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-1780"></a>
<a name="ln-1781"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_rename</span>
<a name="ln-1782"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1783"></a>
<a name="ln-1784"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1785"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1786"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-1787"></a><span class="c">!</span>
<a name="ln-1788"></a><span class="c">!  Clear exceptions in the [[json_core(type)]].</span>
<a name="ln-1789"></a>
<a name="ln-1790"></a>    <span class="k">pure subroutine </span><span class="n">json_clear_exceptions</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<a name="ln-1791"></a>
<a name="ln-1792"></a>    <span class="k">implicit none</span>
<a name="ln-1793"></a>
<a name="ln-1794"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1795"></a>
<a name="ln-1796"></a>    <span class="c">!clear the flag and message:</span>
<a name="ln-1797"></a>    <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-1798"></a>    <span class="n">json</span><span class="p">%</span><span class="n">err_message</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1799"></a>
<a name="ln-1800"></a>    <span class="k">end subroutine </span><span class="n">json_clear_exceptions</span>
<a name="ln-1801"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1802"></a>
<a name="ln-1803"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1804"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1805"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-1806"></a><span class="c">!</span>
<a name="ln-1807"></a><span class="c">!  Throw an exception in the [[json_core(type)]].</span>
<a name="ln-1808"></a><span class="c">!  This routine sets the error flag, and prevents any subsequent routine</span>
<a name="ln-1809"></a><span class="c">!  from doing anything, until [[json_clear_exceptions]] is called.</span>
<a name="ln-1810"></a><span class="c">!</span>
<a name="ln-1811"></a><span class="c">!@note If `is_verbose` is true, this will also print a</span>
<a name="ln-1812"></a><span class="c">!      traceback if the Intel compiler is used.</span>
<a name="ln-1813"></a><span class="c">!</span>
<a name="ln-1814"></a><span class="c">!@note If `stop_on_error` is true, then the program is stopped.</span>
<a name="ln-1815"></a>
<a name="ln-1816"></a>    <span class="k">subroutine </span><span class="n">json_throw_exception</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1817"></a>
<a name="ln-1818"></a><span class="cp">#ifdef __INTEL_COMPILER</span>
<a name="ln-1819"></a>    <span class="k">use </span><span class="n">ifcore</span><span class="p">,</span> <span class="n">only</span><span class="p">:</span> <span class="n">tracebackqq</span>
<a name="ln-1820"></a><span class="cp">#endif</span>
<a name="ln-1821"></a>
<a name="ln-1822"></a>    <span class="k">implicit none</span>
<a name="ln-1823"></a>
<a name="ln-1824"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1825"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">msg</span>    <span class="c">!! the error message</span>
<a name="ln-1826"></a>
<a name="ln-1827"></a>    <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-1828"></a>    <span class="n">json</span><span class="p">%</span><span class="n">err_message</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1829"></a>
<a name="ln-1830"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">stop_on_error</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1831"></a>
<a name="ln-1832"></a><span class="cp">#ifdef __INTEL_COMPILER</span>
<a name="ln-1833"></a>        <span class="c">! for Intel, we raise a traceback and quit</span>
<a name="ln-1834"></a>        <span class="k">call </span><span class="n">tracebackqq</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">user_exit_code</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-1835"></a><span class="cp">#else</span>
<a name="ln-1836"></a>        <span class="k">write</span><span class="p">(</span><span class="n">error_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s1">&#39;JSON-Fortran Exception: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1837"></a>        <span class="n">error</span> <span class="k">stop </span><span class="mi">1</span>
<a name="ln-1838"></a><span class="cp">#endif</span>
<a name="ln-1839"></a>
<a name="ln-1840"></a>    <span class="n">elseif</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">is_verbose</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1841"></a>
<a name="ln-1842"></a><span class="k">        write</span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s1">&#39;***********************&#39;</span>
<a name="ln-1843"></a>        <span class="k">write</span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s1">&#39;JSON-Fortran Exception: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1844"></a>
<a name="ln-1845"></a><span class="c">!#if defined __GFORTRAN__</span>
<a name="ln-1846"></a><span class="c">!        call backtrace()  ! (have to compile with -fbacktrace -fall-intrinsics flags)</span>
<a name="ln-1847"></a><span class="c">!#endif</span>
<a name="ln-1848"></a>
<a name="ln-1849"></a><span class="cp">#ifdef __INTEL_COMPILER</span>
<a name="ln-1850"></a>        <span class="k">call </span><span class="n">tracebackqq</span><span class="p">(</span><span class="n">user_exit_code</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c">! print a traceback and return</span>
<a name="ln-1851"></a><span class="cp">#endif</span>
<a name="ln-1852"></a>
<a name="ln-1853"></a>        <span class="k">write</span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="s1">&#39;***********************&#39;</span>
<a name="ln-1854"></a>
<a name="ln-1855"></a>    <span class="k">end if</span>
<a name="ln-1856"></a>
<a name="ln-1857"></a><span class="k">    end subroutine </span><span class="n">json_throw_exception</span>
<a name="ln-1858"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1859"></a>
<a name="ln-1860"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1861"></a><span class="c">!&gt;</span>
<a name="ln-1862"></a><span class="c">!  Alternate version of [[json_throw_exception]], where `msg` is kind=CDK.</span>
<a name="ln-1863"></a>
<a name="ln-1864"></a>    <span class="k">subroutine </span><span class="n">wrap_json_throw_exception</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">msg</span><span class="p">)</span>
<a name="ln-1865"></a>
<a name="ln-1866"></a>    <span class="k">implicit none</span>
<a name="ln-1867"></a>
<a name="ln-1868"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1869"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">msg</span>    <span class="c">!! the error message</span>
<a name="ln-1870"></a>
<a name="ln-1871"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
<a name="ln-1872"></a>
<a name="ln-1873"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_throw_exception</span>
<a name="ln-1874"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1875"></a>
<a name="ln-1876"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1877"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1878"></a><span class="c">!  date: 12/4/2013</span>
<a name="ln-1879"></a><span class="c">!</span>
<a name="ln-1880"></a><span class="c">!  Retrieve error code from the [[json_core(type)]].</span>
<a name="ln-1881"></a><span class="c">!  This should be called after `parse` to check for errors.</span>
<a name="ln-1882"></a><span class="c">!  If an error is thrown, before using the class again, [[json_initialize]]</span>
<a name="ln-1883"></a><span class="c">!  should be called to clean up before it is used again.</span>
<a name="ln-1884"></a><span class="c">!</span>
<a name="ln-1885"></a><span class="c">!### Example</span>
<a name="ln-1886"></a><span class="c">!</span>
<a name="ln-1887"></a><span class="c">!````fortran</span>
<a name="ln-1888"></a><span class="c">!     type(json_file) :: json</span>
<a name="ln-1889"></a><span class="c">!     logical :: status_ok</span>
<a name="ln-1890"></a><span class="c">!     character(kind=CK,len=:),allocatable :: error_msg</span>
<a name="ln-1891"></a><span class="c">!     call json%load_file(filename=&#39;myfile.json&#39;)</span>
<a name="ln-1892"></a><span class="c">!     call json%check_for_errors(status_ok, error_msg)</span>
<a name="ln-1893"></a><span class="c">!     if (.not. status_ok) then</span>
<a name="ln-1894"></a><span class="c">!         write(*,*) &#39;Error: &#39;//error_msg</span>
<a name="ln-1895"></a><span class="c">!         call json%clear_exceptions()</span>
<a name="ln-1896"></a><span class="c">!         call json%destroy()</span>
<a name="ln-1897"></a><span class="c">!     end if</span>
<a name="ln-1898"></a><span class="c">!````</span>
<a name="ln-1899"></a><span class="c">!</span>
<a name="ln-1900"></a><span class="c">!### See also</span>
<a name="ln-1901"></a><span class="c">!  * [[json_failed]]</span>
<a name="ln-1902"></a>
<a name="ln-1903"></a>    <span class="k">subroutine </span><span class="n">json_check_for_errors</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">status_ok</span><span class="p">,</span><span class="n">error_msg</span><span class="p">)</span>
<a name="ln-1904"></a>
<a name="ln-1905"></a>    <span class="k">implicit none</span>
<a name="ln-1906"></a>
<a name="ln-1907"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1908"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">status_ok</span> <span class="c">!! true if there were no errors</span>
<a name="ln-1909"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">error_msg</span> <span class="c">!! the error message (if there were errors)</span>
<a name="ln-1910"></a>
<a name="ln-1911"></a>    <span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span>
<a name="ln-1912"></a>
<a name="ln-1913"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-1914"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">err_message</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-1915"></a><span class="k">            </span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">err_message</span>
<a name="ln-1916"></a>        <span class="k">else</span>
<a name="ln-1917"></a><span class="k">            </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;Unknown error.&#39;</span>
<a name="ln-1918"></a>        <span class="k">end if</span>
<a name="ln-1919"></a><span class="k">    else</span>
<a name="ln-1920"></a><span class="k">        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-1921"></a>    <span class="k">end if</span>
<a name="ln-1922"></a>
<a name="ln-1923"></a><span class="k">    end subroutine </span><span class="n">json_check_for_errors</span>
<a name="ln-1924"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1925"></a>
<a name="ln-1926"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1927"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-1928"></a><span class="c">!  date: 12/5/2013</span>
<a name="ln-1929"></a><span class="c">!</span>
<a name="ln-1930"></a><span class="c">!  Logical function to indicate if an exception has been thrown in a [[json_core(type)]].</span>
<a name="ln-1931"></a><span class="c">!</span>
<a name="ln-1932"></a><span class="c">!### Example</span>
<a name="ln-1933"></a><span class="c">!</span>
<a name="ln-1934"></a><span class="c">!````fortran</span>
<a name="ln-1935"></a><span class="c">!    type(json_core) :: json</span>
<a name="ln-1936"></a><span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-1937"></a><span class="c">!    logical :: status_ok</span>
<a name="ln-1938"></a><span class="c">!    character(len=:),allocatable :: error_msg</span>
<a name="ln-1939"></a><span class="c">!    call json%parse(filename=&#39;myfile.json&#39;,p)</span>
<a name="ln-1940"></a><span class="c">!    if (json%failed()) then</span>
<a name="ln-1941"></a><span class="c">!        call json%check_for_errors(status_ok, error_msg)</span>
<a name="ln-1942"></a><span class="c">!        write(*,*) &#39;Error: &#39;//error_msg</span>
<a name="ln-1943"></a><span class="c">!        call json%clear_exceptions()</span>
<a name="ln-1944"></a><span class="c">!        call json%destroy(p)</span>
<a name="ln-1945"></a><span class="c">!    end if</span>
<a name="ln-1946"></a><span class="c">!````</span>
<a name="ln-1947"></a><span class="c">!</span>
<a name="ln-1948"></a><span class="c">!  Note that [[json_file]] contains a wrapper for this routine, which is used like:</span>
<a name="ln-1949"></a><span class="c">!````fortran</span>
<a name="ln-1950"></a><span class="c">!    type(json_file) :: f</span>
<a name="ln-1951"></a><span class="c">!    logical :: status_ok</span>
<a name="ln-1952"></a><span class="c">!    character(len=:),allocatable :: error_msg</span>
<a name="ln-1953"></a><span class="c">!    call f%load_file(filename=&#39;myfile.json&#39;)</span>
<a name="ln-1954"></a><span class="c">!    if (f%failed()) then</span>
<a name="ln-1955"></a><span class="c">!        call f%check_for_errors(status_ok, error_msg)</span>
<a name="ln-1956"></a><span class="c">!        write(*,*) &#39;Error: &#39;//error_msg</span>
<a name="ln-1957"></a><span class="c">!        call f%clear_exceptions()</span>
<a name="ln-1958"></a><span class="c">!        call f%destroy()</span>
<a name="ln-1959"></a><span class="c">!    end if</span>
<a name="ln-1960"></a><span class="c">!````</span>
<a name="ln-1961"></a><span class="c">!</span>
<a name="ln-1962"></a><span class="c">!### See also</span>
<a name="ln-1963"></a><span class="c">!  * [[json_check_for_errors]]</span>
<a name="ln-1964"></a>
<a name="ln-1965"></a>    <span class="k">pure function </span><span class="n">json_failed</span><span class="p">(</span><span class="n">json</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span>
<a name="ln-1966"></a>
<a name="ln-1967"></a>    <span class="k">implicit none</span>
<a name="ln-1968"></a>
<a name="ln-1969"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-1970"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">failed</span>  <span class="c">!! will be true if an exception</span>
<a name="ln-1971"></a>                                           <span class="c">!! has been thrown.</span>
<a name="ln-1972"></a>
<a name="ln-1973"></a>    <span class="n">failed</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span>
<a name="ln-1974"></a>
<a name="ln-1975"></a>    <span class="k">end function </span><span class="n">json_failed</span>
<a name="ln-1976"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1977"></a>
<a name="ln-1978"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-1979"></a><span class="c">!&gt;</span>
<a name="ln-1980"></a><span class="c">!  Allocate a [[json_value]] pointer variable.</span>
<a name="ln-1981"></a><span class="c">!  This should be called before adding data to it.</span>
<a name="ln-1982"></a><span class="c">!</span>
<a name="ln-1983"></a><span class="c">!### Example</span>
<a name="ln-1984"></a><span class="c">!</span>
<a name="ln-1985"></a><span class="c">!````fortran</span>
<a name="ln-1986"></a><span class="c">!    type(json_value),pointer :: var</span>
<a name="ln-1987"></a><span class="c">!    call json_value_create(var)</span>
<a name="ln-1988"></a><span class="c">!    call json%to_double(var,1.0_RK)</span>
<a name="ln-1989"></a><span class="c">!````</span>
<a name="ln-1990"></a><span class="c">!</span>
<a name="ln-1991"></a><span class="c">!### Notes</span>
<a name="ln-1992"></a><span class="c">!  1. This routine does not check for exceptions.</span>
<a name="ln-1993"></a><span class="c">!  2. The pointer should not already be allocated, or a memory leak will occur.</span>
<a name="ln-1994"></a>
<a name="ln-1995"></a>    <span class="k">subroutine </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-1996"></a>
<a name="ln-1997"></a>    <span class="k">implicit none</span>
<a name="ln-1998"></a>
<a name="ln-1999"></a><span class="k">    type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2000"></a>
<a name="ln-2001"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2002"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2003"></a>
<a name="ln-2004"></a>    <span class="k">end subroutine </span><span class="n">json_value_create</span>
<a name="ln-2005"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2006"></a>
<a name="ln-2007"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2008"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2009"></a><span class="c">!  date: 1/22/2014</span>
<a name="ln-2010"></a><span class="c">!</span>
<a name="ln-2011"></a><span class="c">!  Destroy a [[json_value]] linked-list structure.</span>
<a name="ln-2012"></a><span class="c">!</span>
<a name="ln-2013"></a><span class="c">!@note The original FSON version of this</span>
<a name="ln-2014"></a><span class="c">!      routine was not properly freeing the memory.</span>
<a name="ln-2015"></a><span class="c">!      It was rewritten.</span>
<a name="ln-2016"></a>
<a name="ln-2017"></a>    <span class="k">recursive subroutine </span><span class="n">json_value_destroy</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">destroy_next</span><span class="p">)</span>
<a name="ln-2018"></a>
<a name="ln-2019"></a>    <span class="k">implicit none</span>
<a name="ln-2020"></a>
<a name="ln-2021"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2022"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>        <span class="kd">::</span> <span class="n">p</span>            <span class="c">!! variable to destroy</span>
<a name="ln-2023"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">destroy_next</span> <span class="c">!! if true, then `p%next`</span>
<a name="ln-2024"></a>                                                    <span class="c">!! is also destroyed (default is true)</span>
<a name="ln-2025"></a>
<a name="ln-2026"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">des_next</span>
<a name="ln-2027"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">child</span>
<a name="ln-2028"></a>
<a name="ln-2029"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2030"></a>
<a name="ln-2031"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">destroy_next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2032"></a><span class="k">            </span><span class="n">des_next</span> <span class="o">=</span> <span class="n">destroy_next</span>
<a name="ln-2033"></a>        <span class="k">else</span>
<a name="ln-2034"></a><span class="k">            </span><span class="n">des_next</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-2035"></a>        <span class="k">end if</span>
<a name="ln-2036"></a>
<a name="ln-2037"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-2038"></a>
<a name="ln-2039"></a>        <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2040"></a>
<a name="ln-2041"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2042"></a><span class="k">            do while</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-2043"></a>                <span class="n">child</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-2044"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2045"></a><span class="k">                    </span><span class="n">p</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">%</span><span class="n">next</span>
<a name="ln-2046"></a>                    <span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2047"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">child</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-2048"></a>                <span class="k">else</span>
<a name="ln-2049"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_destroy: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2050"></a>                                              <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-2051"></a>                    <span class="k">exit</span>
<a name="ln-2052"></a><span class="k">                end if</span>
<a name="ln-2053"></a><span class="k">            end do</span>
<a name="ln-2054"></a><span class="k">            nullify</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">)</span>
<a name="ln-2055"></a>            <span class="k">nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-2056"></a>        <span class="k">end if</span>
<a name="ln-2057"></a>
<a name="ln-2058"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">des_next</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-2059"></a>
<a name="ln-2060"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">previous</span><span class="p">)</span>
<a name="ln-2061"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>   <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">)</span>
<a name="ln-2062"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">tail</span><span class="p">))</span>     <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-2063"></a>
<a name="ln-2064"></a>        <span class="k">deallocate</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2065"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2066"></a>
<a name="ln-2067"></a>    <span class="k">end if</span>
<a name="ln-2068"></a>
<a name="ln-2069"></a><span class="k">    end subroutine </span><span class="n">json_value_destroy</span>
<a name="ln-2070"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2071"></a>
<a name="ln-2072"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2073"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2074"></a><span class="c">!  date: 9/9/2014</span>
<a name="ln-2075"></a><span class="c">!</span>
<a name="ln-2076"></a><span class="c">!  Remove a [[json_value]] (and all its children)</span>
<a name="ln-2077"></a><span class="c">!  from a linked-list structure, preserving the rest of the structure.</span>
<a name="ln-2078"></a><span class="c">!</span>
<a name="ln-2079"></a><span class="c">!### Examples</span>
<a name="ln-2080"></a><span class="c">!</span>
<a name="ln-2081"></a><span class="c">!  To extract an object from one JSON structure, and add it to another:</span>
<a name="ln-2082"></a><span class="c">!````fortran</span>
<a name="ln-2083"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-2084"></a><span class="c">!     type(json_value),pointer :: json1,json2,p</span>
<a name="ln-2085"></a><span class="c">!     logical :: found</span>
<a name="ln-2086"></a><span class="c">!     !create and populate json1 and json2</span>
<a name="ln-2087"></a><span class="c">!     call json%get(json1,&#39;name&#39;,p,found)  ! get pointer to name element of json1</span>
<a name="ln-2088"></a><span class="c">!     call json%remove(p,destroy=.false.)  ! remove it from json1 (don&#39;t destroy)</span>
<a name="ln-2089"></a><span class="c">!     call json%add(json2,p)               ! add it to json2</span>
<a name="ln-2090"></a><span class="c">!````</span>
<a name="ln-2091"></a><span class="c">!</span>
<a name="ln-2092"></a><span class="c">!  To remove an object from a JSON structure (and destroy it):</span>
<a name="ln-2093"></a><span class="c">!````fortran</span>
<a name="ln-2094"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-2095"></a><span class="c">!     type(json_value),pointer :: json1,p</span>
<a name="ln-2096"></a><span class="c">!     logical :: found</span>
<a name="ln-2097"></a><span class="c">!     !create and populate json1</span>
<a name="ln-2098"></a><span class="c">!     call json%get(json1,&#39;name&#39;,p,found)  ! get pointer to name element of json1</span>
<a name="ln-2099"></a><span class="c">!     call json%remove(p)                  ! remove and destroy it</span>
<a name="ln-2100"></a><span class="c">!````</span>
<a name="ln-2101"></a><span class="c">!</span>
<a name="ln-2102"></a><span class="c">!### History</span>
<a name="ln-2103"></a><span class="c">!  * Jacob Williams : 12/28/2014 : added destroy optional argument.</span>
<a name="ln-2104"></a>
<a name="ln-2105"></a>    <span class="k">subroutine </span><span class="n">json_value_remove</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">destroy</span><span class="p">)</span>
<a name="ln-2106"></a>
<a name="ln-2107"></a>    <span class="k">implicit none</span>
<a name="ln-2108"></a>
<a name="ln-2109"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2110"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>        <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2111"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">destroy</span>  <span class="c">!! If destroy is not present, it is also destroyed.</span>
<a name="ln-2112"></a>                                                <span class="c">!! If destroy is present and true, it is destroyed.</span>
<a name="ln-2113"></a>                                                <span class="c">!! If destroy is present and false, it is not destroyed.</span>
<a name="ln-2114"></a>
<a name="ln-2115"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">parent</span><span class="p">,</span><span class="n">previous</span><span class="p">,</span><span class="n">next</span>
<a name="ln-2116"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">destroy_it</span>
<a name="ln-2117"></a>
<a name="ln-2118"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2119"></a>
<a name="ln-2120"></a>        <span class="c">!optional input argument:</span>
<a name="ln-2121"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">destroy</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2122"></a><span class="k">            </span><span class="n">destroy_it</span> <span class="o">=</span> <span class="n">destroy</span>
<a name="ln-2123"></a>        <span class="k">else</span>
<a name="ln-2124"></a><span class="k">            </span><span class="n">destroy_it</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-2125"></a>        <span class="k">end if</span>
<a name="ln-2126"></a>
<a name="ln-2127"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2128"></a>
<a name="ln-2129"></a><span class="k">            </span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-2130"></a>
<a name="ln-2131"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2132"></a>
<a name="ln-2133"></a>                <span class="c">!there are later items in the list:</span>
<a name="ln-2134"></a>
<a name="ln-2135"></a>                <span class="n">next</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">next</span>
<a name="ln-2136"></a>                <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-2137"></a>
<a name="ln-2138"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2139"></a>                    <span class="c">!there are earlier items in the list</span>
<a name="ln-2140"></a>                    <span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2141"></a>                    <span class="n">previous</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">next</span>
<a name="ln-2142"></a>                    <span class="n">next</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">previous</span>
<a name="ln-2143"></a>                <span class="k">else</span>
<a name="ln-2144"></a>                    <span class="c">!this is the first item in the list</span>
<a name="ln-2145"></a>                    <span class="n">parent</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">next</span>
<a name="ln-2146"></a>                    <span class="k">nullify</span><span class="p">(</span><span class="n">next</span><span class="p">%</span><span class="n">previous</span><span class="p">)</span>
<a name="ln-2147"></a>                <span class="k">end if</span>
<a name="ln-2148"></a>
<a name="ln-2149"></a><span class="k">            else</span>
<a name="ln-2150"></a>
<a name="ln-2151"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2152"></a>                    <span class="c">!there are earlier items in the list:</span>
<a name="ln-2153"></a>                    <span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2154"></a>                    <span class="k">nullify</span><span class="p">(</span><span class="n">previous</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-2155"></a>                    <span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">previous</span>
<a name="ln-2156"></a>                <span class="k">else</span>
<a name="ln-2157"></a>                    <span class="c">!this is the only item in the list:</span>
<a name="ln-2158"></a>                    <span class="k">nullify</span><span class="p">(</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">)</span>
<a name="ln-2159"></a>                    <span class="k">nullify</span><span class="p">(</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-2160"></a>                <span class="k">end if</span>
<a name="ln-2161"></a>
<a name="ln-2162"></a><span class="k">            end if</span>
<a name="ln-2163"></a>
<a name="ln-2164"></a><span class="k">            </span><span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-2165"></a>
<a name="ln-2166"></a>        <span class="k">end if</span>
<a name="ln-2167"></a>
<a name="ln-2168"></a><span class="k">        if</span> <span class="p">(</span><span class="n">destroy_it</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2169"></a>
<a name="ln-2170"></a>    <span class="k">end if</span>
<a name="ln-2171"></a>
<a name="ln-2172"></a><span class="k">    end subroutine </span><span class="n">json_value_remove</span>
<a name="ln-2173"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2174"></a>
<a name="ln-2175"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2176"></a><span class="c">!&gt;</span>
<a name="ln-2177"></a><span class="c">!  Replace `p1` with `p2` in a JSON structure.</span>
<a name="ln-2178"></a><span class="c">!</span>
<a name="ln-2179"></a><span class="c">!@note The replacement is done using an insert and remove</span>
<a name="ln-2180"></a><span class="c">!      See [[json_value_insert_after]] and [[json_value_remove]]</span>
<a name="ln-2181"></a><span class="c">!      for details.</span>
<a name="ln-2182"></a>
<a name="ln-2183"></a>    <span class="k">subroutine </span><span class="n">json_value_replace</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">destroy</span><span class="p">)</span>
<a name="ln-2184"></a>
<a name="ln-2185"></a>    <span class="k">implicit none</span>
<a name="ln-2186"></a>
<a name="ln-2187"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2188"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>        <span class="kd">::</span> <span class="n">p1</span>       <span class="c">!! the item to replace</span>
<a name="ln-2189"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>        <span class="kd">::</span> <span class="n">p2</span>       <span class="c">!! item to take the place of `p1`</span>
<a name="ln-2190"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">destroy</span>  <span class="c">!! Should `p1` also be destroyed</span>
<a name="ln-2191"></a>                                                <span class="c">!! (default is True). Normally,</span>
<a name="ln-2192"></a>                                                <span class="c">!! this should be true to avoid</span>
<a name="ln-2193"></a>                                                <span class="c">!! a memory leak.</span>
<a name="ln-2194"></a>
<a name="ln-2195"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">destroy_p1</span> <span class="c">!! if `p1` is to be destroyed</span>
<a name="ln-2196"></a>
<a name="ln-2197"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">destroy</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2198"></a><span class="k">        </span><span class="n">destroy_p1</span> <span class="o">=</span> <span class="n">destroy</span>
<a name="ln-2199"></a>    <span class="k">else</span>
<a name="ln-2200"></a><span class="k">        </span><span class="n">destroy_p1</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">! default</span>
<a name="ln-2201"></a>    <span class="k">end if</span>
<a name="ln-2202"></a>
<a name="ln-2203"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">insert_after</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
<a name="ln-2204"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">remove</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">destroy_p1</span><span class="p">)</span>
<a name="ln-2205"></a>
<a name="ln-2206"></a>    <span class="k">end subroutine </span><span class="n">json_value_replace</span>
<a name="ln-2207"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2208"></a>
<a name="ln-2209"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2210"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2211"></a><span class="c">!  date: 4/11/2017</span>
<a name="ln-2212"></a><span class="c">!</span>
<a name="ln-2213"></a><span class="c">!  Reverse the order of the children of an array or object.</span>
<a name="ln-2214"></a>
<a name="ln-2215"></a>    <span class="k">subroutine </span><span class="n">json_value_reverse</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<a name="ln-2216"></a>
<a name="ln-2217"></a>    <span class="k">implicit none</span>
<a name="ln-2218"></a>
<a name="ln-2219"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2220"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2221"></a>
<a name="ln-2222"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>       <span class="c">!! temp variable for traversing the list</span>
<a name="ln-2223"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">current</span>   <span class="c">!! temp variable for traversing the list</span>
<a name="ln-2224"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">var_type</span>  <span class="c">!! for getting the variable type</span>
<a name="ln-2225"></a>
<a name="ln-2226"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2227"></a>
<a name="ln-2228"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2229"></a>
<a name="ln-2230"></a>        <span class="c">! can only reverse objects or arrays</span>
<a name="ln-2231"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">var_type</span><span class="o">==</span><span class="n">json_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2232"></a>
<a name="ln-2233"></a><span class="k">            nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-2234"></a>            <span class="n">current</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-2235"></a>            <span class="n">p</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">current</span>
<a name="ln-2236"></a>
<a name="ln-2237"></a>            <span class="c">! Swap next and previous for all nodes:</span>
<a name="ln-2238"></a>            <span class="k">do</span>
<a name="ln-2239"></a><span class="k">                if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">current</span><span class="p">))</span> <span class="k">exit</span>
<a name="ln-2240"></a><span class="k">                </span><span class="n">tmp</span>              <span class="o">=&gt;</span> <span class="n">current</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2241"></a>                <span class="n">current</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">current</span><span class="p">%</span><span class="n">next</span>
<a name="ln-2242"></a>                <span class="n">current</span><span class="p">%</span><span class="n">next</span>     <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-2243"></a>                <span class="n">current</span>          <span class="o">=&gt;</span> <span class="n">current</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2244"></a>            <span class="k">end do</span>
<a name="ln-2245"></a>
<a name="ln-2246"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2247"></a><span class="k">                </span><span class="n">p</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2248"></a>            <span class="k">end if</span>
<a name="ln-2249"></a>
<a name="ln-2250"></a><span class="k">        end if</span>
<a name="ln-2251"></a>
<a name="ln-2252"></a><span class="k">    end if</span>
<a name="ln-2253"></a>
<a name="ln-2254"></a><span class="k">    end subroutine </span><span class="n">json_value_reverse</span>
<a name="ln-2255"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2256"></a>
<a name="ln-2257"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2258"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2259"></a><span class="c">!  date: 4/26/2016</span>
<a name="ln-2260"></a><span class="c">!</span>
<a name="ln-2261"></a><span class="c">!  Swap two elements in a JSON structure.</span>
<a name="ln-2262"></a><span class="c">!  All of the children are carried along as well.</span>
<a name="ln-2263"></a><span class="c">!</span>
<a name="ln-2264"></a><span class="c">!@note If both are not associated, then an error is thrown.</span>
<a name="ln-2265"></a><span class="c">!</span>
<a name="ln-2266"></a><span class="c">!@note The assumption here is that both variables are part of a valid</span>
<a name="ln-2267"></a><span class="c">!      [[json_value]] linked list (so the normal `parent`, `previous`,</span>
<a name="ln-2268"></a><span class="c">!      `next`, etc. pointers are properly associated if necessary).</span>
<a name="ln-2269"></a><span class="c">!</span>
<a name="ln-2270"></a><span class="c">!@warning This cannot be used to swap a parent/child pair, since that</span>
<a name="ln-2271"></a><span class="c">!         could lead to a circular linkage. An exception is thrown if</span>
<a name="ln-2272"></a><span class="c">!         this is tried.</span>
<a name="ln-2273"></a><span class="c">!</span>
<a name="ln-2274"></a><span class="c">!@warning There are also other situations where using this routine may</span>
<a name="ln-2275"></a><span class="c">!         produce a malformed JSON structure, such as moving an array</span>
<a name="ln-2276"></a><span class="c">!         element outside of an array. This is not checked for.</span>
<a name="ln-2277"></a><span class="c">!</span>
<a name="ln-2278"></a><span class="c">!@note If `p1` and `p2` have a common parent, it is always safe to swap them.</span>
<a name="ln-2279"></a>
<a name="ln-2280"></a>    <span class="k">subroutine </span><span class="n">json_value_swap</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
<a name="ln-2281"></a>
<a name="ln-2282"></a>    <span class="k">implicit none</span>
<a name="ln-2283"></a>
<a name="ln-2284"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2285"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p1</span>
<a name="ln-2286"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p2</span>
<a name="ln-2287"></a>
<a name="ln-2288"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">same_parent</span><span class="p">,</span><span class="n">first_last</span><span class="p">,</span><span class="n">adjacent</span>
<a name="ln-2289"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
<a name="ln-2290"></a>
<a name="ln-2291"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-2292"></a>
<a name="ln-2293"></a>    <span class="c">!both have to be associated:</span>
<a name="ln-2294"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2295"></a>
<a name="ln-2296"></a>        <span class="c">!simple check to make sure that they both</span>
<a name="ln-2297"></a>        <span class="c">!aren&#39;t pointing to the same thing:</span>
<a name="ln-2298"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2299"></a>
<a name="ln-2300"></a>            <span class="c">!we will not allow swapping an item with one of its descendants:</span>
<a name="ln-2301"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">is_child_of</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">is_child_of</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2302"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_swap: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2303"></a>                                          <span class="s1">&#39;cannot swap an item with one of its descendants&#39;</span><span class="p">)</span>
<a name="ln-2304"></a>            <span class="k">else</span>
<a name="ln-2305"></a>
<a name="ln-2306"></a><span class="k">                </span><span class="n">same_parent</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2307"></a>                                <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2308"></a>                                <span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">,</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-2309"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">same_parent</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2310"></a>                    <span class="c">!if p1,p2 are the first,last or last,first</span>
<a name="ln-2311"></a>                    <span class="c">!children of a common parent</span>
<a name="ln-2312"></a>                    <span class="n">first_last</span> <span class="o">=</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2313"></a>                                  <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2314"></a>                                 <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2315"></a>                                  <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span>
<a name="ln-2316"></a>                <span class="k">else</span>
<a name="ln-2317"></a><span class="k">                    </span><span class="n">first_last</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2318"></a>                <span class="k">end if</span>
<a name="ln-2319"></a>
<a name="ln-2320"></a>                <span class="c">!first, we fix children,tail pointers:</span>
<a name="ln-2321"></a>
<a name="ln-2322"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">same_parent</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">first_last</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2323"></a>
<a name="ln-2324"></a>                    <span class="c">!this is all we have to do for the parent in this case:</span>
<a name="ln-2325"></a>                    <span class="k">call </span><span class="n">swap_pointers</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-2326"></a>
<a name="ln-2327"></a>                <span class="k">else if</span> <span class="p">(</span><span class="n">same_parent</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first_last</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2328"></a>
<a name="ln-2329"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2330"></a><span class="k">                        </span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">p2</span> <span class="c">! p1 is the first child of the parent</span>
<a name="ln-2331"></a>                    <span class="k">else if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2332"></a><span class="k">                        </span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">p1</span> <span class="c">! p2 is the first child of the parent</span>
<a name="ln-2333"></a>                    <span class="k">end if</span>
<a name="ln-2334"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2335"></a><span class="k">                        </span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">p2</span> <span class="c">! p1 is the last child of the parent</span>
<a name="ln-2336"></a>                    <span class="k">else if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2337"></a><span class="k">                        </span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">p1</span> <span class="c">! p2 is the last child of the parent</span>
<a name="ln-2338"></a>                    <span class="k">end if</span>
<a name="ln-2339"></a>
<a name="ln-2340"></a><span class="k">                else</span> <span class="c">! general case: different parents</span>
<a name="ln-2341"></a>
<a name="ln-2342"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2343"></a><span class="k">                        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">p2</span>
<a name="ln-2344"></a>                        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span>     <span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span>     <span class="o">=&gt;</span> <span class="n">p2</span>
<a name="ln-2345"></a>                    <span class="k">end if</span>
<a name="ln-2346"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2347"></a><span class="k">                        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span> <span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">p1</span>
<a name="ln-2348"></a>                        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p2</span><span class="p">))</span>     <span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span>     <span class="o">=&gt;</span> <span class="n">p1</span>
<a name="ln-2349"></a>                    <span class="k">end if</span>
<a name="ln-2350"></a><span class="k">                    call </span><span class="n">swap_pointers</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">parent</span><span class="p">,</span> <span class="n">p2</span><span class="p">%</span><span class="n">parent</span><span class="p">)</span>
<a name="ln-2351"></a>
<a name="ln-2352"></a>                <span class="k">end if</span>
<a name="ln-2353"></a>
<a name="ln-2354"></a>                <span class="c">!now, have to fix previous,next pointers:</span>
<a name="ln-2355"></a>
<a name="ln-2356"></a>                <span class="c">!first, see if they are adjacent:</span>
<a name="ln-2357"></a>                <span class="n">adjacent</span> <span class="o">=</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">next</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2358"></a>                           <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">next</span><span class="p">,</span><span class="n">p1</span><span class="p">)</span>
<a name="ln-2359"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">%</span><span class="n">next</span><span class="p">,</span><span class="n">p1</span><span class="p">))</span> <span class="k">then</span>    <span class="c">!p2,p1</span>
<a name="ln-2360"></a>                    <span class="n">a</span> <span class="o">=&gt;</span> <span class="n">p2</span>
<a name="ln-2361"></a>                    <span class="n">b</span> <span class="o">=&gt;</span> <span class="n">p1</span>
<a name="ln-2362"></a>                <span class="k">else</span>    <span class="c">!p1,p2 (or not adjacent)</span>
<a name="ln-2363"></a>                    <span class="n">a</span> <span class="o">=&gt;</span> <span class="n">p1</span>
<a name="ln-2364"></a>                    <span class="n">b</span> <span class="o">=&gt;</span> <span class="n">p2</span>
<a name="ln-2365"></a>                <span class="k">end if</span>
<a name="ln-2366"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="n">a</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">b</span>
<a name="ln-2367"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">b</span><span class="p">%</span><span class="n">next</span><span class="p">))</span>     <span class="n">b</span><span class="p">%</span><span class="n">next</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">a</span>
<a name="ln-2368"></a>
<a name="ln-2369"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">adjacent</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2370"></a>                    <span class="c">!a comes before b in the original list</span>
<a name="ln-2371"></a>                    <span class="n">b</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">a</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-2372"></a>                    <span class="n">a</span><span class="p">%</span><span class="n">next</span>     <span class="o">=&gt;</span> <span class="n">b</span><span class="p">%</span><span class="n">next</span>
<a name="ln-2373"></a>                    <span class="n">a</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">b</span>
<a name="ln-2374"></a>                    <span class="n">b</span><span class="p">%</span><span class="n">next</span>     <span class="o">=&gt;</span> <span class="n">a</span>
<a name="ln-2375"></a>                <span class="k">else</span>
<a name="ln-2376"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">next</span><span class="p">))</span>       <span class="n">a</span><span class="p">%</span><span class="n">next</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">b</span>
<a name="ln-2377"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">b</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span>   <span class="n">b</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">a</span>
<a name="ln-2378"></a>                    <span class="k">call </span><span class="n">swap_pointers</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">previous</span><span class="p">,</span><span class="n">b</span><span class="p">%</span><span class="n">previous</span><span class="p">)</span>
<a name="ln-2379"></a>                    <span class="k">call </span><span class="n">swap_pointers</span><span class="p">(</span><span class="n">a</span><span class="p">%</span><span class="n">next</span><span class="p">,</span>    <span class="n">b</span><span class="p">%</span><span class="n">next</span><span class="p">)</span>
<a name="ln-2380"></a>                <span class="k">end if</span>
<a name="ln-2381"></a>
<a name="ln-2382"></a><span class="k">            end if</span>
<a name="ln-2383"></a>
<a name="ln-2384"></a><span class="k">        else</span>
<a name="ln-2385"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_swap: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2386"></a>                                      <span class="s1">&#39;both pointers must be associated&#39;</span><span class="p">)</span>
<a name="ln-2387"></a>        <span class="k">end if</span>
<a name="ln-2388"></a>
<a name="ln-2389"></a><span class="k">    end if</span>
<a name="ln-2390"></a>
<a name="ln-2391"></a><span class="k">    contains</span>
<a name="ln-2392"></a>
<a name="ln-2393"></a><span class="k">        pure subroutine </span><span class="n">swap_pointers</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span>
<a name="ln-2394"></a>
<a name="ln-2395"></a>        <span class="k">implicit none</span>
<a name="ln-2396"></a>
<a name="ln-2397"></a><span class="k">        type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s1</span>
<a name="ln-2398"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s2</span>
<a name="ln-2399"></a>
<a name="ln-2400"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! temporary pointer</span>
<a name="ln-2401"></a>
<a name="ln-2402"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2403"></a><span class="k">            </span><span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">s1</span>
<a name="ln-2404"></a>            <span class="n">s1</span>  <span class="o">=&gt;</span> <span class="n">s2</span>
<a name="ln-2405"></a>            <span class="n">s2</span>  <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-2406"></a>        <span class="k">end if</span>
<a name="ln-2407"></a>
<a name="ln-2408"></a><span class="k">        end subroutine </span><span class="n">swap_pointers</span>
<a name="ln-2409"></a>
<a name="ln-2410"></a>    <span class="k">end subroutine </span><span class="n">json_value_swap</span>
<a name="ln-2411"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2412"></a>
<a name="ln-2413"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2414"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2415"></a><span class="c">!  date: 4/28/2016</span>
<a name="ln-2416"></a><span class="c">!</span>
<a name="ln-2417"></a><span class="c">!  Returns True if `p2` is a descendant of `p1`</span>
<a name="ln-2418"></a><span class="c">!  (i.e, a child, or a child of child, etc.)</span>
<a name="ln-2419"></a>
<a name="ln-2420"></a>    <span class="k">function </span><span class="n">json_value_is_child_of</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">is_child_of</span><span class="p">)</span>
<a name="ln-2421"></a>
<a name="ln-2422"></a>    <span class="k">implicit none</span>
<a name="ln-2423"></a>
<a name="ln-2424"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2425"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p1</span>
<a name="ln-2426"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p2</span>
<a name="ln-2427"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">is_child_of</span>
<a name="ln-2428"></a>
<a name="ln-2429"></a>    <span class="n">is_child_of</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2430"></a>
<a name="ln-2431"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-2432"></a>
<a name="ln-2433"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p2</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2434"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2435"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">traverse</span><span class="p">(</span><span class="n">p1</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">is_child_of_callback</span><span class="p">)</span>
<a name="ln-2436"></a>        <span class="k">end if</span>
<a name="ln-2437"></a><span class="k">    end if</span>
<a name="ln-2438"></a>
<a name="ln-2439"></a><span class="k">    contains</span>
<a name="ln-2440"></a>
<a name="ln-2441"></a><span class="k">    subroutine </span><span class="n">is_child_of_callback</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">finished</span><span class="p">)</span>
<a name="ln-2442"></a>    <span class="c">!! Traverse until `p` is `p2`.</span>
<a name="ln-2443"></a>    <span class="k">implicit none</span>
<a name="ln-2444"></a>
<a name="ln-2445"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2446"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2447"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">finished</span>
<a name="ln-2448"></a>
<a name="ln-2449"></a>    <span class="n">is_child_of</span> <span class="o">=</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p2</span><span class="p">)</span>
<a name="ln-2450"></a>    <span class="n">finished</span> <span class="o">=</span> <span class="n">is_child_of</span>  <span class="c">! stop searching if found</span>
<a name="ln-2451"></a>
<a name="ln-2452"></a>    <span class="k">end subroutine </span><span class="n">is_child_of_callback</span>
<a name="ln-2453"></a>
<a name="ln-2454"></a>    <span class="k">end function </span><span class="n">json_value_is_child_of</span>
<a name="ln-2455"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2456"></a>
<a name="ln-2457"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2458"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2459"></a><span class="c">!  date: 5/2/2016</span>
<a name="ln-2460"></a><span class="c">!</span>
<a name="ln-2461"></a><span class="c">!  Validate a [[json_value]] linked list by checking to make sure</span>
<a name="ln-2462"></a><span class="c">!  all the pointers are properly associated, arrays and objects</span>
<a name="ln-2463"></a><span class="c">!  have the correct number of children, and the correct data is</span>
<a name="ln-2464"></a><span class="c">!  allocated for the variable types.</span>
<a name="ln-2465"></a><span class="c">!</span>
<a name="ln-2466"></a><span class="c">!  It recursively traverses the entire structure and checks every element.</span>
<a name="ln-2467"></a><span class="c">!</span>
<a name="ln-2468"></a><span class="c">!### History</span>
<a name="ln-2469"></a><span class="c">!  * Jacob Williams, 8/26/2017 : added duplicate key check.</span>
<a name="ln-2470"></a><span class="c">!</span>
<a name="ln-2471"></a><span class="c">!@note It will return on the first error it encounters.</span>
<a name="ln-2472"></a><span class="c">!</span>
<a name="ln-2473"></a><span class="c">!@note This routine does not check or throw any exceptions.</span>
<a name="ln-2474"></a><span class="c">!      If `json` is currently in a state of exception, it will</span>
<a name="ln-2475"></a><span class="c">!      remain so after calling this routine.</span>
<a name="ln-2476"></a>
<a name="ln-2477"></a>    <span class="k">subroutine </span><span class="n">json_value_validate</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">is_valid</span><span class="p">,</span><span class="n">error_msg</span><span class="p">)</span>
<a name="ln-2478"></a>
<a name="ln-2479"></a>    <span class="k">implicit none</span>
<a name="ln-2480"></a>
<a name="ln-2481"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2482"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2483"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">is_valid</span>  <span class="c">!! True if the structure is valid.</span>
<a name="ln-2484"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">error_msg</span> <span class="c">!! if not valid, this will contain</span>
<a name="ln-2485"></a>                                                                  <span class="c">!! a description of the problem</span>
<a name="ln-2486"></a>
<a name="ln-2487"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span> <span class="c">!! to check for duplicate keys</span>
<a name="ln-2488"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">path</span>  <span class="c">!! path to duplicate key</span>
<a name="ln-2489"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">status_ok</span> <span class="c">!! to check for existing exception</span>
<a name="ln-2490"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">exception_msg</span>  <span class="c">!! error message for an existing exception</span>
<a name="ln-2491"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">exception_msg2</span>  <span class="c">!! error message for a new exception</span>
<a name="ln-2492"></a>
<a name="ln-2493"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2494"></a>
<a name="ln-2495"></a><span class="k">        </span><span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-2496"></a>        <span class="k">call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>
<a name="ln-2497"></a>
<a name="ln-2498"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">is_valid</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">allow_duplicate_keys</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2499"></a>            <span class="c">! if no errors so far, also check the</span>
<a name="ln-2500"></a>            <span class="c">! entire structure for duplicate keys:</span>
<a name="ln-2501"></a>
<a name="ln-2502"></a>            <span class="c">! note: check_for_duplicate_keys does call routines</span>
<a name="ln-2503"></a>            <span class="c">! that check and throw exceptions, so let&#39;s clear any</span>
<a name="ln-2504"></a>            <span class="c">! first. (save message for later)</span>
<a name="ln-2505"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">status_ok</span><span class="p">,</span> <span class="n">exception_msg</span><span class="p">)</span>
<a name="ln-2506"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-2507"></a>
<a name="ln-2508"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
<a name="ln-2509"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">failed</span><span class="p">())</span> <span class="k">then</span>
<a name="ln-2510"></a>                <span class="c">! if an exception was thrown during this call,</span>
<a name="ln-2511"></a>                <span class="c">! then clear it but make that the error message</span>
<a name="ln-2512"></a>                <span class="c">! returned by this routine. Normally this should</span>
<a name="ln-2513"></a>                <span class="c">! never actually occur since we have already</span>
<a name="ln-2514"></a>                <span class="c">! validated the structure.</span>
<a name="ln-2515"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">is_valid</span><span class="p">,</span> <span class="n">exception_msg2</span><span class="p">)</span>
<a name="ln-2516"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="n">exception_msg2</span>
<a name="ln-2517"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-2518"></a>                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2519"></a>            <span class="k">else</span>
<a name="ln-2520"></a><span class="k">                if</span> <span class="p">(</span><span class="n">has_duplicate</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2521"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;duplicate key found: &#39;</span><span class="o">//</span><span class="n">path</span>
<a name="ln-2522"></a>                    <span class="n">is_valid</span>  <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2523"></a>                <span class="k">end if</span>
<a name="ln-2524"></a><span class="k">            end if</span>
<a name="ln-2525"></a>
<a name="ln-2526"></a><span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2527"></a>                <span class="c">! restore any existing exception if necessary</span>
<a name="ln-2528"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">)</span>
<a name="ln-2529"></a>            <span class="k">end if</span>
<a name="ln-2530"></a>
<a name="ln-2531"></a>            <span class="c">! cleanup:</span>
<a name="ln-2532"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>           <span class="k">deallocate</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-2533"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">))</span>  <span class="k">deallocate</span><span class="p">(</span><span class="n">exception_msg</span><span class="p">)</span>
<a name="ln-2534"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">exception_msg2</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">exception_msg2</span><span class="p">)</span>
<a name="ln-2535"></a>
<a name="ln-2536"></a>        <span class="k">end if</span>
<a name="ln-2537"></a>
<a name="ln-2538"></a><span class="k">    else</span>
<a name="ln-2539"></a><span class="k">        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;The pointer is not associated&#39;</span>
<a name="ln-2540"></a>        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2541"></a>    <span class="k">end if</span>
<a name="ln-2542"></a>
<a name="ln-2543"></a><span class="k">    contains</span>
<a name="ln-2544"></a>
<a name="ln-2545"></a><span class="k">    recursive subroutine </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">require_parent</span><span class="p">)</span>
<a name="ln-2546"></a>
<a name="ln-2547"></a>        <span class="k">implicit none</span>
<a name="ln-2548"></a>
<a name="ln-2549"></a><span class="k">        type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2550"></a>        <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">require_parent</span> <span class="c">!! the first one may be a root (so no parent),</span>
<a name="ln-2551"></a>                                             <span class="c">!! but all descendants must have a parent.</span>
<a name="ln-2552"></a>
<a name="ln-2553"></a>        <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span> <span class="c">!! counter</span>
<a name="ln-2554"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-2555"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">previous</span>
<a name="ln-2556"></a>
<a name="ln-2557"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">is_valid</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2558"></a>
<a name="ln-2559"></a>            <span class="c">! data type:</span>
<a name="ln-2560"></a>            <span class="k">select case</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2561"></a>            <span class="k">case</span><span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_object</span><span class="p">,</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-2562"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2563"></a>                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2564"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2565"></a>                                <span class="s1">&#39;json_null, json_object, or json_array variable type&#39;</span>
<a name="ln-2566"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2567"></a>                    <span class="k">return</span>
<a name="ln-2568"></a><span class="k">                end if</span>
<a name="ln-2569"></a><span class="k">            case</span><span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
<a name="ln-2570"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2571"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;log_value should be allocated for json_logical variable type&#39;</span>
<a name="ln-2572"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2573"></a>                    <span class="k">return</span>
<a name="ln-2574"></a><span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2575"></a>                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2576"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_logical variable type&#39;</span>
<a name="ln-2577"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2578"></a>                    <span class="k">return</span>
<a name="ln-2579"></a><span class="k">                end if</span>
<a name="ln-2580"></a><span class="k">            case</span><span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
<a name="ln-2581"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2582"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;int_value should be allocated for json_integer variable type&#39;</span>
<a name="ln-2583"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2584"></a>                    <span class="k">return</span>
<a name="ln-2585"></a><span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2586"></a>                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2587"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_integer variable type&#39;</span>
<a name="ln-2588"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2589"></a>                    <span class="k">return</span>
<a name="ln-2590"></a><span class="k">                end if</span>
<a name="ln-2591"></a><span class="k">            case</span><span class="p">(</span><span class="n">json_double</span><span class="p">)</span>
<a name="ln-2592"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2593"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;dbl_value should be allocated for json_double variable type&#39;</span>
<a name="ln-2594"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2595"></a>                    <span class="k">return</span>
<a name="ln-2596"></a><span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2597"></a>                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2598"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_double variable type&#39;</span>
<a name="ln-2599"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2600"></a>                    <span class="k">return</span>
<a name="ln-2601"></a><span class="k">                end if</span>
<a name="ln-2602"></a><span class="k">            case</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-2603"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2604"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;str_value should be allocated for json_string variable type&#39;</span>
<a name="ln-2605"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2606"></a>                    <span class="k">return</span>
<a name="ln-2607"></a><span class="k">                else if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2608"></a>                    <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2609"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;incorrect data allocated for json_string variable type&#39;</span>
<a name="ln-2610"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2611"></a>                    <span class="k">return</span>
<a name="ln-2612"></a><span class="k">                end if</span>
<a name="ln-2613"></a><span class="k">            case </span><span class="n">default</span>
<a name="ln-2614"></a>                <span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;invalid JSON variable type&#39;</span>
<a name="ln-2615"></a>                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2616"></a>                <span class="k">return</span>
<a name="ln-2617"></a><span class="k">            end select</span>
<a name="ln-2618"></a>
<a name="ln-2619"></a><span class="k">            if</span> <span class="p">(</span><span class="n">require_parent</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2620"></a><span class="k">                </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;parent pointer is not associated&#39;</span>
<a name="ln-2621"></a>                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2622"></a>                <span class="k">return</span>
<a name="ln-2623"></a><span class="k">            end if</span>
<a name="ln-2624"></a>
<a name="ln-2625"></a><span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2626"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2627"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2628"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;JSON variable must have a name if not an &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2629"></a>                                    <span class="s1">&#39;array element or the root&#39;</span>
<a name="ln-2630"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2631"></a>                        <span class="k">return</span>
<a name="ln-2632"></a><span class="k">                    end if</span>
<a name="ln-2633"></a><span class="k">                end if</span>
<a name="ln-2634"></a><span class="k">            end if</span>
<a name="ln-2635"></a>
<a name="ln-2636"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">)</span> <span class="p">.</span><span class="n">neqv</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">tail</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2637"></a><span class="k">                </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;both children and tail pointers must be associated&#39;</span>
<a name="ln-2638"></a>                <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2639"></a>                <span class="k">return</span>
<a name="ln-2640"></a><span class="k">            end if</span>
<a name="ln-2641"></a>
<a name="ln-2642"></a>            <span class="c">! now, check next one:</span>
<a name="ln-2643"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2644"></a><span class="k">                call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="n">require_parent</span><span class="p">)</span>
<a name="ln-2645"></a>            <span class="k">end if</span>
<a name="ln-2646"></a>
<a name="ln-2647"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2648"></a>
<a name="ln-2649"></a><span class="k">                if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_array</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">/=</span><span class="n">json_object</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2650"></a><span class="k">                    </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;only arrays and objects can have children&#39;</span>
<a name="ln-2651"></a>                    <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2652"></a>                    <span class="k">return</span>
<a name="ln-2653"></a><span class="k">                end if</span>
<a name="ln-2654"></a>
<a name="ln-2655"></a>                <span class="c">! first validate children pointers:</span>
<a name="ln-2656"></a>
<a name="ln-2657"></a>                <span class="n">previous</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-2658"></a>                <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-2659"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">%</span><span class="n">n_children</span>
<a name="ln-2660"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">parent</span><span class="p">,</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2661"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;child&#39;&#39;s parent pointer not properly associated&#39;</span>
<a name="ln-2662"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2663"></a>                        <span class="k">return</span>
<a name="ln-2664"></a><span class="k">                    end if</span>
<a name="ln-2665"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2666"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;first child shouldn&#39;&#39;t have a previous&#39;</span>
<a name="ln-2667"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2668"></a>                        <span class="k">return</span>
<a name="ln-2669"></a><span class="k">                    end if</span>
<a name="ln-2670"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2671"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;not enough children&#39;</span>
<a name="ln-2672"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2673"></a>                        <span class="k">return</span>
<a name="ln-2674"></a><span class="k">                    end if</span>
<a name="ln-2675"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2676"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;too many children&#39;</span>
<a name="ln-2677"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2678"></a>                        <span class="k">return</span>
<a name="ln-2679"></a><span class="k">                    end if</span>
<a name="ln-2680"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2681"></a><span class="k">                        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">previous</span><span class="p">,</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2682"></a><span class="k">                            </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;previous pointer not properly associated&#39;</span>
<a name="ln-2683"></a>                            <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2684"></a>                            <span class="k">return</span>
<a name="ln-2685"></a><span class="k">                        end if</span>
<a name="ln-2686"></a><span class="k">                    end if</span>
<a name="ln-2687"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-2688"></a>                        <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-2689"></a><span class="k">                        </span><span class="n">error_msg</span> <span class="o">=</span> <span class="s1">&#39;parent&#39;&#39;s tail pointer not properly associated&#39;</span>
<a name="ln-2690"></a>                        <span class="n">is_valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2691"></a>                        <span class="k">return</span>
<a name="ln-2692"></a><span class="k">                    end if</span>
<a name="ln-2693"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">p</span><span class="p">%</span><span class="n">n_children</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2694"></a>                        <span class="c">!setup next case:</span>
<a name="ln-2695"></a>                        <span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">element</span>
<a name="ln-2696"></a>                        <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-2697"></a>                    <span class="k">end if</span>
<a name="ln-2698"></a><span class="k">                end do</span>
<a name="ln-2699"></a>
<a name="ln-2700"></a>                <span class="c">!now check all the children:</span>
<a name="ln-2701"></a>                <span class="k">call </span><span class="n">check_if_valid</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">,</span><span class="n">require_parent</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-2702"></a>
<a name="ln-2703"></a>            <span class="k">end if</span>
<a name="ln-2704"></a>
<a name="ln-2705"></a><span class="k">        end if</span>
<a name="ln-2706"></a>
<a name="ln-2707"></a><span class="k">    end subroutine </span><span class="n">check_if_valid</span>
<a name="ln-2708"></a>
<a name="ln-2709"></a>    <span class="k">end subroutine </span><span class="n">json_value_validate</span>
<a name="ln-2710"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2711"></a>
<a name="ln-2712"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2713"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2714"></a><span class="c">!  date: 12/6/2014</span>
<a name="ln-2715"></a><span class="c">!</span>
<a name="ln-2716"></a><span class="c">!  Given the path string, remove the variable from</span>
<a name="ln-2717"></a><span class="c">!  the [[json_value]] structure, if it exists.</span>
<a name="ln-2718"></a>
<a name="ln-2719"></a>    <span class="k">subroutine </span><span class="n">json_value_remove_if_present</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-2720"></a>
<a name="ln-2721"></a>    <span class="k">implicit none</span>
<a name="ln-2722"></a>
<a name="ln-2723"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2724"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2725"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-2726"></a>
<a name="ln-2727"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-2728"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2729"></a>
<a name="ln-2730"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2731"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">remove</span><span class="p">(</span><span class="n">p_var</span><span class="p">)</span>
<a name="ln-2732"></a>
<a name="ln-2733"></a>    <span class="k">end subroutine </span><span class="n">json_value_remove_if_present</span>
<a name="ln-2734"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2735"></a>
<a name="ln-2736"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2737"></a><span class="c">!&gt;</span>
<a name="ln-2738"></a><span class="c">!  Alternate version of [[json_value_remove_if_present]], where `name` is kind=CDK.</span>
<a name="ln-2739"></a>
<a name="ln-2740"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_remove_if_present</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-2741"></a>
<a name="ln-2742"></a>    <span class="k">implicit none</span>
<a name="ln-2743"></a>
<a name="ln-2744"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2745"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2746"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-2747"></a>
<a name="ln-2748"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">remove_if_present</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-2749"></a>
<a name="ln-2750"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_remove_if_present</span>
<a name="ln-2751"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2752"></a>
<a name="ln-2753"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2754"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2755"></a><span class="c">!  date: 12/6/2014</span>
<a name="ln-2756"></a><span class="c">!</span>
<a name="ln-2757"></a><span class="c">!  Given the path string, if the variable is present,</span>
<a name="ln-2758"></a><span class="c">!  and is a scalar, then update its value.</span>
<a name="ln-2759"></a><span class="c">!  If it is not present, then create it and set its value.</span>
<a name="ln-2760"></a>
<a name="ln-2761"></a>    <span class="k">subroutine </span><span class="n">json_update_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2762"></a>
<a name="ln-2763"></a>    <span class="k">implicit none</span>
<a name="ln-2764"></a>
<a name="ln-2765"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2766"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2767"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2768"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2769"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2770"></a>
<a name="ln-2771"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-2772"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>
<a name="ln-2773"></a>
<a name="ln-2774"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2775"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2776"></a>
<a name="ln-2777"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2778"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2779"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_logical</span><span class="p">,</span><span class="n">json_integer</span><span class="p">,</span><span class="n">json_double</span><span class="p">,</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-2780"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_logical</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>    <span class="c">!update the value</span>
<a name="ln-2781"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-2782"></a>            <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2783"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_update_logical: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2784"></a>                                      <span class="s1">&#39;the variable is not a scalar value&#39;</span><span class="p">)</span>
<a name="ln-2785"></a>        <span class="k">end select</span>
<a name="ln-2786"></a>
<a name="ln-2787"></a><span class="k">    else</span>
<a name="ln-2788"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">add_by_path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>   <span class="c">!add the new element</span>
<a name="ln-2789"></a>    <span class="k">end if</span>
<a name="ln-2790"></a>
<a name="ln-2791"></a><span class="k">    end subroutine </span><span class="n">json_update_logical</span>
<a name="ln-2792"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2793"></a>
<a name="ln-2794"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2795"></a><span class="c">!&gt;</span>
<a name="ln-2796"></a><span class="c">!  Alternate version of [[json_update_logical]], where `path` is kind=CDK.</span>
<a name="ln-2797"></a>
<a name="ln-2798"></a>    <span class="k">subroutine </span><span class="n">wrap_json_update_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2799"></a>
<a name="ln-2800"></a>    <span class="k">implicit none</span>
<a name="ln-2801"></a>
<a name="ln-2802"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2803"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2804"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2805"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2806"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2807"></a>
<a name="ln-2808"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2809"></a>
<a name="ln-2810"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_update_logical</span>
<a name="ln-2811"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2812"></a>
<a name="ln-2813"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2814"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2815"></a><span class="c">!  date: 12/6/2014</span>
<a name="ln-2816"></a><span class="c">!</span>
<a name="ln-2817"></a><span class="c">!  Given the path string, if the variable is present,</span>
<a name="ln-2818"></a><span class="c">!  and is a scalar, then update its value.</span>
<a name="ln-2819"></a><span class="c">!  If it is not present, then create it and set its value.</span>
<a name="ln-2820"></a>
<a name="ln-2821"></a>    <span class="k">subroutine </span><span class="n">json_update_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2822"></a>
<a name="ln-2823"></a>    <span class="k">implicit none</span>
<a name="ln-2824"></a>
<a name="ln-2825"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2826"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2827"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2828"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2829"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2830"></a>
<a name="ln-2831"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-2832"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>
<a name="ln-2833"></a>
<a name="ln-2834"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2835"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2836"></a>
<a name="ln-2837"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2838"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2839"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_logical</span><span class="p">,</span><span class="n">json_integer</span><span class="p">,</span><span class="n">json_double</span><span class="p">,</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-2840"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_double</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>    <span class="c">!update the value</span>
<a name="ln-2841"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-2842"></a>            <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2843"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_update_double: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2844"></a>                                      <span class="s1">&#39;the variable is not a scalar value&#39;</span><span class="p">)</span>
<a name="ln-2845"></a>        <span class="k">end select</span>
<a name="ln-2846"></a>
<a name="ln-2847"></a><span class="k">    else</span>
<a name="ln-2848"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">add_by_path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>   <span class="c">!add the new element</span>
<a name="ln-2849"></a>    <span class="k">end if</span>
<a name="ln-2850"></a>
<a name="ln-2851"></a><span class="k">    end subroutine </span><span class="n">json_update_double</span>
<a name="ln-2852"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2853"></a>
<a name="ln-2854"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2855"></a><span class="c">!&gt;</span>
<a name="ln-2856"></a><span class="c">!  Alternate version of [[json_update_double]], where `path` is kind=CDK.</span>
<a name="ln-2857"></a>
<a name="ln-2858"></a>    <span class="k">subroutine </span><span class="n">wrap_json_update_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2859"></a>
<a name="ln-2860"></a>    <span class="k">implicit none</span>
<a name="ln-2861"></a>
<a name="ln-2862"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2863"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2864"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2865"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2866"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2867"></a>
<a name="ln-2868"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2869"></a>
<a name="ln-2870"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_update_double</span>
<a name="ln-2871"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2872"></a>
<a name="ln-2873"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2874"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2875"></a><span class="c">!  date: 12/6/2014</span>
<a name="ln-2876"></a><span class="c">!</span>
<a name="ln-2877"></a><span class="c">!  Given the path string, if the variable is present,</span>
<a name="ln-2878"></a><span class="c">!  and is a scalar, then update its value.</span>
<a name="ln-2879"></a><span class="c">!  If it is not present, then create it and set its value.</span>
<a name="ln-2880"></a>
<a name="ln-2881"></a>    <span class="k">subroutine </span><span class="n">json_update_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2882"></a>
<a name="ln-2883"></a>    <span class="k">implicit none</span>
<a name="ln-2884"></a>
<a name="ln-2885"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2886"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2887"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2888"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2889"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2890"></a>
<a name="ln-2891"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-2892"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>
<a name="ln-2893"></a>
<a name="ln-2894"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2895"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2896"></a>
<a name="ln-2897"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2898"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2899"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_logical</span><span class="p">,</span><span class="n">json_integer</span><span class="p">,</span><span class="n">json_double</span><span class="p">,</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-2900"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_integer</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>    <span class="c">!update the value</span>
<a name="ln-2901"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-2902"></a>            <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2903"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_update_integer: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2904"></a>                                      <span class="s1">&#39;the variable is not a scalar value&#39;</span><span class="p">)</span>
<a name="ln-2905"></a>        <span class="k">end select</span>
<a name="ln-2906"></a>
<a name="ln-2907"></a><span class="k">    else</span>
<a name="ln-2908"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">add_by_path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>   <span class="c">!add the new element</span>
<a name="ln-2909"></a>    <span class="k">end if</span>
<a name="ln-2910"></a>
<a name="ln-2911"></a><span class="k">    end subroutine </span><span class="n">json_update_integer</span>
<a name="ln-2912"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2913"></a>
<a name="ln-2914"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2915"></a><span class="c">!&gt;</span>
<a name="ln-2916"></a><span class="c">!  Alternate version of [[json_update_integer]], where `path` is kind=CDK.</span>
<a name="ln-2917"></a>
<a name="ln-2918"></a>    <span class="k">subroutine </span><span class="n">wrap_json_update_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2919"></a>
<a name="ln-2920"></a>    <span class="k">implicit none</span>
<a name="ln-2921"></a>
<a name="ln-2922"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2923"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2924"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2925"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2926"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2927"></a>
<a name="ln-2928"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2929"></a>
<a name="ln-2930"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_update_integer</span>
<a name="ln-2931"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2932"></a>
<a name="ln-2933"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2934"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-2935"></a><span class="c">!  date: 12/6/2014</span>
<a name="ln-2936"></a><span class="c">!</span>
<a name="ln-2937"></a><span class="c">!  Given the path string, if the variable is present,</span>
<a name="ln-2938"></a><span class="c">!  and is a scalar, then update its value.</span>
<a name="ln-2939"></a><span class="c">!  If it is not present, then create it and set its value.</span>
<a name="ln-2940"></a>
<a name="ln-2941"></a>    <span class="k">subroutine </span><span class="n">json_update_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-2942"></a>
<a name="ln-2943"></a>    <span class="k">implicit none</span>
<a name="ln-2944"></a>
<a name="ln-2945"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2946"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2947"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2948"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2949"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2950"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-2951"></a>                                                       <span class="c">!! (only used if `val` is present)</span>
<a name="ln-2952"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-2953"></a>                                                       <span class="c">!! (only used if `val` is present)</span>
<a name="ln-2954"></a>                                                       <span class="c">!! (note that ADJUSTL is done before TRIM)</span>
<a name="ln-2955"></a>
<a name="ln-2956"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p_var</span>
<a name="ln-2957"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span>
<a name="ln-2958"></a>
<a name="ln-2959"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p_var</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-2960"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-2961"></a>
<a name="ln-2962"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2963"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-2964"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">,</span><span class="n">json_logical</span><span class="p">,</span><span class="n">json_integer</span><span class="p">,</span><span class="n">json_double</span><span class="p">,</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-2965"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_string</span><span class="p">(</span><span class="n">p_var</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">trim_str</span><span class="o">=</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="o">=</span><span class="n">adjustl_str</span><span class="p">)</span> <span class="c">! update the value</span>
<a name="ln-2966"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-2967"></a>            <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-2968"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_update_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-2969"></a>                                      <span class="s1">&#39;the variable is not a scalar value&#39;</span><span class="p">)</span>
<a name="ln-2970"></a>        <span class="k">end select</span>
<a name="ln-2971"></a>
<a name="ln-2972"></a><span class="k">    else</span>
<a name="ln-2973"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">add_by_path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>   <span class="c">!add the new element</span>
<a name="ln-2974"></a>    <span class="k">end if</span>
<a name="ln-2975"></a>
<a name="ln-2976"></a><span class="k">    end subroutine </span><span class="n">json_update_string</span>
<a name="ln-2977"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2978"></a>
<a name="ln-2979"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-2980"></a><span class="c">!&gt;</span>
<a name="ln-2981"></a><span class="c">!  Alternate version of [[json_update_string]], where `path` and `value` are kind=CDK.</span>
<a name="ln-2982"></a>
<a name="ln-2983"></a>    <span class="k">subroutine </span><span class="n">wrap_json_update_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-2984"></a>
<a name="ln-2985"></a>    <span class="k">implicit none</span>
<a name="ln-2986"></a>
<a name="ln-2987"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-2988"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-2989"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-2990"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-2991"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-2992"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>       <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-2993"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-2994"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>    <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-2995"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-2996"></a>                                                          <span class="c">!! (note that ADJUSTL is done before TRIM)</span>
<a name="ln-2997"></a>
<a name="ln-2998"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-2999"></a>
<a name="ln-3000"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_update_string</span>
<a name="ln-3001"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3002"></a>
<a name="ln-3003"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3004"></a><span class="c">!&gt;</span>
<a name="ln-3005"></a><span class="c">!  Alternate version of [[json_update_string]], where `path` is kind=CDK.</span>
<a name="ln-3006"></a>
<a name="ln-3007"></a>    <span class="k">subroutine </span><span class="n">json_update_string_name_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3008"></a>
<a name="ln-3009"></a>    <span class="k">implicit none</span>
<a name="ln-3010"></a>
<a name="ln-3011"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3012"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3013"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-3014"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-3015"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-3016"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>       <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-3017"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-3018"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>    <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-3019"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-3020"></a>                                                          <span class="c">!! (note that ADJUSTL is done before TRIM)</span>
<a name="ln-3021"></a>
<a name="ln-3022"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3023"></a>
<a name="ln-3024"></a>    <span class="k">end subroutine </span><span class="n">json_update_string_name_ascii</span>
<a name="ln-3025"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3026"></a>
<a name="ln-3027"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3028"></a><span class="c">!&gt;</span>
<a name="ln-3029"></a><span class="c">!  Alternate version of [[json_update_string]], where `val` is kind=CDK.</span>
<a name="ln-3030"></a>
<a name="ln-3031"></a>    <span class="k">subroutine </span><span class="n">json_update_string_val_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3032"></a>
<a name="ln-3033"></a>    <span class="k">implicit none</span>
<a name="ln-3034"></a>
<a name="ln-3035"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3036"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3037"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-3038"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-3039"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-3040"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>       <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-3041"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-3042"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>    <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-3043"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-3044"></a>                                                          <span class="c">!! (note that ADJUSTL is done before TRIM)</span>
<a name="ln-3045"></a>
<a name="ln-3046"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span><span class="n">found</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3047"></a>
<a name="ln-3048"></a>    <span class="k">end subroutine </span><span class="n">json_update_string_val_ascii</span>
<a name="ln-3049"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3050"></a>
<a name="ln-3051"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3052"></a><span class="c">!&gt;</span>
<a name="ln-3053"></a><span class="c">!  Adds `member` as a child of `p`.</span>
<a name="ln-3054"></a>
<a name="ln-3055"></a>    <span class="k">subroutine </span><span class="n">json_value_add_member</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">member</span><span class="p">)</span>
<a name="ln-3056"></a>
<a name="ln-3057"></a>    <span class="k">implicit none</span>
<a name="ln-3058"></a>
<a name="ln-3059"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3060"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3061"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">member</span>  <span class="c">!! the child member</span>
<a name="ln-3062"></a>                                              <span class="c">!! to add to `p`</span>
<a name="ln-3063"></a>
<a name="ln-3064"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3065"></a>
<a name="ln-3066"></a>        <span class="c">! associate the parent</span>
<a name="ln-3067"></a>        <span class="n">member</span><span class="p">%</span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-3068"></a>
<a name="ln-3069"></a>        <span class="c">! add to linked list</span>
<a name="ln-3070"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3071"></a>
<a name="ln-3072"></a><span class="k">            </span><span class="n">p</span><span class="p">%</span><span class="n">tail</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">member</span>
<a name="ln-3073"></a>            <span class="n">member</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">tail</span>
<a name="ln-3074"></a>
<a name="ln-3075"></a>        <span class="k">else</span>
<a name="ln-3076"></a>
<a name="ln-3077"></a><span class="k">            </span><span class="n">p</span><span class="p">%</span><span class="n">children</span> <span class="o">=&gt;</span> <span class="n">member</span>
<a name="ln-3078"></a>            <span class="n">member</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>  <span class="c">!first in the list</span>
<a name="ln-3079"></a>
<a name="ln-3080"></a>        <span class="k">end if</span>
<a name="ln-3081"></a>
<a name="ln-3082"></a>        <span class="c">! new member is now the last one in the list</span>
<a name="ln-3083"></a>        <span class="n">p</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">member</span>
<a name="ln-3084"></a>        <span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">n_children</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3085"></a>
<a name="ln-3086"></a>    <span class="k">end if</span>
<a name="ln-3087"></a>
<a name="ln-3088"></a><span class="k">    end subroutine </span><span class="n">json_value_add_member</span>
<a name="ln-3089"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3090"></a>
<a name="ln-3091"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3092"></a><span class="c">!&gt;</span>
<a name="ln-3093"></a><span class="c">!  Inserts `element` after `p`, and updates the JSON structure accordingly.</span>
<a name="ln-3094"></a><span class="c">!</span>
<a name="ln-3095"></a><span class="c">!### Example</span>
<a name="ln-3096"></a><span class="c">!</span>
<a name="ln-3097"></a><span class="c">!````fortran</span>
<a name="ln-3098"></a><span class="c">!  program test</span>
<a name="ln-3099"></a><span class="c">!   use json_module</span>
<a name="ln-3100"></a><span class="c">!   implicit none</span>
<a name="ln-3101"></a><span class="c">!   logical(json_LK) :: found</span>
<a name="ln-3102"></a><span class="c">!   type(json_core) :: json</span>
<a name="ln-3103"></a><span class="c">!   type(json_value),pointer :: p,new,element</span>
<a name="ln-3104"></a><span class="c">!   call json%parse(file=&#39;myfile.json&#39;, p=p)</span>
<a name="ln-3105"></a><span class="c">!   call json%get(p,&#39;x(3)&#39;,element,found) ! get pointer to an array element in the file</span>
<a name="ln-3106"></a><span class="c">!   call json%create_integer(new,1,&#39;&#39;)    ! create a new element</span>
<a name="ln-3107"></a><span class="c">!   call json%insert_after(element,new)   ! insert new element after x(3)</span>
<a name="ln-3108"></a><span class="c">!   call json%print(p,&#39;myfile2.json&#39;)     ! write it to a file</span>
<a name="ln-3109"></a><span class="c">!   call json%destroy(p)                  ! cleanup</span>
<a name="ln-3110"></a><span class="c">!  end program test</span>
<a name="ln-3111"></a><span class="c">!````</span>
<a name="ln-3112"></a><span class="c">!</span>
<a name="ln-3113"></a><span class="c">!### Details</span>
<a name="ln-3114"></a><span class="c">!</span>
<a name="ln-3115"></a><span class="c">!  * This routine can be used to insert a new element (or set of elements)</span>
<a name="ln-3116"></a><span class="c">!    into an array or object at a specific index.</span>
<a name="ln-3117"></a><span class="c">!    See [[json_value_insert_after_child_by_index]]</span>
<a name="ln-3118"></a><span class="c">!  * Children and subsequent elements of `element` are carried along.</span>
<a name="ln-3119"></a><span class="c">!  * If the inserted elements are part of an existing list, then</span>
<a name="ln-3120"></a><span class="c">!    they are removed from that list.</span>
<a name="ln-3121"></a><span class="c">!</span>
<a name="ln-3122"></a><span class="c">!````</span>
<a name="ln-3123"></a><span class="c">!              p</span>
<a name="ln-3124"></a><span class="c">!       [1] - [2] - [3] - [4]</span>
<a name="ln-3125"></a><span class="c">!                 |</span>
<a name="ln-3126"></a><span class="c">!                [5] - [6] - [7]        n=3 elements inserted</span>
<a name="ln-3127"></a><span class="c">!              element       last</span>
<a name="ln-3128"></a><span class="c">!</span>
<a name="ln-3129"></a><span class="c">!  Result is:</span>
<a name="ln-3130"></a><span class="c">!</span>
<a name="ln-3131"></a><span class="c">!       [1] - [2] - [5] - [6] - [7] - [3] - [4]</span>
<a name="ln-3132"></a><span class="c">!</span>
<a name="ln-3133"></a><span class="c">!````</span>
<a name="ln-3134"></a>
<a name="ln-3135"></a>    <span class="k">subroutine </span><span class="n">json_value_insert_after</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">element</span><span class="p">)</span>
<a name="ln-3136"></a>
<a name="ln-3137"></a>    <span class="k">implicit none</span>
<a name="ln-3138"></a>
<a name="ln-3139"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3140"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p</span>       <span class="c">!! a value from a JSON structure</span>
<a name="ln-3141"></a>                                              <span class="c">!! (presumably, this is a child of</span>
<a name="ln-3142"></a>                                              <span class="c">!! an object or array).</span>
<a name="ln-3143"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">element</span> <span class="c">!! the element to insert after `p`</span>
<a name="ln-3144"></a>
<a name="ln-3145"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">parent</span>  <span class="c">!! the parent of `p`</span>
<a name="ln-3146"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">next</span>  <span class="c">!! temp pointer for traversing structure</span>
<a name="ln-3147"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">last</span>  <span class="c">!! the last of the items being inserted</span>
<a name="ln-3148"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span>  <span class="c">!! number of items being inserted</span>
<a name="ln-3149"></a>
<a name="ln-3150"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3151"></a>
<a name="ln-3152"></a><span class="k">        </span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-3153"></a>
<a name="ln-3154"></a>        <span class="c">! set first parent of inserted list:</span>
<a name="ln-3155"></a>        <span class="n">element</span><span class="p">%</span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">parent</span>
<a name="ln-3156"></a>
<a name="ln-3157"></a>        <span class="c">! Count the number of inserted elements.</span>
<a name="ln-3158"></a>        <span class="c">! and set their parents.</span>
<a name="ln-3159"></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">! initialize counter</span>
<a name="ln-3160"></a>        <span class="n">next</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-3161"></a>        <span class="n">last</span> <span class="o">=&gt;</span> <span class="n">element</span>
<a name="ln-3162"></a>        <span class="k">do</span>
<a name="ln-3163"></a><span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">next</span><span class="p">))</span> <span class="k">exit</span>
<a name="ln-3164"></a><span class="k">            </span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-3165"></a>            <span class="n">next</span><span class="p">%</span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">parent</span>
<a name="ln-3166"></a>            <span class="n">last</span> <span class="o">=&gt;</span> <span class="n">next</span>
<a name="ln-3167"></a>            <span class="n">next</span> <span class="o">=&gt;</span> <span class="n">next</span><span class="p">%</span><span class="n">next</span>
<a name="ln-3168"></a>        <span class="k">end do</span>
<a name="ln-3169"></a>
<a name="ln-3170"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3171"></a>            <span class="c">! update parent&#39;s child counter:</span>
<a name="ln-3172"></a>            <span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">+</span> <span class="n">n</span>
<a name="ln-3173"></a>            <span class="c">! if p is last of parents children then</span>
<a name="ln-3174"></a>            <span class="c">! also have to update parent tail pointer:</span>
<a name="ln-3175"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span><span class="p">,</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3176"></a><span class="k">                </span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">last</span>
<a name="ln-3177"></a>            <span class="k">end if</span>
<a name="ln-3178"></a><span class="k">        end if</span>
<a name="ln-3179"></a>
<a name="ln-3180"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3181"></a>            <span class="c">! element is apparently part of an existing list,</span>
<a name="ln-3182"></a>            <span class="c">! so have to update that as well.</span>
<a name="ln-3183"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3184"></a><span class="k">                </span><span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">=</span> <span class="p">&amp;</span>
<a name="ln-3185"></a>                    <span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">n_children</span> <span class="o">-</span> <span class="n">n</span>
<a name="ln-3186"></a>                <span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="p">&amp;</span>
<a name="ln-3187"></a>                    <span class="n">element</span><span class="p">%</span><span class="n">previous</span> <span class="c">! now the last one in the list</span>
<a name="ln-3188"></a>            <span class="k">else</span>
<a name="ln-3189"></a>                <span class="c">! this would be a memory leak if the previous entries</span>
<a name="ln-3190"></a>                <span class="c">! are not otherwise being pointed too</span>
<a name="ln-3191"></a>                <span class="c">! [throw an error in this case???]</span>
<a name="ln-3192"></a>            <span class="k">end if</span>
<a name="ln-3193"></a>            <span class="c">!remove element from the other list:</span>
<a name="ln-3194"></a>            <span class="n">element</span><span class="p">%</span><span class="n">previous</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-3195"></a>        <span class="k">end if</span>
<a name="ln-3196"></a><span class="k">        </span><span class="n">element</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-3197"></a>
<a name="ln-3198"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3199"></a>            <span class="c">! if there are any in the list after p:</span>
<a name="ln-3200"></a>            <span class="n">last</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">next</span>
<a name="ln-3201"></a>            <span class="n">last</span><span class="p">%</span><span class="n">next</span><span class="p">%</span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">element</span>
<a name="ln-3202"></a>        <span class="k">else</span>
<a name="ln-3203"></a><span class="k">            </span><span class="n">last</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-3204"></a>        <span class="k">end if</span>
<a name="ln-3205"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">element</span>
<a name="ln-3206"></a>
<a name="ln-3207"></a>    <span class="k">end if</span>
<a name="ln-3208"></a>
<a name="ln-3209"></a><span class="k">    end subroutine </span><span class="n">json_value_insert_after</span>
<a name="ln-3210"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3211"></a>
<a name="ln-3212"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3213"></a><span class="c">!&gt;</span>
<a name="ln-3214"></a><span class="c">!  Inserts `element` after the `idx`-th child of `p`,</span>
<a name="ln-3215"></a><span class="c">!  and updates the JSON structure accordingly. This is just</span>
<a name="ln-3216"></a><span class="c">!  a wrapper for [[json_value_insert_after]].</span>
<a name="ln-3217"></a>
<a name="ln-3218"></a>    <span class="k">subroutine </span><span class="n">json_value_insert_after_child_by_index</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">element</span><span class="p">)</span>
<a name="ln-3219"></a>
<a name="ln-3220"></a>    <span class="k">implicit none</span>
<a name="ln-3221"></a>
<a name="ln-3222"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3223"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">p</span>       <span class="c">!! a JSON object or array.</span>
<a name="ln-3224"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">idx</span>     <span class="c">!! the index of the child of `p` to</span>
<a name="ln-3225"></a>                                              <span class="c">!! insert the new element after</span>
<a name="ln-3226"></a>                                              <span class="c">!! (this is a 1-based Fortran</span>
<a name="ln-3227"></a>                                              <span class="c">!! style array index)</span>
<a name="ln-3228"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">element</span> <span class="c">!! the element to insert</span>
<a name="ln-3229"></a>
<a name="ln-3230"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! for getting the `idx`-th child of `p`</span>
<a name="ln-3231"></a>
<a name="ln-3232"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3233"></a>
<a name="ln-3234"></a>        <span class="c">! get the idx-th child of p:</span>
<a name="ln-3235"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">idx</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-3236"></a>
<a name="ln-3237"></a>        <span class="c">! call json_value_insert_after:</span>
<a name="ln-3238"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">insert_after</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">element</span><span class="p">)</span>
<a name="ln-3239"></a>
<a name="ln-3240"></a>    <span class="k">end if</span>
<a name="ln-3241"></a>
<a name="ln-3242"></a><span class="k">    end subroutine </span><span class="n">json_value_insert_after_child_by_index</span>
<a name="ln-3243"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3244"></a>
<a name="ln-3245"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3246"></a><span class="c">!&gt;</span>
<a name="ln-3247"></a><span class="c">!  Add a new member (`json_value` pointer) to a JSON structure, given the path.</span>
<a name="ln-3248"></a><span class="c">!</span>
<a name="ln-3249"></a><span class="c">!@warning If the path points to an existing variable in the structure,</span>
<a name="ln-3250"></a><span class="c">!         then this routine will destroy it and replace it with the</span>
<a name="ln-3251"></a><span class="c">!         new value.</span>
<a name="ln-3252"></a>
<a name="ln-3253"></a>    <span class="k">subroutine </span><span class="n">json_add_member_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3254"></a>
<a name="ln-3255"></a>    <span class="k">implicit none</span>
<a name="ln-3256"></a>
<a name="ln-3257"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3258"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3259"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3260"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>            <span class="c">!! the value to add</span>
<a name="ln-3261"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3262"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3263"></a>
<a name="ln-3264"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-3265"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! name of the variable</span>
<a name="ln-3266"></a>
<a name="ln-3267"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3268"></a>
<a name="ln-3269"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3270"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_member_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3271"></a>                                      <span class="s1">&#39; Input pointer p is not associated.&#39;</span><span class="p">)</span>
<a name="ln-3272"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3273"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3274"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3275"></a>            <span class="k">end if</span>
<a name="ln-3276"></a><span class="k">            if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3277"></a>        <span class="k">else</span>
<a name="ln-3278"></a>
<a name="ln-3279"></a>            <span class="c">! return a pointer to the path (possibly creating it)</span>
<a name="ln-3280"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3281"></a>
<a name="ln-3282"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3283"></a>
<a name="ln-3284"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_member_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3285"></a>                                          <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-3286"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3287"></a><span class="k">                    </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3288"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3289"></a>                <span class="k">end if</span>
<a name="ln-3290"></a>
<a name="ln-3291"></a><span class="k">            else</span>
<a name="ln-3292"></a>
<a name="ln-3293"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3294"></a>
<a name="ln-3295"></a>                <span class="c">! replace it with the new one:</span>
<a name="ln-3296"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3297"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3298"></a>
<a name="ln-3299"></a>            <span class="k">end if</span>
<a name="ln-3300"></a>
<a name="ln-3301"></a><span class="k">        end if</span>
<a name="ln-3302"></a>
<a name="ln-3303"></a><span class="k">    else</span>
<a name="ln-3304"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3305"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3306"></a>    <span class="k">end if</span>
<a name="ln-3307"></a>
<a name="ln-3308"></a><span class="k">    end subroutine </span><span class="n">json_add_member_by_path</span>
<a name="ln-3309"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3310"></a>
<a name="ln-3311"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3312"></a><span class="c">!&gt;</span>
<a name="ln-3313"></a><span class="c">!  Wrapper to [[json_add_member_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3314"></a>
<a name="ln-3315"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_member_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3316"></a>
<a name="ln-3317"></a>    <span class="k">implicit none</span>
<a name="ln-3318"></a>
<a name="ln-3319"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3320"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3321"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3322"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>            <span class="c">!! the value to add</span>
<a name="ln-3323"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3324"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3325"></a>
<a name="ln-3326"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_member_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3327"></a>
<a name="ln-3328"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_member_by_path</span>
<a name="ln-3329"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3330"></a>
<a name="ln-3331"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3332"></a><span class="c">!&gt;</span>
<a name="ln-3333"></a><span class="c">!  Add an integer value to a [[json_value]], given the path.</span>
<a name="ln-3334"></a><span class="c">!</span>
<a name="ln-3335"></a><span class="c">!@warning If the path points to an existing variable in the structure,</span>
<a name="ln-3336"></a><span class="c">!         then this routine will destroy it and replace it with the</span>
<a name="ln-3337"></a><span class="c">!         new value.</span>
<a name="ln-3338"></a>
<a name="ln-3339"></a>    <span class="k">subroutine </span><span class="n">json_add_integer_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3340"></a>
<a name="ln-3341"></a>    <span class="k">implicit none</span>
<a name="ln-3342"></a>
<a name="ln-3343"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3344"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3345"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3346"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3347"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3348"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3349"></a>
<a name="ln-3350"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3351"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-3352"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-3353"></a>
<a name="ln-3354"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3355"></a>
<a name="ln-3356"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-3357"></a>
<a name="ln-3358"></a>        <span class="c">! return a pointer to the path (possibly creating it)</span>
<a name="ln-3359"></a>        <span class="c">! If the variable had to be created, then</span>
<a name="ln-3360"></a>        <span class="c">! it will be a json_null variable.</span>
<a name="ln-3361"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3362"></a>
<a name="ln-3363"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3364"></a>
<a name="ln-3365"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_integer_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3366"></a>                                      <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-3367"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3368"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3369"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3370"></a>            <span class="k">end if</span>
<a name="ln-3371"></a>
<a name="ln-3372"></a><span class="k">        else</span>
<a name="ln-3373"></a>
<a name="ln-3374"></a>            <span class="c">!NOTE: a new object is created, and the old one</span>
<a name="ln-3375"></a>            <span class="c">!      is replaced and destroyed. This is to</span>
<a name="ln-3376"></a>            <span class="c">!      prevent memory leaks if the type is</span>
<a name="ln-3377"></a>            <span class="c">!      being changed (for example, if an array</span>
<a name="ln-3378"></a>            <span class="c">!      is being replaced with a scalar).</span>
<a name="ln-3379"></a>
<a name="ln-3380"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_integer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3381"></a><span class="k">                </span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span> <span class="o">=</span> <span class="k">value</span>
<a name="ln-3382"></a><span class="k">            else</span>
<a name="ln-3383"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3384"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_integer</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3385"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3386"></a>            <span class="k">end if</span>
<a name="ln-3387"></a>
<a name="ln-3388"></a><span class="k">        end if</span>
<a name="ln-3389"></a>
<a name="ln-3390"></a><span class="k">    else</span>
<a name="ln-3391"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3392"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3393"></a>    <span class="k">end if</span>
<a name="ln-3394"></a>
<a name="ln-3395"></a><span class="k">    end subroutine </span><span class="n">json_add_integer_by_path</span>
<a name="ln-3396"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3397"></a>
<a name="ln-3398"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3399"></a><span class="c">!&gt;</span>
<a name="ln-3400"></a><span class="c">!  Wrapper to [[json_add_integer_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3401"></a>
<a name="ln-3402"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_integer_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3403"></a>
<a name="ln-3404"></a>    <span class="k">implicit none</span>
<a name="ln-3405"></a>
<a name="ln-3406"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3407"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! the JSON structure</span>
<a name="ln-3408"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! the path to the variable</span>
<a name="ln-3409"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="k">value</span>       <span class="c">!! the value to add</span>
<a name="ln-3410"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! if the variable was found</span>
<a name="ln-3411"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if the variable had to be created</span>
<a name="ln-3412"></a>
<a name="ln-3413"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_integer_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3414"></a>
<a name="ln-3415"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_integer_by_path</span>
<a name="ln-3416"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3417"></a>
<a name="ln-3418"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3419"></a><span class="c">!&gt;</span>
<a name="ln-3420"></a><span class="c">!  Add an double value to a [[json_value]], given the path.</span>
<a name="ln-3421"></a><span class="c">!</span>
<a name="ln-3422"></a><span class="c">!@warning If the path points to an existing variable in the structure,</span>
<a name="ln-3423"></a><span class="c">!         then this routine will destroy it and replace it with the</span>
<a name="ln-3424"></a><span class="c">!         new value.</span>
<a name="ln-3425"></a>
<a name="ln-3426"></a>    <span class="k">subroutine </span><span class="n">json_add_double_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3427"></a>
<a name="ln-3428"></a>    <span class="k">implicit none</span>
<a name="ln-3429"></a>
<a name="ln-3430"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3431"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3432"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3433"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3434"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3435"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3436"></a>
<a name="ln-3437"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3438"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-3439"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-3440"></a>
<a name="ln-3441"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3442"></a>
<a name="ln-3443"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-3444"></a>
<a name="ln-3445"></a>        <span class="c">! return a pointer to the path (possibly creating it)</span>
<a name="ln-3446"></a>        <span class="c">! If the variable had to be created, then</span>
<a name="ln-3447"></a>        <span class="c">! it will be a json_null variable.</span>
<a name="ln-3448"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3449"></a>
<a name="ln-3450"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3451"></a>
<a name="ln-3452"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_double_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3453"></a>                                      <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-3454"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3455"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3456"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3457"></a>            <span class="k">end if</span>
<a name="ln-3458"></a>
<a name="ln-3459"></a><span class="k">        else</span>
<a name="ln-3460"></a>
<a name="ln-3461"></a>            <span class="c">!NOTE: a new object is created, and the old one</span>
<a name="ln-3462"></a>            <span class="c">!      is replaced and destroyed. This is to</span>
<a name="ln-3463"></a>            <span class="c">!      prevent memory leaks if the type is</span>
<a name="ln-3464"></a>            <span class="c">!      being changed (for example, if an array</span>
<a name="ln-3465"></a>            <span class="c">!      is being replaced with a scalar).</span>
<a name="ln-3466"></a>
<a name="ln-3467"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_double</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3468"></a><span class="k">                </span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span> <span class="o">=</span> <span class="k">value</span>
<a name="ln-3469"></a><span class="k">            else</span>
<a name="ln-3470"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3471"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_double</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3472"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3473"></a>            <span class="k">end if</span>
<a name="ln-3474"></a>
<a name="ln-3475"></a><span class="k">        end if</span>
<a name="ln-3476"></a>
<a name="ln-3477"></a><span class="k">    else</span>
<a name="ln-3478"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3479"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3480"></a>    <span class="k">end if</span>
<a name="ln-3481"></a>
<a name="ln-3482"></a><span class="k">    end subroutine </span><span class="n">json_add_double_by_path</span>
<a name="ln-3483"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3484"></a>
<a name="ln-3485"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3486"></a><span class="c">!&gt;</span>
<a name="ln-3487"></a><span class="c">!  Wrapper to [[json_add_double_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3488"></a>
<a name="ln-3489"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_double_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3490"></a>
<a name="ln-3491"></a>    <span class="k">implicit none</span>
<a name="ln-3492"></a>
<a name="ln-3493"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3494"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! the JSON structure</span>
<a name="ln-3495"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! the path to the variable</span>
<a name="ln-3496"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="k">value</span>       <span class="c">!! the value to add</span>
<a name="ln-3497"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! if the variable was found</span>
<a name="ln-3498"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if the variable had to be created</span>
<a name="ln-3499"></a>
<a name="ln-3500"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_double_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3501"></a>
<a name="ln-3502"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_double_by_path</span>
<a name="ln-3503"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3504"></a>
<a name="ln-3505"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3506"></a><span class="c">!&gt;</span>
<a name="ln-3507"></a><span class="c">!  Add a logical value to a [[json_value]], given the path.</span>
<a name="ln-3508"></a><span class="c">!</span>
<a name="ln-3509"></a><span class="c">!@warning If the path points to an existing variable in the structure,</span>
<a name="ln-3510"></a><span class="c">!         then this routine will destroy it and replace it with the</span>
<a name="ln-3511"></a><span class="c">!         new value.</span>
<a name="ln-3512"></a>
<a name="ln-3513"></a>    <span class="k">subroutine </span><span class="n">json_add_logical_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3514"></a>
<a name="ln-3515"></a>    <span class="k">implicit none</span>
<a name="ln-3516"></a>
<a name="ln-3517"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3518"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3519"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3520"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3521"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3522"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3523"></a>
<a name="ln-3524"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3525"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-3526"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-3527"></a>
<a name="ln-3528"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3529"></a>
<a name="ln-3530"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-3531"></a>
<a name="ln-3532"></a>        <span class="c">! return a pointer to the path (possibly creating it)</span>
<a name="ln-3533"></a>        <span class="c">! If the variable had to be created, then</span>
<a name="ln-3534"></a>        <span class="c">! it will be a json_null variable.</span>
<a name="ln-3535"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3536"></a>
<a name="ln-3537"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3538"></a>
<a name="ln-3539"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_logical_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3540"></a>                                      <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-3541"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3542"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3543"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3544"></a>            <span class="k">end if</span>
<a name="ln-3545"></a>
<a name="ln-3546"></a><span class="k">        else</span>
<a name="ln-3547"></a>
<a name="ln-3548"></a>            <span class="c">!NOTE: a new object is created, and the old one</span>
<a name="ln-3549"></a>            <span class="c">!      is replaced and destroyed. This is to</span>
<a name="ln-3550"></a>            <span class="c">!      prevent memory leaks if the type is</span>
<a name="ln-3551"></a>            <span class="c">!      being changed (for example, if an array</span>
<a name="ln-3552"></a>            <span class="c">!      is being replaced with a scalar).</span>
<a name="ln-3553"></a>
<a name="ln-3554"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_logical</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3555"></a><span class="k">                </span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span> <span class="o">=</span> <span class="k">value</span>
<a name="ln-3556"></a><span class="k">            else</span>
<a name="ln-3557"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3558"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_logical</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3559"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3560"></a>            <span class="k">end if</span>
<a name="ln-3561"></a>
<a name="ln-3562"></a><span class="k">        end if</span>
<a name="ln-3563"></a>
<a name="ln-3564"></a><span class="k">    else</span>
<a name="ln-3565"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3566"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3567"></a>    <span class="k">end if</span>
<a name="ln-3568"></a>
<a name="ln-3569"></a><span class="k">    end subroutine </span><span class="n">json_add_logical_by_path</span>
<a name="ln-3570"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3571"></a>
<a name="ln-3572"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3573"></a><span class="c">!&gt;</span>
<a name="ln-3574"></a><span class="c">!  Wrapper to [[json_add_logical_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3575"></a>
<a name="ln-3576"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_logical_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3577"></a>
<a name="ln-3578"></a>    <span class="k">implicit none</span>
<a name="ln-3579"></a>
<a name="ln-3580"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3581"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! the JSON structure</span>
<a name="ln-3582"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! the path to the variable</span>
<a name="ln-3583"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="k">value</span>       <span class="c">!! the value to add</span>
<a name="ln-3584"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! if the variable was found</span>
<a name="ln-3585"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if the variable had to be created</span>
<a name="ln-3586"></a>
<a name="ln-3587"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_logical_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3588"></a>
<a name="ln-3589"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_logical_by_path</span>
<a name="ln-3590"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3591"></a>
<a name="ln-3592"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3593"></a><span class="c">!&gt;</span>
<a name="ln-3594"></a><span class="c">!  Add a string value to a [[json_value]], given the path.</span>
<a name="ln-3595"></a><span class="c">!</span>
<a name="ln-3596"></a><span class="c">!@warning If the path points to an existing variable in the structure,</span>
<a name="ln-3597"></a><span class="c">!         then this routine will destroy it and replace it with the</span>
<a name="ln-3598"></a><span class="c">!         new value.</span>
<a name="ln-3599"></a>
<a name="ln-3600"></a>    <span class="k">subroutine </span><span class="n">json_add_string_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-3601"></a>                                            <span class="n">was_created</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3602"></a>
<a name="ln-3603"></a>    <span class="k">implicit none</span>
<a name="ln-3604"></a>
<a name="ln-3605"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3606"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3607"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3608"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3609"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3610"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3611"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>     <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-3612"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>  <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-3613"></a>
<a name="ln-3614"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-3615"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-3616"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-3617"></a>
<a name="ln-3618"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3619"></a>
<a name="ln-3620"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-3621"></a>
<a name="ln-3622"></a>        <span class="c">! return a pointer to the path (possibly creating it)</span>
<a name="ln-3623"></a>        <span class="c">! If the variable had to be created, then</span>
<a name="ln-3624"></a>        <span class="c">! it will be a json_null variable.</span>
<a name="ln-3625"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3626"></a>
<a name="ln-3627"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3628"></a>
<a name="ln-3629"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_string_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3630"></a>                                      <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-3631"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3632"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3633"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3634"></a>            <span class="k">end if</span>
<a name="ln-3635"></a>
<a name="ln-3636"></a><span class="k">        else</span>
<a name="ln-3637"></a>
<a name="ln-3638"></a>            <span class="c">!NOTE: a new object is created, and the old one</span>
<a name="ln-3639"></a>            <span class="c">!      is replaced and destroyed. This is to</span>
<a name="ln-3640"></a>            <span class="c">!      prevent memory leaks if the type is</span>
<a name="ln-3641"></a>            <span class="c">!      being changed (for example, if an array</span>
<a name="ln-3642"></a>            <span class="c">!      is being replaced with a scalar).</span>
<a name="ln-3643"></a>
<a name="ln-3644"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_string</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3645"></a><span class="k">                </span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="k">value</span>
<a name="ln-3646"></a><span class="k">            else</span>
<a name="ln-3647"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-3648"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_string</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3649"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-3650"></a>            <span class="k">end if</span>
<a name="ln-3651"></a>
<a name="ln-3652"></a><span class="k">        end if</span>
<a name="ln-3653"></a>
<a name="ln-3654"></a><span class="k">    else</span>
<a name="ln-3655"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3656"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3657"></a>    <span class="k">end if</span>
<a name="ln-3658"></a>
<a name="ln-3659"></a><span class="k">    end subroutine </span><span class="n">json_add_string_by_path</span>
<a name="ln-3660"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3661"></a>
<a name="ln-3662"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3663"></a><span class="c">!&gt;</span>
<a name="ln-3664"></a><span class="c">!  Wrapper to [[json_add_string_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3665"></a>
<a name="ln-3666"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_string_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-3667"></a>                                                <span class="n">was_created</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3668"></a>
<a name="ln-3669"></a>    <span class="k">implicit none</span>
<a name="ln-3670"></a>
<a name="ln-3671"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3672"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! the JSON structure</span>
<a name="ln-3673"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! the path to the variable</span>
<a name="ln-3674"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>       <span class="c">!! the value to add</span>
<a name="ln-3675"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! if the variable was found</span>
<a name="ln-3676"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if the variable had to be created</span>
<a name="ln-3677"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-3678"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-3679"></a>
<a name="ln-3680"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">to_unicode</span><span class="p">(</span><span class="k">value</span><span class="p">),&amp;</span>
<a name="ln-3681"></a>                                        <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3682"></a>
<a name="ln-3683"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_string_by_path</span>
<a name="ln-3684"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3685"></a>
<a name="ln-3686"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3687"></a><span class="c">!&gt;</span>
<a name="ln-3688"></a><span class="c">!  Wrapper for [[json_add_string_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-3689"></a>
<a name="ln-3690"></a>    <span class="k">subroutine </span><span class="n">json_add_string_by_path_path_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-3691"></a>                                                    <span class="n">was_created</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3692"></a>
<a name="ln-3693"></a>    <span class="k">implicit none</span>
<a name="ln-3694"></a>
<a name="ln-3695"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3696"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3697"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3698"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3699"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3700"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3701"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>     <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-3702"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span>  <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-3703"></a>
<a name="ln-3704"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3705"></a>
<a name="ln-3706"></a>    <span class="k">end subroutine </span><span class="n">json_add_string_by_path_path_ascii</span>
<a name="ln-3707"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3708"></a>
<a name="ln-3709"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3710"></a><span class="c">!&gt;</span>
<a name="ln-3711"></a><span class="c">!  Wrapper for [[json_add_string_by_path]] where &quot;value&quot; is kind=CDK.</span>
<a name="ln-3712"></a>
<a name="ln-3713"></a>    <span class="k">subroutine </span><span class="n">json_add_string_by_path_value_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-3714"></a>                                                        <span class="n">was_created</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3715"></a>
<a name="ln-3716"></a>    <span class="k">implicit none</span>
<a name="ln-3717"></a>
<a name="ln-3718"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3719"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3720"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3721"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the value to add</span>
<a name="ln-3722"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3723"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3724"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>     <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-3725"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span>  <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-3726"></a>
<a name="ln-3727"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="k">value</span><span class="p">),</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3728"></a>
<a name="ln-3729"></a>    <span class="k">end subroutine </span><span class="n">json_add_string_by_path_value_ascii</span>
<a name="ln-3730"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3731"></a>
<a name="ln-3732"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3733"></a><span class="c">!&gt;</span>
<a name="ln-3734"></a><span class="c">!  Wrapper to [[json_add_integer_by_path]] for adding an integer vector by path.</span>
<a name="ln-3735"></a>
<a name="ln-3736"></a>    <span class="k">subroutine </span><span class="n">json_add_integer_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3737"></a>
<a name="ln-3738"></a>    <span class="k">implicit none</span>
<a name="ln-3739"></a>
<a name="ln-3740"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3741"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3742"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3743"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3744"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3745"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3746"></a>
<a name="ln-3747"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to path (which may exist)</span>
<a name="ln-3748"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span> <span class="c">!! new variable that is created</span>
<a name="ln-3749"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-3750"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the variable name</span>
<a name="ln-3751"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_found</span>  <span class="c">!! if the path was successfully found (or created)</span>
<a name="ln-3752"></a>
<a name="ln-3753"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3754"></a>
<a name="ln-3755"></a>        <span class="c">!get a pointer to the variable</span>
<a name="ln-3756"></a>        <span class="c">!(creating it if necessary)</span>
<a name="ln-3757"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="o">=</span><span class="n">p_found</span><span class="p">)</span>
<a name="ln-3758"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">p_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3759"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>             <span class="c">! want to keep the existing name</span>
<a name="ln-3760"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>        <span class="c">! create a new array variable</span>
<a name="ln-3761"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span> <span class="c">! replace p with this array (destroy p)</span>
<a name="ln-3762"></a>            <span class="c">!populate each element of the array:</span>
<a name="ln-3763"></a>            <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-3764"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3765"></a>            <span class="k">end do</span>
<a name="ln-3766"></a><span class="k">        end if</span>
<a name="ln-3767"></a>
<a name="ln-3768"></a><span class="k">    else</span>
<a name="ln-3769"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3770"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3771"></a>    <span class="k">end if</span>
<a name="ln-3772"></a>
<a name="ln-3773"></a><span class="k">    end subroutine </span><span class="n">json_add_integer_vec_by_path</span>
<a name="ln-3774"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3775"></a>
<a name="ln-3776"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3777"></a><span class="c">!&gt;</span>
<a name="ln-3778"></a><span class="c">!  Wrapper for [[json_add_integer_vec_by_path]] where &quot;path&quot; is kind=CDK).</span>
<a name="ln-3779"></a>
<a name="ln-3780"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_integer_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3781"></a>
<a name="ln-3782"></a>    <span class="k">implicit none</span>
<a name="ln-3783"></a>
<a name="ln-3784"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3785"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3786"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3787"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3788"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3789"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3790"></a>
<a name="ln-3791"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_integer_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3792"></a>
<a name="ln-3793"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_integer_vec_by_path</span>
<a name="ln-3794"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3795"></a>
<a name="ln-3796"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3797"></a><span class="c">!&gt;</span>
<a name="ln-3798"></a><span class="c">!  Wrapper to [[json_add_logical_by_path]] for adding a logical vector by path.</span>
<a name="ln-3799"></a>
<a name="ln-3800"></a>    <span class="k">subroutine </span><span class="n">json_add_logical_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3801"></a>
<a name="ln-3802"></a>    <span class="k">implicit none</span>
<a name="ln-3803"></a>
<a name="ln-3804"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3805"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3806"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3807"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3808"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3809"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3810"></a>
<a name="ln-3811"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to path (which may exist)</span>
<a name="ln-3812"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span> <span class="c">!! new variable that is created</span>
<a name="ln-3813"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-3814"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the variable name</span>
<a name="ln-3815"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_found</span>  <span class="c">!! if the path was successfully found (or created)</span>
<a name="ln-3816"></a>
<a name="ln-3817"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3818"></a>
<a name="ln-3819"></a>        <span class="c">!get a pointer to the variable</span>
<a name="ln-3820"></a>        <span class="c">!(creating it if necessary)</span>
<a name="ln-3821"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="o">=</span><span class="n">p_found</span><span class="p">)</span>
<a name="ln-3822"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">p_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3823"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>             <span class="c">! want to keep the existing name</span>
<a name="ln-3824"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>        <span class="c">! create a new array variable</span>
<a name="ln-3825"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span> <span class="c">! replace p with this array (destroy p)</span>
<a name="ln-3826"></a>            <span class="c">!populate each element of the array:</span>
<a name="ln-3827"></a>            <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-3828"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3829"></a>            <span class="k">end do</span>
<a name="ln-3830"></a><span class="k">        end if</span>
<a name="ln-3831"></a>
<a name="ln-3832"></a><span class="k">    else</span>
<a name="ln-3833"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3834"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3835"></a>    <span class="k">end if</span>
<a name="ln-3836"></a>
<a name="ln-3837"></a><span class="k">    end subroutine </span><span class="n">json_add_logical_vec_by_path</span>
<a name="ln-3838"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3839"></a>
<a name="ln-3840"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3841"></a><span class="c">!&gt;</span>
<a name="ln-3842"></a><span class="c">!  Wrapper for [[json_add_logical_vec_by_path]] where &quot;path&quot; is kind=CDK).</span>
<a name="ln-3843"></a>
<a name="ln-3844"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_logical_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3845"></a>
<a name="ln-3846"></a>    <span class="k">implicit none</span>
<a name="ln-3847"></a>
<a name="ln-3848"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3849"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3850"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3851"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3852"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3853"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3854"></a>
<a name="ln-3855"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_logical_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3856"></a>
<a name="ln-3857"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_logical_vec_by_path</span>
<a name="ln-3858"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3859"></a>
<a name="ln-3860"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3861"></a><span class="c">!&gt;</span>
<a name="ln-3862"></a><span class="c">!  Wrapper to [[json_add_double_by_path]] for adding a double vector by path.</span>
<a name="ln-3863"></a>
<a name="ln-3864"></a>    <span class="k">subroutine </span><span class="n">json_add_double_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3865"></a>
<a name="ln-3866"></a>    <span class="k">implicit none</span>
<a name="ln-3867"></a>
<a name="ln-3868"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3869"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3870"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3871"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3872"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3873"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3874"></a>
<a name="ln-3875"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to path (which may exist)</span>
<a name="ln-3876"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span> <span class="c">!! new variable that is created</span>
<a name="ln-3877"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-3878"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the variable name</span>
<a name="ln-3879"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_found</span>  <span class="c">!! if the path was successfully found (or created)</span>
<a name="ln-3880"></a>
<a name="ln-3881"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3882"></a>
<a name="ln-3883"></a>        <span class="c">!get a pointer to the variable</span>
<a name="ln-3884"></a>        <span class="c">!(creating it if necessary)</span>
<a name="ln-3885"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="o">=</span><span class="n">p_found</span><span class="p">)</span>
<a name="ln-3886"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">p_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3887"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>             <span class="c">! want to keep the existing name</span>
<a name="ln-3888"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>        <span class="c">! create a new array variable</span>
<a name="ln-3889"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span> <span class="c">! replace p with this array (destroy p)</span>
<a name="ln-3890"></a>            <span class="c">!populate each element of the array:</span>
<a name="ln-3891"></a>            <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-3892"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-3893"></a>            <span class="k">end do</span>
<a name="ln-3894"></a><span class="k">        end if</span>
<a name="ln-3895"></a>
<a name="ln-3896"></a><span class="k">    else</span>
<a name="ln-3897"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3898"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3899"></a>    <span class="k">end if</span>
<a name="ln-3900"></a>
<a name="ln-3901"></a><span class="k">    end subroutine </span><span class="n">json_add_double_vec_by_path</span>
<a name="ln-3902"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3903"></a>
<a name="ln-3904"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3905"></a><span class="c">!&gt;</span>
<a name="ln-3906"></a><span class="c">!  Wrapper for [[json_add_double_vec_by_path]] where &quot;path&quot; is kind=CDK).</span>
<a name="ln-3907"></a>
<a name="ln-3908"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_double_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3909"></a>
<a name="ln-3910"></a>    <span class="k">implicit none</span>
<a name="ln-3911"></a>
<a name="ln-3912"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3913"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3914"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3915"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-3916"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3917"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3918"></a>
<a name="ln-3919"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_double_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-3920"></a>
<a name="ln-3921"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_double_vec_by_path</span>
<a name="ln-3922"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3923"></a>
<a name="ln-3924"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-3925"></a><span class="c">!&gt;</span>
<a name="ln-3926"></a><span class="c">!  Wrapper to [[json_add_string_by_path]] for adding a string vector by path.</span>
<a name="ln-3927"></a><span class="c">!</span>
<a name="ln-3928"></a><span class="c">!@note The `ilen` input can be used to specify the actual lengths of the</span>
<a name="ln-3929"></a><span class="c">!      the strings in the array. They must all be `&lt;= len(value)`.</span>
<a name="ln-3930"></a>
<a name="ln-3931"></a>    <span class="k">subroutine </span><span class="n">json_add_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3932"></a>
<a name="ln-3933"></a>    <span class="k">implicit none</span>
<a name="ln-3934"></a>
<a name="ln-3935"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-3936"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-3937"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-3938"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span> <span class="c">!! the vector to add</span>
<a name="ln-3939"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-3940"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-3941"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the string lengths of each</span>
<a name="ln-3942"></a>                                                         <span class="c">!! element in `value`. If not present,</span>
<a name="ln-3943"></a>                                                         <span class="c">!! the full `len(value)` string is added</span>
<a name="ln-3944"></a>                                                         <span class="c">!! for each element.</span>
<a name="ln-3945"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>      <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-3946"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>   <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-3947"></a>
<a name="ln-3948"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to path (which may exist)</span>
<a name="ln-3949"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span> <span class="c">!! new variable that is created</span>
<a name="ln-3950"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-3951"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the variable name</span>
<a name="ln-3952"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p_found</span>  <span class="c">!! if the path was successfully found (or created)</span>
<a name="ln-3953"></a>
<a name="ln-3954"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-3955"></a>
<a name="ln-3956"></a>        <span class="c">! validate ilen array if present:</span>
<a name="ln-3957"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ilen</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3958"></a><span class="k">            if</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">ilen</span><span class="p">)</span><span class="o">/=</span><span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3959"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_string_vec_by_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3960"></a>                                          <span class="s1">&#39;Invalid size of ilen input vector.&#39;</span><span class="p">)</span>
<a name="ln-3961"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3962"></a><span class="k">                    </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3963"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3964"></a>                <span class="k">end if</span>
<a name="ln-3965"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3966"></a>                <span class="k">return</span>
<a name="ln-3967"></a><span class="k">            else</span>
<a name="ln-3968"></a>                <span class="c">! also have to validate the specified lengths.</span>
<a name="ln-3969"></a>                <span class="c">! (must not be greater than input string length)</span>
<a name="ln-3970"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-3971"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="k">value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3972"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_add_string_vec_by_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-3973"></a>                                                  <span class="s1">&#39;Invalid ilen element.&#39;</span><span class="p">)</span>
<a name="ln-3974"></a>                        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3975"></a><span class="k">                            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3976"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-3977"></a>                        <span class="k">end if</span>
<a name="ln-3978"></a><span class="k">                        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-3979"></a>                        <span class="k">return</span>
<a name="ln-3980"></a><span class="k">                    end if</span>
<a name="ln-3981"></a><span class="k">                end do</span>
<a name="ln-3982"></a><span class="k">            end if</span>
<a name="ln-3983"></a><span class="k">        end if</span>
<a name="ln-3984"></a>
<a name="ln-3985"></a>        <span class="c">!get a pointer to the variable</span>
<a name="ln-3986"></a>        <span class="c">!(creating it if necessary)</span>
<a name="ln-3987"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="o">=</span><span class="n">p_found</span><span class="p">)</span>
<a name="ln-3988"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">p_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-3989"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>             <span class="c">! want to keep the existing name</span>
<a name="ln-3990"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>        <span class="c">! create a new array variable</span>
<a name="ln-3991"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span> <span class="c">! replace p with this array (destroy p)</span>
<a name="ln-3992"></a>            <span class="c">!populate each element of the array:</span>
<a name="ln-3993"></a>            <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-3994"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">ilen</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-3995"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="p">(</span><span class="n">i</span><span class="p">)(</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span> <span class="p">&amp;</span>
<a name="ln-3996"></a>                                  <span class="n">trim_str</span><span class="o">=</span><span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="o">=</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-3997"></a>                <span class="k">else</span>
<a name="ln-3998"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">&amp;</span>
<a name="ln-3999"></a>                                  <span class="n">trim_str</span><span class="o">=</span><span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="o">=</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4000"></a>                <span class="k">end if</span>
<a name="ln-4001"></a><span class="k">            end do</span>
<a name="ln-4002"></a><span class="k">        end if</span>
<a name="ln-4003"></a>
<a name="ln-4004"></a><span class="k">    else</span>
<a name="ln-4005"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span>       <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4006"></a>        <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">)</span> <span class="p">)</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4007"></a>    <span class="k">end if</span>
<a name="ln-4008"></a>
<a name="ln-4009"></a><span class="k">    end subroutine </span><span class="n">json_add_string_vec_by_path</span>
<a name="ln-4010"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4011"></a>
<a name="ln-4012"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4013"></a><span class="c">!&gt;</span>
<a name="ln-4014"></a><span class="c">!  Wrapper for [[json_add_string_vec_by_path]] where &quot;path&quot; and &quot;value&quot; are kind=CDK).</span>
<a name="ln-4015"></a>
<a name="ln-4016"></a>    <span class="k">subroutine </span><span class="n">wrap_json_add_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,&amp;</span>
<a name="ln-4017"></a>                                                <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,&amp;</span>
<a name="ln-4018"></a>                                                <span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4019"></a>
<a name="ln-4020"></a>    <span class="k">implicit none</span>
<a name="ln-4021"></a>
<a name="ln-4022"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4023"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-4024"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-4025"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-4026"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-4027"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-4028"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the string lengths of each</span>
<a name="ln-4029"></a>                                                         <span class="c">!! element in `value`. If not present,</span>
<a name="ln-4030"></a>                                                         <span class="c">!! the full `len(value)` string is added</span>
<a name="ln-4031"></a>                                                         <span class="c">!! for each element.</span>
<a name="ln-4032"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">trim_str</span>         <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-4033"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">adjustl_str</span>      <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-4034"></a>
<a name="ln-4035"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">to_unicode</span><span class="p">(</span><span class="k">value</span><span class="p">),&amp;</span>
<a name="ln-4036"></a>                                            <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4037"></a>
<a name="ln-4038"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_add_string_vec_by_path</span>
<a name="ln-4039"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4040"></a>
<a name="ln-4041"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4042"></a><span class="c">!&gt;</span>
<a name="ln-4043"></a><span class="c">!  Wrapper for [[json_add_string_vec_by_path]] where &quot;value&quot; is kind=CDK).</span>
<a name="ln-4044"></a>
<a name="ln-4045"></a>    <span class="k">subroutine </span><span class="n">json_add_string_vec_by_path_value_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,&amp;</span>
<a name="ln-4046"></a>                                                        <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,&amp;</span>
<a name="ln-4047"></a>                                                        <span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4048"></a>
<a name="ln-4049"></a>    <span class="k">implicit none</span>
<a name="ln-4050"></a>
<a name="ln-4051"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4052"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-4053"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-4054"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-4055"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-4056"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-4057"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the string lengths of each</span>
<a name="ln-4058"></a>                                                         <span class="c">!! element in `value`. If not present,</span>
<a name="ln-4059"></a>                                                         <span class="c">!! the full `len(value)` string is added</span>
<a name="ln-4060"></a>                                                         <span class="c">!! for each element.</span>
<a name="ln-4061"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">trim_str</span>         <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-4062"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">adjustl_str</span>      <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-4063"></a>
<a name="ln-4064"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="k">value</span><span class="p">),&amp;</span>
<a name="ln-4065"></a>                                            <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4066"></a>
<a name="ln-4067"></a>    <span class="k">end subroutine </span><span class="n">json_add_string_vec_by_path_value_ascii</span>
<a name="ln-4068"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4069"></a>
<a name="ln-4070"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4071"></a><span class="c">!&gt;</span>
<a name="ln-4072"></a><span class="c">!  Wrapper for [[json_add_string_vec_by_path]] where &quot;path&quot; is kind=CDK).</span>
<a name="ln-4073"></a>
<a name="ln-4074"></a>    <span class="k">subroutine </span><span class="n">json_add_string_vec_by_path_path_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="k">value</span><span class="p">,&amp;</span>
<a name="ln-4075"></a>                                                        <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">,&amp;</span>
<a name="ln-4076"></a>                                                        <span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4077"></a>
<a name="ln-4078"></a>    <span class="k">implicit none</span>
<a name="ln-4079"></a>
<a name="ln-4080"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4081"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! the JSON structure</span>
<a name="ln-4082"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! the path to the variable</span>
<a name="ln-4083"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>        <span class="c">!! the vector to add</span>
<a name="ln-4084"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! if the variable was found</span>
<a name="ln-4085"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! if the variable had to be created</span>
<a name="ln-4086"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the string lengths of each</span>
<a name="ln-4087"></a>                                                         <span class="c">!! element in `value`. If not present,</span>
<a name="ln-4088"></a>                                                         <span class="c">!! the full `len(value)` string is added</span>
<a name="ln-4089"></a>                                                         <span class="c">!! for each element.</span>
<a name="ln-4090"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">trim_str</span>         <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-4091"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>  <span class="kd">::</span> <span class="n">adjustl_str</span>      <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-4092"></a>
<a name="ln-4093"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_add_string_vec_by_path</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,&amp;</span>
<a name="ln-4094"></a>                                            <span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">,</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-4095"></a>
<a name="ln-4096"></a>    <span class="k">end subroutine </span><span class="n">json_add_string_vec_by_path_path_ascii</span>
<a name="ln-4097"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4098"></a>
<a name="ln-4099"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4100"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4101"></a><span class="c">!  date: 1/19/2014</span>
<a name="ln-4102"></a><span class="c">!</span>
<a name="ln-4103"></a><span class="c">!  Add a real value child to the [[json_value]] variable</span>
<a name="ln-4104"></a><span class="c">!</span>
<a name="ln-4105"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4106"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4107"></a>
<a name="ln-4108"></a>    <span class="k">subroutine </span><span class="n">json_value_add_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4109"></a>
<a name="ln-4110"></a>    <span class="k">implicit none</span>
<a name="ln-4111"></a>
<a name="ln-4112"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4113"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4114"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-4115"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! real value</span>
<a name="ln-4116"></a>
<a name="ln-4117"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4118"></a>
<a name="ln-4119"></a>    <span class="c">!create the variable:</span>
<a name="ln-4120"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_double</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4121"></a>
<a name="ln-4122"></a>    <span class="c">!add it:</span>
<a name="ln-4123"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4124"></a>
<a name="ln-4125"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_double</span>
<a name="ln-4126"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4127"></a>
<a name="ln-4128"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4129"></a><span class="c">!&gt;</span>
<a name="ln-4130"></a><span class="c">!  Alternate version of [[json_value_add_double]] where `name` is kind=CDK.</span>
<a name="ln-4131"></a>
<a name="ln-4132"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4133"></a>
<a name="ln-4134"></a>    <span class="k">implicit none</span>
<a name="ln-4135"></a>
<a name="ln-4136"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4137"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4138"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-4139"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! real value</span>
<a name="ln-4140"></a>
<a name="ln-4141"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4142"></a>
<a name="ln-4143"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_double</span>
<a name="ln-4144"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4145"></a>
<a name="ln-4146"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4147"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4148"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-4149"></a><span class="c">!</span>
<a name="ln-4150"></a><span class="c">!  Add a real vector to the structure.</span>
<a name="ln-4151"></a><span class="c">!</span>
<a name="ln-4152"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4153"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4154"></a>
<a name="ln-4155"></a>    <span class="k">subroutine </span><span class="n">json_value_add_double_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4156"></a>
<a name="ln-4157"></a>    <span class="k">implicit none</span>
<a name="ln-4158"></a>
<a name="ln-4159"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4160"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4161"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4162"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4163"></a>
<a name="ln-4164"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4165"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span> <span class="c">!! counter</span>
<a name="ln-4166"></a>
<a name="ln-4167"></a>    <span class="c">!create the variable as an array:</span>
<a name="ln-4168"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4169"></a>
<a name="ln-4170"></a>    <span class="c">!populate the array:</span>
<a name="ln-4171"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4172"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4173"></a>    <span class="k">end do</span>
<a name="ln-4174"></a>
<a name="ln-4175"></a>    <span class="c">!add it:</span>
<a name="ln-4176"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4177"></a>
<a name="ln-4178"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_double_vec</span>
<a name="ln-4179"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4180"></a>
<a name="ln-4181"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4182"></a><span class="c">!&gt;</span>
<a name="ln-4183"></a><span class="c">!  Alternate version of [[json_value_add_double_vec]] where `name` is kind=CDK.</span>
<a name="ln-4184"></a>
<a name="ln-4185"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_double_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4186"></a>
<a name="ln-4187"></a>    <span class="k">implicit none</span>
<a name="ln-4188"></a>
<a name="ln-4189"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4190"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4191"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4192"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>     <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4193"></a>
<a name="ln-4194"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4195"></a>
<a name="ln-4196"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_double_vec</span>
<a name="ln-4197"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4198"></a>
<a name="ln-4199"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4200"></a><span class="c">!&gt;</span>
<a name="ln-4201"></a><span class="c">!  Add a NULL value child to the [[json_value]] variable</span>
<a name="ln-4202"></a><span class="c">!</span>
<a name="ln-4203"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4204"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4205"></a>
<a name="ln-4206"></a>    <span class="k">subroutine </span><span class="n">json_value_add_null</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a name="ln-4207"></a>
<a name="ln-4208"></a>    <span class="k">implicit none</span>
<a name="ln-4209"></a>
<a name="ln-4210"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4211"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4212"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4213"></a>
<a name="ln-4214"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4215"></a>
<a name="ln-4216"></a>    <span class="c">!create the variable:</span>
<a name="ln-4217"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_null</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4218"></a>
<a name="ln-4219"></a>    <span class="c">!add it:</span>
<a name="ln-4220"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4221"></a>
<a name="ln-4222"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_null</span>
<a name="ln-4223"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4224"></a>
<a name="ln-4225"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4226"></a><span class="c">!&gt;</span>
<a name="ln-4227"></a><span class="c">!  Alternate version of [[json_value_add_null]] where `name` is kind=CDK.</span>
<a name="ln-4228"></a>
<a name="ln-4229"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_null</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<a name="ln-4230"></a>
<a name="ln-4231"></a>    <span class="k">implicit none</span>
<a name="ln-4232"></a>
<a name="ln-4233"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4234"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4235"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4236"></a>
<a name="ln-4237"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-4238"></a>
<a name="ln-4239"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_null</span>
<a name="ln-4240"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4241"></a>
<a name="ln-4242"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4243"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4244"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-4245"></a><span class="c">!</span>
<a name="ln-4246"></a><span class="c">!  Add an integer value child to the [[json_value]] variable</span>
<a name="ln-4247"></a><span class="c">!</span>
<a name="ln-4248"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4249"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4250"></a>
<a name="ln-4251"></a>    <span class="k">subroutine </span><span class="n">json_value_add_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4252"></a>
<a name="ln-4253"></a>    <span class="k">implicit none</span>
<a name="ln-4254"></a>
<a name="ln-4255"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4256"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4257"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4258"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4259"></a>
<a name="ln-4260"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4261"></a>
<a name="ln-4262"></a>    <span class="c">!create the variable:</span>
<a name="ln-4263"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_integer</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4264"></a>
<a name="ln-4265"></a>    <span class="c">!add it:</span>
<a name="ln-4266"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4267"></a>
<a name="ln-4268"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_integer</span>
<a name="ln-4269"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4270"></a>
<a name="ln-4271"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4272"></a><span class="c">!&gt;</span>
<a name="ln-4273"></a><span class="c">!  Alternate version of [[json_value_add_integer]] where `name` is kind=CDK.</span>
<a name="ln-4274"></a>
<a name="ln-4275"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4276"></a>
<a name="ln-4277"></a>    <span class="k">implicit none</span>
<a name="ln-4278"></a>
<a name="ln-4279"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4280"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4281"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4282"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4283"></a>
<a name="ln-4284"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4285"></a>
<a name="ln-4286"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_integer</span>
<a name="ln-4287"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4288"></a>
<a name="ln-4289"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4290"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4291"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-4292"></a><span class="c">!</span>
<a name="ln-4293"></a><span class="c">!  Add an integer vector to the structure.</span>
<a name="ln-4294"></a><span class="c">!</span>
<a name="ln-4295"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4296"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4297"></a>
<a name="ln-4298"></a>    <span class="k">subroutine </span><span class="n">json_value_add_integer_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4299"></a>
<a name="ln-4300"></a>    <span class="k">implicit none</span>
<a name="ln-4301"></a>
<a name="ln-4302"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4303"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4304"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4305"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4306"></a>
<a name="ln-4307"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4308"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-4309"></a>
<a name="ln-4310"></a>    <span class="c">!create a variable as an array:</span>
<a name="ln-4311"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4312"></a>
<a name="ln-4313"></a>    <span class="c">!populate the array:</span>
<a name="ln-4314"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4315"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4316"></a>    <span class="k">end do</span>
<a name="ln-4317"></a>
<a name="ln-4318"></a>    <span class="c">!add it:</span>
<a name="ln-4319"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4320"></a>
<a name="ln-4321"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_integer_vec</span>
<a name="ln-4322"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4323"></a>
<a name="ln-4324"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4325"></a><span class="c">!&gt;</span>
<a name="ln-4326"></a><span class="c">!  Alternate version of [[json_value_add_integer_vec]] where `name` is kind=CDK.</span>
<a name="ln-4327"></a>
<a name="ln-4328"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_integer_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4329"></a>
<a name="ln-4330"></a>    <span class="k">implicit none</span>
<a name="ln-4331"></a>
<a name="ln-4332"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4333"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4334"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4335"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4336"></a>
<a name="ln-4337"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4338"></a>
<a name="ln-4339"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_integer_vec</span>
<a name="ln-4340"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4341"></a>
<a name="ln-4342"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4343"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4344"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-4345"></a><span class="c">!</span>
<a name="ln-4346"></a><span class="c">!  Add a logical value child to the [[json_value]] variable</span>
<a name="ln-4347"></a><span class="c">!</span>
<a name="ln-4348"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4349"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4350"></a>
<a name="ln-4351"></a>    <span class="k">subroutine </span><span class="n">json_value_add_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4352"></a>
<a name="ln-4353"></a>    <span class="k">implicit none</span>
<a name="ln-4354"></a>
<a name="ln-4355"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4356"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4357"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4358"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4359"></a>
<a name="ln-4360"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4361"></a>
<a name="ln-4362"></a>    <span class="c">!create the variable:</span>
<a name="ln-4363"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_logical</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4364"></a>
<a name="ln-4365"></a>    <span class="c">!add it:</span>
<a name="ln-4366"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4367"></a>
<a name="ln-4368"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_logical</span>
<a name="ln-4369"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4370"></a>
<a name="ln-4371"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4372"></a><span class="c">!&gt;</span>
<a name="ln-4373"></a><span class="c">!  Alternate version of [[json_value_add_logical]] where `name` is kind=CDK.</span>
<a name="ln-4374"></a>
<a name="ln-4375"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4376"></a>
<a name="ln-4377"></a>    <span class="k">implicit none</span>
<a name="ln-4378"></a>
<a name="ln-4379"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4380"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4381"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4382"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4383"></a>
<a name="ln-4384"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4385"></a>
<a name="ln-4386"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_logical</span>
<a name="ln-4387"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4388"></a>
<a name="ln-4389"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4390"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4391"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-4392"></a><span class="c">!</span>
<a name="ln-4393"></a><span class="c">!  Add a logical vector to the structure.</span>
<a name="ln-4394"></a><span class="c">!</span>
<a name="ln-4395"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4396"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4397"></a>
<a name="ln-4398"></a>    <span class="k">subroutine </span><span class="n">json_value_add_logical_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4399"></a>
<a name="ln-4400"></a>    <span class="k">implicit none</span>
<a name="ln-4401"></a>
<a name="ln-4402"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4403"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4404"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! name of the vector</span>
<a name="ln-4405"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! value</span>
<a name="ln-4406"></a>
<a name="ln-4407"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4408"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a name="ln-4409"></a>
<a name="ln-4410"></a>    <span class="c">!create the variable as an array:</span>
<a name="ln-4411"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4412"></a>
<a name="ln-4413"></a>    <span class="c">!populate the array:</span>
<a name="ln-4414"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4415"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-4416"></a>    <span class="k">end do</span>
<a name="ln-4417"></a>
<a name="ln-4418"></a>    <span class="c">!add it:</span>
<a name="ln-4419"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4420"></a>
<a name="ln-4421"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_logical_vec</span>
<a name="ln-4422"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4423"></a>
<a name="ln-4424"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4425"></a><span class="c">!&gt;</span>
<a name="ln-4426"></a><span class="c">!  Alternate version of [[json_value_add_logical_vec]] where `name` is kind=CDK.</span>
<a name="ln-4427"></a>
<a name="ln-4428"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_logical_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4429"></a>
<a name="ln-4430"></a>    <span class="k">implicit none</span>
<a name="ln-4431"></a>
<a name="ln-4432"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4433"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4434"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! name of the variable</span>
<a name="ln-4435"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">val</span>    <span class="c">!! value</span>
<a name="ln-4436"></a>
<a name="ln-4437"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
<a name="ln-4438"></a>
<a name="ln-4439"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_logical_vec</span>
<a name="ln-4440"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4441"></a>
<a name="ln-4442"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4443"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4444"></a><span class="c">!  date: 1/19/2014</span>
<a name="ln-4445"></a><span class="c">!</span>
<a name="ln-4446"></a><span class="c">!  Add a character string child to the [[json_value]] variable.</span>
<a name="ln-4447"></a><span class="c">!</span>
<a name="ln-4448"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4449"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4450"></a>
<a name="ln-4451"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4452"></a>
<a name="ln-4453"></a>    <span class="k">implicit none</span>
<a name="ln-4454"></a>
<a name="ln-4455"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4456"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4457"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>        <span class="c">!! name of the variable</span>
<a name="ln-4458"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>         <span class="c">!! value</span>
<a name="ln-4459"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-4460"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-4461"></a>
<a name="ln-4462"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4463"></a>
<a name="ln-4464"></a>    <span class="c">!create the variable:</span>
<a name="ln-4465"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_string</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4466"></a>
<a name="ln-4467"></a>    <span class="c">!add it:</span>
<a name="ln-4468"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4469"></a>
<a name="ln-4470"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string</span>
<a name="ln-4471"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4472"></a>
<a name="ln-4473"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4474"></a><span class="c">!&gt;</span>
<a name="ln-4475"></a><span class="c">!  Alternate version of [[json_value_add_string]] where `name` and `val` are kind=CDK.</span>
<a name="ln-4476"></a>
<a name="ln-4477"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4478"></a>
<a name="ln-4479"></a>    <span class="k">implicit none</span>
<a name="ln-4480"></a>
<a name="ln-4481"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4482"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4483"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>        <span class="c">!! name of the variable</span>
<a name="ln-4484"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>         <span class="c">!! value</span>
<a name="ln-4485"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-4486"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-4487"></a>
<a name="ln-4488"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4489"></a>
<a name="ln-4490"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_string</span>
<a name="ln-4491"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4492"></a>
<a name="ln-4493"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4494"></a><span class="c">!&gt;</span>
<a name="ln-4495"></a><span class="c">!  Alternate version of [[json_value_add_string]] where `name` is kind=CDK.</span>
<a name="ln-4496"></a>
<a name="ln-4497"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string_name_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4498"></a>
<a name="ln-4499"></a>    <span class="k">implicit none</span>
<a name="ln-4500"></a>
<a name="ln-4501"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4502"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4503"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>        <span class="c">!! name of the variable</span>
<a name="ln-4504"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>         <span class="c">!! value</span>
<a name="ln-4505"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-4506"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-4507"></a>
<a name="ln-4508"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4509"></a>
<a name="ln-4510"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string_name_ascii</span>
<a name="ln-4511"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4512"></a>
<a name="ln-4513"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4514"></a><span class="c">!&gt;</span>
<a name="ln-4515"></a><span class="c">!  Alternate version of [[json_value_add_string]] where `val` is kind=CDK.</span>
<a name="ln-4516"></a>
<a name="ln-4517"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string_val_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4518"></a>
<a name="ln-4519"></a>    <span class="k">implicit none</span>
<a name="ln-4520"></a>
<a name="ln-4521"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4522"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4523"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>        <span class="c">!! name of the variable</span>
<a name="ln-4524"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>         <span class="c">!! value</span>
<a name="ln-4525"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-4526"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-4527"></a>
<a name="ln-4528"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4529"></a>
<a name="ln-4530"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string_val_ascii</span>
<a name="ln-4531"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4532"></a>
<a name="ln-4533"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4534"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4535"></a><span class="c">!  date: 1/19/2014</span>
<a name="ln-4536"></a><span class="c">!</span>
<a name="ln-4537"></a><span class="c">!  Add an array of character strings to the structure.</span>
<a name="ln-4538"></a><span class="c">!</span>
<a name="ln-4539"></a><span class="c">!@note This routine is part of the public API that can be</span>
<a name="ln-4540"></a><span class="c">!      used to build a JSON structure using [[json_value]] pointers.</span>
<a name="ln-4541"></a>
<a name="ln-4542"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4543"></a>
<a name="ln-4544"></a>    <span class="k">implicit none</span>
<a name="ln-4545"></a>
<a name="ln-4546"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4547"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4548"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">name</span>        <span class="c">!! variable name</span>
<a name="ln-4549"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>         <span class="c">!! array of strings</span>
<a name="ln-4550"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                  <span class="kd">::</span> <span class="n">trim_str</span>    <span class="c">!! if TRIM() should be called for each element</span>
<a name="ln-4551"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                  <span class="kd">::</span> <span class="n">adjustl_str</span> <span class="c">!! if ADJUSTL() should be called for each element</span>
<a name="ln-4552"></a>
<a name="ln-4553"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">var</span>
<a name="ln-4554"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a name="ln-4555"></a>
<a name="ln-4556"></a>    <span class="c">!create the variable as an array:</span>
<a name="ln-4557"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-4558"></a>
<a name="ln-4559"></a>    <span class="c">!populate the array:</span>
<a name="ln-4560"></a>    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">size</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a name="ln-4561"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4562"></a>    <span class="k">end do</span>
<a name="ln-4563"></a>
<a name="ln-4564"></a>    <span class="c">!add it:</span>
<a name="ln-4565"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
<a name="ln-4566"></a>
<a name="ln-4567"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string_vec</span>
<a name="ln-4568"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4569"></a>
<a name="ln-4570"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4571"></a><span class="c">!&gt;</span>
<a name="ln-4572"></a><span class="c">!  Alternate version of [[json_value_add_string_vec]] where `name` and `val` are kind=CDK.</span>
<a name="ln-4573"></a>
<a name="ln-4574"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_add_string_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4575"></a>
<a name="ln-4576"></a>    <span class="k">implicit none</span>
<a name="ln-4577"></a>
<a name="ln-4578"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4579"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                          <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4580"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4581"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4582"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">trim_str</span>
<a name="ln-4583"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">adjustl_str</span>
<a name="ln-4584"></a>
<a name="ln-4585"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4586"></a>
<a name="ln-4587"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_add_string_vec</span>
<a name="ln-4588"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4589"></a>
<a name="ln-4590"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4591"></a><span class="c">!&gt;</span>
<a name="ln-4592"></a><span class="c">!  Alternate version of [[json_value_add_string_vec]] where `name` is kind=CDK.</span>
<a name="ln-4593"></a>
<a name="ln-4594"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string_vec_name_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4595"></a>
<a name="ln-4596"></a>    <span class="k">implicit none</span>
<a name="ln-4597"></a>
<a name="ln-4598"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4599"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                          <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4600"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4601"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4602"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">trim_str</span>
<a name="ln-4603"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">adjustl_str</span>
<a name="ln-4604"></a>
<a name="ln-4605"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4606"></a>
<a name="ln-4607"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string_vec_name_ascii</span>
<a name="ln-4608"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4609"></a>
<a name="ln-4610"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4611"></a><span class="c">!&gt;</span>
<a name="ln-4612"></a><span class="c">!  Alternate version of [[json_value_add_string_vec]] where `val` is kind=CDK.</span>
<a name="ln-4613"></a>
<a name="ln-4614"></a>    <span class="k">subroutine </span><span class="n">json_value_add_string_vec_val_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4615"></a>
<a name="ln-4616"></a>    <span class="k">implicit none</span>
<a name="ln-4617"></a>
<a name="ln-4618"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4619"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                          <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4620"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">name</span>
<a name="ln-4621"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-4622"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">trim_str</span>
<a name="ln-4623"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">adjustl_str</span>
<a name="ln-4624"></a>
<a name="ln-4625"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">trim_str</span><span class="p">,</span> <span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-4626"></a>
<a name="ln-4627"></a>    <span class="k">end subroutine </span><span class="n">json_value_add_string_vec_val_ascii</span>
<a name="ln-4628"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4629"></a>
<a name="ln-4630"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4631"></a><span class="c">!&gt;</span>
<a name="ln-4632"></a><span class="c">!  Count the number of children.</span>
<a name="ln-4633"></a><span class="c">!</span>
<a name="ln-4634"></a><span class="c">!### History</span>
<a name="ln-4635"></a><span class="c">!  * JW : 1/4/2014 : Original routine removed.</span>
<a name="ln-4636"></a><span class="c">!    Now using `n_children` variable.</span>
<a name="ln-4637"></a><span class="c">!    Renamed from `json_value_count`.</span>
<a name="ln-4638"></a>
<a name="ln-4639"></a>    <span class="k">function </span><span class="n">json_count</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="nb">count</span><span class="p">)</span>
<a name="ln-4640"></a>
<a name="ln-4641"></a>    <span class="k">implicit none</span>
<a name="ln-4642"></a>
<a name="ln-4643"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4644"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4645"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="nb">count</span>  <span class="c">!! number of children</span>
<a name="ln-4646"></a>
<a name="ln-4647"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4648"></a><span class="k">        </span><span class="nb">count</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">n_children</span>
<a name="ln-4649"></a>    <span class="k">else</span>
<a name="ln-4650"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_count: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4651"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4652"></a>    <span class="k">end if</span>
<a name="ln-4653"></a>
<a name="ln-4654"></a><span class="k">    end function </span><span class="n">json_count</span>
<a name="ln-4655"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4656"></a>
<a name="ln-4657"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4658"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4659"></a><span class="c">!  date: 10/16/2015</span>
<a name="ln-4660"></a><span class="c">!</span>
<a name="ln-4661"></a><span class="c">!  Returns a pointer to the parent of a [[json_value]].</span>
<a name="ln-4662"></a><span class="c">!  If there is no parent, then a `null()` pointer is returned.</span>
<a name="ln-4663"></a>
<a name="ln-4664"></a>    <span class="k">subroutine </span><span class="n">json_get_parent</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
<a name="ln-4665"></a>
<a name="ln-4666"></a>    <span class="k">implicit none</span>
<a name="ln-4667"></a>
<a name="ln-4668"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4669"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>        <span class="c">!! JSON object</span>
<a name="ln-4670"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">parent</span>   <span class="c">!! pointer to `parent`</span>
<a name="ln-4671"></a>
<a name="ln-4672"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4673"></a><span class="k">        </span><span class="n">parent</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-4674"></a>    <span class="k">else</span>
<a name="ln-4675"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<a name="ln-4676"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_parent: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4677"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4678"></a>    <span class="k">end if</span>
<a name="ln-4679"></a>
<a name="ln-4680"></a><span class="k">    end subroutine </span><span class="n">json_get_parent</span>
<a name="ln-4681"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4682"></a>
<a name="ln-4683"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4684"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4685"></a><span class="c">!  date: 10/31/2015</span>
<a name="ln-4686"></a><span class="c">!</span>
<a name="ln-4687"></a><span class="c">!  Returns a pointer to the next of a [[json_value]].</span>
<a name="ln-4688"></a><span class="c">!  If there is no next, then a `null()` pointer is returned.</span>
<a name="ln-4689"></a>
<a name="ln-4690"></a>    <span class="k">subroutine </span><span class="n">json_get_next</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">next</span><span class="p">)</span>
<a name="ln-4691"></a>
<a name="ln-4692"></a>    <span class="k">implicit none</span>
<a name="ln-4693"></a>
<a name="ln-4694"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4695"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>       <span class="c">!! JSON object</span>
<a name="ln-4696"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">next</span>    <span class="c">!! pointer to `next`</span>
<a name="ln-4697"></a>
<a name="ln-4698"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4699"></a><span class="k">        </span><span class="n">next</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">next</span>
<a name="ln-4700"></a>    <span class="k">else</span>
<a name="ln-4701"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">next</span><span class="p">)</span>
<a name="ln-4702"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_next: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4703"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4704"></a>    <span class="k">end if</span>
<a name="ln-4705"></a>
<a name="ln-4706"></a><span class="k">    end subroutine </span><span class="n">json_get_next</span>
<a name="ln-4707"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4708"></a>
<a name="ln-4709"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4710"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4711"></a><span class="c">!  date: 10/31/2015</span>
<a name="ln-4712"></a><span class="c">!</span>
<a name="ln-4713"></a><span class="c">!  Returns a pointer to the previous of a [[json_value]].</span>
<a name="ln-4714"></a><span class="c">!  If there is no previous, then a `null()` pointer is returned.</span>
<a name="ln-4715"></a>
<a name="ln-4716"></a>    <span class="k">subroutine </span><span class="n">json_get_previous</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">previous</span><span class="p">)</span>
<a name="ln-4717"></a>
<a name="ln-4718"></a>    <span class="k">implicit none</span>
<a name="ln-4719"></a>
<a name="ln-4720"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4721"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>        <span class="c">!! JSON object</span>
<a name="ln-4722"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">previous</span> <span class="c">!! pointer to `previous`</span>
<a name="ln-4723"></a>
<a name="ln-4724"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4725"></a><span class="k">        </span><span class="n">previous</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">previous</span>
<a name="ln-4726"></a>    <span class="k">else</span>
<a name="ln-4727"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span>
<a name="ln-4728"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_previous: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4729"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4730"></a>    <span class="k">end if</span>
<a name="ln-4731"></a>
<a name="ln-4732"></a><span class="k">    end subroutine </span><span class="n">json_get_previous</span>
<a name="ln-4733"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4734"></a>
<a name="ln-4735"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4736"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4737"></a><span class="c">!  date: 10/31/2015</span>
<a name="ln-4738"></a><span class="c">!</span>
<a name="ln-4739"></a><span class="c">!  Returns a pointer to the tail of a [[json_value]]</span>
<a name="ln-4740"></a><span class="c">!  (the last child of an array of object).</span>
<a name="ln-4741"></a><span class="c">!  If there is no tail, then a `null()` pointer is returned.</span>
<a name="ln-4742"></a>
<a name="ln-4743"></a>    <span class="k">subroutine </span><span class="n">json_get_tail</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-4744"></a>
<a name="ln-4745"></a>    <span class="k">implicit none</span>
<a name="ln-4746"></a>
<a name="ln-4747"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4748"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>        <span class="c">!! JSON object</span>
<a name="ln-4749"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tail</span>     <span class="c">!! pointer to `tail`</span>
<a name="ln-4750"></a>
<a name="ln-4751"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4752"></a><span class="k">        </span><span class="n">tail</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">tail</span>
<a name="ln-4753"></a>    <span class="k">else</span>
<a name="ln-4754"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">tail</span><span class="p">)</span>
<a name="ln-4755"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_tail: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4756"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4757"></a>    <span class="k">end if</span>
<a name="ln-4758"></a>
<a name="ln-4759"></a><span class="k">    end subroutine </span><span class="n">json_get_tail</span>
<a name="ln-4760"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4761"></a>
<a name="ln-4762"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4763"></a><span class="c">!&gt;</span>
<a name="ln-4764"></a><span class="c">!  Returns a child in the object or array given the index.</span>
<a name="ln-4765"></a>
<a name="ln-4766"></a>    <span class="k">subroutine </span><span class="n">json_value_get_child_by_index</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-4767"></a>
<a name="ln-4768"></a>    <span class="k">implicit none</span>
<a name="ln-4769"></a>
<a name="ln-4770"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4771"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! object or array JSON data</span>
<a name="ln-4772"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">idx</span>    <span class="c">!! index of the child</span>
<a name="ln-4773"></a>                                                  <span class="c">!! (this is a 1-based Fortran</span>
<a name="ln-4774"></a>                                                  <span class="c">!! style array index).</span>
<a name="ln-4775"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">child</span>  <span class="c">!! pointer to the child</span>
<a name="ln-4776"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if the value was found</span>
<a name="ln-4777"></a>                                                  <span class="c">!! (if not present, an exception</span>
<a name="ln-4778"></a>                                                  <span class="c">!! will be thrown if it was not</span>
<a name="ln-4779"></a>                                                  <span class="c">!! found.  If present and not</span>
<a name="ln-4780"></a>                                                  <span class="c">!! found, no exception will be</span>
<a name="ln-4781"></a>                                                  <span class="c">!! thrown).</span>
<a name="ln-4782"></a>
<a name="ln-4783"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a name="ln-4784"></a>
<a name="ln-4785"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-4786"></a>
<a name="ln-4787"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4788"></a>
<a name="ln-4789"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">children</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4790"></a>
<a name="ln-4791"></a><span class="k">            </span><span class="n">child</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-4792"></a>
<a name="ln-4793"></a>            <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-4794"></a>
<a name="ln-4795"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">%</span><span class="n">next</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4796"></a><span class="k">                    </span><span class="n">child</span> <span class="o">=&gt;</span> <span class="n">child</span><span class="p">%</span><span class="n">next</span>
<a name="ln-4797"></a>                <span class="k">else</span>
<a name="ln-4798"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_get_child_by_index:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4799"></a>                                              <span class="s1">&#39; child%next is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4800"></a>                    <span class="k">nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-4801"></a>                    <span class="k">exit</span>
<a name="ln-4802"></a><span class="k">                end if</span>
<a name="ln-4803"></a>
<a name="ln-4804"></a><span class="k">            end do</span>
<a name="ln-4805"></a>
<a name="ln-4806"></a><span class="k">        else</span>
<a name="ln-4807"></a>
<a name="ln-4808"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_get_child_by_index:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4809"></a>                                      <span class="s1">&#39; p%children is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4810"></a>
<a name="ln-4811"></a>        <span class="k">end if</span>
<a name="ln-4812"></a>
<a name="ln-4813"></a>        <span class="c">! found output:</span>
<a name="ln-4814"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4815"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4816"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-4817"></a>                <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4818"></a>            <span class="k">end if</span>
<a name="ln-4819"></a><span class="k">        else</span>
<a name="ln-4820"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-4821"></a>        <span class="k">end if</span>
<a name="ln-4822"></a>
<a name="ln-4823"></a><span class="k">    else</span>
<a name="ln-4824"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4825"></a>    <span class="k">end if</span>
<a name="ln-4826"></a>
<a name="ln-4827"></a><span class="k">    end subroutine </span><span class="n">json_value_get_child_by_index</span>
<a name="ln-4828"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4829"></a>
<a name="ln-4830"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4831"></a><span class="c">!&gt;</span>
<a name="ln-4832"></a><span class="c">!  Returns pointer to the first child of the object</span>
<a name="ln-4833"></a><span class="c">!  (or `null()` if it is not associated).</span>
<a name="ln-4834"></a>
<a name="ln-4835"></a>    <span class="k">subroutine </span><span class="n">json_value_get_child</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">child</span><span class="p">)</span>
<a name="ln-4836"></a>
<a name="ln-4837"></a>    <span class="k">implicit none</span>
<a name="ln-4838"></a>
<a name="ln-4839"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4840"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! object or array JSON data</span>
<a name="ln-4841"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">child</span>  <span class="c">!! pointer to the child</span>
<a name="ln-4842"></a>
<a name="ln-4843"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4844"></a><span class="k">        </span><span class="n">child</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-4845"></a>    <span class="k">else</span>
<a name="ln-4846"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-4847"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_get_child: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4848"></a>                                  <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4849"></a>    <span class="k">end if</span>
<a name="ln-4850"></a>
<a name="ln-4851"></a><span class="k">    end subroutine </span><span class="n">json_value_get_child</span>
<a name="ln-4852"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4853"></a>
<a name="ln-4854"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4855"></a><span class="c">!&gt;</span>
<a name="ln-4856"></a><span class="c">!  Returns a child in the object or array given the name string.</span>
<a name="ln-4857"></a><span class="c">!</span>
<a name="ln-4858"></a><span class="c">!  The name search can be case-sensitive or not, and can have significant trailing</span>
<a name="ln-4859"></a><span class="c">!  whitespace or not, depending on the settings in the [[json_core(type)]] class.</span>
<a name="ln-4860"></a><span class="c">!</span>
<a name="ln-4861"></a><span class="c">!@note The `name` input is not a path, and is not parsed like it is in [[json_get_by_path]].</span>
<a name="ln-4862"></a>
<a name="ln-4863"></a>    <span class="k">subroutine </span><span class="n">json_value_get_child_by_name</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-4864"></a>
<a name="ln-4865"></a>    <span class="k">implicit none</span>
<a name="ln-4866"></a>
<a name="ln-4867"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4868"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-4869"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>   <span class="c">!! the name of a child of `p`</span>
<a name="ln-4870"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">child</span>  <span class="c">!! pointer to the child</span>
<a name="ln-4871"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if the value was found</span>
<a name="ln-4872"></a>                                                  <span class="c">!! (if not present, an exception</span>
<a name="ln-4873"></a>                                                  <span class="c">!! will be thrown if it was not</span>
<a name="ln-4874"></a>                                                  <span class="c">!! found.  If present and not</span>
<a name="ln-4875"></a>                                                  <span class="c">!! found, no exception will be</span>
<a name="ln-4876"></a>                                                  <span class="c">!! thrown).</span>
<a name="ln-4877"></a>
<a name="ln-4878"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span><span class="n">n_children</span>
<a name="ln-4879"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">error</span>
<a name="ln-4880"></a>
<a name="ln-4881"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-4882"></a>
<a name="ln-4883"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4884"></a>
<a name="ln-4885"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4886"></a>
<a name="ln-4887"></a><span class="k">            </span><span class="n">error</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>   <span class="c">! will be false if it is found</span>
<a name="ln-4888"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4889"></a><span class="k">                </span><span class="n">n_children</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-4890"></a>                <span class="n">child</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>    <span class="c">!start with first one</span>
<a name="ln-4891"></a>                <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_children</span>
<a name="ln-4892"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4893"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-4894"></a>                            <span class="s1">&#39;Error in json_value_get_child_by_name: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4895"></a>                            <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-4896"></a>                        <span class="k">exit</span>
<a name="ln-4897"></a><span class="k">                    end if</span>
<a name="ln-4898"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">child</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4899"></a>                        <span class="c">!name string matching routine:</span>
<a name="ln-4900"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">name_equal</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4901"></a><span class="k">                            </span><span class="n">error</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4902"></a>                            <span class="k">exit</span>
<a name="ln-4903"></a><span class="k">                        end if</span>
<a name="ln-4904"></a><span class="k">                    end if</span>
<a name="ln-4905"></a><span class="k">                    </span><span class="n">child</span> <span class="o">=&gt;</span> <span class="n">child</span><span class="p">%</span><span class="n">next</span>
<a name="ln-4906"></a>                <span class="k">end do</span>
<a name="ln-4907"></a><span class="k">            end if</span>
<a name="ln-4908"></a>
<a name="ln-4909"></a><span class="k">            if</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4910"></a>                <span class="c">!did not find anything:</span>
<a name="ln-4911"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-4912"></a>                    <span class="s1">&#39;Error in json_value_get_child_by_name: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4913"></a>                    <span class="s1">&#39;child variable &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39; was not found.&#39;</span><span class="p">)</span>
<a name="ln-4914"></a>                <span class="k">nullify</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<a name="ln-4915"></a>            <span class="k">end if</span>
<a name="ln-4916"></a>
<a name="ln-4917"></a><span class="k">        else</span>
<a name="ln-4918"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-4919"></a>                <span class="s1">&#39;Error in json_value_get_child_by_name: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-4920"></a>                <span class="s1">&#39;pointer is not associated.&#39;</span><span class="p">)</span>
<a name="ln-4921"></a>        <span class="k">end if</span>
<a name="ln-4922"></a>
<a name="ln-4923"></a>        <span class="c">! found output:</span>
<a name="ln-4924"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4925"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4926"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-4927"></a>                <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4928"></a>            <span class="k">end if</span>
<a name="ln-4929"></a><span class="k">        else</span>
<a name="ln-4930"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-4931"></a>        <span class="k">end if</span>
<a name="ln-4932"></a>
<a name="ln-4933"></a><span class="k">    else</span>
<a name="ln-4934"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4935"></a>    <span class="k">end if</span>
<a name="ln-4936"></a>
<a name="ln-4937"></a><span class="k">    end subroutine </span><span class="n">json_value_get_child_by_name</span>
<a name="ln-4938"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4939"></a>
<a name="ln-4940"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-4941"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-4942"></a><span class="c">!  date: 8/25/2017</span>
<a name="ln-4943"></a><span class="c">!</span>
<a name="ln-4944"></a><span class="c">!  Checks a JSON object for duplicate child names.</span>
<a name="ln-4945"></a><span class="c">!</span>
<a name="ln-4946"></a><span class="c">!  It uses the specified settings for name matching (see [[name_strings_equal]]).</span>
<a name="ln-4947"></a><span class="c">!</span>
<a name="ln-4948"></a><span class="c">!@note This will only check for one duplicate,</span>
<a name="ln-4949"></a><span class="c">!      it will return the first one that it finds.</span>
<a name="ln-4950"></a>
<a name="ln-4951"></a>    <span class="k">subroutine </span><span class="n">json_check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
<a name="ln-4952"></a>
<a name="ln-4953"></a>    <span class="k">implicit none</span>
<a name="ln-4954"></a>
<a name="ln-4955"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-4956"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>  <span class="c">!! the object to search. If `p` is</span>
<a name="ln-4957"></a>                                              <span class="c">!! not a `json_object`, then `has_duplicate`</span>
<a name="ln-4958"></a>                                              <span class="c">!! will be false.</span>
<a name="ln-4959"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span>  <span class="c">!! true if there is at least</span>
<a name="ln-4960"></a>                                              <span class="c">!! two children have duplicate</span>
<a name="ln-4961"></a>                                              <span class="c">!! `name` values.</span>
<a name="ln-4962"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the duplicate name</span>
<a name="ln-4963"></a>                                                                      <span class="c">!! (unallocated if no</span>
<a name="ln-4964"></a>                                                                      <span class="c">!! duplicate was found)</span>
<a name="ln-4965"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">path</span> <span class="c">!! the full path to the</span>
<a name="ln-4966"></a>                                                                      <span class="c">!! duplicate name</span>
<a name="ln-4967"></a>                                                                      <span class="c">!! (unallocated if no</span>
<a name="ln-4968"></a>                                                                      <span class="c">!! duplicate was found)</span>
<a name="ln-4969"></a>
<a name="ln-4970"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>           <span class="c">!! counter</span>
<a name="ln-4971"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">j</span>           <span class="c">!! counter</span>
<a name="ln-4972"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">child</span>       <span class="c">!! pointer to a child of `p`</span>
<a name="ln-4973"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">n_children</span>  <span class="c">!! number of children of `p`</span>
<a name="ln-4974"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! flag for `get_child`</span>
<a name="ln-4975"></a>
<a name="ln-4976"></a>    <span class="k">type</span> <span class="kd">::</span> <span class="n">alloc_str</span>
<a name="ln-4977"></a>        <span class="c">!! so we can have an array of allocatable strings</span>
<a name="ln-4978"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str</span>  <span class="c">!! name string</span>
<a name="ln-4979"></a>    <span class="k">end type </span><span class="n">alloc_str</span>
<a name="ln-4980"></a>    <span class="k">type</span><span class="p">(</span><span class="n">alloc_str</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">names</span> <span class="c">!! array of all the</span>
<a name="ln-4981"></a>                                                      <span class="c">!! child name strings</span>
<a name="ln-4982"></a>
<a name="ln-4983"></a>    <span class="c">! initialize:</span>
<a name="ln-4984"></a>    <span class="n">has_duplicate</span> <span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-4985"></a>
<a name="ln-4986"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4987"></a>
<a name="ln-4988"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-4989"></a>
<a name="ln-4990"></a><span class="k">            if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-4991"></a>
<a name="ln-4992"></a>                <span class="c">! number of items to check:</span>
<a name="ln-4993"></a>                <span class="n">n_children</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-4994"></a>                <span class="k">allocate</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">n_children</span><span class="p">))</span>
<a name="ln-4995"></a>
<a name="ln-4996"></a>                <span class="c">! first get a list of all the name keys:</span>
<a name="ln-4997"></a>                <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_children</span>
<a name="ln-4998"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">child</span><span class="p">,</span><span class="n">found</span><span class="p">)</span> <span class="c">! get by index</span>
<a name="ln-4999"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5000"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-5001"></a>                            <span class="s1">&#39;Error in json_check_children_for_duplicate_keys: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5002"></a>                            <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-5003"></a>                        <span class="k">exit</span>
<a name="ln-5004"></a><span class="k">                    end if</span>
<a name="ln-5005"></a><span class="k">                    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">child</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5006"></a><span class="k">                        </span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span> <span class="o">=</span> <span class="n">child</span><span class="p">%</span><span class="n">name</span>
<a name="ln-5007"></a>                    <span class="k">else</span>
<a name="ln-5008"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-5009"></a>                            <span class="s1">&#39;Error in json_check_children_for_duplicate_keys: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5010"></a>                            <span class="s1">&#39;Object child name is not allocated&#39;</span><span class="p">)</span>
<a name="ln-5011"></a>                        <span class="k">exit</span>
<a name="ln-5012"></a><span class="k">                    end if</span>
<a name="ln-5013"></a><span class="k">                end do</span>
<a name="ln-5014"></a>
<a name="ln-5015"></a><span class="k">                if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5016"></a>                    <span class="c">! now check the list for duplicates:</span>
<a name="ln-5017"></a>                    <span class="n">main</span><span class="p">:</span> <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n_children</span>
<a name="ln-5018"></a>                        <span class="k">do </span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-5019"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">name_strings_equal</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span><span class="p">,</span><span class="n">names</span><span class="p">(</span><span class="n">j</span><span class="p">)%</span><span class="n">str</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5020"></a><span class="k">                                </span><span class="n">has_duplicate</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5021"></a>                                <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5022"></a><span class="k">                                    </span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span>
<a name="ln-5023"></a>                                <span class="k">end if</span>
<a name="ln-5024"></a><span class="k">                                if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5025"></a><span class="k">                                    call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span><span class="p">,</span><span class="n">child</span><span class="p">,</span><span class="n">found</span><span class="p">)</span> <span class="c">! get by name</span>
<a name="ln-5026"></a>                                    <span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5027"></a><span class="k">                                        call </span><span class="n">json</span><span class="p">%</span><span class="n">get_path</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5028"></a>                                        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5029"></a>                                            <span class="c">! should never happen since we know it is there</span>
<a name="ln-5030"></a>                                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-5031"></a>                                                    <span class="s1">&#39;Error in json_check_children_for_duplicate_keys: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5032"></a>                                                    <span class="s1">&#39;Could not get path&#39;</span><span class="p">)</span>
<a name="ln-5033"></a>                                        <span class="k">end if</span>
<a name="ln-5034"></a><span class="k">                                    else</span>
<a name="ln-5035"></a>                                        <span class="c">! should never happen since we know it is there</span>
<a name="ln-5036"></a>                                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-5037"></a>                                            <span class="s1">&#39;Error in json_check_children_for_duplicate_keys: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5038"></a>                                            <span class="s1">&#39;Could not get child: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span><span class="p">))</span>
<a name="ln-5039"></a>                                    <span class="k">end if</span>
<a name="ln-5040"></a><span class="k">                                end if</span>
<a name="ln-5041"></a><span class="k">                                exit </span><span class="n">main</span>
<a name="ln-5042"></a>                            <span class="k">end if</span>
<a name="ln-5043"></a><span class="k">                        end do</span>
<a name="ln-5044"></a><span class="k">                    end do </span><span class="n">main</span>
<a name="ln-5045"></a>                <span class="k">end if</span>
<a name="ln-5046"></a>
<a name="ln-5047"></a>                <span class="c">! cleanup</span>
<a name="ln-5048"></a>                <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n_children</span>
<a name="ln-5049"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">i</span><span class="p">)%</span><span class="n">str</span><span class="p">)</span>
<a name="ln-5050"></a>                <span class="k">end do</span>
<a name="ln-5051"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">names</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>
<a name="ln-5052"></a>
<a name="ln-5053"></a>            <span class="k">end if</span>
<a name="ln-5054"></a>
<a name="ln-5055"></a><span class="k">        end if</span>
<a name="ln-5056"></a>
<a name="ln-5057"></a><span class="k">    end if</span>
<a name="ln-5058"></a>
<a name="ln-5059"></a><span class="k">    end subroutine </span><span class="n">json_check_children_for_duplicate_keys</span>
<a name="ln-5060"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5061"></a>
<a name="ln-5062"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5063"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-5064"></a><span class="c">!  date: 8/25/2017</span>
<a name="ln-5065"></a><span class="c">!</span>
<a name="ln-5066"></a><span class="c">!  Checks a JSON structure for duplicate child names.</span>
<a name="ln-5067"></a><span class="c">!  This one recursively traverses the entire structure</span>
<a name="ln-5068"></a><span class="c">!  (calling [[json_check_children_for_duplicate_keys]]</span>
<a name="ln-5069"></a><span class="c">!  recursively for each element).</span>
<a name="ln-5070"></a><span class="c">!</span>
<a name="ln-5071"></a><span class="c">!@note This will only check for one duplicate,</span>
<a name="ln-5072"></a><span class="c">!      it will return the first one that it finds.</span>
<a name="ln-5073"></a>
<a name="ln-5074"></a>    <span class="k">subroutine </span><span class="n">json_check_all_for_duplicate_keys</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
<a name="ln-5075"></a>
<a name="ln-5076"></a>    <span class="k">implicit none</span>
<a name="ln-5077"></a>
<a name="ln-5078"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5079"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>  <span class="c">!! the object to search. If `p` is</span>
<a name="ln-5080"></a>                                              <span class="c">!! not a `json_object`, then `has_duplicate`</span>
<a name="ln-5081"></a>                                              <span class="c">!! will be false.</span>
<a name="ln-5082"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span>  <span class="c">!! true if there is at least</span>
<a name="ln-5083"></a>                                              <span class="c">!! one duplicate `name` key anywhere</span>
<a name="ln-5084"></a>                                              <span class="c">!! in the structure.</span>
<a name="ln-5085"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the duplicate name</span>
<a name="ln-5086"></a>                                                                      <span class="c">!! (unallocated if no</span>
<a name="ln-5087"></a>                                                                      <span class="c">!! duplicates were found)</span>
<a name="ln-5088"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">path</span> <span class="c">!! the full path to the</span>
<a name="ln-5089"></a>                                                                      <span class="c">!! duplicate name</span>
<a name="ln-5090"></a>                                                                      <span class="c">!! (unallocated if no</span>
<a name="ln-5091"></a>                                                                      <span class="c">!! duplicate was found)</span>
<a name="ln-5092"></a>
<a name="ln-5093"></a>    <span class="n">has_duplicate</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5094"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5095"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">traverse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">duplicate_key_func</span><span class="p">)</span>
<a name="ln-5096"></a>    <span class="k">end if</span>
<a name="ln-5097"></a>
<a name="ln-5098"></a><span class="k">    contains</span>
<a name="ln-5099"></a>
<a name="ln-5100"></a><span class="k">        subroutine </span><span class="n">duplicate_key_func</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">finished</span><span class="p">)</span>
<a name="ln-5101"></a>
<a name="ln-5102"></a>        <span class="c">!! Callback function to check each element</span>
<a name="ln-5103"></a>        <span class="c">!! for duplicate child names.</span>
<a name="ln-5104"></a>
<a name="ln-5105"></a>        <span class="k">implicit none</span>
<a name="ln-5106"></a>
<a name="ln-5107"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5108"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5109"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">finished</span>
<a name="ln-5110"></a>
<a name="ln-5111"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-5112"></a>
<a name="ln-5113"></a>        <span class="c">! this is a workaround for a gfortran bug (6 and 7),</span>
<a name="ln-5114"></a>
<a name="ln-5115"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp_name</span> <span class="c">!! temp variable for `name` string</span>
<a name="ln-5116"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp_path</span> <span class="c">!! temp variable for `path` string</span>
<a name="ln-5117"></a>
<a name="ln-5118"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5119"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">tmp_name</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">)</span>
<a name="ln-5120"></a>        <span class="k">else if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5121"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">tmp_name</span><span class="p">)</span>
<a name="ln-5122"></a>        <span class="k">else if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5123"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">tmp_path</span><span class="p">)</span>
<a name="ln-5124"></a>        <span class="k">else</span>
<a name="ln-5125"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">)</span>
<a name="ln-5126"></a>        <span class="k">end if</span>
<a name="ln-5127"></a>
<a name="ln-5128"></a><span class="k">        if</span> <span class="p">(</span><span class="n">has_duplicate</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5129"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="n">name</span> <span class="o">=</span> <span class="n">tmp_name</span>
<a name="ln-5130"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="n">path</span> <span class="o">=</span> <span class="n">tmp_path</span>
<a name="ln-5131"></a>        <span class="k">end if</span>
<a name="ln-5132"></a>
<a name="ln-5133"></a><span class="cp">#else</span>
<a name="ln-5134"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_children_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">path</span><span class="p">)</span>
<a name="ln-5135"></a><span class="cp">#endif</span>
<a name="ln-5136"></a>
<a name="ln-5137"></a>        <span class="n">finished</span> <span class="o">=</span> <span class="n">has_duplicate</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span>
<a name="ln-5138"></a>
<a name="ln-5139"></a>        <span class="k">end subroutine </span><span class="n">duplicate_key_func</span>
<a name="ln-5140"></a>
<a name="ln-5141"></a>    <span class="k">end subroutine </span><span class="n">json_check_all_for_duplicate_keys</span>
<a name="ln-5142"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5143"></a>
<a name="ln-5144"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5145"></a><span class="c">!&gt;</span>
<a name="ln-5146"></a><span class="c">!  Alternate version of [[json_value_get_child_by_name]] where `name` is kind=CDK.</span>
<a name="ln-5147"></a>
<a name="ln-5148"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_get_child_by_name</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5149"></a>
<a name="ln-5150"></a>    <span class="k">implicit none</span>
<a name="ln-5151"></a>
<a name="ln-5152"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5153"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5154"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-5155"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">child</span>
<a name="ln-5156"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-5157"></a>
<a name="ln-5158"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">child</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5159"></a>
<a name="ln-5160"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_get_child_by_name</span>
<a name="ln-5161"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5162"></a>
<a name="ln-5163"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5164"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-5165"></a><span class="c">!  date: 2/12/2014</span>
<a name="ln-5166"></a><span class="c">!</span>
<a name="ln-5167"></a><span class="c">!  Print the [[json_value]] structure to an allocatable string.</span>
<a name="ln-5168"></a>
<a name="ln-5169"></a>    <span class="k">subroutine </span><span class="n">json_value_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a name="ln-5170"></a>
<a name="ln-5171"></a>    <span class="k">implicit none</span>
<a name="ln-5172"></a>
<a name="ln-5173"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5174"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5175"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str</span>  <span class="c">!! prints structure to this string</span>
<a name="ln-5176"></a>
<a name="ln-5177"></a>    <span class="n">str</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-5178"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_value_print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">iunit</span><span class="o">=</span><span class="n">unit2str</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1_IK</span><span class="p">,</span> <span class="n">colon</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-5179"></a>
<a name="ln-5180"></a>    <span class="k">end subroutine </span><span class="n">json_value_to_string</span>
<a name="ln-5181"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5182"></a>
<a name="ln-5183"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5184"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-5185"></a><span class="c">!  date: 6/20/2014</span>
<a name="ln-5186"></a><span class="c">!</span>
<a name="ln-5187"></a><span class="c">!  Print the [[json_value]] structure to a file.</span>
<a name="ln-5188"></a>
<a name="ln-5189"></a>    <span class="k">subroutine </span><span class="n">json_print_1</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">iunit</span><span class="p">)</span>
<a name="ln-5190"></a>
<a name="ln-5191"></a>    <span class="k">implicit none</span>
<a name="ln-5192"></a>
<a name="ln-5193"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5194"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5195"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">iunit</span>   <span class="c">!! the file unit (the file must</span>
<a name="ln-5196"></a>                                                    <span class="c">!! already have been opened, can&#39;t be -1).</span>
<a name="ln-5197"></a>
<a name="ln-5198"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">dummy</span>
<a name="ln-5199"></a>
<a name="ln-5200"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">iunit</span><span class="o">/=</span><span class="n">unit2str</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5201"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">json_value_print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">iunit</span><span class="p">,</span><span class="n">str</span><span class="o">=</span><span class="n">dummy</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1_IK</span><span class="p">,</span> <span class="n">colon</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-5202"></a>    <span class="k">else</span>
<a name="ln-5203"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_print_1: iunit must not be -1.&#39;</span><span class="p">)</span>
<a name="ln-5204"></a>    <span class="k">end if</span>
<a name="ln-5205"></a>
<a name="ln-5206"></a><span class="k">    end subroutine </span><span class="n">json_print_1</span>
<a name="ln-5207"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5208"></a>
<a name="ln-5209"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5210"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-5211"></a><span class="c">!  date: 12/23/2014</span>
<a name="ln-5212"></a><span class="c">!</span>
<a name="ln-5213"></a><span class="c">!  Print the [[json_value]] structure to a file.</span>
<a name="ln-5214"></a>
<a name="ln-5215"></a>    <span class="k">subroutine </span><span class="n">json_print_2</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
<a name="ln-5216"></a>
<a name="ln-5217"></a>    <span class="k">implicit none</span>
<a name="ln-5218"></a>
<a name="ln-5219"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5220"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5221"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">filename</span>  <span class="c">!! the filename to print to</span>
<a name="ln-5222"></a>                                                      <span class="c">!! (should not already be open)</span>
<a name="ln-5223"></a>
<a name="ln-5224"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iunit</span><span class="p">,</span><span class="n">istat</span>
<a name="ln-5225"></a>
<a name="ln-5226"></a>    <span class="k">open</span><span class="p">(</span><span class="n">newunit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;REPLACE&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span> <span class="n">FILE_ENCODING</span> <span class="p">)</span>
<a name="ln-5227"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5228"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="k">print</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">iunit</span><span class="p">)</span>
<a name="ln-5229"></a>        <span class="k">close</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span>
<a name="ln-5230"></a>    <span class="k">else</span>
<a name="ln-5231"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_print_2: could not open file: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5232"></a>                              <span class="nb">trim</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
<a name="ln-5233"></a>    <span class="k">end if</span>
<a name="ln-5234"></a>
<a name="ln-5235"></a><span class="k">    end subroutine </span><span class="n">json_print_2</span>
<a name="ln-5236"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5237"></a>
<a name="ln-5238"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5239"></a><span class="c">!&gt;</span>
<a name="ln-5240"></a><span class="c">!  Print the JSON structure to a string or a file.</span>
<a name="ln-5241"></a><span class="c">!</span>
<a name="ln-5242"></a><span class="c">!### Notes</span>
<a name="ln-5243"></a><span class="c">!  * This is an internal routine called by the various wrapper routines.</span>
<a name="ln-5244"></a><span class="c">!  * The reason the `str` argument is non-optional is because of a</span>
<a name="ln-5245"></a><span class="c">!    bug in v4.9 of the gfortran compiler.</span>
<a name="ln-5246"></a>
<a name="ln-5247"></a>    <span class="k">recursive subroutine </span><span class="n">json_value_print</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">iunit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">indent</span><span class="p">,&amp;</span>
<a name="ln-5248"></a>                                          <span class="n">need_comma</span><span class="p">,</span><span class="n">colon</span><span class="p">,</span><span class="n">is_array_element</span><span class="p">,&amp;</span>
<a name="ln-5249"></a>                                          <span class="n">is_compressed_vector</span><span class="p">)</span>
<a name="ln-5250"></a>
<a name="ln-5251"></a>    <span class="k">implicit none</span>
<a name="ln-5252"></a>
<a name="ln-5253"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5254"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5255"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">iunit</span>             <span class="c">!! file unit to write to (6=console)</span>
<a name="ln-5256"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">indent</span>            <span class="c">!! indention level</span>
<a name="ln-5257"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">is_array_element</span>  <span class="c">!! if this is an array element</span>
<a name="ln-5258"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">need_comma</span>        <span class="c">!! if it needs a comma after it</span>
<a name="ln-5259"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">colon</span>             <span class="c">!! if the colon was just written</span>
<a name="ln-5260"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-5261"></a>                                                      <span class="c">!! if iunit==unit2str (-1) then the structure is</span>
<a name="ln-5262"></a>                                                      <span class="c">!! printed to this string rather than</span>
<a name="ln-5263"></a>                                                      <span class="c">!! a file. This mode is used by</span>
<a name="ln-5264"></a>                                                      <span class="c">!! [[json_value_to_string]].</span>
<a name="ln-5265"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">is_compressed_vector</span>  <span class="c">!! if True, this is an element</span>
<a name="ln-5266"></a>                                                             <span class="c">!! from an array being printed</span>
<a name="ln-5267"></a>                                                             <span class="c">!! on one line [default is False]</span>
<a name="ln-5268"></a>
<a name="ln-5269"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_numeric_str_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tmp</span> <span class="c">!! for val to string conversions</span>
<a name="ln-5270"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">s</span>
<a name="ln-5271"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-5272"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">tab</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">,</span> <span class="n">spaces</span>
<a name="ln-5273"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">print_comma</span>
<a name="ln-5274"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">write_file</span><span class="p">,</span> <span class="n">write_string</span>
<a name="ln-5275"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">is_array</span>
<a name="ln-5276"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span><span class="p">,</span><span class="n">var_type_prev</span>
<a name="ln-5277"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">is_vector</span> <span class="c">!! if all elements of a vector</span>
<a name="ln-5278"></a>                             <span class="c">!! are scalars of the same type</span>
<a name="ln-5279"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_escaped</span> <span class="c">!! escaped version of</span>
<a name="ln-5280"></a>                                                        <span class="c">!! `name` or `str_value`</span>
<a name="ln-5281"></a>
<a name="ln-5282"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5283"></a>
<a name="ln-5284"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">is_compressed_vector</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5285"></a><span class="k">            </span><span class="n">is_vector</span> <span class="o">=</span> <span class="n">is_compressed_vector</span>
<a name="ln-5286"></a>        <span class="k">else</span>
<a name="ln-5287"></a><span class="k">            </span><span class="n">is_vector</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5288"></a>        <span class="k">end if</span>
<a name="ln-5289"></a>
<a name="ln-5290"></a>        <span class="c">!whether to write a string or a file (one or the other):</span>
<a name="ln-5291"></a>        <span class="n">write_string</span> <span class="o">=</span> <span class="p">(</span><span class="n">iunit</span><span class="o">==</span><span class="n">unit2str</span><span class="p">)</span>
<a name="ln-5292"></a>        <span class="n">write_file</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">write_string</span>
<a name="ln-5293"></a>
<a name="ln-5294"></a>        <span class="c">!if the comma will be printed after the value</span>
<a name="ln-5295"></a>        <span class="c">! [comma not printed for the last elements]</span>
<a name="ln-5296"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">need_comma</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5297"></a><span class="k">            </span><span class="n">print_comma</span> <span class="o">=</span> <span class="n">need_comma</span>
<a name="ln-5298"></a>        <span class="k">else</span>
<a name="ln-5299"></a><span class="k">            </span><span class="n">print_comma</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5300"></a>        <span class="k">end if</span>
<a name="ln-5301"></a>
<a name="ln-5302"></a>        <span class="c">!number of &quot;tabs&quot; to indent:</span>
<a name="ln-5303"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">indent</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5304"></a><span class="k">            </span><span class="n">tab</span> <span class="o">=</span> <span class="n">indent</span>
<a name="ln-5305"></a>        <span class="k">else</span>
<a name="ln-5306"></a><span class="k">            </span><span class="n">tab</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-5307"></a>        <span class="k">end if</span>
<a name="ln-5308"></a>        <span class="c">!convert to number of spaces:</span>
<a name="ln-5309"></a>        <span class="n">spaces</span> <span class="o">=</span> <span class="n">tab</span><span class="o">*</span><span class="n">json</span><span class="p">%</span><span class="n">spaces_per_tab</span>
<a name="ln-5310"></a>
<a name="ln-5311"></a>        <span class="c">!if this is an element in an array:</span>
<a name="ln-5312"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">is_array_element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5313"></a><span class="k">            </span><span class="n">is_array</span> <span class="o">=</span> <span class="n">is_array_element</span>
<a name="ln-5314"></a>        <span class="k">else</span>
<a name="ln-5315"></a><span class="k">            </span><span class="n">is_array</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5316"></a>        <span class="k">end if</span>
<a name="ln-5317"></a>
<a name="ln-5318"></a>        <span class="c">!if the colon was the last thing written</span>
<a name="ln-5319"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">colon</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5320"></a><span class="k">            </span><span class="n">s</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-5321"></a>        <span class="k">else</span>
<a name="ln-5322"></a><span class="k">            </span><span class="n">s</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">spaces</span><span class="p">)</span>
<a name="ln-5323"></a>        <span class="k">end if</span>
<a name="ln-5324"></a>
<a name="ln-5325"></a><span class="k">        select case</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-5326"></a>
<a name="ln-5327"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
<a name="ln-5328"></a>
<a name="ln-5329"></a>            <span class="nb">count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5330"></a>
<a name="ln-5331"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!special case for empty object</span>
<a name="ln-5332"></a>
<a name="ln-5333"></a>                <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">start_object</span><span class="o">//</span><span class="n">end_object</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span> <span class="p">)</span>
<a name="ln-5334"></a>
<a name="ln-5335"></a>            <span class="k">else</span>
<a name="ln-5336"></a>
<a name="ln-5337"></a><span class="k">                call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">start_object</span> <span class="p">)</span>
<a name="ln-5338"></a>
<a name="ln-5339"></a>                <span class="c">!if an object is in an array, there is an extra tab:</span>
<a name="ln-5340"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">is_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5341"></a><span class="k">                    if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5342"></a>                    <span class="n">spaces</span> <span class="o">=</span> <span class="n">tab</span><span class="o">*</span><span class="n">json</span><span class="p">%</span><span class="n">spaces_per_tab</span>
<a name="ln-5343"></a>                <span class="k">end if</span>
<a name="ln-5344"></a>
<a name="ln-5345"></a><span class="k">                nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5346"></a>                <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-5347"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">count</span>
<a name="ln-5348"></a>
<a name="ln-5349"></a><span class="nb">                    </span><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5350"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5351"></a>                                                  <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-5352"></a>                        <span class="k">return</span>
<a name="ln-5353"></a><span class="k">                    end if</span>
<a name="ln-5354"></a>
<a name="ln-5355"></a>                    <span class="c">! print the name</span>
<a name="ln-5356"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">name</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5357"></a><span class="k">                        call </span><span class="n">escape_string</span><span class="p">(</span><span class="n">element</span><span class="p">%</span><span class="n">name</span><span class="p">,</span><span class="n">str_escaped</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">escape_solidus</span><span class="p">)</span>
<a name="ln-5358"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5359"></a>                            <span class="c">!compact printing - no extra space</span>
<a name="ln-5360"></a>                            <span class="k">call </span><span class="n">write_it</span><span class="p">(</span><span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">spaces</span><span class="p">)</span><span class="o">//</span><span class="n">quotation_mark</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5361"></a>                                          <span class="n">str_escaped</span><span class="o">//</span><span class="n">quotation_mark</span><span class="o">//</span><span class="n">colon_char</span><span class="p">,&amp;</span>
<a name="ln-5362"></a>                                          <span class="n">advance</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-5363"></a>                        <span class="k">else</span>
<a name="ln-5364"></a><span class="k">                            call </span><span class="n">write_it</span><span class="p">(</span><span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">spaces</span><span class="p">)</span><span class="o">//</span><span class="n">quotation_mark</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5365"></a>                                          <span class="n">str_escaped</span><span class="o">//</span><span class="n">quotation_mark</span><span class="o">//</span><span class="n">colon_char</span><span class="o">//</span><span class="n">space</span><span class="p">,&amp;</span>
<a name="ln-5366"></a>                                          <span class="n">advance</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-5367"></a>                        <span class="k">end if</span>
<a name="ln-5368"></a><span class="k">                    else</span>
<a name="ln-5369"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5370"></a>                                                  <span class="s1">&#39; element%name not allocated&#39;</span><span class="p">)</span>
<a name="ln-5371"></a>                        <span class="k">nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5372"></a>                        <span class="k">return</span>
<a name="ln-5373"></a><span class="k">                    end if</span>
<a name="ln-5374"></a>
<a name="ln-5375"></a>                    <span class="c">! recursive print of the element</span>
<a name="ln-5376"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_value_print</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">iunit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">tab</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5377"></a>                                    <span class="n">need_comma</span><span class="o">=</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">,</span> <span class="n">colon</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">)</span>
<a name="ln-5378"></a>
<a name="ln-5379"></a>                    <span class="c">! get the next child the list:</span>
<a name="ln-5380"></a>                    <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-5381"></a>
<a name="ln-5382"></a>                <span class="k">end do</span>
<a name="ln-5383"></a>
<a name="ln-5384"></a>                <span class="c">! [one fewer tab if it isn&#39;t an array element]</span>
<a name="ln-5385"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_array</span><span class="p">)</span> <span class="n">s</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">spaces</span><span class="o">-</span><span class="n">json</span><span class="p">%</span><span class="n">spaces_per_tab</span><span class="p">))</span>
<a name="ln-5386"></a>                <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">end_object</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span> <span class="p">)</span>
<a name="ln-5387"></a>                <span class="k">nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5388"></a>
<a name="ln-5389"></a>            <span class="k">end if</span>
<a name="ln-5390"></a>
<a name="ln-5391"></a><span class="k">        case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-5392"></a>
<a name="ln-5393"></a>            <span class="nb">count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5394"></a>
<a name="ln-5395"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">compress_vectors</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5396"></a>                <span class="c">! check to see if every child is the same type,</span>
<a name="ln-5397"></a>                <span class="c">! and a scalar:</span>
<a name="ln-5398"></a>                <span class="n">is_vector</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5399"></a>                <span class="n">var_type_prev</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>   <span class="c">! an invalid value</span>
<a name="ln-5400"></a>                <span class="k">nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5401"></a>                <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-5402"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">count</span>
<a name="ln-5403"></a><span class="nb">                    </span><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5404"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5405"></a>                                                  <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-5406"></a>                        <span class="k">return</span>
<a name="ln-5407"></a><span class="k">                    end if</span>
<a name="ln-5408"></a>                    <span class="c">! check variable type of all the children.</span>
<a name="ln-5409"></a>                    <span class="c">! They must all be the same, and a scalar.</span>
<a name="ln-5410"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-5411"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-5412"></a>                        <span class="n">var_type</span><span class="o">==</span><span class="n">json_array</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">&amp;</span>
<a name="ln-5413"></a>                        <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">var_type</span><span class="o">/=</span><span class="n">var_type_prev</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5414"></a><span class="k">                        </span><span class="n">is_vector</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5415"></a>                        <span class="k">exit</span>
<a name="ln-5416"></a><span class="k">                    end if</span>
<a name="ln-5417"></a><span class="k">                    </span><span class="n">var_type_prev</span> <span class="o">=</span> <span class="n">var_type</span>
<a name="ln-5418"></a>                    <span class="c">! get the next child the list:</span>
<a name="ln-5419"></a>                    <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-5420"></a>                <span class="k">end do</span>
<a name="ln-5421"></a><span class="k">            else</span>
<a name="ln-5422"></a><span class="k">                </span><span class="n">is_vector</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5423"></a>            <span class="k">end if</span>
<a name="ln-5424"></a>
<a name="ln-5425"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">count</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!special case for empty array</span>
<a name="ln-5426"></a>
<a name="ln-5427"></a>                <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">start_array</span><span class="o">//</span><span class="n">end_array</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span> <span class="p">)</span>
<a name="ln-5428"></a>
<a name="ln-5429"></a>            <span class="k">else</span>
<a name="ln-5430"></a>
<a name="ln-5431"></a><span class="k">                call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">start_array</span><span class="p">,</span> <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-5432"></a>
<a name="ln-5433"></a>                <span class="c">!if an array is in an array, there is an extra tab:</span>
<a name="ln-5434"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">is_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5435"></a><span class="k">                    if</span> <span class="p">(</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="n">tab</span> <span class="o">=</span> <span class="n">tab</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-5436"></a>                    <span class="n">spaces</span> <span class="o">=</span> <span class="n">tab</span><span class="o">*</span><span class="n">json</span><span class="p">%</span><span class="n">spaces_per_tab</span>
<a name="ln-5437"></a>                <span class="k">end if</span>
<a name="ln-5438"></a>
<a name="ln-5439"></a><span class="k">                nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5440"></a>                <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>
<a name="ln-5441"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">count</span>
<a name="ln-5442"></a>
<a name="ln-5443"></a><span class="nb">                    </span><span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5444"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5445"></a>                                                  <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-5446"></a>                        <span class="k">return</span>
<a name="ln-5447"></a><span class="k">                    end if</span>
<a name="ln-5448"></a>
<a name="ln-5449"></a>                    <span class="c">! recursive print of the element</span>
<a name="ln-5450"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">is_vector</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5451"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">json_value_print</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">iunit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">,&amp;</span>
<a name="ln-5452"></a>                                        <span class="n">need_comma</span><span class="o">=</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">,</span> <span class="n">is_array_element</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,&amp;</span>
<a name="ln-5453"></a>                                        <span class="n">is_compressed_vector</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-5454"></a>                    <span class="k">else</span>
<a name="ln-5455"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">json_value_print</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">iunit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="n">tab</span><span class="p">,&amp;</span>
<a name="ln-5456"></a>                                        <span class="n">need_comma</span><span class="o">=</span><span class="n">i</span><span class="o">&lt;</span><span class="nb">count</span><span class="p">,</span> <span class="n">is_array_element</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">)</span>
<a name="ln-5457"></a>                    <span class="k">end if</span>
<a name="ln-5458"></a>                    <span class="c">! get the next child the list:</span>
<a name="ln-5459"></a>                    <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-5460"></a>
<a name="ln-5461"></a>                <span class="k">end do</span>
<a name="ln-5462"></a>
<a name="ln-5463"></a>                <span class="c">!indent the closing array character:</span>
<a name="ln-5464"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">is_vector</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5465"></a><span class="k">                    call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">end_array</span><span class="p">,</span><span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span> <span class="p">)</span>
<a name="ln-5466"></a>                <span class="k">else</span>
<a name="ln-5467"></a><span class="k">                    call </span><span class="n">write_it</span><span class="p">(</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">spaces</span><span class="o">-</span><span class="n">json</span><span class="p">%</span><span class="n">spaces_per_tab</span><span class="p">))</span><span class="o">//</span><span class="n">end_array</span><span class="p">,&amp;</span>
<a name="ln-5468"></a>                                   <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span> <span class="p">)</span>
<a name="ln-5469"></a>                <span class="k">end if</span>
<a name="ln-5470"></a><span class="k">                nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-5471"></a>
<a name="ln-5472"></a>            <span class="k">end if</span>
<a name="ln-5473"></a>
<a name="ln-5474"></a><span class="k">        case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">)</span>
<a name="ln-5475"></a>
<a name="ln-5476"></a>            <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">null_str</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5477"></a>                            <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5478"></a>                            <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5479"></a>
<a name="ln-5480"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-5481"></a>
<a name="ln-5482"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5483"></a>                <span class="c">! have to escape the string for printing:</span>
<a name="ln-5484"></a>                <span class="k">call </span><span class="n">escape_string</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span><span class="p">,</span><span class="n">str_escaped</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">escape_solidus</span><span class="p">)</span>
<a name="ln-5485"></a>                <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">quotation_mark</span><span class="o">//</span> <span class="p">&amp;</span>
<a name="ln-5486"></a>                               <span class="n">str_escaped</span><span class="o">//</span><span class="n">quotation_mark</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5487"></a>                               <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5488"></a>                               <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5489"></a>                               <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5490"></a>            <span class="k">else</span>
<a name="ln-5491"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5492"></a>                                          <span class="s1">&#39; p%value_string not allocated&#39;</span><span class="p">)</span>
<a name="ln-5493"></a>                <span class="k">return</span>
<a name="ln-5494"></a><span class="k">            end if</span>
<a name="ln-5495"></a>
<a name="ln-5496"></a><span class="k">        case</span> <span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
<a name="ln-5497"></a>
<a name="ln-5498"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5499"></a><span class="k">                call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">true_str</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5500"></a>                                <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5501"></a>                                <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5502"></a>            <span class="k">else</span>
<a name="ln-5503"></a><span class="k">                call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="n">false_str</span><span class="p">,</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5504"></a>                                <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5505"></a>                                <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5506"></a>            <span class="k">end if</span>
<a name="ln-5507"></a>
<a name="ln-5508"></a><span class="k">        case</span> <span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
<a name="ln-5509"></a>
<a name="ln-5510"></a>            <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-5511"></a>
<a name="ln-5512"></a>            <span class="k">call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5513"></a>                            <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5514"></a>                            <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5515"></a>
<a name="ln-5516"></a>        <span class="k">case</span> <span class="p">(</span><span class="n">json_double</span><span class="p">)</span>
<a name="ln-5517"></a>
<a name="ln-5518"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">real_fmt</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5519"></a><span class="k">                call </span><span class="n">real_to_string</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">real_fmt</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">compact_real</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-5520"></a>            <span class="k">else</span>
<a name="ln-5521"></a>                <span class="c">!use the default format (user has not called initialize() or specified one):</span>
<a name="ln-5522"></a>                <span class="k">call </span><span class="n">real_to_string</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">,</span><span class="n">default_real_fmt</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">compact_real</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-5523"></a>            <span class="k">end if</span>
<a name="ln-5524"></a>
<a name="ln-5525"></a><span class="k">            call </span><span class="n">write_it</span><span class="p">(</span> <span class="n">s</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="n">comma</span><span class="o">=</span><span class="n">print_comma</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-5526"></a>                            <span class="n">advance</span><span class="o">=</span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_vector</span><span class="p">),&amp;</span>
<a name="ln-5527"></a>                            <span class="n">space_after_comma</span><span class="o">=</span><span class="n">is_vector</span> <span class="p">)</span>
<a name="ln-5528"></a>
<a name="ln-5529"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-5530"></a>
<a name="ln-5531"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_value_print: unknown data type&#39;</span><span class="p">)</span>
<a name="ln-5532"></a>
<a name="ln-5533"></a>        <span class="k">end select</span>
<a name="ln-5534"></a>
<a name="ln-5535"></a>        <span class="c">!cleanup:</span>
<a name="ln-5536"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a name="ln-5537"></a>
<a name="ln-5538"></a>    <span class="k">end if</span>
<a name="ln-5539"></a>
<a name="ln-5540"></a><span class="k">    contains</span>
<a name="ln-5541"></a>
<a name="ln-5542"></a><span class="k">        subroutine </span><span class="n">write_it</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">advance</span><span class="p">,</span><span class="n">comma</span><span class="p">,</span><span class="n">space_after_comma</span><span class="p">)</span>
<a name="ln-5543"></a>
<a name="ln-5544"></a>        <span class="c">!! write the string to the file (or the output string)</span>
<a name="ln-5545"></a>
<a name="ln-5546"></a>        <span class="k">implicit none</span>
<a name="ln-5547"></a>
<a name="ln-5548"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s</span>  <span class="c">!! string to print</span>
<a name="ln-5549"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">advance</span>           <span class="c">!! to add line break or not</span>
<a name="ln-5550"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">comma</span>             <span class="c">!! print comma after the string</span>
<a name="ln-5551"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">space_after_comma</span> <span class="c">!! print a space after the comma</span>
<a name="ln-5552"></a>
<a name="ln-5553"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">add_comma</span>       <span class="c">!! if a delimiter is to be added after string</span>
<a name="ln-5554"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">add_line_break</span>  <span class="c">!! if a line break is to be added after string</span>
<a name="ln-5555"></a>        <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">add_space</span>       <span class="c">!! if a space is to be added after the comma</span>
<a name="ln-5556"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">s2</span>  <span class="c">!! temporary string</span>
<a name="ln-5557"></a>
<a name="ln-5558"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">comma</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5559"></a><span class="k">            </span><span class="n">add_comma</span> <span class="o">=</span> <span class="n">comma</span>
<a name="ln-5560"></a>        <span class="k">else</span>
<a name="ln-5561"></a><span class="k">            </span><span class="n">add_comma</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!default is not to add comma</span>
<a name="ln-5562"></a>        <span class="k">end if</span>
<a name="ln-5563"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5564"></a><span class="k">            </span><span class="n">add_space</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5565"></a>        <span class="k">else</span>
<a name="ln-5566"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">space_after_comma</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5567"></a><span class="k">                </span><span class="n">add_space</span> <span class="o">=</span> <span class="n">space_after_comma</span>
<a name="ln-5568"></a>            <span class="k">else</span>
<a name="ln-5569"></a><span class="k">                </span><span class="n">add_space</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">!default is not to add space</span>
<a name="ln-5570"></a>            <span class="k">end if</span>
<a name="ln-5571"></a><span class="k">        end if</span>
<a name="ln-5572"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">advance</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5573"></a><span class="k">            if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5574"></a>                <span class="c">! overrides input value:</span>
<a name="ln-5575"></a>                <span class="n">add_line_break</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5576"></a>            <span class="k">else</span>
<a name="ln-5577"></a><span class="k">                </span><span class="n">add_line_break</span> <span class="o">=</span> <span class="n">advance</span>
<a name="ln-5578"></a>            <span class="k">end if</span>
<a name="ln-5579"></a><span class="k">        else</span>
<a name="ln-5580"></a><span class="k">            </span><span class="n">add_line_break</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">no_whitespace</span> <span class="c">! default is to advance if</span>
<a name="ln-5581"></a>                                                      <span class="c">! we are printing whitespace</span>
<a name="ln-5582"></a>        <span class="k">end if</span>
<a name="ln-5583"></a>
<a name="ln-5584"></a>        <span class="c">!string to print:</span>
<a name="ln-5585"></a>        <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span>
<a name="ln-5586"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">add_comma</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5587"></a><span class="k">            </span><span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">//</span> <span class="n">delimiter</span>
<a name="ln-5588"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">add_space</span><span class="p">)</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">//</span> <span class="n">space</span>
<a name="ln-5589"></a>        <span class="k">end if</span>
<a name="ln-5590"></a>
<a name="ln-5591"></a><span class="k">        if</span> <span class="p">(</span><span class="n">write_file</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5592"></a>
<a name="ln-5593"></a><span class="k">            if</span> <span class="p">(</span><span class="n">add_line_break</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5594"></a><span class="k">                write</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="n">s2</span>
<a name="ln-5595"></a>            <span class="k">else</span>
<a name="ln-5596"></a><span class="k">                write</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;(A)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;NO&#39;</span><span class="p">)</span> <span class="n">s2</span>
<a name="ln-5597"></a>            <span class="k">end if</span>
<a name="ln-5598"></a>
<a name="ln-5599"></a><span class="k">        else</span>    <span class="c">!write string</span>
<a name="ln-5600"></a>
<a name="ln-5601"></a>            <span class="n">str</span> <span class="o">=</span> <span class="n">str</span> <span class="o">//</span> <span class="n">s2</span>
<a name="ln-5602"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">add_line_break</span><span class="p">)</span> <span class="n">str</span> <span class="o">=</span> <span class="n">str</span> <span class="o">//</span> <span class="n">newline</span>
<a name="ln-5603"></a>
<a name="ln-5604"></a>        <span class="k">end if</span>
<a name="ln-5605"></a>
<a name="ln-5606"></a>        <span class="c">!cleanup:</span>
<a name="ln-5607"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<a name="ln-5608"></a>
<a name="ln-5609"></a>        <span class="k">end subroutine </span><span class="n">write_it</span>
<a name="ln-5610"></a>
<a name="ln-5611"></a>    <span class="k">end subroutine </span><span class="n">json_value_print</span>
<a name="ln-5612"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5613"></a>
<a name="ln-5614"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5615"></a><span class="c">!&gt;</span>
<a name="ln-5616"></a><span class="c">!  Returns true if the `path` is present in the `p` JSON structure.</span>
<a name="ln-5617"></a><span class="c">!</span>
<a name="ln-5618"></a><span class="c">!@note Just a wrapper for [[json_get_by_path]], so it uses the</span>
<a name="ln-5619"></a><span class="c">!      specified `path_mode` and other settings.</span>
<a name="ln-5620"></a>
<a name="ln-5621"></a>    <span class="k">function </span><span class="n">json_valid_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5622"></a>
<a name="ln-5623"></a>    <span class="k">implicit none</span>
<a name="ln-5624"></a>
<a name="ln-5625"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5626"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! a JSON linked list</span>
<a name="ln-5627"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>   <span class="c">!! path to the variable</span>
<a name="ln-5628"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if it was found</span>
<a name="ln-5629"></a>
<a name="ln-5630"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! pointer to the variable specified by `path`</span>
<a name="ln-5631"></a>
<a name="ln-5632"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5633"></a>
<a name="ln-5634"></a>    <span class="k">end function </span><span class="n">json_valid_path</span>
<a name="ln-5635"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5636"></a>
<a name="ln-5637"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5638"></a><span class="c">!&gt;</span>
<a name="ln-5639"></a><span class="c">!  Alternate version of [[json_valid_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-5640"></a>
<a name="ln-5641"></a>    <span class="k">function </span><span class="n">wrap_json_valid_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5642"></a>
<a name="ln-5643"></a>    <span class="k">implicit none</span>
<a name="ln-5644"></a>
<a name="ln-5645"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5646"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! a JSON linked list</span>
<a name="ln-5647"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>   <span class="c">!! path to the variable</span>
<a name="ln-5648"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if it was found</span>
<a name="ln-5649"></a>
<a name="ln-5650"></a>    <span class="n">found</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">valid_path</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-5651"></a>
<a name="ln-5652"></a>    <span class="k">end function </span><span class="n">wrap_json_valid_path</span>
<a name="ln-5653"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5654"></a>
<a name="ln-5655"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5656"></a><span class="c">!&gt;</span>
<a name="ln-5657"></a><span class="c">!  Returns the [[json_value]] pointer given the path string.</span>
<a name="ln-5658"></a><span class="c">!</span>
<a name="ln-5659"></a><span class="c">!  It uses either of two methods:</span>
<a name="ln-5660"></a><span class="c">!</span>
<a name="ln-5661"></a><span class="c">!  * The original JSON-Fortran defaults</span>
<a name="ln-5662"></a><span class="c">!  * [RFC 6901](https://tools.ietf.org/html/rfc6901)</span>
<a name="ln-5663"></a><span class="c">!</span>
<a name="ln-5664"></a><span class="c">!@warning if `found` is present, we should clear any exceptions that are thrown</span>
<a name="ln-5665"></a><span class="c">!         to be consistent with other routines. This is not currently being done.</span>
<a name="ln-5666"></a>
<a name="ln-5667"></a>    <span class="k">subroutine </span><span class="n">json_get_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5668"></a>
<a name="ln-5669"></a>    <span class="k">implicit none</span>
<a name="ln-5670"></a>
<a name="ln-5671"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5672"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>     <span class="c">!! a JSON linked list</span>
<a name="ln-5673"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>   <span class="c">!! path to the variable</span>
<a name="ln-5674"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! pointer to the variable</span>
<a name="ln-5675"></a>                                                   <span class="c">!! specified by `path`</span>
<a name="ln-5676"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if it was found</span>
<a name="ln-5677"></a>
<a name="ln-5678"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_integer_str_len</span><span class="p">),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">path_mode_str</span> <span class="c">!! string version</span>
<a name="ln-5679"></a>                                                                            <span class="c">!! of `json%path_mode`</span>
<a name="ln-5680"></a>
<a name="ln-5681"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5682"></a>
<a name="ln-5683"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5684"></a>
<a name="ln-5685"></a>        <span class="c">! note: it can only be 1 or 2 (3 not currently enabled)</span>
<a name="ln-5686"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-5687"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">1_IK</span><span class="p">)</span>
<a name="ln-5688"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_get_by_path_default</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5689"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">2_IK</span><span class="p">)</span>
<a name="ln-5690"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_get_by_path_rfc6901</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5691"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-5692"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_get_by_path_jsonpath_bracket</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5693"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-5694"></a>            <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">path_mode_str</span><span class="p">)</span>
<a name="ln-5695"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path: Unsupported path_mode: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5696"></a>                                        <span class="nb">trim</span><span class="p">(</span><span class="n">path_mode_str</span><span class="p">))</span>
<a name="ln-5697"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5698"></a>        <span class="k">end select</span>
<a name="ln-5699"></a>
<a name="ln-5700"></a><span class="k">    else</span>
<a name="ln-5701"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5702"></a>    <span class="k">end if</span>
<a name="ln-5703"></a>
<a name="ln-5704"></a><span class="k">    end subroutine </span><span class="n">json_get_by_path</span>
<a name="ln-5705"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5706"></a>
<a name="ln-5707"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5708"></a><span class="c">!&gt;</span>
<a name="ln-5709"></a><span class="c">!  Returns the [[json_value]] pointer given the path string,</span>
<a name="ln-5710"></a><span class="c">!  If necessary, by creating the variables as needed.</span>
<a name="ln-5711"></a><span class="c">!</span>
<a name="ln-5712"></a><span class="c">!  By default, the leaf node and any empty array elements</span>
<a name="ln-5713"></a><span class="c">!  are created as `json_null` values.</span>
<a name="ln-5714"></a><span class="c">!</span>
<a name="ln-5715"></a><span class="c">!  It only works for `path_mode=1` or `path_mode=3`.</span>
<a name="ln-5716"></a><span class="c">!  An error will be thrown for `path_mode=2` (RFC 6901).</span>
<a name="ln-5717"></a><span class="c">!</span>
<a name="ln-5718"></a><span class="c">!### See also</span>
<a name="ln-5719"></a><span class="c">!  * [[json_get_by_path]]</span>
<a name="ln-5720"></a>
<a name="ln-5721"></a>    <span class="k">subroutine </span><span class="n">json_create_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5722"></a>
<a name="ln-5723"></a>    <span class="k">implicit none</span>
<a name="ln-5724"></a>
<a name="ln-5725"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5726"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! a JSON linked list</span>
<a name="ln-5727"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! path to the variable</span>
<a name="ln-5728"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to the variable</span>
<a name="ln-5729"></a>                                                         <span class="c">!! specify by `path`</span>
<a name="ln-5730"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! true if there were no errors</span>
<a name="ln-5731"></a>                                                         <span class="c">!! (variable found or created)</span>
<a name="ln-5732"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! true if it was actually created</span>
<a name="ln-5733"></a>                                                         <span class="c">!! (as opposed to already being there)</span>
<a name="ln-5734"></a>
<a name="ln-5735"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-5736"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_integer_str_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path_mode_str</span> <span class="c">!! string version</span>
<a name="ln-5737"></a>                                                                <span class="c">!! of `json%path_mode`</span>
<a name="ln-5738"></a>
<a name="ln-5739"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5740"></a>
<a name="ln-5741"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5742"></a>
<a name="ln-5743"></a><span class="k">        select case</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-5744"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">1_IK</span><span class="p">)</span>
<a name="ln-5745"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_get_by_path_default</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-5746"></a>                                                <span class="n">create_it</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,&amp;</span>
<a name="ln-5747"></a>                                                <span class="n">was_created</span><span class="o">=</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5748"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-5749"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-5750"></a>           <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">json_get_by_path_jsonpath_bracket</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">found</span><span class="p">,&amp;</span>
<a name="ln-5751"></a>                                                       <span class="n">create_it</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,&amp;</span>
<a name="ln-5752"></a>                                                       <span class="n">was_created</span><span class="o">=</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5753"></a>           <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-5754"></a>
<a name="ln-5755"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-5756"></a>
<a name="ln-5757"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="o">==</span><span class="mi">2_IK</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5758"></a>                <span class="c">! the problem here is there isn&#39;t really a way to disambiguate</span>
<a name="ln-5759"></a>                <span class="c">! the array elements, so &#39;/a/0&#39; could be &#39;a(1)&#39; or &#39;a.0&#39;.</span>
<a name="ln-5760"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_create_by_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5761"></a>                                          <span class="s1">&#39;Create by path not supported in RFC 6901 path mode.&#39;</span><span class="p">)</span>
<a name="ln-5762"></a>            <span class="k">else</span>
<a name="ln-5763"></a><span class="k">                call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">path_mode_str</span><span class="p">)</span>
<a name="ln-5764"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_create_by_path: Unsupported path_mode: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5765"></a>                                            <span class="nb">trim</span><span class="p">(</span><span class="n">path_mode_str</span><span class="p">))</span>
<a name="ln-5766"></a>            <span class="k">end if</span>
<a name="ln-5767"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5768"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-5769"></a>                <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5770"></a>            <span class="k">end if</span>
<a name="ln-5771"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5772"></a>        <span class="k">end select</span>
<a name="ln-5773"></a>
<a name="ln-5774"></a><span class="k">    else</span>
<a name="ln-5775"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5776"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5777"></a>    <span class="k">end if</span>
<a name="ln-5778"></a>
<a name="ln-5779"></a><span class="k">    end subroutine </span><span class="n">json_create_by_path</span>
<a name="ln-5780"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5781"></a>
<a name="ln-5782"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5783"></a><span class="c">!&gt;</span>
<a name="ln-5784"></a><span class="c">!  Alternate version of [[json_create_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-5785"></a>
<a name="ln-5786"></a>    <span class="k">subroutine </span><span class="n">wrap_json_create_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5787"></a>
<a name="ln-5788"></a>    <span class="k">implicit none</span>
<a name="ln-5789"></a>
<a name="ln-5790"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5791"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>           <span class="c">!! a JSON linked list</span>
<a name="ln-5792"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>         <span class="c">!! path to the variable</span>
<a name="ln-5793"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">p</span>   <span class="c">!! pointer to the variable</span>
<a name="ln-5794"></a>                                                         <span class="c">!! specify by `path`</span>
<a name="ln-5795"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>        <span class="c">!! true if there were no errors</span>
<a name="ln-5796"></a>                                                         <span class="c">!! (variable found or created)</span>
<a name="ln-5797"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span>  <span class="c">!! true if it was actually created</span>
<a name="ln-5798"></a>                                                         <span class="c">!! (as opposed to already being there)</span>
<a name="ln-5799"></a>
<a name="ln-5800"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5801"></a>
<a name="ln-5802"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_create_by_path</span>
<a name="ln-5803"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5804"></a>
<a name="ln-5805"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5806"></a><span class="c">!&gt;</span>
<a name="ln-5807"></a><span class="c">!  Rename a [[json_value]], given the path.</span>
<a name="ln-5808"></a>
<a name="ln-5809"></a>    <span class="k">subroutine </span><span class="n">json_rename_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5810"></a>
<a name="ln-5811"></a>    <span class="k">implicit none</span>
<a name="ln-5812"></a>
<a name="ln-5813"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5814"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-5815"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>
<a name="ln-5816"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! the new name</span>
<a name="ln-5817"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-5818"></a>
<a name="ln-5819"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-5820"></a>
<a name="ln-5821"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-5822"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5823"></a>        <span class="k">return</span>
<a name="ln-5824"></a><span class="k">    end if</span>
<a name="ln-5825"></a>
<a name="ln-5826"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5827"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5828"></a>
<a name="ln-5829"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5830"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_rename_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-5831"></a>                                  <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-5832"></a>    <span class="k">else</span>
<a name="ln-5833"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-5834"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5835"></a>    <span class="k">end if</span>
<a name="ln-5836"></a>
<a name="ln-5837"></a><span class="k">    if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5838"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5839"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5840"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-5841"></a>        <span class="k">end if</span>
<a name="ln-5842"></a><span class="k">    else</span>
<a name="ln-5843"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-5844"></a>    <span class="k">end if</span>
<a name="ln-5845"></a>
<a name="ln-5846"></a><span class="k">    end subroutine </span><span class="n">json_rename_by_path</span>
<a name="ln-5847"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5848"></a>
<a name="ln-5849"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5850"></a><span class="c">!&gt;</span>
<a name="ln-5851"></a><span class="c">!  Alternate version of [[json_rename_by_path]], where &quot;path&quot; and &quot;name&quot; are kind=CDK</span>
<a name="ln-5852"></a>
<a name="ln-5853"></a>    <span class="k">subroutine </span><span class="n">wrap_json_rename_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5854"></a>
<a name="ln-5855"></a>    <span class="k">implicit none</span>
<a name="ln-5856"></a>
<a name="ln-5857"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5858"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">me</span>
<a name="ln-5859"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>
<a name="ln-5860"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">name</span>
<a name="ln-5861"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">found</span>
<a name="ln-5862"></a>
<a name="ln-5863"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5864"></a>
<a name="ln-5865"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_rename_by_path</span>
<a name="ln-5866"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5867"></a>
<a name="ln-5868"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5869"></a><span class="c">!&gt;</span>
<a name="ln-5870"></a><span class="c">!  Alternate version of [[json_rename_by_path]], where &quot;name&quot; is kind=CDK</span>
<a name="ln-5871"></a>
<a name="ln-5872"></a>    <span class="k">subroutine </span><span class="n">json_rename_by_path_name_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5873"></a>
<a name="ln-5874"></a>    <span class="k">implicit none</span>
<a name="ln-5875"></a>
<a name="ln-5876"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5877"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">me</span>
<a name="ln-5878"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">path</span>
<a name="ln-5879"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">name</span>
<a name="ln-5880"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">found</span>
<a name="ln-5881"></a>
<a name="ln-5882"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5883"></a>
<a name="ln-5884"></a>    <span class="k">end subroutine </span><span class="n">json_rename_by_path_name_ascii</span>
<a name="ln-5885"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5886"></a>
<a name="ln-5887"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5888"></a><span class="c">!&gt;</span>
<a name="ln-5889"></a><span class="c">!  Alternate version of [[json_rename_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-5890"></a>
<a name="ln-5891"></a>    <span class="k">subroutine </span><span class="n">json_rename_by_path_path_ascii</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-5892"></a>
<a name="ln-5893"></a>    <span class="k">implicit none</span>
<a name="ln-5894"></a>
<a name="ln-5895"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5896"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">me</span>
<a name="ln-5897"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>
<a name="ln-5898"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">name</span>
<a name="ln-5899"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">found</span>
<a name="ln-5900"></a>
<a name="ln-5901"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">name</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-5902"></a>
<a name="ln-5903"></a>    <span class="k">end subroutine </span><span class="n">json_rename_by_path_path_ascii</span>
<a name="ln-5904"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5905"></a>
<a name="ln-5906"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-5907"></a><span class="c">!&gt;</span>
<a name="ln-5908"></a><span class="c">!  Returns the [[json_value]] pointer given the path string.</span>
<a name="ln-5909"></a><span class="c">!</span>
<a name="ln-5910"></a><span class="c">!### Example</span>
<a name="ln-5911"></a><span class="c">!</span>
<a name="ln-5912"></a><span class="c">!````fortran</span>
<a name="ln-5913"></a><span class="c">!    type(json_core) :: json</span>
<a name="ln-5914"></a><span class="c">!    type(json_value),pointer :: dat,p</span>
<a name="ln-5915"></a><span class="c">!    logical :: found</span>
<a name="ln-5916"></a><span class="c">!    !...</span>
<a name="ln-5917"></a><span class="c">!    call json%initialize(path_mode=1) ! this is the default so not strictly necessary.</span>
<a name="ln-5918"></a><span class="c">!    call json%get(dat,&#39;data(2).version&#39;,p,found)</span>
<a name="ln-5919"></a><span class="c">!````</span>
<a name="ln-5920"></a><span class="c">!</span>
<a name="ln-5921"></a><span class="c">!### Notes</span>
<a name="ln-5922"></a><span class="c">!  The syntax used here is a subset of the</span>
<a name="ln-5923"></a><span class="c">!  [http://goessner.net/articles/JsonPath/](JSONPath) &quot;dotâ€“notation&quot;.</span>
<a name="ln-5924"></a><span class="c">!  The following special characters are used to denote paths:</span>
<a name="ln-5925"></a><span class="c">!</span>
<a name="ln-5926"></a><span class="c">!  * `$`           - root</span>
<a name="ln-5927"></a><span class="c">!  * `@`           - this</span>
<a name="ln-5928"></a><span class="c">!  * `.`           - child object member (note this can be changed using `json%path_separator`)</span>
<a name="ln-5929"></a><span class="c">!  * `[]` or `()`  - child array element (note that indices are 1-based)</span>
<a name="ln-5930"></a><span class="c">!</span>
<a name="ln-5931"></a><span class="c">!  Thus, if any of these characters are present in the name key,</span>
<a name="ln-5932"></a><span class="c">!  this routine cannot be used to get the value.</span>
<a name="ln-5933"></a><span class="c">!  In that case, the `get_child` methods would need to be used.</span>
<a name="ln-5934"></a><span class="c">!  Or, the alternate [[json_get_by_path_rfc6901]] could be used.</span>
<a name="ln-5935"></a><span class="c">!</span>
<a name="ln-5936"></a><span class="c">!### See also</span>
<a name="ln-5937"></a><span class="c">!  * [[json_get_by_path_rfc6901]]</span>
<a name="ln-5938"></a><span class="c">!  * [[json_get_by_path_jsonpath_bracket]]</span>
<a name="ln-5939"></a><span class="c">!</span>
<a name="ln-5940"></a><span class="c">!@note The syntax is inherited from FSON, and is basically a subset</span>
<a name="ln-5941"></a><span class="c">!      of JSONPath &quot;dot-notation&quot;, with the additional allowance of</span>
<a name="ln-5942"></a><span class="c">!      () for array elements.</span>
<a name="ln-5943"></a><span class="c">!</span>
<a name="ln-5944"></a><span class="c">!@note JSON `null` values are used here for unknown variables when `create_it` is True.</span>
<a name="ln-5945"></a><span class="c">!      So, it is possible that an existing null variable can be converted to another</span>
<a name="ln-5946"></a><span class="c">!      type (object or array) if a child is specified in the path. Doing it this way</span>
<a name="ln-5947"></a><span class="c">!      to avoid having to use another type (say `json_unknown`) that would have to be</span>
<a name="ln-5948"></a><span class="c">!      converted to null once all the variables have been created (user would have</span>
<a name="ln-5949"></a><span class="c">!      had to do this).</span>
<a name="ln-5950"></a><span class="c">!</span>
<a name="ln-5951"></a><span class="c">!@warning See (**) in code. I think we need to protect for memory leaks when</span>
<a name="ln-5952"></a><span class="c">!         changing the type of a variable that already exists.</span>
<a name="ln-5953"></a>
<a name="ln-5954"></a>    <span class="k">subroutine </span><span class="n">json_get_by_path_default</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">create_it</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-5955"></a>
<a name="ln-5956"></a>    <span class="k">implicit none</span>
<a name="ln-5957"></a>
<a name="ln-5958"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-5959"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-5960"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! path to the variable</span>
<a name="ln-5961"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>           <span class="c">!! pointer to the variable</span>
<a name="ln-5962"></a>                                                        <span class="c">!! specify by `path`</span>
<a name="ln-5963"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! true if it was found</span>
<a name="ln-5964"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">create_it</span>   <span class="c">!! if a variable is not present</span>
<a name="ln-5965"></a>                                                        <span class="c">!! in the path, then it is created.</span>
<a name="ln-5966"></a>                                                        <span class="c">!! the leaf node is returned as</span>
<a name="ln-5967"></a>                                                        <span class="c">!! a `null` json type and can be</span>
<a name="ln-5968"></a>                                                        <span class="c">!! changed by the caller.</span>
<a name="ln-5969"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if `create_it` is true, this</span>
<a name="ln-5970"></a>                                                        <span class="c">!! will be true if the variable</span>
<a name="ln-5971"></a>                                                        <span class="c">!! was actually created. Otherwise</span>
<a name="ln-5972"></a>                                                        <span class="c">!! it will be false.</span>
<a name="ln-5973"></a>
<a name="ln-5974"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>           <span class="c">!! counter of characters in `path`</span>
<a name="ln-5975"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">length</span>      <span class="c">!! significant length of `path`</span>
<a name="ln-5976"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">child_i</span>     <span class="c">!! index for getting children</span>
<a name="ln-5977"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>           <span class="c">!! a character in the `path`</span>
<a name="ln-5978"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="k">array</span>       <span class="c">!! flag when searching for array index in `path`</span>
<a name="ln-5979"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>         <span class="c">!! temp variables for getting child objects</span>
<a name="ln-5980"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">child_found</span> <span class="c">!! if the child value was found</span>
<a name="ln-5981"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">create</span>      <span class="c">!! if the object is to be created</span>
<a name="ln-5982"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">created</span>     <span class="c">!! if `create` is true, then this will be</span>
<a name="ln-5983"></a>                                            <span class="c">!! true if the leaf object had to be created</span>
<a name="ln-5984"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">j</span>           <span class="c">!! counter of children when creating object</span>
<a name="ln-5985"></a>
<a name="ln-5986"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-5987"></a>
<a name="ln-5988"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-5989"></a>
<a name="ln-5990"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">create_it</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-5991"></a><span class="k">            </span><span class="n">create</span> <span class="o">=</span> <span class="n">create_it</span>
<a name="ln-5992"></a>        <span class="k">else</span>
<a name="ln-5993"></a><span class="k">            </span><span class="n">create</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-5994"></a>        <span class="k">end if</span>
<a name="ln-5995"></a>
<a name="ln-5996"></a>        <span class="c">! default to assuming relative to me</span>
<a name="ln-5997"></a>        <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">me</span>
<a name="ln-5998"></a>
<a name="ln-5999"></a>        <span class="n">child_i</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-6000"></a>        <span class="k">array</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6001"></a>        <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6002"></a>
<a name="ln-6003"></a>        <span class="c">!keep trailing space or not:</span>
<a name="ln-6004"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6005"></a><span class="k">            </span><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-6006"></a>        <span class="k">else</span>
<a name="ln-6007"></a><span class="k">            </span><span class="n">length</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-6008"></a>        <span class="k">end if</span>
<a name="ln-6009"></a>
<a name="ln-6010"></a><span class="k">        do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span>
<a name="ln-6011"></a>
<a name="ln-6012"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>
<a name="ln-6013"></a>
<a name="ln-6014"></a>            <span class="k">select case</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-6015"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">root</span><span class="p">)</span>
<a name="ln-6016"></a>
<a name="ln-6017"></a>                <span class="c">! root</span>
<a name="ln-6018"></a>                <span class="k">do while</span> <span class="p">(</span><span class="nb">associated</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>
<a name="ln-6019"></a>                    <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-6020"></a>                <span class="k">end do</span>
<a name="ln-6021"></a><span class="k">                </span><span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6022"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">! should always exist</span>
<a name="ln-6023"></a>
<a name="ln-6024"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">this</span><span class="p">)</span>
<a name="ln-6025"></a>
<a name="ln-6026"></a>                <span class="c">! this</span>
<a name="ln-6027"></a>                <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">me</span>
<a name="ln-6028"></a>                <span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6029"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">! should always exist</span>
<a name="ln-6030"></a>
<a name="ln-6031"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">start_array</span><span class="p">,</span><span class="n">start_array_alt</span><span class="p">)</span>
<a name="ln-6032"></a>
<a name="ln-6033"></a>                <span class="c">! start looking for the array element index</span>
<a name="ln-6034"></a>                <span class="k">array</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6035"></a>
<a name="ln-6036"></a>                <span class="c">! get child member from p</span>
<a name="ln-6037"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">child_i</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6038"></a><span class="k">                    nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6039"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6040"></a>
<a name="ln-6041"></a>                        <span class="c">! Example:</span>
<a name="ln-6042"></a>                        <span class="c">!    &#39;aaa.bbb(1)&#39;</span>
<a name="ln-6043"></a>                        <span class="c">!     -&gt; and aaa is a null, need to make it an object</span>
<a name="ln-6044"></a>                        <span class="c">!</span>
<a name="ln-6045"></a>                        <span class="c">!  What about the case: aaa.bbb(1)(3) ?</span>
<a name="ln-6046"></a>                        <span class="c">!  Is that already handled?</span>
<a name="ln-6047"></a>
<a name="ln-6048"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_null</span><span class="p">)</span> <span class="k">then</span>             <span class="c">! (**)</span>
<a name="ln-6049"></a>                            <span class="c">! if p was also created, then we need to</span>
<a name="ln-6050"></a>                            <span class="c">! convert it into an object here:</span>
<a name="ln-6051"></a>                            <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_object</span>
<a name="ln-6052"></a>                        <span class="k">end if</span>
<a name="ln-6053"></a>
<a name="ln-6054"></a>                        <span class="c">! don&#39;t want to throw exceptions in this case</span>
<a name="ln-6055"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">child_found</span><span class="p">)</span>
<a name="ln-6056"></a>                        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6057"></a>                            <span class="c">! have to create this child</span>
<a name="ln-6058"></a>                            <span class="c">! [make it an array]</span>
<a name="ln-6059"></a>                            <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6060"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_array</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6061"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6062"></a>                            <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6063"></a>                        <span class="k">else</span>
<a name="ln-6064"></a><span class="k">                            </span><span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6065"></a>                        <span class="k">end if</span>
<a name="ln-6066"></a><span class="k">                    else</span>
<a name="ln-6067"></a>                        <span class="c">! call the normal way</span>
<a name="ln-6068"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">)</span>
<a name="ln-6069"></a>                    <span class="k">end if</span>
<a name="ln-6070"></a><span class="k">                    </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6071"></a>                <span class="k">else</span>
<a name="ln-6072"></a><span class="k">                    </span><span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>     <span class="c">! say, &#39;@(&#39;</span>
<a name="ln-6073"></a>                    <span class="k">cycle</span>
<a name="ln-6074"></a><span class="k">                end if</span>
<a name="ln-6075"></a><span class="k">                if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6076"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_default:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6077"></a>                                              <span class="s1">&#39; Error getting array element&#39;</span><span class="p">)</span>
<a name="ln-6078"></a>                    <span class="k">exit</span>
<a name="ln-6079"></a><span class="k">                end if</span>
<a name="ln-6080"></a><span class="k">                </span><span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6081"></a>
<a name="ln-6082"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">end_array</span><span class="p">,</span><span class="n">end_array_alt</span><span class="p">)</span>
<a name="ln-6083"></a>
<a name="ln-6084"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="k">array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6085"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_default: Unexpected &#39;</span><span class="o">//</span><span class="n">c</span><span class="p">)</span>
<a name="ln-6086"></a>                    <span class="k">exit</span>
<a name="ln-6087"></a><span class="k">                end if</span>
<a name="ln-6088"></a><span class="k">                array</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6089"></a>                <span class="n">child_i</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">string_to_int</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6090"></a>
<a name="ln-6091"></a>                <span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6092"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6093"></a>                    <span class="c">! don&#39;t want to throw exceptions in this case</span>
<a name="ln-6094"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">child_i</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">child_found</span><span class="p">)</span>
<a name="ln-6095"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6096"></a>
<a name="ln-6097"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_null</span><span class="p">)</span> <span class="k">then</span>            <span class="c">! (**)</span>
<a name="ln-6098"></a>                            <span class="c">! if p was also created, then we need to</span>
<a name="ln-6099"></a>                            <span class="c">! convert it into an array here:</span>
<a name="ln-6100"></a>                            <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_array</span>
<a name="ln-6101"></a>                        <span class="k">end if</span>
<a name="ln-6102"></a>
<a name="ln-6103"></a>                        <span class="c">! have to create this element</span>
<a name="ln-6104"></a>                        <span class="c">! [make it a null]</span>
<a name="ln-6105"></a>                        <span class="c">! (and any missing ones before it)</span>
<a name="ln-6106"></a>                        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">child_i</span>
<a name="ln-6107"></a>                            <span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6108"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">child_found</span><span class="p">)</span>
<a name="ln-6109"></a>                            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6110"></a><span class="k">                                call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6111"></a>                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>  <span class="c">! array element doesn&#39;t need a name</span>
<a name="ln-6112"></a>                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6113"></a>                                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">child_i</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6114"></a>                            <span class="k">else</span>
<a name="ln-6115"></a><span class="k">                                if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">child_i</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6116"></a>                            <span class="k">end if</span>
<a name="ln-6117"></a><span class="k">                        end do</span>
<a name="ln-6118"></a>
<a name="ln-6119"></a><span class="k">                    else</span>
<a name="ln-6120"></a><span class="k">                        </span><span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6121"></a>                    <span class="k">end if</span>
<a name="ln-6122"></a>
<a name="ln-6123"></a><span class="k">                else</span>
<a name="ln-6124"></a>                    <span class="c">! call the normal way:</span>
<a name="ln-6125"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">child_i</span><span class="p">,</span> <span class="n">tmp</span><span class="p">)</span>
<a name="ln-6126"></a>                <span class="k">end if</span>
<a name="ln-6127"></a>
<a name="ln-6128"></a><span class="k">                </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6129"></a>
<a name="ln-6130"></a>                <span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6131"></a>
<a name="ln-6132"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-6133"></a>
<a name="ln-6134"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">json</span><span class="p">%</span><span class="n">path_separator</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6135"></a>
<a name="ln-6136"></a>                    <span class="c">! get child member from p</span>
<a name="ln-6137"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">child_i</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6138"></a><span class="k">                        nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6139"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6140"></a><span class="k">                            if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_null</span><span class="p">)</span> <span class="k">then</span>            <span class="c">! (**)</span>
<a name="ln-6141"></a>                                <span class="c">! if p was also created, then we need to</span>
<a name="ln-6142"></a>                                <span class="c">! convert it into an object here:</span>
<a name="ln-6143"></a>                                <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_object</span>
<a name="ln-6144"></a>                            <span class="k">end if</span>
<a name="ln-6145"></a>
<a name="ln-6146"></a>                            <span class="c">! don&#39;t want to throw exceptions in this case</span>
<a name="ln-6147"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">child_found</span><span class="p">)</span>
<a name="ln-6148"></a>                            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6149"></a>                                <span class="c">! have to create this child</span>
<a name="ln-6150"></a>                                <span class="c">! [make it an object]</span>
<a name="ln-6151"></a>                                <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6152"></a>                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_object</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6153"></a>                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6154"></a>                                <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6155"></a>                            <span class="k">else</span>
<a name="ln-6156"></a><span class="k">                                </span><span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6157"></a>                            <span class="k">end if</span>
<a name="ln-6158"></a><span class="k">                        else</span>
<a name="ln-6159"></a>                            <span class="c">! call the normal way</span>
<a name="ln-6160"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">)</span>
<a name="ln-6161"></a>                        <span class="k">end if</span>
<a name="ln-6162"></a><span class="k">                        </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6163"></a>                    <span class="k">else</span>
<a name="ln-6164"></a><span class="k">                        </span><span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>     <span class="c">! say &#39;$.&#39;, &#39;@.&#39;, or &#39;).&#39;</span>
<a name="ln-6165"></a>                        <span class="k">cycle</span>
<a name="ln-6166"></a><span class="k">                    end if</span>
<a name="ln-6167"></a>
<a name="ln-6168"></a><span class="k">                    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6169"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_default:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6170"></a>                                                  <span class="s1">&#39; Error getting child member.&#39;</span><span class="p">)</span>
<a name="ln-6171"></a>                        <span class="k">exit</span>
<a name="ln-6172"></a><span class="k">                    end if</span>
<a name="ln-6173"></a>
<a name="ln-6174"></a><span class="k">                    </span><span class="n">child_i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6175"></a>
<a name="ln-6176"></a>                <span class="k">end if</span>
<a name="ln-6177"></a>
<a name="ln-6178"></a><span class="k">            end select</span>
<a name="ln-6179"></a>
<a name="ln-6180"></a><span class="k">        end do</span>
<a name="ln-6181"></a>
<a name="ln-6182"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6183"></a>
<a name="ln-6184"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6185"></a><span class="k">                nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c">! just in case</span>
<a name="ln-6186"></a>                <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6187"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-6188"></a>            <span class="k">end if</span>
<a name="ln-6189"></a>
<a name="ln-6190"></a><span class="k">        else</span>
<a name="ln-6191"></a>
<a name="ln-6192"></a>            <span class="c">! grab the last child if present in the path</span>
<a name="ln-6193"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">child_i</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6194"></a><span class="k">                nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6195"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6196"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_null</span><span class="p">)</span> <span class="k">then</span>            <span class="c">! (**)</span>
<a name="ln-6197"></a>                        <span class="c">! if p was also created, then we need to</span>
<a name="ln-6198"></a>                        <span class="c">! convert it into an object here:</span>
<a name="ln-6199"></a>                        <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_object</span>
<a name="ln-6200"></a>                    <span class="k">end if</span>
<a name="ln-6201"></a>
<a name="ln-6202"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">child_found</span><span class="p">)</span>
<a name="ln-6203"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6204"></a>                        <span class="c">! have to create this child</span>
<a name="ln-6205"></a>                        <span class="c">! (make it a null since it is the leaf)</span>
<a name="ln-6206"></a>                        <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6207"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<a name="ln-6208"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6209"></a>                        <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6210"></a>                    <span class="k">else</span>
<a name="ln-6211"></a><span class="k">                        </span><span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6212"></a>                    <span class="k">end if</span>
<a name="ln-6213"></a><span class="k">                else</span>
<a name="ln-6214"></a>                    <span class="c">! call the normal way</span>
<a name="ln-6215"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">(</span><span class="n">child_i</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">tmp</span><span class="p">)</span>
<a name="ln-6216"></a>                <span class="k">end if</span>
<a name="ln-6217"></a><span class="k">                </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6218"></a>            <span class="k">else</span>
<a name="ln-6219"></a>                <span class="c">! we already have p</span>
<a name="ln-6220"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">create</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">created</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6221"></a>                    <span class="c">! make leaf p a null, but only</span>
<a name="ln-6222"></a>                    <span class="c">! if it wasn&#39;t there</span>
<a name="ln-6223"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-6224"></a>                <span class="k">end if</span>
<a name="ln-6225"></a><span class="k">            end if</span>
<a name="ln-6226"></a>
<a name="ln-6227"></a>            <span class="c">! error checking</span>
<a name="ln-6228"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6229"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>    <span class="c">!everything seems to be ok</span>
<a name="ln-6230"></a>            <span class="k">else</span>
<a name="ln-6231"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_default:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6232"></a>                                          <span class="s1">&#39; variable not found: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6233"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6234"></a><span class="k">                    </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6235"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-6236"></a>                <span class="k">end if</span>
<a name="ln-6237"></a><span class="k">            end if</span>
<a name="ln-6238"></a>
<a name="ln-6239"></a><span class="k">        end if</span>
<a name="ln-6240"></a>
<a name="ln-6241"></a>        <span class="c">! if it had to be created:</span>
<a name="ln-6242"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="n">created</span>
<a name="ln-6243"></a>
<a name="ln-6244"></a>    <span class="k">else</span>
<a name="ln-6245"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6246"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6247"></a>    <span class="k">end if</span>
<a name="ln-6248"></a>
<a name="ln-6249"></a><span class="k">    end subroutine </span><span class="n">json_get_by_path_default</span>
<a name="ln-6250"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6251"></a>
<a name="ln-6252"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6253"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-6254"></a><span class="c">!  date: 2/4/2017</span>
<a name="ln-6255"></a><span class="c">!</span>
<a name="ln-6256"></a><span class="c">!  Returns the [[json_value]] pointer given the path string,</span>
<a name="ln-6257"></a><span class="c">!  using the &quot;JSON Pointer&quot; path specification defined by RFC 6901.</span>
<a name="ln-6258"></a><span class="c">!</span>
<a name="ln-6259"></a><span class="c">!  Note that trailing whitespace significance and case sensitivity</span>
<a name="ln-6260"></a><span class="c">!  are user-specified. To fully conform to the RFC 6901 standard,</span>
<a name="ln-6261"></a><span class="c">!  should probably set (via `initialize`):</span>
<a name="ln-6262"></a><span class="c">!</span>
<a name="ln-6263"></a><span class="c">!  * `trailing_spaces_significant` = .true. [this is not the default setting]</span>
<a name="ln-6264"></a><span class="c">!  * `case_sensitive_keys` = .true.         [this is the default setting]</span>
<a name="ln-6265"></a><span class="c">!</span>
<a name="ln-6266"></a><span class="c">!### Example</span>
<a name="ln-6267"></a><span class="c">!</span>
<a name="ln-6268"></a><span class="c">!````fortran</span>
<a name="ln-6269"></a><span class="c">!    type(json_core) :: json</span>
<a name="ln-6270"></a><span class="c">!    type(json_value),pointer :: dat,p</span>
<a name="ln-6271"></a><span class="c">!    logical :: found</span>
<a name="ln-6272"></a><span class="c">!    !...</span>
<a name="ln-6273"></a><span class="c">!    call json%initialize(path_mode=2)</span>
<a name="ln-6274"></a><span class="c">!    call json%get(dat,&#39;/data/2/version&#39;,p,found)</span>
<a name="ln-6275"></a><span class="c">!````</span>
<a name="ln-6276"></a><span class="c">!</span>
<a name="ln-6277"></a><span class="c">!### See also</span>
<a name="ln-6278"></a><span class="c">!  * [[json_get_by_path_default]]</span>
<a name="ln-6279"></a><span class="c">!  * [[json_get_by_path_jsonpath_bracket]]</span>
<a name="ln-6280"></a><span class="c">!</span>
<a name="ln-6281"></a><span class="c">!### Reference</span>
<a name="ln-6282"></a><span class="c">!  * [JavaScript Object Notation (JSON) Pointer](https://tools.ietf.org/html/rfc6901)</span>
<a name="ln-6283"></a><span class="c">!</span>
<a name="ln-6284"></a><span class="c">!@note Not doing anything special about the `-` character to index an array.</span>
<a name="ln-6285"></a><span class="c">!      This is considered a normal error.</span>
<a name="ln-6286"></a><span class="c">!</span>
<a name="ln-6287"></a><span class="c">!@note Unlike in the default path mode, the array indices here are 0-based</span>
<a name="ln-6288"></a><span class="c">!      (in accordance with the RFC 6901 standard)</span>
<a name="ln-6289"></a><span class="c">!</span>
<a name="ln-6290"></a><span class="c">!@warning Not checking if the member that is referenced is unique.</span>
<a name="ln-6291"></a><span class="c">!         (according to the standard, evaluation of non-unique references</span>
<a name="ln-6292"></a><span class="c">!         should fail). Like [[json_get_by_path_default]], this one will just return</span>
<a name="ln-6293"></a><span class="c">!         the first instance it encounters. This might be changed in the future.</span>
<a name="ln-6294"></a><span class="c">!</span>
<a name="ln-6295"></a><span class="c">!@warning I think the standard indicates that the input paths should use</span>
<a name="ln-6296"></a><span class="c">!         escaped JSON strings (currently we are assuming they are not escaped).</span>
<a name="ln-6297"></a>
<a name="ln-6298"></a>    <span class="k">subroutine </span><span class="n">json_get_by_path_rfc6901</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-6299"></a>
<a name="ln-6300"></a>    <span class="k">implicit none</span>
<a name="ln-6301"></a>
<a name="ln-6302"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-6303"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>     <span class="c">!! a JSON linked list</span>
<a name="ln-6304"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>   <span class="c">!! path to the variable</span>
<a name="ln-6305"></a>                                                   <span class="c">!! (an RFC 6901 &quot;JSON Pointer&quot;)</span>
<a name="ln-6306"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>      <span class="c">!! pointer to the variable</span>
<a name="ln-6307"></a>                                                   <span class="c">!! specify by `path`</span>
<a name="ln-6308"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>  <span class="c">!! true if it was found</span>
<a name="ln-6309"></a>
<a name="ln-6310"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">token</span>  <span class="c">!! a token in the path (between the `/` characters)</span>
<a name="ln-6311"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>                  <span class="c">!! counter</span>
<a name="ln-6312"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">islash_curr</span>        <span class="c">!! location of current &#39;/&#39; character in the path</span>
<a name="ln-6313"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">islash_next</span>        <span class="c">!! location of next &#39;/&#39; character in the path</span>
<a name="ln-6314"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ilen</span>               <span class="c">!! length of `path` string</span>
<a name="ln-6315"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>                <span class="c">!! temporary variable for traversing the structure</span>
<a name="ln-6316"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ival</span>               <span class="c">!! integer array index value (0-based)</span>
<a name="ln-6317"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">status_ok</span>          <span class="c">!! error flag</span>
<a name="ln-6318"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">child_found</span>        <span class="c">!! for getting child values</span>
<a name="ln-6319"></a>
<a name="ln-6320"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-6321"></a>
<a name="ln-6322"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6323"></a>
<a name="ln-6324"></a><span class="k">        </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">me</span> <span class="c">! initialize</span>
<a name="ln-6325"></a>
<a name="ln-6326"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="o">/=</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6327"></a>
<a name="ln-6328"></a><span class="k">            if</span> <span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">slash</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! the first character must be a slash</span>
<a name="ln-6329"></a>
<a name="ln-6330"></a>                <span class="n">islash_curr</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c">! initialize current slash index</span>
<a name="ln-6331"></a>
<a name="ln-6332"></a>                <span class="c">!keep trailing space or not:</span>
<a name="ln-6333"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6334"></a><span class="k">                    </span><span class="n">ilen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-6335"></a>                <span class="k">else</span>
<a name="ln-6336"></a><span class="k">                    </span><span class="n">ilen</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-6337"></a>                <span class="k">end if</span>
<a name="ln-6338"></a>
<a name="ln-6339"></a><span class="k">                do</span>
<a name="ln-6340"></a>
<a name="ln-6341"></a>                    <span class="c">! get the next token by finding the slashes</span>
<a name="ln-6342"></a>                    <span class="c">!</span>
<a name="ln-6343"></a>                    <span class="c">!  1   2 3</span>
<a name="ln-6344"></a>                    <span class="c">!  /abc/d/efg</span>
<a name="ln-6345"></a>
<a name="ln-6346"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">islash_curr</span><span class="o">==</span><span class="n">ilen</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6347"></a>                        <span class="c">!the last token is an empty string</span>
<a name="ln-6348"></a>                        <span class="n">token</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-6349"></a>                        <span class="n">islash_next</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">! will signal to stop</span>
<a name="ln-6350"></a>                    <span class="k">else</span>
<a name="ln-6351"></a>
<a name="ln-6352"></a>                        <span class="c">!      .</span>
<a name="ln-6353"></a>                        <span class="c">! &#39;/123/567/&#39;</span>
<a name="ln-6354"></a>
<a name="ln-6355"></a>                        <span class="c">! index in remaining string:</span>
<a name="ln-6356"></a>                        <span class="n">islash_next</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">islash_curr</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">),</span><span class="n">slash</span><span class="p">)</span>
<a name="ln-6357"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">islash_next</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6358"></a>                            <span class="c">!last token:</span>
<a name="ln-6359"></a>                            <span class="n">token</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">islash_curr</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">)</span>
<a name="ln-6360"></a>                        <span class="k">else</span>
<a name="ln-6361"></a>                            <span class="c">! convert to actual index in path:</span>
<a name="ln-6362"></a>                            <span class="n">islash_next</span> <span class="o">=</span> <span class="n">islash_curr</span> <span class="o">+</span> <span class="nb">index</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">islash_curr</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">),</span><span class="n">slash</span><span class="p">)</span>
<a name="ln-6363"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">islash_next</span><span class="o">&gt;</span><span class="n">islash_curr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6364"></a><span class="k">                                </span><span class="n">token</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">islash_curr</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">islash_next</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6365"></a>                            <span class="k">else</span>
<a name="ln-6366"></a>                                <span class="c">!empty token:</span>
<a name="ln-6367"></a>                                <span class="n">token</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-6368"></a>                            <span class="k">end if</span>
<a name="ln-6369"></a><span class="k">                        end if</span>
<a name="ln-6370"></a>
<a name="ln-6371"></a><span class="k">                    end if</span>
<a name="ln-6372"></a>
<a name="ln-6373"></a>                    <span class="c">! remove trailing spaces in the token here if necessary:</span>
<a name="ln-6374"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-6375"></a>                        <span class="n">token</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6376"></a>
<a name="ln-6377"></a>                    <span class="c">! decode the token:</span>
<a name="ln-6378"></a>                    <span class="n">token</span> <span class="o">=</span> <span class="n">decode_rfc6901</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6379"></a>
<a name="ln-6380"></a>                    <span class="c">! now, parse the token:</span>
<a name="ln-6381"></a>
<a name="ln-6382"></a>                    <span class="c">! first see if there is a child with this name</span>
<a name="ln-6383"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">token</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">child_found</span><span class="p">)</span>
<a name="ln-6384"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6385"></a>                        <span class="c">! it was found</span>
<a name="ln-6386"></a>                        <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6387"></a>                    <span class="k">else</span>
<a name="ln-6388"></a>                        <span class="c">! No key with this name.</span>
<a name="ln-6389"></a>                        <span class="c">! Is it an integer? If so,</span>
<a name="ln-6390"></a>                        <span class="c">! it might be an array index.</span>
<a name="ln-6391"></a>                        <span class="n">status_ok</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<a name="ln-6392"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6393"></a><span class="k">                            do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6394"></a>                                <span class="c">! It must only contain (0..9) characters</span>
<a name="ln-6395"></a>                                <span class="c">! (it must be unsigned)</span>
<a name="ln-6396"></a>                                <span class="k">if</span> <span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">token</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">),</span><span class="n">CK_</span><span class="s1">&#39;0123456789&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6397"></a><span class="k">                                    </span><span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6398"></a>                                    <span class="k">exit</span>
<a name="ln-6399"></a><span class="k">                                end if</span>
<a name="ln-6400"></a><span class="k">                            end do</span>
<a name="ln-6401"></a><span class="k">                            if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6402"></a><span class="k">                                if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">token</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6403"></a>                                    <span class="c">! leading zeros not allowed for some reason</span>
<a name="ln-6404"></a>                                    <span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6405"></a>                                <span class="k">end if</span>
<a name="ln-6406"></a><span class="k">                            end if</span>
<a name="ln-6407"></a><span class="k">                            if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6408"></a>                                <span class="c">! if we make it this far, it should be</span>
<a name="ln-6409"></a>                                <span class="c">! convertable to an integer, so do it.</span>
<a name="ln-6410"></a>                                <span class="k">call </span><span class="n">string_to_integer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6411"></a>                            <span class="k">end if</span>
<a name="ln-6412"></a><span class="k">                        end if</span>
<a name="ln-6413"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6414"></a>                            <span class="c">! ival is an array index (0-based)</span>
<a name="ln-6415"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ival</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">child_found</span><span class="p">)</span>
<a name="ln-6416"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">child_found</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6417"></a><span class="k">                                </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6418"></a>                            <span class="k">else</span>
<a name="ln-6419"></a>                                <span class="c">! not found</span>
<a name="ln-6420"></a>                                <span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6421"></a>                            <span class="k">end if</span>
<a name="ln-6422"></a><span class="k">                        end if</span>
<a name="ln-6423"></a><span class="k">                        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6424"></a><span class="k">                            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_rfc6901: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6425"></a>                                                        <span class="s1">&#39;invalid path specification: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6426"></a>                            <span class="k">exit</span>
<a name="ln-6427"></a><span class="k">                        end if</span>
<a name="ln-6428"></a><span class="k">                    end if</span>
<a name="ln-6429"></a>
<a name="ln-6430"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">islash_next</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit</span> <span class="c">! finished</span>
<a name="ln-6431"></a>
<a name="ln-6432"></a>                    <span class="c">! set up for next token:</span>
<a name="ln-6433"></a>                    <span class="n">islash_curr</span> <span class="o">=</span> <span class="n">islash_next</span>
<a name="ln-6434"></a>
<a name="ln-6435"></a>                <span class="k">end do</span>
<a name="ln-6436"></a>
<a name="ln-6437"></a><span class="k">            else</span>
<a name="ln-6438"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_rfc6901: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6439"></a>                                            <span class="s1">&#39;invalid path specification: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6440"></a>            <span class="k">end if</span>
<a name="ln-6441"></a><span class="k">        end if</span>
<a name="ln-6442"></a>
<a name="ln-6443"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6444"></a><span class="k">            nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-6445"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6446"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6447"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-6448"></a>            <span class="k">end if</span>
<a name="ln-6449"></a><span class="k">        else</span>
<a name="ln-6450"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6451"></a>        <span class="k">end if</span>
<a name="ln-6452"></a>
<a name="ln-6453"></a><span class="k">    else</span>
<a name="ln-6454"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6455"></a>    <span class="k">end if</span>
<a name="ln-6456"></a>
<a name="ln-6457"></a><span class="k">    end subroutine </span><span class="n">json_get_by_path_rfc6901</span>
<a name="ln-6458"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6459"></a>
<a name="ln-6460"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6461"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-6462"></a><span class="c">!  date: 9/2/2017</span>
<a name="ln-6463"></a><span class="c">!</span>
<a name="ln-6464"></a><span class="c">!  Returns the [[json_value]] pointer given the path string,</span>
<a name="ln-6465"></a><span class="c">!  using the &quot;JSON Pointer&quot; path specification defined by the</span>
<a name="ln-6466"></a><span class="c">!  JSONPath &quot;bracket-notation&quot;.</span>
<a name="ln-6467"></a><span class="c">!</span>
<a name="ln-6468"></a><span class="c">!  The first character `$` is optional, and signifies the root</span>
<a name="ln-6469"></a><span class="c">!  of the structure. If it is not present, then the first key</span>
<a name="ln-6470"></a><span class="c">!  is taken to be in the `me` object.</span>
<a name="ln-6471"></a><span class="c">!</span>
<a name="ln-6472"></a><span class="c">!  Single or double quotes may be used.</span>
<a name="ln-6473"></a><span class="c">!</span>
<a name="ln-6474"></a><span class="c">!### Example</span>
<a name="ln-6475"></a><span class="c">!</span>
<a name="ln-6476"></a><span class="c">!````fortran</span>
<a name="ln-6477"></a><span class="c">!    type(json_core) :: json</span>
<a name="ln-6478"></a><span class="c">!    type(json_value),pointer :: dat,p</span>
<a name="ln-6479"></a><span class="c">!    logical :: found</span>
<a name="ln-6480"></a><span class="c">!    !...</span>
<a name="ln-6481"></a><span class="c">!    call json%initialize(path_mode=3)</span>
<a name="ln-6482"></a><span class="c">!    call json%get(dat,&quot;$[&#39;store&#39;][&#39;book&#39;][1][&#39;title&#39;]&quot;,p,found)</span>
<a name="ln-6483"></a><span class="c">!````</span>
<a name="ln-6484"></a><span class="c">!</span>
<a name="ln-6485"></a><span class="c">!### See also</span>
<a name="ln-6486"></a><span class="c">!  * [[json_get_by_path_default]]</span>
<a name="ln-6487"></a><span class="c">!  * [[json_get_by_path_rfc6901]]</span>
<a name="ln-6488"></a><span class="c">!</span>
<a name="ln-6489"></a><span class="c">!### Reference</span>
<a name="ln-6490"></a><span class="c">!  * [JSONPath](http://goessner.net/articles/JsonPath/)</span>
<a name="ln-6491"></a><span class="c">!</span>
<a name="ln-6492"></a><span class="c">!@note Uses 1-based array indices (same as [[json_get_by_path_default]],</span>
<a name="ln-6493"></a><span class="c">!      but unlike [[json_get_by_path_rfc6901]] which uses 0-based indices).</span>
<a name="ln-6494"></a><span class="c">!</span>
<a name="ln-6495"></a><span class="c">!@note When `create_it=True`, if the variable already exists and is a type</span>
<a name="ln-6496"></a><span class="c">!      that is not compatible with the usage in the `path`, then it is</span>
<a name="ln-6497"></a><span class="c">!      destroyed and replaced with what is specified in the `path`. Note that</span>
<a name="ln-6498"></a><span class="c">!      this applies the all variables in the path as it is created. Currently,</span>
<a name="ln-6499"></a><span class="c">!      this behavior is different from [[json_get_by_path_default]].</span>
<a name="ln-6500"></a><span class="c">!</span>
<a name="ln-6501"></a><span class="c">!@note JSON `null` values are used here for unknown variables</span>
<a name="ln-6502"></a><span class="c">!      when `create_it` is True.</span>
<a name="ln-6503"></a><span class="c">!</span>
<a name="ln-6504"></a><span class="c">!@warning Note that if using single quotes, this routine cannot parse</span>
<a name="ln-6505"></a><span class="c">!         a key containing `&#39;]`. If using double quotes, this routine</span>
<a name="ln-6506"></a><span class="c">!         cannot parse a key containing `&quot;]`. If the key contains both</span>
<a name="ln-6507"></a><span class="c">!         `&#39;]` and `&quot;]`, there is no way to parse it using this routine.</span>
<a name="ln-6508"></a>
<a name="ln-6509"></a>    <span class="k">subroutine </span><span class="n">json_get_by_path_jsonpath_bracket</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">create_it</span><span class="p">,</span><span class="n">was_created</span><span class="p">)</span>
<a name="ln-6510"></a>
<a name="ln-6511"></a>    <span class="k">implicit none</span>
<a name="ln-6512"></a>
<a name="ln-6513"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-6514"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>          <span class="c">!! a JSON linked list</span>
<a name="ln-6515"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>        <span class="c">!! path to the variable</span>
<a name="ln-6516"></a>                                                        <span class="c">!! (using JSONPath</span>
<a name="ln-6517"></a>                                                        <span class="c">!! &quot;bracket-notation&quot;)</span>
<a name="ln-6518"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>           <span class="c">!! pointer to the variable</span>
<a name="ln-6519"></a>                                                        <span class="c">!! specify by `path`</span>
<a name="ln-6520"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>       <span class="c">!! true if it was found</span>
<a name="ln-6521"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">create_it</span>   <span class="c">!! if a variable is not present</span>
<a name="ln-6522"></a>                                                        <span class="c">!! in the path, then it is created.</span>
<a name="ln-6523"></a>                                                        <span class="c">!! the leaf node is returned as</span>
<a name="ln-6524"></a>                                                        <span class="c">!! a `null` json type and can be</span>
<a name="ln-6525"></a>                                                        <span class="c">!! changed by the caller.</span>
<a name="ln-6526"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">was_created</span> <span class="c">!! if `create_it` is true, this</span>
<a name="ln-6527"></a>                                                        <span class="c">!! will be true if the variable</span>
<a name="ln-6528"></a>                                                        <span class="c">!! was actually created. Otherwise</span>
<a name="ln-6529"></a>                                                        <span class="c">!! it will be false.</span>
<a name="ln-6530"></a>
<a name="ln-6531"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">token</span>  <span class="c">!! a token in the path</span>
<a name="ln-6532"></a>                                                   <span class="c">!! (between the `[&#39;&#39;]` or</span>
<a name="ln-6533"></a>                                                   <span class="c">!! `[]` characters)</span>
<a name="ln-6534"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">istart</span>             <span class="c">!! location of current &#39;[&#39;</span>
<a name="ln-6535"></a>                                                   <span class="c">!! character in the path</span>
<a name="ln-6536"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">iend</span>               <span class="c">!! location of current &#39;]&#39;</span>
<a name="ln-6537"></a>                                                   <span class="c">!! character in the path</span>
<a name="ln-6538"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ival</span>               <span class="c">!! integer array index value</span>
<a name="ln-6539"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">status_ok</span>          <span class="c">!! error flag</span>
<a name="ln-6540"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>                <span class="c">!! temporary variable for</span>
<a name="ln-6541"></a>                                                   <span class="c">!! traversing the structure</span>
<a name="ln-6542"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>                  <span class="c">!! counter</span>
<a name="ln-6543"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ilen</span>               <span class="c">!! length of `path` string</span>
<a name="ln-6544"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">double_quotes</span>      <span class="c">!! if the keys are enclosed in `&quot;`,</span>
<a name="ln-6545"></a>                                                   <span class="c">!! rather than `&#39;` tokens.</span>
<a name="ln-6546"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">create</span>             <span class="c">!! if the object is to be created</span>
<a name="ln-6547"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">created</span>            <span class="c">!! if `create` is true, then this will be</span>
<a name="ln-6548"></a>                                                   <span class="c">!! true if the leaf object had to be created</span>
<a name="ln-6549"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">j</span>                  <span class="c">!! counter of children when creating object</span>
<a name="ln-6550"></a>
<a name="ln-6551"></a>    <span class="c">!TODO instead of reallocating `token` all the time, just</span>
<a name="ln-6552"></a>    <span class="c">!     allocate a big size and keep track of the length,</span>
<a name="ln-6553"></a>    <span class="c">!     then just reallocate only if necessary.</span>
<a name="ln-6554"></a>    <span class="c">!     [would probably be inefficient if there was a very large token,</span>
<a name="ln-6555"></a>    <span class="c">!     and then a bunch of small ones... but for similarly-sized ones</span>
<a name="ln-6556"></a>    <span class="c">!     it should be way more efficient since it would avoid most</span>
<a name="ln-6557"></a>    <span class="c">!     reallocations.]</span>
<a name="ln-6558"></a>
<a name="ln-6559"></a>    <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-6560"></a>
<a name="ln-6561"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6562"></a>
<a name="ln-6563"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">create_it</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6564"></a><span class="k">            </span><span class="n">create</span> <span class="o">=</span> <span class="n">create_it</span>
<a name="ln-6565"></a>        <span class="k">else</span>
<a name="ln-6566"></a><span class="k">            </span><span class="n">create</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6567"></a>        <span class="k">end if</span>
<a name="ln-6568"></a>
<a name="ln-6569"></a><span class="k">        </span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">me</span> <span class="c">! initialize</span>
<a name="ln-6570"></a>        <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6571"></a>
<a name="ln-6572"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="o">==</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6573"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6574"></a>                                      <span class="s1">&#39;invalid path specification: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6575"></a>        <span class="k">else</span>
<a name="ln-6576"></a>
<a name="ln-6577"></a><span class="k">            if</span> <span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">root</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">path</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">start_array</span><span class="p">)</span> <span class="k">then</span> <span class="c">! the first character must be</span>
<a name="ln-6578"></a>                                                                  <span class="c">! a `$` (root) or a `[`</span>
<a name="ln-6579"></a>                                                                  <span class="c">! (element of `me`)</span>
<a name="ln-6580"></a>
<a name="ln-6581"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">root</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6582"></a>                    <span class="c">! go to the root</span>
<a name="ln-6583"></a>                    <span class="k">do while</span> <span class="p">(</span><span class="nb">associated</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>
<a name="ln-6584"></a>                        <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-6585"></a>                    <span class="k">end do</span>
<a name="ln-6586"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">! should always exist</span>
<a name="ln-6587"></a>                <span class="k">end if</span>
<a name="ln-6588"></a>
<a name="ln-6589"></a>                <span class="c">!path length (don&#39;t need trailing spaces:)</span>
<a name="ln-6590"></a>                <span class="n">ilen</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a name="ln-6591"></a>
<a name="ln-6592"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ilen</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6593"></a>
<a name="ln-6594"></a><span class="k">                    </span><span class="n">istart</span> <span class="o">=</span> <span class="mi">2</span>   <span class="c">! initialize first &#39;[&#39; location index</span>
<a name="ln-6595"></a>
<a name="ln-6596"></a>                    <span class="k">do</span>
<a name="ln-6597"></a>
<a name="ln-6598"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">istart</span><span class="o">&gt;</span><span class="n">ilen</span><span class="p">)</span> <span class="k">exit</span>  <span class="c">! finished</span>
<a name="ln-6599"></a>
<a name="ln-6600"></a>                        <span class="c">! must be the next start bracket:</span>
<a name="ln-6601"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="p">:</span><span class="n">istart</span><span class="p">)</span> <span class="o">/=</span> <span class="n">start_array</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6602"></a><span class="k">                            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6603"></a>                                    <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6604"></a>                                    <span class="s1">&#39;expecting &quot;[&quot;, found: &quot;&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="p">:</span><span class="n">istart</span><span class="p">))</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6605"></a>                                    <span class="s1">&#39;&quot; in path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6606"></a>                            <span class="k">exit</span>
<a name="ln-6607"></a><span class="k">                        end if</span>
<a name="ln-6608"></a>
<a name="ln-6609"></a>                        <span class="c">! get the next token by checking:</span>
<a name="ln-6610"></a>                        <span class="c">!</span>
<a name="ln-6611"></a>                        <span class="c">! * [&#39;&#39;] -- is the token after istart a quote?</span>
<a name="ln-6612"></a>                        <span class="c">!           if so, then search for the next `&#39;]`</span>
<a name="ln-6613"></a>                        <span class="c">!</span>
<a name="ln-6614"></a>                        <span class="c">! * [1] -- if not, then maybe it is a number,</span>
<a name="ln-6615"></a>                        <span class="c">!          so search for the next `]`</span>
<a name="ln-6616"></a>
<a name="ln-6617"></a>                        <span class="c">! verify length of remaining string</span>
<a name="ln-6618"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">2</span><span class="o">&lt;=</span><span class="n">ilen</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6619"></a>
<a name="ln-6620"></a><span class="k">                            </span><span class="n">double_quotes</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">quotation_mark</span>   <span class="c">! [&quot;</span>
<a name="ln-6621"></a>
<a name="ln-6622"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">double_quotes</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">single_quote</span><span class="p">)</span> <span class="k">then</span>  <span class="c">! [&#39;</span>
<a name="ln-6623"></a>
<a name="ln-6624"></a>                                <span class="c">! it might be a key value: [&#39;abc&#39;]</span>
<a name="ln-6625"></a>
<a name="ln-6626"></a>                                <span class="n">istart</span> <span class="o">=</span> <span class="n">istart</span> <span class="o">+</span> <span class="mi">1</span> <span class="c">! move counter to &#39; index</span>
<a name="ln-6627"></a>                                <span class="k">if</span> <span class="p">(</span><span class="n">double_quotes</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6628"></a><span class="k">                                    </span><span class="n">iend</span> <span class="o">=</span> <span class="n">istart</span> <span class="o">+</span> <span class="nb">index</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">),&amp;</span>
<a name="ln-6629"></a>                                           <span class="n">quotation_mark</span><span class="o">//</span><span class="n">end_array</span><span class="p">)</span>  <span class="c">! &quot;]</span>
<a name="ln-6630"></a>                                <span class="k">else</span>
<a name="ln-6631"></a><span class="k">                                    </span><span class="n">iend</span> <span class="o">=</span> <span class="n">istart</span> <span class="o">+</span> <span class="nb">index</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">),&amp;</span>
<a name="ln-6632"></a>                                           <span class="n">single_quote</span><span class="o">//</span><span class="n">end_array</span><span class="p">)</span>  <span class="c">! &#39;]</span>
<a name="ln-6633"></a>                                <span class="k">end if</span>
<a name="ln-6634"></a><span class="k">                                if</span> <span class="p">(</span><span class="n">iend</span><span class="o">&gt;</span><span class="n">istart</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6635"></a>
<a name="ln-6636"></a>                                    <span class="c">!     istart  iend</span>
<a name="ln-6637"></a>                                    <span class="c">!       |       |</span>
<a name="ln-6638"></a>                                    <span class="c">! [&#39;p&#39;][&#39;abcdefg&#39;]</span>
<a name="ln-6639"></a>
<a name="ln-6640"></a>                                    <span class="k">if</span> <span class="p">(</span><span class="n">iend</span><span class="o">&gt;</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6641"></a><span class="k">                                        </span><span class="n">token</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">iend</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6642"></a>                                    <span class="k">else</span>
<a name="ln-6643"></a><span class="k">                                        </span><span class="n">token</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>  <span class="c">! blank string</span>
<a name="ln-6644"></a>                                    <span class="k">end if</span>
<a name="ln-6645"></a>                                    <span class="c">! remove trailing spaces in</span>
<a name="ln-6646"></a>                                    <span class="c">! the token here if necessary:</span>
<a name="ln-6647"></a>                                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">trailing_spaces_significant</span><span class="p">)</span> <span class="p">&amp;</span>
<a name="ln-6648"></a>                                        <span class="n">token</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6649"></a>
<a name="ln-6650"></a>                                    <span class="k">if</span> <span class="p">(</span><span class="n">create</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6651"></a>                                        <span class="c">! have a token, create it if necessary</span>
<a name="ln-6652"></a>
<a name="ln-6653"></a>                                        <span class="c">! we need to convert it into an object here</span>
<a name="ln-6654"></a>                                        <span class="c">! (e.g., if p was also just created)</span>
<a name="ln-6655"></a>                                        <span class="c">! and destroy its data to prevent a memory leak</span>
<a name="ln-6656"></a>                                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">convert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">json_object</span><span class="p">)</span>
<a name="ln-6657"></a>
<a name="ln-6658"></a>                                        <span class="c">! don&#39;t want to throw exceptions in this case</span>
<a name="ln-6659"></a>                                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">token</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6660"></a>                                        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6661"></a>                                            <span class="c">! have to create this child</span>
<a name="ln-6662"></a>                                            <span class="c">! [make it a null since we don&#39;t</span>
<a name="ln-6663"></a>                                            <span class="c">! know what it is yet]</span>
<a name="ln-6664"></a>                                            <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6665"></a>                                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6666"></a>                                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6667"></a>                                            <span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6668"></a>                                            <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6669"></a>                                        <span class="k">else</span>
<a name="ln-6670"></a>                                            <span class="c">! it was already there.</span>
<a name="ln-6671"></a>                                            <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6672"></a>                                        <span class="k">end if</span>
<a name="ln-6673"></a><span class="k">                                    else</span>
<a name="ln-6674"></a>                                        <span class="c">! have a token, see if it is valid:</span>
<a name="ln-6675"></a>                                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">token</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6676"></a>                                    <span class="k">end if</span>
<a name="ln-6677"></a>
<a name="ln-6678"></a><span class="k">                                    if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6679"></a>                                        <span class="c">! it was found</span>
<a name="ln-6680"></a>                                        <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6681"></a>                                    <span class="k">else</span>
<a name="ln-6682"></a><span class="k">                                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6683"></a>                                                <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6684"></a>                                                <span class="s1">&#39;invalid token found: &quot;&#39;</span><span class="o">//</span><span class="n">token</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6685"></a>                                                <span class="s1">&#39;&quot; in path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6686"></a>                                        <span class="k">exit</span>
<a name="ln-6687"></a><span class="k">                                    end if</span>
<a name="ln-6688"></a><span class="k">                                    </span><span class="n">iend</span> <span class="o">=</span> <span class="n">iend</span> <span class="o">+</span> <span class="mi">1</span> <span class="c">! move counter to ] index</span>
<a name="ln-6689"></a>                                <span class="k">else</span>
<a name="ln-6690"></a><span class="k">                                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6691"></a>                                            <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6692"></a>                                            <span class="s1">&#39;invalid path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6693"></a>                                    <span class="k">exit</span>
<a name="ln-6694"></a><span class="k">                                end if</span>
<a name="ln-6695"></a>
<a name="ln-6696"></a><span class="k">                            else</span>
<a name="ln-6697"></a>
<a name="ln-6698"></a>                                <span class="c">! it might be an integer value: [123]</span>
<a name="ln-6699"></a>
<a name="ln-6700"></a>                                <span class="n">iend</span> <span class="o">=</span> <span class="n">istart</span> <span class="o">+</span> <span class="nb">index</span><span class="p">(</span><span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">ilen</span><span class="p">),</span><span class="n">end_array</span><span class="p">)</span>   <span class="c">! ]</span>
<a name="ln-6701"></a>                                <span class="k">if</span> <span class="p">(</span><span class="n">iend</span><span class="o">&gt;</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6702"></a>
<a name="ln-6703"></a>                                    <span class="c">! this should be an integer:</span>
<a name="ln-6704"></a>                                    <span class="n">token</span> <span class="o">=</span> <span class="n">path</span><span class="p">(</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">iend</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-6705"></a>
<a name="ln-6706"></a>                                    <span class="c">! verify that there are no spaces or other</span>
<a name="ln-6707"></a>                                    <span class="c">! characters in the string:</span>
<a name="ln-6708"></a>                                    <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
<a name="ln-6709"></a>                                        <span class="c">! It must only contain (0..9) characters</span>
<a name="ln-6710"></a>                                        <span class="c">! (it must be unsigned)</span>
<a name="ln-6711"></a>                                        <span class="k">if</span> <span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">token</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">),</span><span class="n">CK_</span><span class="s1">&#39;0123456789&#39;</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6712"></a><span class="k">                                            </span><span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6713"></a>                                            <span class="k">exit</span>
<a name="ln-6714"></a><span class="k">                                        end if</span>
<a name="ln-6715"></a><span class="k">                                    end do</span>
<a name="ln-6716"></a><span class="k">                                    if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6717"></a><span class="k">                                        call </span><span class="n">string_to_integer</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6718"></a>                                        <span class="k">if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="n">status_ok</span> <span class="o">=</span> <span class="n">ival</span><span class="o">&gt;</span><span class="mi">0</span>  <span class="c">! assuming 1-based array indices</span>
<a name="ln-6719"></a>                                    <span class="k">end if</span>
<a name="ln-6720"></a>
<a name="ln-6721"></a><span class="k">                                    if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6722"></a>
<a name="ln-6723"></a>                                        <span class="c">! have a valid integer to use as an index</span>
<a name="ln-6724"></a>                                        <span class="c">! see if this element is really there:</span>
<a name="ln-6725"></a>                                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6726"></a>
<a name="ln-6727"></a>                                        <span class="k">if</span> <span class="p">(</span><span class="n">create</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6728"></a>
<a name="ln-6729"></a>                                            <span class="c">! have to create it:</span>
<a name="ln-6730"></a>
<a name="ln-6731"></a>                                            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_array</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6732"></a>                                                <span class="c">! we need to convert it into an array here</span>
<a name="ln-6733"></a>                                                <span class="c">! (e.g., if p was also just created)</span>
<a name="ln-6734"></a>                                                <span class="c">! and destroy its data to prevent a memory leak</span>
<a name="ln-6735"></a>                                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">convert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-6736"></a>                                            <span class="k">end if</span>
<a name="ln-6737"></a>
<a name="ln-6738"></a>                                            <span class="c">! have to create this element</span>
<a name="ln-6739"></a>                                            <span class="c">! [make it a null]</span>
<a name="ln-6740"></a>                                            <span class="c">! (and any missing ones before it)</span>
<a name="ln-6741"></a>                                            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ival</span>
<a name="ln-6742"></a>                                                <span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6743"></a>                                                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get_child</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">status_ok</span><span class="p">)</span>
<a name="ln-6744"></a>                                                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6745"></a><span class="k">                                                    call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6746"></a>                                                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>  <span class="c">! array element doesn&#39;t need a name</span>
<a name="ln-6747"></a>                                                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6748"></a>                                                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">ival</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6749"></a>                                                <span class="k">else</span>
<a name="ln-6750"></a><span class="k">                                                    if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">ival</span><span class="p">)</span> <span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6751"></a>                                                <span class="k">end if</span>
<a name="ln-6752"></a><span class="k">                                            end do</span>
<a name="ln-6753"></a><span class="k">                                            </span><span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6754"></a>
<a name="ln-6755"></a>                                        <span class="k">else</span>
<a name="ln-6756"></a><span class="k">                                            </span><span class="n">created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6757"></a>                                        <span class="k">end if</span>
<a name="ln-6758"></a>
<a name="ln-6759"></a><span class="k">                                        if</span> <span class="p">(</span><span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6760"></a>                                            <span class="c">! found it</span>
<a name="ln-6761"></a>                                            <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6762"></a>                                        <span class="k">else</span>
<a name="ln-6763"></a>                                            <span class="c">! not found</span>
<a name="ln-6764"></a>                                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6765"></a>                                                    <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6766"></a>                                                    <span class="s1">&#39;invalid array index found: &quot;&#39;</span><span class="o">//</span><span class="n">token</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6767"></a>                                                    <span class="s1">&#39;&quot; in path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6768"></a>                                            <span class="k">exit</span>
<a name="ln-6769"></a><span class="k">                                        end if</span>
<a name="ln-6770"></a><span class="k">                                    else</span>
<a name="ln-6771"></a><span class="k">                                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6772"></a>                                                <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6773"></a>                                                <span class="s1">&#39;invalid token: &quot;&#39;</span><span class="o">//</span><span class="n">token</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6774"></a>                                                <span class="s1">&#39;&quot; in path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6775"></a>                                        <span class="k">exit</span>
<a name="ln-6776"></a><span class="k">                                    end if</span>
<a name="ln-6777"></a>
<a name="ln-6778"></a><span class="k">                                else</span>
<a name="ln-6779"></a><span class="k">                                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6780"></a>                                            <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6781"></a>                                            <span class="s1">&#39;invalid path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6782"></a>                                    <span class="k">exit</span>
<a name="ln-6783"></a><span class="k">                                end if</span>
<a name="ln-6784"></a>
<a name="ln-6785"></a><span class="k">                            end if</span>
<a name="ln-6786"></a>
<a name="ln-6787"></a><span class="k">                        else</span>
<a name="ln-6788"></a><span class="k">                            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6789"></a>                                    <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6790"></a>                                    <span class="s1">&#39;invalid path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6791"></a>                            <span class="k">exit</span>
<a name="ln-6792"></a><span class="k">                        end if</span>
<a name="ln-6793"></a>
<a name="ln-6794"></a>                        <span class="c">! set up for next token:</span>
<a name="ln-6795"></a>                        <span class="n">istart</span> <span class="o">=</span> <span class="n">iend</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-6796"></a>
<a name="ln-6797"></a>                    <span class="k">end do</span>
<a name="ln-6798"></a>
<a name="ln-6799"></a><span class="k">                end if</span>
<a name="ln-6800"></a>
<a name="ln-6801"></a><span class="k">            else</span>
<a name="ln-6802"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(&amp;</span>
<a name="ln-6803"></a>                        <span class="s1">&#39;Error in json_get_by_path_jsonpath_bracket: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6804"></a>                        <span class="s1">&#39;expecting &quot;&#39;</span><span class="o">//</span><span class="n">root</span><span class="o">//</span><span class="s1">&#39;&quot;, found: &quot;&#39;</span><span class="o">//</span><span class="n">path</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6805"></a>                        <span class="s1">&#39;&quot; in path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-6806"></a>            <span class="k">end if</span>
<a name="ln-6807"></a>
<a name="ln-6808"></a><span class="k">        end if</span>
<a name="ln-6809"></a>
<a name="ln-6810"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6811"></a><span class="k">            nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-6812"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6813"></a><span class="k">                </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6814"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-6815"></a>            <span class="k">end if</span>
<a name="ln-6816"></a><span class="k">        else</span>
<a name="ln-6817"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6818"></a>        <span class="k">end if</span>
<a name="ln-6819"></a>
<a name="ln-6820"></a>        <span class="c">! if it had to be created:</span>
<a name="ln-6821"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="n">created</span>
<a name="ln-6822"></a>
<a name="ln-6823"></a>    <span class="k">else</span>
<a name="ln-6824"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6825"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">was_created</span><span class="p">))</span> <span class="n">was_created</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-6826"></a>    <span class="k">end if</span>
<a name="ln-6827"></a>
<a name="ln-6828"></a><span class="k">    end subroutine </span><span class="n">json_get_by_path_jsonpath_bracket</span>
<a name="ln-6829"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6830"></a>
<a name="ln-6831"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6832"></a><span class="c">!&gt;</span>
<a name="ln-6833"></a><span class="c">!  Convert an existing JSON variable `p` to a different variable type.</span>
<a name="ln-6834"></a><span class="c">!  The existing variable (and its children) is destroyed. It is replaced</span>
<a name="ln-6835"></a><span class="c">!  in the structure by a new variable of type `var_type`</span>
<a name="ln-6836"></a><span class="c">!  (which can be a `json_null`, `json_object` or `json_array`).</span>
<a name="ln-6837"></a><span class="c">!</span>
<a name="ln-6838"></a><span class="c">!@note This is an internal routine used when creating variables by path.</span>
<a name="ln-6839"></a>
<a name="ln-6840"></a>    <span class="k">subroutine </span><span class="n">convert</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-6841"></a>
<a name="ln-6842"></a>    <span class="k">implicit none</span>
<a name="ln-6843"></a>
<a name="ln-6844"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-6845"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>  <span class="c">!! the variable to convert</span>
<a name="ln-6846"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">var_type</span> <span class="c">!! the variable type to convert `p` to</span>
<a name="ln-6847"></a>
<a name="ln-6848"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! temporary variable</span>
<a name="ln-6849"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">name</span> <span class="c">!! the name of a JSON variable</span>
<a name="ln-6850"></a>
<a name="ln-6851"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">convert_it</span>  <span class="c">!! if `p` needs to be converted</span>
<a name="ln-6852"></a>
<a name="ln-6853"></a>    <span class="n">convert_it</span> <span class="o">=</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">/=</span> <span class="n">var_type</span>
<a name="ln-6854"></a>
<a name="ln-6855"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">convert_it</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6856"></a>
<a name="ln-6857"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="c">! get existing name</span>
<a name="ln-6858"></a>
<a name="ln-6859"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-6860"></a>        <span class="k">case</span><span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
<a name="ln-6861"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_object</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-6862"></a>        <span class="k">case</span><span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-6863"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-6864"></a>        <span class="k">case</span><span class="p">(</span><span class="n">json_null</span><span class="p">)</span>
<a name="ln-6865"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_null</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-6866"></a>        <span class="k">case </span><span class="n">default</span>
<a name="ln-6867"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in convert: invalid var_type value.&#39;</span><span class="p">)</span>
<a name="ln-6868"></a>            <span class="k">return</span>
<a name="ln-6869"></a><span class="k">        end select</span>
<a name="ln-6870"></a>
<a name="ln-6871"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">replace</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">destroy</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-6872"></a>        <span class="n">p</span> <span class="o">=&gt;</span> <span class="n">tmp</span>
<a name="ln-6873"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-6874"></a>
<a name="ln-6875"></a>    <span class="k">end if</span>
<a name="ln-6876"></a>
<a name="ln-6877"></a><span class="k">    end subroutine </span><span class="n">convert</span>
<a name="ln-6878"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6879"></a>
<a name="ln-6880"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6881"></a><span class="c">!&gt;</span>
<a name="ln-6882"></a><span class="c">!  Alternate version of [[json_get_by_path]] where &quot;path&quot; is kind=CDK.</span>
<a name="ln-6883"></a>
<a name="ln-6884"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-6885"></a>
<a name="ln-6886"></a>    <span class="k">implicit none</span>
<a name="ln-6887"></a>
<a name="ln-6888"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-6889"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-6890"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-6891"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-6892"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-6893"></a>
<a name="ln-6894"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-6895"></a>
<a name="ln-6896"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_by_path</span>
<a name="ln-6897"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6898"></a>
<a name="ln-6899"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-6900"></a><span class="c">!&gt;</span>
<a name="ln-6901"></a><span class="c">!  Returns the path to a JSON object that is part</span>
<a name="ln-6902"></a><span class="c">!  of a linked list structure.</span>
<a name="ln-6903"></a><span class="c">!</span>
<a name="ln-6904"></a><span class="c">!  The path returned would be suitable for input to</span>
<a name="ln-6905"></a><span class="c">!  [[json_get_by_path]] and related routines.</span>
<a name="ln-6906"></a><span class="c">!</span>
<a name="ln-6907"></a><span class="c">!@note If an error occurs (which in this case means a malformed</span>
<a name="ln-6908"></a><span class="c">!      JSON structure) then an exception will be thrown, unless</span>
<a name="ln-6909"></a><span class="c">!      `found` is present, which will be set to `false`. `path`</span>
<a name="ln-6910"></a><span class="c">!      will be a blank string.</span>
<a name="ln-6911"></a><span class="c">!</span>
<a name="ln-6912"></a><span class="c">!@note If `json%path_mode/=1`, then the `use_alt_array_tokens`</span>
<a name="ln-6913"></a><span class="c">!      and `path_sep` inputs are ignored if present.</span>
<a name="ln-6914"></a><span class="c">!</span>
<a name="ln-6915"></a><span class="c">!@note [http://goessner.net/articles/JsonPath/](JSONPath) (`path_mode=3`)</span>
<a name="ln-6916"></a><span class="c">!      does not specify whether or not the keys should be escaped (this routine</span>
<a name="ln-6917"></a><span class="c">!      assumes not, as does http://jsonpath.com).</span>
<a name="ln-6918"></a><span class="c">!      Also, we are using Fortran-style 1-based array indices,</span>
<a name="ln-6919"></a><span class="c">!      not 0-based, to agree with the assumption in `path_mode=1`</span>
<a name="ln-6920"></a>
<a name="ln-6921"></a>    <span class="k">subroutine </span><span class="n">json_get_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">use_alt_array_tokens</span><span class="p">,</span> <span class="n">path_sep</span><span class="p">)</span>
<a name="ln-6922"></a>
<a name="ln-6923"></a>    <span class="k">implicit none</span>
<a name="ln-6924"></a>
<a name="ln-6925"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-6926"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">p</span>     <span class="c">!! a JSON linked list object</span>
<a name="ln-6927"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>  <span class="c">!! path to the variable</span>
<a name="ln-6928"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span> <span class="c">!! true if there were no problems</span>
<a name="ln-6929"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">use_alt_array_tokens</span>   <span class="c">!! if true, then &#39;()&#39; are used for array elements</span>
<a name="ln-6930"></a>                                                              <span class="c">!! otherwise, &#39;[]&#39; are used [default]</span>
<a name="ln-6931"></a>                                                              <span class="c">!! (only used if `path_mode=1`)</span>
<a name="ln-6932"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">path_sep</span>  <span class="c">!! character to use for path separator</span>
<a name="ln-6933"></a>                                                              <span class="c">!! (otherwise use `json%path_separator`)</span>
<a name="ln-6934"></a>                                                              <span class="c">!! (only used if `path_mode=1`)</span>
<a name="ln-6935"></a>
<a name="ln-6936"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                   <span class="kd">::</span> <span class="n">tmp</span>            <span class="c">!! for traversing the structure</span>
<a name="ln-6937"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                   <span class="kd">::</span> <span class="n">element</span>        <span class="c">!! for traversing the structure</span>
<a name="ln-6938"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">var_type</span>       <span class="c">!! JSON variable type flag</span>
<a name="ln-6939"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>       <span class="kd">::</span> <span class="n">name</span>           <span class="c">!! variable name</span>
<a name="ln-6940"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span>       <span class="kd">::</span> <span class="n">parent_name</span>    <span class="c">!! variable&#39;s parent name</span>
<a name="ln-6941"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_integer_str_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istr</span>           <span class="c">!! for integer to string conversion</span>
<a name="ln-6942"></a>                                                                 <span class="c">!! (array indices)</span>
<a name="ln-6943"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">i</span>              <span class="c">!! counter</span>
<a name="ln-6944"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">n_children</span>     <span class="c">!! number of children for parent</span>
<a name="ln-6945"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">use_brackets</span>   <span class="c">!! to use &#39;[]&#39; characters for arrays</span>
<a name="ln-6946"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">parent_is_root</span> <span class="c">!! if the parent is the root</span>
<a name="ln-6947"></a>
<a name="ln-6948"></a>    <span class="c">!optional input:</span>
<a name="ln-6949"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">use_alt_array_tokens</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6950"></a><span class="k">        </span><span class="n">use_brackets</span> <span class="o">=</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">use_alt_array_tokens</span>
<a name="ln-6951"></a>    <span class="k">else</span>
<a name="ln-6952"></a><span class="k">        </span><span class="n">use_brackets</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-6953"></a>    <span class="k">end if</span>
<a name="ln-6954"></a>
<a name="ln-6955"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6956"></a>
<a name="ln-6957"></a>        <span class="c">!traverse the structure via parents up to the root</span>
<a name="ln-6958"></a>        <span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">p</span>
<a name="ln-6959"></a>        <span class="k">do</span>
<a name="ln-6960"></a>
<a name="ln-6961"></a><span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="k">exit</span> <span class="c">!finished</span>
<a name="ln-6962"></a>
<a name="ln-6963"></a>            <span class="c">!get info about the current variable:</span>
<a name="ln-6964"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<a name="ln-6965"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="o">==</span><span class="mi">2_IK</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6966"></a><span class="k">                </span><span class="n">name</span> <span class="o">=</span> <span class="n">encode_rfc6901</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a name="ln-6967"></a>            <span class="k">end if</span>
<a name="ln-6968"></a>
<a name="ln-6969"></a>            <span class="c">! if tmp a child of an object, or an element of an array</span>
<a name="ln-6970"></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6971"></a>
<a name="ln-6972"></a>                <span class="c">!get info about the parent:</span>
<a name="ln-6973"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">parent</span><span class="p">,</span><span class="n">var_type</span><span class="o">=</span><span class="n">var_type</span><span class="p">,&amp;</span>
<a name="ln-6974"></a>                               <span class="n">n_children</span><span class="o">=</span><span class="n">n_children</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">parent_name</span><span class="p">)</span>
<a name="ln-6975"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="o">==</span><span class="mi">2_IK</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-6976"></a><span class="k">                    </span><span class="n">parent_name</span> <span class="o">=</span> <span class="n">encode_rfc6901</span><span class="p">(</span><span class="n">parent_name</span><span class="p">)</span>
<a name="ln-6977"></a>                <span class="k">end if</span>
<a name="ln-6978"></a>
<a name="ln-6979"></a><span class="k">                select case</span> <span class="p">(</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-6980"></a>                <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-6981"></a>
<a name="ln-6982"></a>                    <span class="c">!get array index of this element:</span>
<a name="ln-6983"></a>                    <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">children</span>
<a name="ln-6984"></a>                    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_children</span>
<a name="ln-6985"></a>                        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6986"></a><span class="k">                            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6987"></a>                                                      <span class="s1">&#39;malformed JSON structure. &#39;</span><span class="p">)</span>
<a name="ln-6988"></a>                            <span class="k">exit</span>
<a name="ln-6989"></a><span class="k">                        end if</span>
<a name="ln-6990"></a><span class="k">                        if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="n">tmp</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-6991"></a><span class="k">                            exit</span>
<a name="ln-6992"></a><span class="k">                        else</span>
<a name="ln-6993"></a><span class="k">                            </span><span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-6994"></a>                        <span class="k">end if</span>
<a name="ln-6995"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">n_children</span><span class="p">)</span> <span class="k">then</span> <span class="c">! it wasn&#39;t found (should never happen)</span>
<a name="ln-6996"></a>                            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-6997"></a>                                                      <span class="s1">&#39;malformed JSON structure. &#39;</span><span class="p">)</span>
<a name="ln-6998"></a>                            <span class="k">exit</span>
<a name="ln-6999"></a><span class="k">                        end if</span>
<a name="ln-7000"></a><span class="k">                    end do</span>
<a name="ln-7001"></a><span class="k">                    select case</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-7002"></a>                    <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-7003"></a>                        <span class="c">! JSONPath &quot;bracket-notation&quot;</span>
<a name="ln-7004"></a>                        <span class="c">! example: `$[&#39;key&#39;][1]`</span>
<a name="ln-7005"></a>                        <span class="c">! [note: this uses 1-based indices]</span>
<a name="ln-7006"></a>                        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">istr</span><span class="p">)</span>
<a name="ln-7007"></a>                        <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">start_array</span><span class="o">//</span><span class="n">single_quote</span><span class="o">//</span><span class="n">parent_name</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7008"></a>                                         <span class="n">single_quote</span><span class="o">//</span><span class="n">end_array</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7009"></a>                                         <span class="n">start_array</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">istr</span><span class="p">))</span><span class="o">//</span><span class="n">end_array</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-7010"></a>                    <span class="k">case</span><span class="p">(</span><span class="mi">2_IK</span><span class="p">)</span>
<a name="ln-7011"></a>                        <span class="c">! rfc6901</span>
<a name="ln-7012"></a>                        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">istr</span><span class="p">)</span> <span class="c">! 0-based index</span>
<a name="ln-7013"></a>                        <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">parent_name</span><span class="o">//</span><span class="n">slash</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">istr</span><span class="p">)))</span>
<a name="ln-7014"></a>                    <span class="k">case</span><span class="p">(</span><span class="mi">1_IK</span><span class="p">)</span>
<a name="ln-7015"></a>                        <span class="c">! default</span>
<a name="ln-7016"></a>                        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">istr</span><span class="p">)</span>
<a name="ln-7017"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">use_brackets</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7018"></a><span class="k">                            call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">parent_name</span><span class="o">//</span><span class="n">start_array</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7019"></a>                                             <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">istr</span><span class="p">))</span><span class="o">//</span><span class="n">end_array</span><span class="p">,</span><span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7020"></a>                        <span class="k">else</span>
<a name="ln-7021"></a><span class="k">                            call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">parent_name</span><span class="o">//</span><span class="n">start_array_alt</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7022"></a>                                             <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">istr</span><span class="p">))</span><span class="o">//</span><span class="n">end_array_alt</span><span class="p">,</span><span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7023"></a>                        <span class="k">end if</span>
<a name="ln-7024"></a><span class="k">                    end select</span>
<a name="ln-7025"></a><span class="k">                    </span><span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">parent</span>  <span class="c">! already added parent name</span>
<a name="ln-7026"></a>
<a name="ln-7027"></a>                <span class="k">case</span> <span class="p">(</span><span class="n">json_object</span><span class="p">)</span>
<a name="ln-7028"></a>
<a name="ln-7029"></a>                    <span class="c">!process parent on the next pass</span>
<a name="ln-7030"></a>                    <span class="k">select case</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-7031"></a>                    <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-7032"></a>                        <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">start_array</span><span class="o">//</span><span class="n">single_quote</span><span class="o">//</span><span class="n">name</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7033"></a>                                         <span class="n">single_quote</span><span class="o">//</span><span class="n">end_array</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-7034"></a>                    <span class="k">case </span><span class="n">default</span>
<a name="ln-7035"></a>                        <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7036"></a>                    <span class="k">end select</span>
<a name="ln-7037"></a>
<a name="ln-7038"></a><span class="k">                case </span><span class="n">default</span>
<a name="ln-7039"></a>
<a name="ln-7040"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7041"></a>                                              <span class="s1">&#39;malformed JSON structure. &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7042"></a>                                              <span class="s1">&#39;A variable that is not an object &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7043"></a>                                              <span class="s1">&#39;or array should not have a child.&#39;</span><span class="p">)</span>
<a name="ln-7044"></a>                    <span class="k">exit</span>
<a name="ln-7045"></a>
<a name="ln-7046"></a><span class="k">                end select</span>
<a name="ln-7047"></a>
<a name="ln-7048"></a><span class="k">            else</span>
<a name="ln-7049"></a>                <span class="c">!the last one:</span>
<a name="ln-7050"></a>                <span class="k">select case</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-7051"></a>                <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-7052"></a>                    <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">start_array</span><span class="o">//</span><span class="n">single_quote</span><span class="o">//</span><span class="n">name</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7053"></a>                                     <span class="n">single_quote</span><span class="o">//</span><span class="n">end_array</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-7054"></a>                <span class="k">case </span><span class="n">default</span>
<a name="ln-7055"></a>                    <span class="k">call </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7056"></a>                <span class="k">end select</span>
<a name="ln-7057"></a><span class="k">            end if</span>
<a name="ln-7058"></a>
<a name="ln-7059"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7060"></a>                <span class="c">!check if the parent is the root:</span>
<a name="ln-7061"></a>                <span class="n">parent_is_root</span> <span class="o">=</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">tmp</span><span class="p">%</span><span class="n">parent</span><span class="p">%</span><span class="n">parent</span><span class="p">))</span>
<a name="ln-7062"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">parent_is_root</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-7063"></a><span class="k">            end if</span>
<a name="ln-7064"></a>
<a name="ln-7065"></a>            <span class="c">!go to parent:</span>
<a name="ln-7066"></a>            <span class="n">tmp</span> <span class="o">=&gt;</span> <span class="n">tmp</span><span class="p">%</span><span class="n">parent</span>
<a name="ln-7067"></a>
<a name="ln-7068"></a>        <span class="k">end do</span>
<a name="ln-7069"></a>
<a name="ln-7070"></a><span class="k">    else</span>
<a name="ln-7071"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_path: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7072"></a>                                  <span class="s1">&#39;input pointer is not associated&#39;</span><span class="p">)</span>
<a name="ln-7073"></a>    <span class="k">end if</span>
<a name="ln-7074"></a>
<a name="ln-7075"></a>    <span class="c">!for errors, return blank string:</span>
<a name="ln-7076"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7077"></a><span class="k">        </span><span class="n">path</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-7078"></a>    <span class="k">else</span>
<a name="ln-7079"></a><span class="k">        select case</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-7080"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-7081"></a>            <span class="c">! add the outer level object identifier:</span>
<a name="ln-7082"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">root</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7083"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">2_IK</span><span class="p">)</span>
<a name="ln-7084"></a>            <span class="c">! add the root slash:</span>
<a name="ln-7085"></a>            <span class="n">path</span> <span class="o">=</span> <span class="n">slash</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7086"></a>        <span class="k">end select</span>
<a name="ln-7087"></a><span class="k">    end if</span>
<a name="ln-7088"></a>
<a name="ln-7089"></a>    <span class="c">!optional output:</span>
<a name="ln-7090"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7091"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7092"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7093"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7094"></a>        <span class="k">else</span>
<a name="ln-7095"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7096"></a>        <span class="k">end if</span>
<a name="ln-7097"></a><span class="k">    end if</span>
<a name="ln-7098"></a>
<a name="ln-7099"></a><span class="k">    contains</span>
<a name="ln-7100"></a>
<a name="ln-7101"></a><span class="k">        subroutine </span><span class="n">add_to_path</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7102"></a>        <span class="c">!! prepend the string to the path</span>
<a name="ln-7103"></a>        <span class="k">implicit none</span>
<a name="ln-7104"></a><span class="k">        </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>  <span class="c">!! string to prepend to `path`</span>
<a name="ln-7105"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">path_sep</span>
<a name="ln-7106"></a>            <span class="c">!! path separator (default is &#39;.&#39;).</span>
<a name="ln-7107"></a>            <span class="c">!! (ignored if `json%path_mode/=1`)</span>
<a name="ln-7108"></a>
<a name="ln-7109"></a>        <span class="k">select case</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">path_mode</span><span class="p">)</span>
<a name="ln-7110"></a>        <span class="k">case</span><span class="p">(</span><span class="mi">3_IK</span><span class="p">)</span>
<a name="ln-7111"></a>            <span class="c">! in this case, the options are ignored</span>
<a name="ln-7112"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7113"></a><span class="k">                </span><span class="n">path</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-7114"></a>            <span class="k">else</span>
<a name="ln-7115"></a><span class="k">                </span><span class="n">path</span> <span class="o">=</span> <span class="n">str</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7116"></a>            <span class="k">end if</span>
<a name="ln-7117"></a><span class="k">        case</span><span class="p">(</span><span class="mi">2_IK</span><span class="p">)</span>
<a name="ln-7118"></a>            <span class="c">! in this case, the options are ignored</span>
<a name="ln-7119"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7120"></a><span class="k">                </span><span class="n">path</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-7121"></a>            <span class="k">else</span>
<a name="ln-7122"></a><span class="k">                </span><span class="n">path</span> <span class="o">=</span> <span class="n">str</span><span class="o">//</span><span class="n">slash</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7123"></a>            <span class="k">end if</span>
<a name="ln-7124"></a><span class="k">        case</span><span class="p">(</span><span class="mi">1_IK</span><span class="p">)</span>
<a name="ln-7125"></a>            <span class="c">! default path format</span>
<a name="ln-7126"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7127"></a><span class="k">                </span><span class="n">path</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-7128"></a>            <span class="k">else</span>
<a name="ln-7129"></a><span class="k">                if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">path_sep</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7130"></a>                    <span class="c">! use user specified:</span>
<a name="ln-7131"></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">str</span><span class="o">//</span><span class="n">path_sep</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7132"></a>                <span class="k">else</span>
<a name="ln-7133"></a>                    <span class="c">! use the default:</span>
<a name="ln-7134"></a>                    <span class="n">path</span> <span class="o">=</span> <span class="n">str</span><span class="o">//</span><span class="n">json</span><span class="p">%</span><span class="n">path_separator</span><span class="o">//</span><span class="n">path</span>
<a name="ln-7135"></a>                <span class="k">end if</span>
<a name="ln-7136"></a><span class="k">            end if</span>
<a name="ln-7137"></a><span class="k">        end select</span>
<a name="ln-7138"></a>
<a name="ln-7139"></a><span class="k">        end subroutine </span><span class="n">add_to_path</span>
<a name="ln-7140"></a>
<a name="ln-7141"></a>    <span class="k">end subroutine </span><span class="n">json_get_path</span>
<a name="ln-7142"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7143"></a>
<a name="ln-7144"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7145"></a><span class="c">!&gt;</span>
<a name="ln-7146"></a><span class="c">!  Wrapper for [[json_get_path]] where &quot;path&quot; and &quot;path_sep&quot; are kind=CDK.</span>
<a name="ln-7147"></a>
<a name="ln-7148"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">found</span><span class="p">,</span> <span class="n">use_alt_array_tokens</span><span class="p">,</span> <span class="n">path_sep</span><span class="p">)</span>
<a name="ln-7149"></a>
<a name="ln-7150"></a>    <span class="k">implicit none</span>
<a name="ln-7151"></a>
<a name="ln-7152"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                    <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7153"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">p</span>     <span class="c">!! a JSON linked list object</span>
<a name="ln-7154"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>  <span class="c">!! path to the variable</span>
<a name="ln-7155"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                  <span class="kd">::</span> <span class="n">found</span> <span class="c">!! true if there were no problems</span>
<a name="ln-7156"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">use_alt_array_tokens</span>    <span class="c">!! if true, then &#39;()&#39; are used for array elements</span>
<a name="ln-7157"></a>                                                               <span class="c">!! otherwise, &#39;[]&#39; are used [default]</span>
<a name="ln-7158"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">path_sep</span>  <span class="c">!! character to use for path separator</span>
<a name="ln-7159"></a>                                                               <span class="c">!! (default is &#39;.&#39;)</span>
<a name="ln-7160"></a>
<a name="ln-7161"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">ck_path</span>  <span class="c">!! path to the variable</span>
<a name="ln-7162"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sep</span>
<a name="ln-7163"></a>
<a name="ln-7164"></a>    <span class="c">! from unicode:</span>
<a name="ln-7165"></a>    <span class="n">sep</span> <span class="o">=</span> <span class="n">path_sep</span>
<a name="ln-7166"></a>
<a name="ln-7167"></a>    <span class="c">! call the main routine:</span>
<a name="ln-7168"></a>    <span class="k">call </span><span class="n">json_get_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">ck_path</span><span class="p">,</span><span class="n">found</span><span class="p">,</span><span class="n">use_alt_array_tokens</span><span class="p">,</span><span class="n">sep</span><span class="p">)</span>
<a name="ln-7169"></a>
<a name="ln-7170"></a>    <span class="c">! from unicode:</span>
<a name="ln-7171"></a>    <span class="n">path</span> <span class="o">=</span> <span class="n">ck_path</span>
<a name="ln-7172"></a>
<a name="ln-7173"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_path</span>
<a name="ln-7174"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7175"></a>
<a name="ln-7176"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7177"></a><span class="c">!&gt;</span>
<a name="ln-7178"></a><span class="c">!  Convert a string into an integer.</span>
<a name="ln-7179"></a><span class="c">!</span>
<a name="ln-7180"></a><span class="c">!@note Replacement for the `parse_integer` function in the original code.</span>
<a name="ln-7181"></a>
<a name="ln-7182"></a>    <span class="k">function </span><span class="n">string_to_int</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">ival</span><span class="p">)</span>
<a name="ln-7183"></a>
<a name="ln-7184"></a>    <span class="k">implicit none</span>
<a name="ln-7185"></a>
<a name="ln-7186"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7187"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-7188"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">ival</span>
<a name="ln-7189"></a>
<a name="ln-7190"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">status_ok</span> <span class="c">!! error flag</span>
<a name="ln-7191"></a>
<a name="ln-7192"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7193"></a>
<a name="ln-7194"></a>        <span class="c">! call the core routine:</span>
<a name="ln-7195"></a>        <span class="k">call </span><span class="n">string_to_integer</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-7196"></a>
<a name="ln-7197"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7198"></a><span class="k">            </span><span class="n">ival</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7199"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in string_to_int: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7200"></a>                                      <span class="s1">&#39;string cannot be converted to an integer: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7201"></a>                                      <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a name="ln-7202"></a>        <span class="k">end if</span>
<a name="ln-7203"></a>
<a name="ln-7204"></a><span class="k">    else</span>
<a name="ln-7205"></a><span class="k">        </span><span class="n">ival</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7206"></a>    <span class="k">end if</span>
<a name="ln-7207"></a>
<a name="ln-7208"></a><span class="k">    end function </span><span class="n">string_to_int</span>
<a name="ln-7209"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7210"></a>
<a name="ln-7211"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7212"></a><span class="c">!&gt;</span>
<a name="ln-7213"></a><span class="c">!  Convert a string into a double.</span>
<a name="ln-7214"></a>
<a name="ln-7215"></a>    <span class="k">function </span><span class="n">string_to_dble</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">rval</span><span class="p">)</span>
<a name="ln-7216"></a>
<a name="ln-7217"></a>    <span class="k">implicit none</span>
<a name="ln-7218"></a>
<a name="ln-7219"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7220"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a name="ln-7221"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">rval</span>
<a name="ln-7222"></a>
<a name="ln-7223"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">status_ok</span>  <span class="c">!! error flag</span>
<a name="ln-7224"></a>
<a name="ln-7225"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7226"></a>
<a name="ln-7227"></a><span class="k">        call </span><span class="n">string_to_real</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">rval</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a name="ln-7228"></a>
<a name="ln-7229"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!if there was an error</span>
<a name="ln-7230"></a>            <span class="n">rval</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-7231"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in string_to_dble: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7232"></a>                                      <span class="s1">&#39;string cannot be converted to a double: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7233"></a>                                      <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a name="ln-7234"></a>        <span class="k">end if</span>
<a name="ln-7235"></a>
<a name="ln-7236"></a><span class="k">    else</span>
<a name="ln-7237"></a><span class="k">        </span><span class="n">rval</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-7238"></a>    <span class="k">end if</span>
<a name="ln-7239"></a>
<a name="ln-7240"></a><span class="k">    end function </span><span class="n">string_to_dble</span>
<a name="ln-7241"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7242"></a>
<a name="ln-7243"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7244"></a><span class="c">!&gt;</span>
<a name="ln-7245"></a><span class="c">!  Get an integer value from a [[json_value]].</span>
<a name="ln-7246"></a>
<a name="ln-7247"></a>    <span class="k">subroutine </span><span class="n">json_get_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-7248"></a>
<a name="ln-7249"></a>    <span class="k">implicit none</span>
<a name="ln-7250"></a>
<a name="ln-7251"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7252"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7253"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7254"></a>
<a name="ln-7255"></a><span class="k">    value</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7256"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">return</span>
<a name="ln-7257"></a>
<a name="ln-7258"></a><span class="k">    if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span> <span class="o">==</span> <span class="n">json_integer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7259"></a><span class="k">        value</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">int_value</span>
<a name="ln-7260"></a>    <span class="k">else</span>
<a name="ln-7261"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7262"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in get_integer:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7263"></a>                 <span class="s1">&#39; Unable to resolve value to integer: &#39;</span><span class="o">//</span><span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7264"></a>        <span class="k">else</span>
<a name="ln-7265"></a>            <span class="c">!type conversions</span>
<a name="ln-7266"></a>            <span class="k">select case</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7267"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">json_double</span><span class="p">)</span>
<a name="ln-7268"></a>                <span class="k">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span>
<a name="ln-7269"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
<a name="ln-7270"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7271"></a><span class="k">                    value</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-7272"></a>                <span class="k">else</span>
<a name="ln-7273"></a><span class="k">                    value</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7274"></a>                <span class="k">end if</span>
<a name="ln-7275"></a><span class="k">            case </span><span class="n">default</span>
<a name="ln-7276"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in get_integer:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7277"></a>                     <span class="s1">&#39; Unable to resolve value to integer: &#39;</span><span class="o">//</span><span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7278"></a>            <span class="k">end select</span>
<a name="ln-7279"></a><span class="k">        end if</span>
<a name="ln-7280"></a><span class="k">    end if</span>
<a name="ln-7281"></a>
<a name="ln-7282"></a><span class="k">    end subroutine </span><span class="n">json_get_integer</span>
<a name="ln-7283"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7284"></a>
<a name="ln-7285"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7286"></a><span class="c">!&gt;</span>
<a name="ln-7287"></a><span class="c">!  Get an integer value from a [[json_value]], given the path string.</span>
<a name="ln-7288"></a>
<a name="ln-7289"></a>    <span class="k">subroutine </span><span class="n">json_get_integer_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7290"></a>
<a name="ln-7291"></a>    <span class="k">implicit none</span>
<a name="ln-7292"></a>
<a name="ln-7293"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7294"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7295"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7296"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7297"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7298"></a>
<a name="ln-7299"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7300"></a>
<a name="ln-7301"></a>    <span class="k">value</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-7302"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-7303"></a><span class="k">       if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7304"></a>       <span class="k">return</span>
<a name="ln-7305"></a><span class="k">    end if</span>
<a name="ln-7306"></a>
<a name="ln-7307"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7308"></a>
<a name="ln-7309"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7310"></a>
<a name="ln-7311"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7312"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_integer:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7313"></a>            <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span> <span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-7314"></a>    <span class="k">else</span>
<a name="ln-7315"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7316"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7317"></a>    <span class="k">end if</span>
<a name="ln-7318"></a><span class="k">    if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-7319"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-7320"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7321"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7322"></a>        <span class="k">end if</span>
<a name="ln-7323"></a><span class="k">    else</span>
<a name="ln-7324"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7325"></a>    <span class="k">end if</span>
<a name="ln-7326"></a>
<a name="ln-7327"></a><span class="k">    end subroutine </span><span class="n">json_get_integer_by_path</span>
<a name="ln-7328"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7329"></a>
<a name="ln-7330"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7331"></a><span class="c">!&gt;</span>
<a name="ln-7332"></a><span class="c">!  Alternate version of [[json_get_integer_by_path]], where &quot;path&quot; is kind=CDK.</span>
<a name="ln-7333"></a>
<a name="ln-7334"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_integer_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7335"></a>
<a name="ln-7336"></a>    <span class="k">implicit none</span>
<a name="ln-7337"></a>
<a name="ln-7338"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7339"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7340"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7341"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7342"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7343"></a>
<a name="ln-7344"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7345"></a>
<a name="ln-7346"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_integer_by_path</span>
<a name="ln-7347"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7348"></a>
<a name="ln-7349"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7350"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-7351"></a><span class="c">!  date: 5/14/2014</span>
<a name="ln-7352"></a><span class="c">!</span>
<a name="ln-7353"></a><span class="c">!  Get an integer vector from a [[json_value]].</span>
<a name="ln-7354"></a>
<a name="ln-7355"></a>    <span class="k">subroutine </span><span class="n">json_get_integer_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7356"></a>
<a name="ln-7357"></a>    <span class="k">implicit none</span>
<a name="ln-7358"></a>
<a name="ln-7359"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7360"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7361"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7362"></a>
<a name="ln-7363"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span>
<a name="ln-7364"></a>
<a name="ln-7365"></a>    <span class="c">! check for 0-length arrays first:</span>
<a name="ln-7366"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7367"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-7368"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7369"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-7370"></a>            <span class="k">return</span>
<a name="ln-7371"></a><span class="k">        end if</span>
<a name="ln-7372"></a><span class="k">    end select</span>
<a name="ln-7373"></a>
<a name="ln-7374"></a><span class="k">    </span><span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7375"></a>
<a name="ln-7376"></a>    <span class="c">!the callback function is called for each element of the array:</span>
<a name="ln-7377"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_int_from_array</span><span class="p">)</span>
<a name="ln-7378"></a>
<a name="ln-7379"></a>    <span class="k">contains</span>
<a name="ln-7380"></a>
<a name="ln-7381"></a><span class="k">        subroutine </span><span class="n">get_int_from_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-7382"></a>
<a name="ln-7383"></a>        <span class="c">!! callback function for integer</span>
<a name="ln-7384"></a>
<a name="ln-7385"></a>        <span class="k">implicit none</span>
<a name="ln-7386"></a>
<a name="ln-7387"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7388"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-7389"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-7390"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-7391"></a>
<a name="ln-7392"></a>        <span class="c">!size the output array:</span>
<a name="ln-7393"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7394"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="nb">count</span><span class="p">))</span>
<a name="ln-7395"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7396"></a>        <span class="k">end if</span>
<a name="ln-7397"></a>
<a name="ln-7398"></a>        <span class="c">!populate the elements:</span>
<a name="ln-7399"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-7400"></a>
<a name="ln-7401"></a>        <span class="k">end subroutine </span><span class="n">get_int_from_array</span>
<a name="ln-7402"></a>
<a name="ln-7403"></a>    <span class="k">end subroutine </span><span class="n">json_get_integer_vec</span>
<a name="ln-7404"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7405"></a>
<a name="ln-7406"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7407"></a><span class="c">!&gt;</span>
<a name="ln-7408"></a><span class="c">!  Get an integer vector from a [[json_value]], given the path string.</span>
<a name="ln-7409"></a>
<a name="ln-7410"></a>    <span class="k">subroutine </span><span class="n">json_get_integer_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7411"></a>
<a name="ln-7412"></a>    <span class="k">implicit none</span>
<a name="ln-7413"></a>
<a name="ln-7414"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7415"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7416"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7417"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7418"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7419"></a>
<a name="ln-7420"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7421"></a>
<a name="ln-7422"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7423"></a>
<a name="ln-7424"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7425"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7426"></a><span class="k">    else</span>
<a name="ln-7427"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7428"></a><span class="k">    end if</span>
<a name="ln-7429"></a>
<a name="ln-7430"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7431"></a>
<a name="ln-7432"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7433"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7434"></a>        <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7435"></a>    <span class="k">end if</span>
<a name="ln-7436"></a>
<a name="ln-7437"></a><span class="k">    end subroutine </span><span class="n">json_get_integer_vec_by_path</span>
<a name="ln-7438"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7439"></a>
<a name="ln-7440"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7441"></a><span class="c">!&gt;</span>
<a name="ln-7442"></a><span class="c">!  Alternate version of [[json_get_integer_vec_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-7443"></a>
<a name="ln-7444"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_integer_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7445"></a>
<a name="ln-7446"></a>    <span class="k">implicit none</span>
<a name="ln-7447"></a>
<a name="ln-7448"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7449"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                         <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7450"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7451"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7452"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7453"></a>
<a name="ln-7454"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">vec</span><span class="o">=</span><span class="n">vec</span><span class="p">,</span><span class="n">found</span><span class="o">=</span><span class="n">found</span><span class="p">)</span>
<a name="ln-7455"></a>
<a name="ln-7456"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_integer_vec_by_path</span>
<a name="ln-7457"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7458"></a>
<a name="ln-7459"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7460"></a><span class="c">!&gt;</span>
<a name="ln-7461"></a><span class="c">!  Get a double value from a [[json_value]].</span>
<a name="ln-7462"></a>
<a name="ln-7463"></a>    <span class="k">subroutine </span><span class="n">json_get_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-7464"></a>
<a name="ln-7465"></a>    <span class="k">implicit none</span>
<a name="ln-7466"></a>
<a name="ln-7467"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7468"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>       <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7469"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>           <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7470"></a>
<a name="ln-7471"></a><span class="k">    value</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-7472"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">return</span>
<a name="ln-7473"></a>
<a name="ln-7474"></a><span class="k">    if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span> <span class="o">==</span> <span class="n">json_double</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7475"></a><span class="k">        value</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">dbl_value</span>
<a name="ln-7476"></a>    <span class="k">else</span>
<a name="ln-7477"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7478"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_double:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7479"></a>                                      <span class="s1">&#39; Unable to resolve value to double: &#39;</span><span class="o">//</span><span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7480"></a>        <span class="k">else</span>
<a name="ln-7481"></a>            <span class="c">!type conversions</span>
<a name="ln-7482"></a>            <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7483"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
<a name="ln-7484"></a>                <span class="k">value</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">int_value</span>
<a name="ln-7485"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
<a name="ln-7486"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7487"></a><span class="k">                    value</span> <span class="o">=</span> <span class="mf">1.0_RK</span>
<a name="ln-7488"></a>                <span class="k">else</span>
<a name="ln-7489"></a><span class="k">                    value</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-7490"></a>                <span class="k">end if</span>
<a name="ln-7491"></a><span class="k">            case </span><span class="n">default</span>
<a name="ln-7492"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_double:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7493"></a>                                          <span class="s1">&#39; Unable to resolve value to double: &#39;</span><span class="o">//</span><span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7494"></a>            <span class="k">end select</span>
<a name="ln-7495"></a><span class="k">        end if</span>
<a name="ln-7496"></a><span class="k">    end if</span>
<a name="ln-7497"></a>
<a name="ln-7498"></a><span class="k">    end subroutine </span><span class="n">json_get_double</span>
<a name="ln-7499"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7500"></a>
<a name="ln-7501"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7502"></a><span class="c">!&gt;</span>
<a name="ln-7503"></a><span class="c">!  Get a double value from a [[json_value]], given the path.</span>
<a name="ln-7504"></a>
<a name="ln-7505"></a>    <span class="k">subroutine </span><span class="n">json_get_double_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7506"></a>
<a name="ln-7507"></a>    <span class="k">implicit none</span>
<a name="ln-7508"></a>
<a name="ln-7509"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7510"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7511"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7512"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7513"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7514"></a>
<a name="ln-7515"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7516"></a>
<a name="ln-7517"></a>    <span class="k">value</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a name="ln-7518"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-7519"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7520"></a>        <span class="k">return</span>
<a name="ln-7521"></a><span class="k">    end if</span>
<a name="ln-7522"></a>
<a name="ln-7523"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7524"></a>
<a name="ln-7525"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7526"></a>
<a name="ln-7527"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7528"></a>
<a name="ln-7529"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_double:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7530"></a>                             <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-7531"></a>
<a name="ln-7532"></a>    <span class="k">else</span>
<a name="ln-7533"></a>
<a name="ln-7534"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7535"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7536"></a>
<a name="ln-7537"></a>    <span class="k">end if</span>
<a name="ln-7538"></a>
<a name="ln-7539"></a><span class="k">    if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7540"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7541"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7542"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7543"></a>        <span class="k">end if</span>
<a name="ln-7544"></a><span class="k">    else</span>
<a name="ln-7545"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7546"></a>    <span class="k">end if</span>
<a name="ln-7547"></a>
<a name="ln-7548"></a><span class="k">    end subroutine </span><span class="n">json_get_double_by_path</span>
<a name="ln-7549"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7550"></a>
<a name="ln-7551"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7552"></a><span class="c">!&gt;</span>
<a name="ln-7553"></a><span class="c">!  Alternate version of [[json_get_double_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-7554"></a>
<a name="ln-7555"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_double_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7556"></a>
<a name="ln-7557"></a>    <span class="k">implicit none</span>
<a name="ln-7558"></a>
<a name="ln-7559"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7560"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7561"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7562"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                 <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7563"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7564"></a>
<a name="ln-7565"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-7566"></a>
<a name="ln-7567"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_double_by_path</span>
<a name="ln-7568"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7569"></a>
<a name="ln-7570"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7571"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-7572"></a><span class="c">!  date: 5/14/2014</span>
<a name="ln-7573"></a><span class="c">!</span>
<a name="ln-7574"></a><span class="c">!  Get a double vector from a [[json_value]].</span>
<a name="ln-7575"></a>
<a name="ln-7576"></a>    <span class="k">subroutine </span><span class="n">json_get_double_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7577"></a>
<a name="ln-7578"></a>    <span class="k">implicit none</span>
<a name="ln-7579"></a>
<a name="ln-7580"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7581"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                      <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7582"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7583"></a>
<a name="ln-7584"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span>
<a name="ln-7585"></a>
<a name="ln-7586"></a>    <span class="c">! check for 0-length arrays first:</span>
<a name="ln-7587"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7588"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-7589"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7590"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-7591"></a>            <span class="k">return</span>
<a name="ln-7592"></a><span class="k">        end if</span>
<a name="ln-7593"></a><span class="k">    end select</span>
<a name="ln-7594"></a>
<a name="ln-7595"></a><span class="k">    </span><span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7596"></a>
<a name="ln-7597"></a>    <span class="c">!the callback function is called for each element of the array:</span>
<a name="ln-7598"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_double_from_array</span><span class="p">)</span>
<a name="ln-7599"></a>
<a name="ln-7600"></a>    <span class="k">contains</span>
<a name="ln-7601"></a>
<a name="ln-7602"></a><span class="k">        subroutine </span><span class="n">get_double_from_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-7603"></a>
<a name="ln-7604"></a>        <span class="c">!! callback function for double</span>
<a name="ln-7605"></a>
<a name="ln-7606"></a>        <span class="k">implicit none</span>
<a name="ln-7607"></a>
<a name="ln-7608"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7609"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-7610"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-7611"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-7612"></a>
<a name="ln-7613"></a>        <span class="c">!size the output array:</span>
<a name="ln-7614"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7615"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="nb">count</span><span class="p">))</span>
<a name="ln-7616"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7617"></a>        <span class="k">end if</span>
<a name="ln-7618"></a>
<a name="ln-7619"></a>        <span class="c">!populate the elements:</span>
<a name="ln-7620"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-7621"></a>
<a name="ln-7622"></a>        <span class="k">end subroutine </span><span class="n">get_double_from_array</span>
<a name="ln-7623"></a>
<a name="ln-7624"></a>    <span class="k">end subroutine </span><span class="n">json_get_double_vec</span>
<a name="ln-7625"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7626"></a>
<a name="ln-7627"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7628"></a><span class="c">!&gt;</span>
<a name="ln-7629"></a><span class="c">!  Get a double vector from a [[json_value]], given the path.</span>
<a name="ln-7630"></a>
<a name="ln-7631"></a>    <span class="k">subroutine </span><span class="n">json_get_double_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7632"></a>
<a name="ln-7633"></a>    <span class="k">implicit none</span>
<a name="ln-7634"></a>
<a name="ln-7635"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7636"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7637"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>           <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7638"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7639"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7640"></a>
<a name="ln-7641"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7642"></a>
<a name="ln-7643"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7644"></a>
<a name="ln-7645"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7646"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7647"></a><span class="k">    else</span>
<a name="ln-7648"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7649"></a><span class="k">    end if</span>
<a name="ln-7650"></a>
<a name="ln-7651"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7652"></a>
<a name="ln-7653"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7654"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7655"></a>        <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7656"></a>    <span class="k">end if</span>
<a name="ln-7657"></a>
<a name="ln-7658"></a><span class="k">    end subroutine </span><span class="n">json_get_double_vec_by_path</span>
<a name="ln-7659"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7660"></a>
<a name="ln-7661"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7662"></a><span class="c">!&gt;</span>
<a name="ln-7663"></a><span class="c">!  Alternate version of [[json_get_double_vec_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-7664"></a>
<a name="ln-7665"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_double_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7666"></a>
<a name="ln-7667"></a>    <span class="k">implicit none</span>
<a name="ln-7668"></a>
<a name="ln-7669"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7670"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                      <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7671"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>          <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7672"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7673"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7674"></a>
<a name="ln-7675"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7676"></a>
<a name="ln-7677"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_double_vec_by_path</span>
<a name="ln-7678"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7679"></a>
<a name="ln-7680"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7681"></a><span class="c">!&gt;</span>
<a name="ln-7682"></a><span class="c">!  Get a logical value from a [[json_value]].</span>
<a name="ln-7683"></a>
<a name="ln-7684"></a>    <span class="k">subroutine </span><span class="n">json_get_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-7685"></a>
<a name="ln-7686"></a>    <span class="k">implicit none</span>
<a name="ln-7687"></a>
<a name="ln-7688"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7689"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7690"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7691"></a>
<a name="ln-7692"></a><span class="k">    value</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7693"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">return</span>
<a name="ln-7694"></a>
<a name="ln-7695"></a><span class="k">    if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span> <span class="o">==</span> <span class="n">json_logical</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7696"></a><span class="k">        value</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">log_value</span>
<a name="ln-7697"></a>    <span class="k">else</span>
<a name="ln-7698"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7699"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_logical: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7700"></a>                                      <span class="s1">&#39;Unable to resolve value to logical: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7701"></a>                                      <span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7702"></a>        <span class="k">else</span>
<a name="ln-7703"></a>            <span class="c">!type conversions</span>
<a name="ln-7704"></a>            <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7705"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
<a name="ln-7706"></a>                <span class="k">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">int_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="ln-7707"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-7708"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_logical: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7709"></a>                                          <span class="s1">&#39;Unable to resolve value to logical: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7710"></a>                                          <span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7711"></a>            <span class="k">end select</span>
<a name="ln-7712"></a><span class="k">        end if</span>
<a name="ln-7713"></a><span class="k">    end if</span>
<a name="ln-7714"></a>
<a name="ln-7715"></a><span class="k">    end subroutine </span><span class="n">json_get_logical</span>
<a name="ln-7716"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7717"></a>
<a name="ln-7718"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7719"></a><span class="c">!&gt;</span>
<a name="ln-7720"></a><span class="c">!  Get a logical value from a [[json_value]], given the path.</span>
<a name="ln-7721"></a>
<a name="ln-7722"></a>    <span class="k">subroutine </span><span class="n">json_get_logical_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7723"></a>
<a name="ln-7724"></a>    <span class="k">implicit none</span>
<a name="ln-7725"></a>
<a name="ln-7726"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7727"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7728"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7729"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7730"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7731"></a>
<a name="ln-7732"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7733"></a>
<a name="ln-7734"></a>    <span class="k">value</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7735"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7736"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7737"></a>        <span class="k">return</span>
<a name="ln-7738"></a><span class="k">    end if</span>
<a name="ln-7739"></a>
<a name="ln-7740"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7741"></a>
<a name="ln-7742"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7743"></a>
<a name="ln-7744"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7745"></a>
<a name="ln-7746"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_logical:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7747"></a>                             <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-7748"></a>
<a name="ln-7749"></a>    <span class="k">else</span>
<a name="ln-7750"></a>
<a name="ln-7751"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7752"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-7753"></a>
<a name="ln-7754"></a>    <span class="k">end if</span>
<a name="ln-7755"></a>
<a name="ln-7756"></a><span class="k">    if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7757"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7758"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7759"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7760"></a>        <span class="k">end if</span>
<a name="ln-7761"></a><span class="k">    else</span>
<a name="ln-7762"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7763"></a>    <span class="k">end if</span>
<a name="ln-7764"></a>
<a name="ln-7765"></a><span class="k">    end subroutine </span><span class="n">json_get_logical_by_path</span>
<a name="ln-7766"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7767"></a>
<a name="ln-7768"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7769"></a><span class="c">!&gt;</span>
<a name="ln-7770"></a><span class="c">!  Alternate version of [[json_get_logical_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-7771"></a>
<a name="ln-7772"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_logical_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7773"></a>
<a name="ln-7774"></a>    <span class="k">implicit none</span>
<a name="ln-7775"></a>
<a name="ln-7776"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7777"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7778"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7779"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7780"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7781"></a>
<a name="ln-7782"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-7783"></a>
<a name="ln-7784"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_logical_by_path</span>
<a name="ln-7785"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7786"></a>
<a name="ln-7787"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7788"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-7789"></a><span class="c">!  date: 5/14/2014</span>
<a name="ln-7790"></a><span class="c">!</span>
<a name="ln-7791"></a><span class="c">!  Get a logical vector from [[json_value]].</span>
<a name="ln-7792"></a>
<a name="ln-7793"></a>    <span class="k">subroutine </span><span class="n">json_get_logical_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7794"></a>
<a name="ln-7795"></a>    <span class="k">implicit none</span>
<a name="ln-7796"></a>
<a name="ln-7797"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7798"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7799"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7800"></a>
<a name="ln-7801"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span>
<a name="ln-7802"></a>
<a name="ln-7803"></a>    <span class="c">! check for 0-length arrays first:</span>
<a name="ln-7804"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7805"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-7806"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7807"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-7808"></a>            <span class="k">return</span>
<a name="ln-7809"></a><span class="k">        end if</span>
<a name="ln-7810"></a><span class="k">    end select</span>
<a name="ln-7811"></a>
<a name="ln-7812"></a><span class="k">    </span><span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7813"></a>
<a name="ln-7814"></a>    <span class="c">!the callback function is called for each element of the array:</span>
<a name="ln-7815"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_logical_from_array</span><span class="p">)</span>
<a name="ln-7816"></a>
<a name="ln-7817"></a>    <span class="k">contains</span>
<a name="ln-7818"></a>
<a name="ln-7819"></a><span class="k">        subroutine </span><span class="n">get_logical_from_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-7820"></a>
<a name="ln-7821"></a>        <span class="c">!! callback function for logical</span>
<a name="ln-7822"></a>
<a name="ln-7823"></a>        <span class="k">implicit none</span>
<a name="ln-7824"></a>
<a name="ln-7825"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7826"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-7827"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-7828"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-7829"></a>
<a name="ln-7830"></a>        <span class="c">!size the output array:</span>
<a name="ln-7831"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7832"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="nb">count</span><span class="p">))</span>
<a name="ln-7833"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-7834"></a>        <span class="k">end if</span>
<a name="ln-7835"></a>
<a name="ln-7836"></a>        <span class="c">!populate the elements:</span>
<a name="ln-7837"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a name="ln-7838"></a>
<a name="ln-7839"></a>        <span class="k">end subroutine </span><span class="n">get_logical_from_array</span>
<a name="ln-7840"></a>
<a name="ln-7841"></a>    <span class="k">end subroutine </span><span class="n">json_get_logical_vec</span>
<a name="ln-7842"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7843"></a>
<a name="ln-7844"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7845"></a><span class="c">!&gt;</span>
<a name="ln-7846"></a><span class="c">!  Get a logical vector from a [[json_value]], given the path.</span>
<a name="ln-7847"></a>
<a name="ln-7848"></a>    <span class="k">subroutine </span><span class="n">json_get_logical_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7849"></a>
<a name="ln-7850"></a>    <span class="k">implicit none</span>
<a name="ln-7851"></a>
<a name="ln-7852"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7853"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7854"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7855"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7856"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7857"></a>
<a name="ln-7858"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-7859"></a>
<a name="ln-7860"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7861"></a>
<a name="ln-7862"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7863"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7864"></a><span class="k">    else</span>
<a name="ln-7865"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-7866"></a><span class="k">    end if</span>
<a name="ln-7867"></a>
<a name="ln-7868"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-7869"></a>
<a name="ln-7870"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7871"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-7872"></a>        <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-7873"></a>    <span class="k">end if</span>
<a name="ln-7874"></a>
<a name="ln-7875"></a><span class="k">    end subroutine </span><span class="n">json_get_logical_vec_by_path</span>
<a name="ln-7876"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7877"></a>
<a name="ln-7878"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7879"></a><span class="c">!&gt;</span>
<a name="ln-7880"></a><span class="c">!  Alternate version of [[json_get_logical_vec_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-7881"></a>
<a name="ln-7882"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_logical_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7883"></a>
<a name="ln-7884"></a>    <span class="k">implicit none</span>
<a name="ln-7885"></a>
<a name="ln-7886"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7887"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7888"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">path</span>
<a name="ln-7889"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-7890"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-7891"></a>
<a name="ln-7892"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">vec</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-7893"></a>
<a name="ln-7894"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_logical_vec_by_path</span>
<a name="ln-7895"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7896"></a>
<a name="ln-7897"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7898"></a><span class="c">!&gt;</span>
<a name="ln-7899"></a><span class="c">!  Get a character string from a [[json_value]].</span>
<a name="ln-7900"></a>
<a name="ln-7901"></a>    <span class="k">subroutine </span><span class="n">json_get_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-7902"></a>
<a name="ln-7903"></a>    <span class="k">implicit none</span>
<a name="ln-7904"></a>
<a name="ln-7905"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-7906"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-7907"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>
<a name="ln-7908"></a>
<a name="ln-7909"></a><span class="k">    value</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-7910"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7911"></a>
<a name="ln-7912"></a><span class="k">        if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span> <span class="o">==</span> <span class="n">json_string</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7913"></a>
<a name="ln-7914"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">str_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7915"></a><span class="k">                if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">unescaped_strings</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7916"></a>                    <span class="c">! default: it is stored already unescaped:</span>
<a name="ln-7917"></a>                    <span class="k">value</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">str_value</span>
<a name="ln-7918"></a>                <span class="k">else</span>
<a name="ln-7919"></a>                    <span class="c">! return the escaped version:</span>
<a name="ln-7920"></a>                    <span class="k">call </span><span class="n">escape_string</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">str_value</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">json</span><span class="p">%</span><span class="n">escape_solidus</span><span class="p">)</span>
<a name="ln-7921"></a>                <span class="k">end if</span>
<a name="ln-7922"></a><span class="k">            else</span>
<a name="ln-7923"></a><span class="k">               call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7924"></a>                                         <span class="s1">&#39;me%str_value not allocated&#39;</span><span class="p">)</span>
<a name="ln-7925"></a>            <span class="k">end if</span>
<a name="ln-7926"></a>
<a name="ln-7927"></a><span class="k">        else</span>
<a name="ln-7928"></a>
<a name="ln-7929"></a><span class="k">            if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">strict_type_checking</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7930"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7931"></a>                                          <span class="s1">&#39; Unable to resolve value to string: &#39;</span><span class="o">//</span><span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7932"></a>            <span class="k">else</span>
<a name="ln-7933"></a>
<a name="ln-7934"></a><span class="k">                select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-7935"></a>
<a name="ln-7936"></a>                <span class="k">case</span> <span class="p">(</span><span class="n">json_integer</span><span class="p">)</span>
<a name="ln-7937"></a>
<a name="ln-7938"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">int_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7939"></a><span class="k">                        value</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">max_integer_str_len</span><span class="p">)</span>
<a name="ln-7940"></a>                        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">int_value</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7941"></a>                        <span class="k">value</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7942"></a>                    <span class="k">else</span>
<a name="ln-7943"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7944"></a>                                                  <span class="s1">&#39;me%int_value not allocated&#39;</span><span class="p">)</span>
<a name="ln-7945"></a>                    <span class="k">end if</span>
<a name="ln-7946"></a>
<a name="ln-7947"></a><span class="k">                case</span> <span class="p">(</span><span class="n">json_double</span><span class="p">)</span>
<a name="ln-7948"></a>
<a name="ln-7949"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7950"></a><span class="k">                        value</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">max_numeric_str_len</span><span class="p">)</span>
<a name="ln-7951"></a>                        <span class="k">call </span><span class="n">real_to_string</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">real_fmt</span><span class="p">,&amp;</span>
<a name="ln-7952"></a>                                            <span class="n">json</span><span class="p">%</span><span class="n">compact_real</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7953"></a>                        <span class="k">value</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-7954"></a>                    <span class="k">else</span>
<a name="ln-7955"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in dbl_value: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7956"></a>                                                  <span class="s1">&#39;me%int_value not allocated&#39;</span><span class="p">)</span>
<a name="ln-7957"></a>                    <span class="k">end if</span>
<a name="ln-7958"></a>
<a name="ln-7959"></a><span class="k">                case</span> <span class="p">(</span><span class="n">json_logical</span><span class="p">)</span>
<a name="ln-7960"></a>
<a name="ln-7961"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">log_value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-7962"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-7963"></a><span class="k">                            value</span> <span class="o">=</span> <span class="n">true_str</span>
<a name="ln-7964"></a>                        <span class="k">else</span>
<a name="ln-7965"></a><span class="k">                            value</span> <span class="o">=</span> <span class="n">false_str</span>
<a name="ln-7966"></a>                        <span class="k">end if</span>
<a name="ln-7967"></a><span class="k">                    else</span>
<a name="ln-7968"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7969"></a>                                                  <span class="s1">&#39;me%log_value not allocated&#39;</span><span class="p">)</span>
<a name="ln-7970"></a>                    <span class="k">end if</span>
<a name="ln-7971"></a>
<a name="ln-7972"></a><span class="k">                case</span> <span class="p">(</span><span class="n">json_null</span><span class="p">)</span>
<a name="ln-7973"></a>
<a name="ln-7974"></a>                    <span class="k">value</span> <span class="o">=</span> <span class="n">null_str</span>
<a name="ln-7975"></a>
<a name="ln-7976"></a>                <span class="k">case </span><span class="n">default</span>
<a name="ln-7977"></a>
<a name="ln-7978"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7979"></a>                                              <span class="s1">&#39;Unable to resolve value to characters: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-7980"></a>                                              <span class="n">me</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-7981"></a>
<a name="ln-7982"></a>                <span class="k">end select</span>
<a name="ln-7983"></a>
<a name="ln-7984"></a><span class="k">            end if</span>
<a name="ln-7985"></a><span class="k">        end if</span>
<a name="ln-7986"></a>
<a name="ln-7987"></a><span class="k">    end if</span>
<a name="ln-7988"></a>
<a name="ln-7989"></a><span class="k">    end subroutine </span><span class="n">json_get_string</span>
<a name="ln-7990"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7991"></a>
<a name="ln-7992"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-7993"></a><span class="c">!&gt;</span>
<a name="ln-7994"></a><span class="c">!  Get a character string from a [[json_value]], given the path.</span>
<a name="ln-7995"></a>
<a name="ln-7996"></a>    <span class="k">subroutine </span><span class="n">json_get_string_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-7997"></a>
<a name="ln-7998"></a>    <span class="k">implicit none</span>
<a name="ln-7999"></a>
<a name="ln-8000"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8001"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8002"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8003"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>
<a name="ln-8004"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8005"></a>
<a name="ln-8006"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8007"></a>
<a name="ln-8008"></a>    <span class="k">value</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8009"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-8010"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8011"></a>        <span class="k">return</span>
<a name="ln-8012"></a><span class="k">    end if</span>
<a name="ln-8013"></a>
<a name="ln-8014"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8015"></a>
<a name="ln-8016"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8017"></a>
<a name="ln-8018"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8019"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_string_by_path:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8020"></a>                                  <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-8021"></a>
<a name="ln-8022"></a>    <span class="k">else</span>
<a name="ln-8023"></a>
<a name="ln-8024"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="k">value</span><span class="p">)</span>
<a name="ln-8025"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8026"></a>
<a name="ln-8027"></a>    <span class="k">end if</span>
<a name="ln-8028"></a>
<a name="ln-8029"></a><span class="k">    if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="k">value</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8030"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-8031"></a>    <span class="k">else</span>
<a name="ln-8032"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8033"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8034"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-8035"></a>        <span class="k">end if</span>
<a name="ln-8036"></a><span class="k">    end if</span>
<a name="ln-8037"></a>
<a name="ln-8038"></a>    <span class="c">!cleanup:</span>
<a name="ln-8039"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8040"></a>
<a name="ln-8041"></a>    <span class="k">end subroutine </span><span class="n">json_get_string_by_path</span>
<a name="ln-8042"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8043"></a>
<a name="ln-8044"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8045"></a><span class="c">!&gt;</span>
<a name="ln-8046"></a><span class="c">!  Alternate version of [[json_get_string_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-8047"></a>
<a name="ln-8048"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_string_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="k">value</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8049"></a>
<a name="ln-8050"></a>    <span class="k">implicit none</span>
<a name="ln-8051"></a>
<a name="ln-8052"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8053"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8054"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8055"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="k">value</span>
<a name="ln-8056"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8057"></a>
<a name="ln-8058"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="k">value</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-8059"></a>
<a name="ln-8060"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_string_by_path</span>
<a name="ln-8061"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8062"></a>
<a name="ln-8063"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8064"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8065"></a><span class="c">!  date: 5/14/2014</span>
<a name="ln-8066"></a><span class="c">!</span>
<a name="ln-8067"></a><span class="c">!  Get a string vector from a [[json_value(type)]].</span>
<a name="ln-8068"></a>
<a name="ln-8069"></a>    <span class="k">subroutine </span><span class="n">json_get_string_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-8070"></a>
<a name="ln-8071"></a>    <span class="k">implicit none</span>
<a name="ln-8072"></a>
<a name="ln-8073"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8074"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8075"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8076"></a>
<a name="ln-8077"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span>
<a name="ln-8078"></a>
<a name="ln-8079"></a>    <span class="c">! check for 0-length arrays first:</span>
<a name="ln-8080"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-8081"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-8082"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8083"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-8084"></a>            <span class="k">return</span>
<a name="ln-8085"></a><span class="k">        end if</span>
<a name="ln-8086"></a><span class="k">    end select</span>
<a name="ln-8087"></a>
<a name="ln-8088"></a><span class="k">    </span><span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8089"></a>
<a name="ln-8090"></a>    <span class="c">!the callback function is called for each element of the array:</span>
<a name="ln-8091"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_chars_from_array</span><span class="p">)</span>
<a name="ln-8092"></a>
<a name="ln-8093"></a>    <span class="k">contains</span>
<a name="ln-8094"></a>
<a name="ln-8095"></a><span class="k">        subroutine </span><span class="n">get_chars_from_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-8096"></a>
<a name="ln-8097"></a>        <span class="c">!! callback function for chars</span>
<a name="ln-8098"></a>
<a name="ln-8099"></a>        <span class="k">implicit none</span>
<a name="ln-8100"></a>
<a name="ln-8101"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8102"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-8103"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-8104"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-8105"></a>
<a name="ln-8106"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">cval</span>
<a name="ln-8107"></a>
<a name="ln-8108"></a>        <span class="c">!size the output array:</span>
<a name="ln-8109"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8110"></a><span class="k">            allocate</span><span class="p">(</span><span class="n">vec</span><span class="p">(</span><span class="nb">count</span><span class="p">))</span>
<a name="ln-8111"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-8112"></a>        <span class="k">end if</span>
<a name="ln-8113"></a>
<a name="ln-8114"></a>        <span class="c">!populate the elements:</span>
<a name="ln-8115"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-8116"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">cval</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8117"></a><span class="k">            </span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">cval</span>
<a name="ln-8118"></a>            <span class="k">deallocate</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-8119"></a>        <span class="k">else</span>
<a name="ln-8120"></a><span class="k">            </span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8121"></a>        <span class="k">end if</span>
<a name="ln-8122"></a>
<a name="ln-8123"></a><span class="k">        end subroutine </span><span class="n">get_chars_from_array</span>
<a name="ln-8124"></a>
<a name="ln-8125"></a>    <span class="k">end subroutine </span><span class="n">json_get_string_vec</span>
<a name="ln-8126"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8127"></a>
<a name="ln-8128"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8129"></a><span class="c">!&gt;</span>
<a name="ln-8130"></a><span class="c">!  Get a string vector from a [[json_value(type)]], given the path.</span>
<a name="ln-8131"></a>
<a name="ln-8132"></a>    <span class="k">subroutine </span><span class="n">json_get_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8133"></a>
<a name="ln-8134"></a>    <span class="k">implicit none</span>
<a name="ln-8135"></a>
<a name="ln-8136"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8137"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8138"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8139"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8140"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8141"></a>
<a name="ln-8142"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8143"></a>
<a name="ln-8144"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8145"></a>
<a name="ln-8146"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8147"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8148"></a><span class="k">    else</span>
<a name="ln-8149"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8150"></a><span class="k">    end if</span>
<a name="ln-8151"></a>
<a name="ln-8152"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
<a name="ln-8153"></a>
<a name="ln-8154"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8155"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-8156"></a>        <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8157"></a>    <span class="k">end if</span>
<a name="ln-8158"></a>
<a name="ln-8159"></a><span class="k">    end subroutine </span><span class="n">json_get_string_vec_by_path</span>
<a name="ln-8160"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8161"></a>
<a name="ln-8162"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8163"></a><span class="c">!&gt;</span>
<a name="ln-8164"></a><span class="c">!  Alternate version of [[json_get_string_vec_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-8165"></a>
<a name="ln-8166"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8167"></a>
<a name="ln-8168"></a>    <span class="k">implicit none</span>
<a name="ln-8169"></a>
<a name="ln-8170"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                                <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8171"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8172"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                          <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8173"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8174"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>                              <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8175"></a>
<a name="ln-8176"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">vec</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-8177"></a>
<a name="ln-8178"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_string_vec_by_path</span>
<a name="ln-8179"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8180"></a>
<a name="ln-8181"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8182"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8183"></a><span class="c">!  date: 12/16/2016</span>
<a name="ln-8184"></a><span class="c">!</span>
<a name="ln-8185"></a><span class="c">!  Get a string vector from a [[json_value(type)]]. This is an alternate</span>
<a name="ln-8186"></a><span class="c">!  version of [[json_get_string_vec]]. This one returns an allocatable</span>
<a name="ln-8187"></a><span class="c">!  length character (where the string length is the maximum length of</span>
<a name="ln-8188"></a><span class="c">!  any element in the array). It also returns an integer array of the</span>
<a name="ln-8189"></a><span class="c">!  actual sizes of the strings in the JSON structure.</span>
<a name="ln-8190"></a><span class="c">!</span>
<a name="ln-8191"></a><span class="c">!@note This is somewhat inefficient since it does</span>
<a name="ln-8192"></a><span class="c">!      cycle through the array twice.</span>
<a name="ln-8193"></a><span class="c">!</span>
<a name="ln-8194"></a><span class="c">!@warning The allocation of `vec` doesn&#39;t work with</span>
<a name="ln-8195"></a><span class="c">!         gfortran 4.9 or 5 due to compiler bugs</span>
<a name="ln-8196"></a>
<a name="ln-8197"></a>    <span class="k">subroutine </span><span class="n">json_get_alloc_string_vec</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">ilen</span><span class="p">)</span>
<a name="ln-8198"></a>
<a name="ln-8199"></a>    <span class="k">implicit none</span>
<a name="ln-8200"></a>
<a name="ln-8201"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8202"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8203"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8204"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the actual length</span>
<a name="ln-8205"></a>                                                             <span class="c">!! of each character</span>
<a name="ln-8206"></a>                                                             <span class="c">!! string in the array</span>
<a name="ln-8207"></a>
<a name="ln-8208"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">initialized</span> <span class="c">!! if the output array has been sized</span>
<a name="ln-8209"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">max_len</span>     <span class="c">!! the length of the longest string in the array</span>
<a name="ln-8210"></a>
<a name="ln-8211"></a>    <span class="c">! check for 0-length arrays first:</span>
<a name="ln-8212"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-8213"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-8214"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8215"></a><span class="k">            allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-8216"></a>            <span class="k">allocate</span><span class="p">(</span><span class="n">ilen</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a name="ln-8217"></a>            <span class="k">return</span>
<a name="ln-8218"></a><span class="k">        end if</span>
<a name="ln-8219"></a><span class="k">    end select</span>
<a name="ln-8220"></a>
<a name="ln-8221"></a><span class="k">    </span><span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8222"></a>
<a name="ln-8223"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">string_info</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">ilen</span><span class="o">=</span><span class="n">ilen</span><span class="p">,</span><span class="n">max_str_len</span><span class="o">=</span><span class="n">max_len</span><span class="p">)</span>
<a name="ln-8224"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8225"></a>        <span class="c">! now get each string using the callback function:</span>
<a name="ln-8226"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="o">=</span><span class="n">get_chars_from_array</span><span class="p">)</span>
<a name="ln-8227"></a>    <span class="k">end if</span>
<a name="ln-8228"></a>
<a name="ln-8229"></a><span class="k">    contains</span>
<a name="ln-8230"></a>
<a name="ln-8231"></a><span class="k">        subroutine </span><span class="n">get_chars_from_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-8232"></a>
<a name="ln-8233"></a>        <span class="c">!! callback function for chars</span>
<a name="ln-8234"></a>
<a name="ln-8235"></a>        <span class="k">implicit none</span>
<a name="ln-8236"></a>
<a name="ln-8237"></a><span class="k">        class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8238"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-8239"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! index</span>
<a name="ln-8240"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="nb">count</span>    <span class="c">!! size of array</span>
<a name="ln-8241"></a>
<a name="ln-8242"></a>        <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">cval</span>  <span class="c">!! for getting string</span>
<a name="ln-8243"></a>
<a name="ln-8244"></a>        <span class="c">!size the output array:</span>
<a name="ln-8245"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">initialized</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8246"></a>            <span class="c">! string length long enough to hold the longest one</span>
<a name="ln-8247"></a>            <span class="c">! Note that this doesn&#39;t work with gfortran 4.9 or 5.</span>
<a name="ln-8248"></a>            <span class="k">allocate</span><span class="p">(</span> <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span><span class="p">(</span><span class="nb">count</span><span class="p">)</span> <span class="p">)</span>
<a name="ln-8249"></a>            <span class="n">initialized</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-8250"></a>        <span class="k">end if</span>
<a name="ln-8251"></a>
<a name="ln-8252"></a>        <span class="c">!populate the elements:</span>
<a name="ln-8253"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-8254"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">cval</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8255"></a><span class="k">            </span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">cval</span>
<a name="ln-8256"></a>            <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>  <span class="c">! return the actual length</span>
<a name="ln-8257"></a>            <span class="k">deallocate</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span>
<a name="ln-8258"></a>        <span class="k">else</span>
<a name="ln-8259"></a><span class="k">            </span><span class="n">vec</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8260"></a>            <span class="n">ilen</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-8261"></a>        <span class="k">end if</span>
<a name="ln-8262"></a>
<a name="ln-8263"></a><span class="k">        end subroutine </span><span class="n">get_chars_from_array</span>
<a name="ln-8264"></a>
<a name="ln-8265"></a>    <span class="k">end subroutine </span><span class="n">json_get_alloc_string_vec</span>
<a name="ln-8266"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8267"></a>
<a name="ln-8268"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8269"></a><span class="c">!&gt;</span>
<a name="ln-8270"></a><span class="c">!  Alternate version of [[json_get_alloc_string_vec]] where input is the path.</span>
<a name="ln-8271"></a><span class="c">!</span>
<a name="ln-8272"></a><span class="c">!  This is an alternate version of [[json_get_string_vec_by_path]].</span>
<a name="ln-8273"></a><span class="c">!  This one returns an allocatable length character (where the string</span>
<a name="ln-8274"></a><span class="c">!  length is the maximum length of any element in the array). It also</span>
<a name="ln-8275"></a><span class="c">!  returns an integer array of the actual sizes of the strings in the</span>
<a name="ln-8276"></a><span class="c">!  JSON structure.</span>
<a name="ln-8277"></a><span class="c">!</span>
<a name="ln-8278"></a><span class="c">!@note An alternative to using this routine is to use [[json_get_array]] with</span>
<a name="ln-8279"></a><span class="c">!      a callback function that gets the string from each element and populates</span>
<a name="ln-8280"></a><span class="c">!      a user-defined string type.</span>
<a name="ln-8281"></a>
<a name="ln-8282"></a>    <span class="k">subroutine </span><span class="n">json_get_alloc_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">ilen</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8283"></a>
<a name="ln-8284"></a>    <span class="k">implicit none</span>
<a name="ln-8285"></a>
<a name="ln-8286"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8287"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8288"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8289"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8290"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the actual length</span>
<a name="ln-8291"></a>                                                             <span class="c">!! of each character</span>
<a name="ln-8292"></a>                                                             <span class="c">!! string in the array</span>
<a name="ln-8293"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8294"></a>
<a name="ln-8295"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8296"></a>
<a name="ln-8297"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8298"></a>
<a name="ln-8299"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8300"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">found</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8301"></a><span class="k">    else</span>
<a name="ln-8302"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8303"></a><span class="k">    end if</span>
<a name="ln-8304"></a>
<a name="ln-8305"></a><span class="k">    call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">vec</span><span class="p">,</span> <span class="n">ilen</span><span class="p">)</span>
<a name="ln-8306"></a>
<a name="ln-8307"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8308"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-8309"></a>        <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8310"></a>    <span class="k">end if</span>
<a name="ln-8311"></a>
<a name="ln-8312"></a><span class="k">    end subroutine </span><span class="n">json_get_alloc_string_vec_by_path</span>
<a name="ln-8313"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8314"></a>
<a name="ln-8315"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8316"></a><span class="c">!&gt;</span>
<a name="ln-8317"></a><span class="c">!  Alternate version of [[json_get_alloc_string_vec_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-8318"></a>
<a name="ln-8319"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_alloc_string_vec_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">me</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">vec</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-8320"></a>
<a name="ln-8321"></a>    <span class="k">implicit none</span>
<a name="ln-8322"></a>
<a name="ln-8323"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>        <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8324"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8325"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8326"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">vec</span>
<a name="ln-8327"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen</span> <span class="c">!! the actual length</span>
<a name="ln-8328"></a>                                                             <span class="c">!! of each character</span>
<a name="ln-8329"></a>                                                             <span class="c">!! string in the array</span>
<a name="ln-8330"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8331"></a>
<a name="ln-8332"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span><span class="n">vec</span><span class="p">,</span><span class="n">ilen</span><span class="p">,</span><span class="n">found</span><span class="p">)</span>
<a name="ln-8333"></a>
<a name="ln-8334"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_alloc_string_vec_by_path</span>
<a name="ln-8335"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8336"></a>
<a name="ln-8337"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8338"></a><span class="c">!&gt;</span>
<a name="ln-8339"></a><span class="c">!  This routine calls the user-supplied [[json_array_callback_func]]</span>
<a name="ln-8340"></a><span class="c">!  subroutine for each element in the array.</span>
<a name="ln-8341"></a><span class="c">!</span>
<a name="ln-8342"></a><span class="c">!@note For integer, double, logical, and character arrays,</span>
<a name="ln-8343"></a><span class="c">!      higher-level routines are provided (see `get` methods), so</span>
<a name="ln-8344"></a><span class="c">!      this routine does not have to be used for those cases.</span>
<a name="ln-8345"></a>
<a name="ln-8346"></a>    <span class="k">subroutine </span><span class="n">json_get_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">array_callback</span><span class="p">)</span>
<a name="ln-8347"></a>
<a name="ln-8348"></a>    <span class="k">implicit none</span>
<a name="ln-8349"></a>
<a name="ln-8350"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8351"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8352"></a>    <span class="k">procedure</span><span class="p">(</span><span class="n">json_array_callback_func</span><span class="p">)</span> <span class="kd">::</span> <span class="n">array_callback</span>
<a name="ln-8353"></a>
<a name="ln-8354"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span> <span class="c">!! temp variable for getting elements</span>
<a name="ln-8355"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>      <span class="c">!! counter</span>
<a name="ln-8356"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">count</span>  <span class="c">!! number of elements in the array</span>
<a name="ln-8357"></a>
<a name="ln-8358"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">return</span>
<a name="ln-8359"></a>
<a name="ln-8360"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-8361"></a>
<a name="ln-8362"></a>    <span class="k">select case</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-8363"></a>    <span class="k">case</span> <span class="p">(</span><span class="n">json_array</span><span class="p">)</span>
<a name="ln-8364"></a>        <span class="nb">count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">me</span><span class="p">)</span>
<a name="ln-8365"></a>        <span class="n">element</span> <span class="o">=&gt;</span> <span class="n">me</span><span class="p">%</span><span class="n">children</span>
<a name="ln-8366"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">count</span> <span class="c">! callback for each child</span>
<a name="ln-8367"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8368"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_array: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8369"></a>                                          <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-8370"></a>                <span class="k">return</span>
<a name="ln-8371"></a><span class="k">            end if</span>
<a name="ln-8372"></a><span class="k">            call </span><span class="n">array_callback</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="nb">count</span><span class="p">)</span>
<a name="ln-8373"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-8374"></a><span class="k">            </span><span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-8375"></a>        <span class="k">end do</span>
<a name="ln-8376"></a><span class="k">    case </span><span class="n">default</span>
<a name="ln-8377"></a>
<a name="ln-8378"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_array:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8379"></a>                                  <span class="s1">&#39; Resolved value is not an array &#39;</span><span class="p">)</span>
<a name="ln-8380"></a>
<a name="ln-8381"></a>    <span class="k">end select</span>
<a name="ln-8382"></a>
<a name="ln-8383"></a>    <span class="c">!cleanup:</span>
<a name="ln-8384"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-8385"></a>
<a name="ln-8386"></a>    <span class="k">end subroutine </span><span class="n">json_get_array</span>
<a name="ln-8387"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8388"></a>
<a name="ln-8389"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8390"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8391"></a><span class="c">!  date: 4/28/2016</span>
<a name="ln-8392"></a><span class="c">!</span>
<a name="ln-8393"></a><span class="c">!  Traverse a JSON structure.</span>
<a name="ln-8394"></a><span class="c">!  This routine calls the user-specified [[json_traverse_callback_func]]</span>
<a name="ln-8395"></a><span class="c">!  for each element of the structure.</span>
<a name="ln-8396"></a>
<a name="ln-8397"></a>    <span class="k">subroutine </span><span class="n">json_traverse</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">traverse_callback</span><span class="p">)</span>
<a name="ln-8398"></a>
<a name="ln-8399"></a>    <span class="k">implicit none</span>
<a name="ln-8400"></a>
<a name="ln-8401"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>         <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8402"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>    <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8403"></a>    <span class="k">procedure</span><span class="p">(</span><span class="n">json_traverse_callback_func</span><span class="p">)</span> <span class="kd">::</span> <span class="n">traverse_callback</span>
<a name="ln-8404"></a>
<a name="ln-8405"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">finished</span> <span class="c">!! can be used to stop the process</span>
<a name="ln-8406"></a>
<a name="ln-8407"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">call </span><span class="n">traverse</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8408"></a>
<a name="ln-8409"></a>    <span class="k">contains</span>
<a name="ln-8410"></a>
<a name="ln-8411"></a><span class="k">        recursive subroutine </span><span class="n">traverse</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8412"></a>
<a name="ln-8413"></a>        <span class="c">!! recursive [[json_value]] traversal.</span>
<a name="ln-8414"></a>
<a name="ln-8415"></a>        <span class="k">implicit none</span>
<a name="ln-8416"></a>
<a name="ln-8417"></a><span class="k">        type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8418"></a>
<a name="ln-8419"></a>        <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span>  <span class="c">!! a child element</span>
<a name="ln-8420"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>        <span class="c">!! counter</span>
<a name="ln-8421"></a>        <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">icount</span>   <span class="c">!! number of children</span>
<a name="ln-8422"></a>
<a name="ln-8423"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8424"></a><span class="k">        call </span><span class="n">traverse_callback</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">finished</span><span class="p">)</span> <span class="c">! first call for this object</span>
<a name="ln-8425"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-8426"></a>
<a name="ln-8427"></a>        <span class="c">!for arrays and objects, have to also call for all children:</span>
<a name="ln-8428"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_array</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">p</span><span class="p">%</span><span class="n">var_type</span><span class="o">==</span><span class="n">json_object</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8429"></a>
<a name="ln-8430"></a><span class="k">            </span><span class="n">icount</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="nb">count</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="c">! number of children</span>
<a name="ln-8431"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">icount</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8432"></a><span class="k">                </span><span class="n">element</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="p">%</span><span class="n">children</span>   <span class="c">! first one</span>
<a name="ln-8433"></a>                <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">icount</span>        <span class="c">! call for each child</span>
<a name="ln-8434"></a>                    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8435"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_traverse: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8436"></a>                                                  <span class="s1">&#39;Malformed JSON linked list&#39;</span><span class="p">)</span>
<a name="ln-8437"></a>                        <span class="k">return</span>
<a name="ln-8438"></a><span class="k">                    end if</span>
<a name="ln-8439"></a><span class="k">                    call </span><span class="n">traverse</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-8440"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">finished</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-8441"></a><span class="k">                    </span><span class="n">element</span> <span class="o">=&gt;</span> <span class="n">element</span><span class="p">%</span><span class="n">next</span>
<a name="ln-8442"></a>                <span class="k">end do</span>
<a name="ln-8443"></a><span class="k">            end if</span>
<a name="ln-8444"></a><span class="k">            nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-8445"></a>
<a name="ln-8446"></a>        <span class="k">end if</span>
<a name="ln-8447"></a>
<a name="ln-8448"></a><span class="k">        end subroutine </span><span class="n">traverse</span>
<a name="ln-8449"></a>
<a name="ln-8450"></a>    <span class="k">end subroutine </span><span class="n">json_traverse</span>
<a name="ln-8451"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8452"></a>
<a name="ln-8453"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8454"></a><span class="c">!&gt;</span>
<a name="ln-8455"></a><span class="c">!  This routine calls the user-supplied array_callback subroutine</span>
<a name="ln-8456"></a><span class="c">!  for each element in the array (specified by the path).</span>
<a name="ln-8457"></a>
<a name="ln-8458"></a>    <span class="k">subroutine </span><span class="n">json_get_array_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">array_callback</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8459"></a>
<a name="ln-8460"></a>    <span class="k">implicit none</span>
<a name="ln-8461"></a>
<a name="ln-8462"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8463"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8464"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8465"></a>    <span class="k">procedure</span><span class="p">(</span><span class="n">json_array_callback_func</span><span class="p">)</span> <span class="kd">::</span> <span class="n">array_callback</span>
<a name="ln-8466"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>    <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8467"></a>
<a name="ln-8468"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">p</span>
<a name="ln-8469"></a>
<a name="ln-8470"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-8471"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8472"></a>        <span class="k">return</span>
<a name="ln-8473"></a><span class="k">    end if</span>
<a name="ln-8474"></a>
<a name="ln-8475"></a><span class="k">    nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8476"></a>
<a name="ln-8477"></a>    <span class="c">! resolve the path to the value</span>
<a name="ln-8478"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8479"></a>
<a name="ln-8480"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8481"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_get_array:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8482"></a>             <span class="s1">&#39; Unable to resolve path: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
<a name="ln-8483"></a>    <span class="k">else</span>
<a name="ln-8484"></a><span class="k">       call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">array_callback</span><span class="o">=</span><span class="n">array_callback</span><span class="p">)</span>
<a name="ln-8485"></a>       <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8486"></a>    <span class="k">end if</span>
<a name="ln-8487"></a><span class="k">    if</span> <span class="p">(</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-8488"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-8489"></a><span class="k">            </span><span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-8490"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-8491"></a>        <span class="k">end if</span>
<a name="ln-8492"></a><span class="k">    else</span>
<a name="ln-8493"></a><span class="k">        if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">found</span><span class="p">)</span> <span class="p">)</span> <span class="n">found</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-8494"></a>    <span class="k">end if</span>
<a name="ln-8495"></a>
<a name="ln-8496"></a><span class="k">    end subroutine </span><span class="n">json_get_array_by_path</span>
<a name="ln-8497"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8498"></a>
<a name="ln-8499"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8500"></a><span class="c">!&gt;</span>
<a name="ln-8501"></a><span class="c">!  Alternate version of [[json_get_array_by_path]], where &quot;path&quot; is kind=CDK</span>
<a name="ln-8502"></a>
<a name="ln-8503"></a>    <span class="k">subroutine </span><span class="n">wrap_json_get_array_by_path</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">me</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">array_callback</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8504"></a>
<a name="ln-8505"></a>    <span class="k">implicit none</span>
<a name="ln-8506"></a>
<a name="ln-8507"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8508"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">me</span>
<a name="ln-8509"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">path</span>
<a name="ln-8510"></a>    <span class="k">procedure</span><span class="p">(</span><span class="n">json_array_callback_func</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">array_callback</span>
<a name="ln-8511"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">found</span>
<a name="ln-8512"></a>
<a name="ln-8513"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">get</span><span class="p">(</span><span class="n">me</span><span class="p">,</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">array_callback</span><span class="p">,</span> <span class="n">found</span><span class="p">)</span>
<a name="ln-8514"></a>
<a name="ln-8515"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_get_array_by_path</span>
<a name="ln-8516"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8517"></a>
<a name="ln-8518"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8519"></a><span class="c">!&gt;</span>
<a name="ln-8520"></a><span class="c">!  Parse the JSON file and populate the [[json_value]] tree.</span>
<a name="ln-8521"></a><span class="c">!</span>
<a name="ln-8522"></a><span class="c">!### Inputs</span>
<a name="ln-8523"></a><span class="c">!</span>
<a name="ln-8524"></a><span class="c">!  The inputs can be:</span>
<a name="ln-8525"></a><span class="c">!</span>
<a name="ln-8526"></a><span class="c">!  * `file` &amp; `unit` : the specified unit is used to read JSON from file.</span>
<a name="ln-8527"></a><span class="c">!                      [note if unit is already open, then the filename is ignored]</span>
<a name="ln-8528"></a><span class="c">!  * `file`          : JSON is read from file using internal unit number</span>
<a name="ln-8529"></a><span class="c">!</span>
<a name="ln-8530"></a><span class="c">!### Example</span>
<a name="ln-8531"></a><span class="c">!</span>
<a name="ln-8532"></a><span class="c">!````fortran</span>
<a name="ln-8533"></a><span class="c">!    type(json_core) :: json</span>
<a name="ln-8534"></a><span class="c">!    type(json_value),pointer :: p</span>
<a name="ln-8535"></a><span class="c">!    call json%parse(file=&#39;myfile.json&#39;, p=p)</span>
<a name="ln-8536"></a><span class="c">!````</span>
<a name="ln-8537"></a><span class="c">!</span>
<a name="ln-8538"></a><span class="c">!### History</span>
<a name="ln-8539"></a><span class="c">!  * Jacob Williams : 01/13/2015 : added read from string option.</span>
<a name="ln-8540"></a><span class="c">!  * Izaak Beekman  : 03/08/2015 : moved read from string to separate</span>
<a name="ln-8541"></a><span class="c">!    subroutine, and error annotation to separate subroutine.</span>
<a name="ln-8542"></a><span class="c">!</span>
<a name="ln-8543"></a><span class="c">!@note When calling this routine, any exceptions thrown from previous</span>
<a name="ln-8544"></a><span class="c">!      calls will automatically be cleared.</span>
<a name="ln-8545"></a>
<a name="ln-8546"></a>    <span class="k">subroutine </span><span class="n">json_parse_file</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="k">file</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
<a name="ln-8547"></a>
<a name="ln-8548"></a>    <span class="k">implicit none</span>
<a name="ln-8549"></a>
<a name="ln-8550"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8551"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="k">file</span>  <span class="c">!! JSON file name</span>
<a name="ln-8552"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>     <span class="c">!! output structure</span>
<a name="ln-8553"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">unit</span>  <span class="c">!! file unit number (/= 0)</span>
<a name="ln-8554"></a>
<a name="ln-8555"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">iunit</span>   <span class="c">!! file unit actually used</span>
<a name="ln-8556"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span>   <span class="c">!! iostat flag</span>
<a name="ln-8557"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">is_open</span> <span class="c">!! if the file is already open</span>
<a name="ln-8558"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span>  <span class="c">!! if checking for duplicate keys</span>
<a name="ln-8559"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">path</span> <span class="c">!! path to any duplicate key</span>
<a name="ln-8560"></a>
<a name="ln-8561"></a>    <span class="c">!clear any exceptions and initialize:</span>
<a name="ln-8562"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">initialize</span><span class="p">()</span>
<a name="ln-8563"></a>
<a name="ln-8564"></a>    <span class="k">if</span> <span class="p">(</span> <span class="nb">present</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-8565"></a>
<a name="ln-8566"></a><span class="k">        if</span> <span class="p">(</span><span class="n">unit</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8567"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_parse_file: unit number must not be 0.&#39;</span><span class="p">)</span>
<a name="ln-8568"></a>            <span class="k">return</span>
<a name="ln-8569"></a><span class="k">        end if</span>
<a name="ln-8570"></a>
<a name="ln-8571"></a><span class="k">        </span><span class="n">iunit</span> <span class="o">=</span> <span class="n">unit</span>
<a name="ln-8572"></a>
<a name="ln-8573"></a>        <span class="c">!check to see if the file is already open</span>
<a name="ln-8574"></a>        <span class="c">! if it is, then use it, otherwise open the file with the name given.</span>
<a name="ln-8575"></a>        <span class="k">inquire</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">opened</span><span class="o">=</span><span class="n">is_open</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span>
<a name="ln-8576"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">is_open</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8577"></a>           <span class="c">! open the file</span>
<a name="ln-8578"></a>            <span class="k">open</span> <span class="p">(</span>  <span class="n">unit</span>        <span class="o">=</span> <span class="n">iunit</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8579"></a>                    <span class="k">file</span>        <span class="o">=</span> <span class="k">file</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8580"></a>                    <span class="n">status</span>      <span class="o">=</span> <span class="s1">&#39;OLD&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8581"></a>                    <span class="n">action</span>      <span class="o">=</span> <span class="s1">&#39;READ&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8582"></a>                    <span class="n">form</span>        <span class="o">=</span> <span class="n">form_spec</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8583"></a>                    <span class="nb">access</span>      <span class="o">=</span> <span class="n">access_spec</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8584"></a>                    <span class="n">iostat</span>      <span class="o">=</span> <span class="n">istat</span> <span class="p">&amp;</span>
<a name="ln-8585"></a>                    <span class="n">FILE_ENCODING</span> <span class="p">)</span>
<a name="ln-8586"></a>        <span class="k">else</span>
<a name="ln-8587"></a>            <span class="c">!if the file is already open, then we need to make sure</span>
<a name="ln-8588"></a>            <span class="c">! that it is open with the correct form/access/etc...</span>
<a name="ln-8589"></a>        <span class="k">end if</span>
<a name="ln-8590"></a>
<a name="ln-8591"></a><span class="k">    else</span>
<a name="ln-8592"></a>
<a name="ln-8593"></a>        <span class="c">! open the file with a new unit number:</span>
<a name="ln-8594"></a>        <span class="k">open</span> <span class="p">(</span>  <span class="n">newunit</span>     <span class="o">=</span> <span class="n">iunit</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8595"></a>                <span class="k">file</span>        <span class="o">=</span> <span class="k">file</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8596"></a>                <span class="n">status</span>      <span class="o">=</span> <span class="s1">&#39;OLD&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8597"></a>                <span class="n">action</span>      <span class="o">=</span> <span class="s1">&#39;READ&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8598"></a>                <span class="n">form</span>        <span class="o">=</span> <span class="n">form_spec</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8599"></a>                <span class="nb">access</span>      <span class="o">=</span> <span class="n">access_spec</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-8600"></a>                <span class="n">iostat</span>      <span class="o">=</span> <span class="n">istat</span> <span class="p">&amp;</span>
<a name="ln-8601"></a>                <span class="n">FILE_ENCODING</span> <span class="p">)</span>
<a name="ln-8602"></a>
<a name="ln-8603"></a>    <span class="k">end if</span>
<a name="ln-8604"></a>
<a name="ln-8605"></a><span class="k">    if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8606"></a>
<a name="ln-8607"></a>        <span class="c">! create the value and associate the pointer</span>
<a name="ln-8608"></a>        <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8609"></a>
<a name="ln-8610"></a>        <span class="c">! Note: the name of the root json_value doesn&#39;t really matter,</span>
<a name="ln-8611"></a>        <span class="c">!  but we&#39;ll allocate something here just in case.</span>
<a name="ln-8612"></a>        <span class="n">p</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="k">file</span><span class="p">)</span>  <span class="c">!use the file name</span>
<a name="ln-8613"></a>
<a name="ln-8614"></a>        <span class="c">! parse as a value</span>
<a name="ln-8615"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_value</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8616"></a>
<a name="ln-8617"></a>        <span class="c">! close the file if necessary</span>
<a name="ln-8618"></a>        <span class="k">close</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span>
<a name="ln-8619"></a>
<a name="ln-8620"></a>        <span class="c">! check for errors:</span>
<a name="ln-8621"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8622"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">annotate_invalid_json</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a name="ln-8623"></a>        <span class="k">else</span>
<a name="ln-8624"></a><span class="k">            if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">allow_duplicate_keys</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8625"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
<a name="ln-8626"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8627"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">has_duplicate</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8628"></a><span class="k">                        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_parse_file: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8629"></a>                                                  <span class="s1">&#39;Duplicate key found: &#39;</span><span class="o">//</span><span class="n">path</span><span class="p">)</span>
<a name="ln-8630"></a>                    <span class="k">end if</span>
<a name="ln-8631"></a><span class="k">                end if</span>
<a name="ln-8632"></a><span class="k">            end if</span>
<a name="ln-8633"></a><span class="k">        end if</span>
<a name="ln-8634"></a>
<a name="ln-8635"></a><span class="k">    else</span>
<a name="ln-8636"></a>
<a name="ln-8637"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_parse_file: Error opening file: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="k">file</span><span class="p">))</span>
<a name="ln-8638"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8639"></a>
<a name="ln-8640"></a>    <span class="k">end if</span>
<a name="ln-8641"></a>
<a name="ln-8642"></a><span class="k">    end subroutine </span><span class="n">json_parse_file</span>
<a name="ln-8643"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8644"></a>
<a name="ln-8645"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8646"></a><span class="c">!&gt;</span>
<a name="ln-8647"></a><span class="c">!  Parse the JSON string and populate the [[json_value]] tree.</span>
<a name="ln-8648"></a><span class="c">!</span>
<a name="ln-8649"></a><span class="c">!### See also</span>
<a name="ln-8650"></a><span class="c">!  * [[json_parse_file]]</span>
<a name="ln-8651"></a>
<a name="ln-8652"></a>    <span class="k">subroutine </span><span class="n">json_parse_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
<a name="ln-8653"></a>
<a name="ln-8654"></a>    <span class="k">implicit none</span>
<a name="ln-8655"></a>
<a name="ln-8656"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8657"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>     <span class="c">!! output structure</span>
<a name="ln-8658"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>   <span class="c">!! string with JSON data</span>
<a name="ln-8659"></a>
<a name="ln-8660"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">iunit</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">!! indicates that json data will be read from buffer</span>
<a name="ln-8661"></a>
<a name="ln-8662"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">has_duplicate</span>  <span class="c">!! if checking for duplicate keys</span>
<a name="ln-8663"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">path</span> <span class="c">!! path to any duplicate key</span>
<a name="ln-8664"></a>
<a name="ln-8665"></a>    <span class="c">!clear any exceptions and initialize:</span>
<a name="ln-8666"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">initialize</span><span class="p">()</span>
<a name="ln-8667"></a>
<a name="ln-8668"></a>    <span class="c">! create the value and associate the pointer</span>
<a name="ln-8669"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8670"></a>
<a name="ln-8671"></a>    <span class="c">! Note: the name of the root json_value doesn&#39;t really matter,</span>
<a name="ln-8672"></a>    <span class="c">!  but we&#39;ll allocate something here just in case.</span>
<a name="ln-8673"></a>    <span class="n">p</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8674"></a>
<a name="ln-8675"></a>    <span class="c">! parse as a value</span>
<a name="ln-8676"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_value</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">iunit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
<a name="ln-8677"></a>
<a name="ln-8678"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8679"></a><span class="k">        call </span><span class="n">json</span><span class="p">%</span><span class="n">annotate_invalid_json</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a name="ln-8680"></a>    <span class="k">else</span>
<a name="ln-8681"></a><span class="k">        if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">allow_duplicate_keys</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8682"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_duplicate_keys</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">has_duplicate</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
<a name="ln-8683"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8684"></a><span class="k">                if</span> <span class="p">(</span><span class="n">has_duplicate</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8685"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in json_parse_string: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8686"></a>                                              <span class="s1">&#39;Duplicate key found: &#39;</span><span class="o">//</span><span class="n">path</span><span class="p">)</span>
<a name="ln-8687"></a>                <span class="k">end if</span>
<a name="ln-8688"></a><span class="k">            end if</span>
<a name="ln-8689"></a><span class="k">        end if</span>
<a name="ln-8690"></a><span class="k">    end if</span>
<a name="ln-8691"></a>
<a name="ln-8692"></a><span class="k">    end subroutine </span><span class="n">json_parse_string</span>
<a name="ln-8693"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8694"></a>
<a name="ln-8695"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8696"></a><span class="c">!&gt;</span>
<a name="ln-8697"></a><span class="c">!  Alternate version of [[json_parse_string]], where `str` is kind=CDK.</span>
<a name="ln-8698"></a>
<a name="ln-8699"></a>    <span class="k">subroutine </span><span class="n">wrap_json_parse_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
<a name="ln-8700"></a>
<a name="ln-8701"></a>    <span class="k">implicit none</span>
<a name="ln-8702"></a>
<a name="ln-8703"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8704"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>     <span class="c">!! output structure</span>
<a name="ln-8705"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>   <span class="c">!! string with JSON data</span>
<a name="ln-8706"></a>
<a name="ln-8707"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a name="ln-8708"></a>
<a name="ln-8709"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_parse_string</span>
<a name="ln-8710"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8711"></a>
<a name="ln-8712"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8713"></a><span class="c">!&gt;</span>
<a name="ln-8714"></a><span class="c">!  Generate a warning message if there was an error parsing a JSON</span>
<a name="ln-8715"></a><span class="c">!  file or string.</span>
<a name="ln-8716"></a>
<a name="ln-8717"></a>    <span class="k">subroutine </span><span class="n">annotate_invalid_json</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">iunit</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a name="ln-8718"></a>
<a name="ln-8719"></a>    <span class="k">implicit none</span>
<a name="ln-8720"></a>
<a name="ln-8721"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8722"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">iunit</span> <span class="c">!! file unit number</span>
<a name="ln-8723"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>   <span class="c">!! string with JSON data</span>
<a name="ln-8724"></a>
<a name="ln-8725"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">line</span><span class="p">,</span> <span class="n">arrow_str</span>
<a name="ln-8726"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line_str</span><span class="p">,</span> <span class="n">char_str</span>
<a name="ln-8727"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">i_nl_prev</span><span class="p">,</span> <span class="n">i_nl</span>
<a name="ln-8728"></a>
<a name="ln-8729"></a>    <span class="c">!  If there was an error reading the file, then</span>
<a name="ln-8730"></a>    <span class="c">!   print the line where the error occurred:</span>
<a name="ln-8731"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8732"></a>
<a name="ln-8733"></a>        <span class="c">!the counters for the current line and the last character read:</span>
<a name="ln-8734"></a>        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">line_count</span><span class="p">,</span> <span class="n">int_fmt</span><span class="p">,</span> <span class="n">line_str</span><span class="p">)</span>
<a name="ln-8735"></a>        <span class="k">call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">char_count</span><span class="p">,</span> <span class="n">int_fmt</span><span class="p">,</span> <span class="n">char_str</span><span class="p">)</span>
<a name="ln-8736"></a>
<a name="ln-8737"></a>        <span class="c">!draw the arrow string that points to the current character:</span>
<a name="ln-8738"></a>        <span class="n">arrow_str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span><span class="o">//</span><span class="s1">&#39;^&#39;</span>
<a name="ln-8739"></a>
<a name="ln-8740"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">line_count</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">char_count</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8741"></a>
<a name="ln-8742"></a><span class="k">            if</span> <span class="p">(</span><span class="n">iunit</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8743"></a>
<a name="ln-8744"></a><span class="k">                if</span> <span class="p">(</span><span class="n">use_unformatted_stream</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8745"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">get_current_line_from_file_stream</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
<a name="ln-8746"></a>                <span class="k">else</span>
<a name="ln-8747"></a><span class="k">                    call </span><span class="n">json</span><span class="p">%</span><span class="n">get_current_line_from_file_sequential</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
<a name="ln-8748"></a>                <span class="k">end if</span>
<a name="ln-8749"></a>
<a name="ln-8750"></a><span class="k">            else</span>
<a name="ln-8751"></a>
<a name="ln-8752"></a>                <span class="c">!get the current line from the string:</span>
<a name="ln-8753"></a>                <span class="c">! [this is done by counting the newline characters]</span>
<a name="ln-8754"></a>                <span class="n">i_nl_prev</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!index of previous newline character</span>
<a name="ln-8755"></a>                <span class="n">i_nl</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c">!just in case line_count = 0</span>
<a name="ln-8756"></a>                <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">json</span><span class="p">%</span><span class="n">line_count</span>
<a name="ln-8757"></a>                    <span class="n">i_nl</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">i_nl_prev</span><span class="o">+</span><span class="mi">1</span><span class="p">:),</span><span class="n">newline</span><span class="p">)</span>
<a name="ln-8758"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">i_nl</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>   <span class="c">!last line - no newline character</span>
<a name="ln-8759"></a>                        <span class="n">i_nl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-8760"></a>                        <span class="k">exit</span>
<a name="ln-8761"></a><span class="k">                    end if</span>
<a name="ln-8762"></a><span class="k">                    </span><span class="n">i_nl</span> <span class="o">=</span> <span class="n">i_nl</span> <span class="o">+</span> <span class="n">i_nl_prev</span>   <span class="c">!index of current newline character</span>
<a name="ln-8763"></a>                    <span class="n">i_nl_prev</span> <span class="o">=</span> <span class="n">i_nl</span>          <span class="c">!update for next iteration</span>
<a name="ln-8764"></a>                <span class="k">end do</span>
<a name="ln-8765"></a><span class="k">                </span><span class="n">line</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">i_nl_prev</span><span class="o">+</span><span class="mi">1</span> <span class="p">:</span> <span class="n">i_nl</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c">!extract current line</span>
<a name="ln-8766"></a>
<a name="ln-8767"></a>            <span class="k">end if</span>
<a name="ln-8768"></a>
<a name="ln-8769"></a><span class="k">        else</span>
<a name="ln-8770"></a>            <span class="c">!in this case, it was an empty line or file</span>
<a name="ln-8771"></a>            <span class="n">line</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8772"></a>        <span class="k">end if</span>
<a name="ln-8773"></a>
<a name="ln-8774"></a>        <span class="c">!create the error message:</span>
<a name="ln-8775"></a>        <span class="n">json</span><span class="p">%</span><span class="n">err_message</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">err_message</span><span class="o">//</span><span class="n">newline</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8776"></a>                           <span class="s1">&#39;line: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">line_str</span><span class="p">))</span><span class="o">//</span><span class="s1">&#39;, &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8777"></a>                           <span class="s1">&#39;character: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">char_str</span><span class="p">))</span><span class="o">//</span><span class="n">newline</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8778"></a>                           <span class="nb">trim</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="o">//</span><span class="n">newline</span><span class="o">//</span><span class="n">arrow_str</span>
<a name="ln-8779"></a>
<a name="ln-8780"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">line</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a name="ln-8781"></a>
<a name="ln-8782"></a>    <span class="k">end if</span>
<a name="ln-8783"></a>
<a name="ln-8784"></a><span class="k">    end subroutine </span><span class="n">annotate_invalid_json</span>
<a name="ln-8785"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8786"></a>
<a name="ln-8787"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8788"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8789"></a><span class="c">!</span>
<a name="ln-8790"></a><span class="c">!  Rewind the file to the beginning of the current line, and return this line.</span>
<a name="ln-8791"></a><span class="c">!  The file is assumed to be opened.</span>
<a name="ln-8792"></a><span class="c">!  This is the SEQUENTIAL version (see also [[get_current_line_from_file_stream]]).</span>
<a name="ln-8793"></a>
<a name="ln-8794"></a>    <span class="k">subroutine </span><span class="n">get_current_line_from_file_sequential</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">iunit</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
<a name="ln-8795"></a>
<a name="ln-8796"></a>    <span class="k">implicit none</span>
<a name="ln-8797"></a>
<a name="ln-8798"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8799"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">iunit</span>  <span class="c">!! file unit number</span>
<a name="ln-8800"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span>   <span class="c">!! current line</span>
<a name="ln-8801"></a>
<a name="ln-8802"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">seq_chunk_size</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chunk</span> <span class="c">!! for reading line in chunks</span>
<a name="ln-8803"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span>  <span class="c">!! iostat flag</span>
<a name="ln-8804"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">isize</span>  <span class="c">!! number of characters read in read statement</span>
<a name="ln-8805"></a>
<a name="ln-8806"></a>    <span class="c">!initialize:</span>
<a name="ln-8807"></a>    <span class="n">line</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-8808"></a>
<a name="ln-8809"></a>    <span class="c">!rewind to beginning of the current record:</span>
<a name="ln-8810"></a>    <span class="k">backspace</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span> <span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span>
<a name="ln-8811"></a>
<a name="ln-8812"></a>    <span class="c">!loop to read in all the characters in the current record.</span>
<a name="ln-8813"></a>    <span class="c">![the line is read in chunks until the end of the line is reached]</span>
<a name="ln-8814"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8815"></a><span class="k">        do</span>
<a name="ln-8816"></a><span class="k">            </span><span class="n">isize</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-8817"></a>            <span class="k">read</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;(A)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">isize</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">chunk</span>
<a name="ln-8818"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8819"></a><span class="k">                </span><span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">//</span><span class="n">chunk</span>
<a name="ln-8820"></a>            <span class="k">else</span>
<a name="ln-8821"></a><span class="k">                if</span> <span class="p">(</span><span class="n">isize</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">isize</span><span class="o">&lt;=</span><span class="n">seq_chunk_size</span><span class="p">)</span> <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">//</span><span class="n">chunk</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">isize</span><span class="p">)</span>
<a name="ln-8822"></a>                <span class="k">exit</span>
<a name="ln-8823"></a><span class="k">            end if</span>
<a name="ln-8824"></a><span class="k">        end do</span>
<a name="ln-8825"></a><span class="k">    end if</span>
<a name="ln-8826"></a>
<a name="ln-8827"></a><span class="k">    end subroutine </span><span class="n">get_current_line_from_file_sequential</span>
<a name="ln-8828"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8829"></a>
<a name="ln-8830"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8831"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8832"></a><span class="c">!</span>
<a name="ln-8833"></a><span class="c">!  Rewind the file to the beginning of the current line, and return this line.</span>
<a name="ln-8834"></a><span class="c">!  The file is assumed to be opened.</span>
<a name="ln-8835"></a><span class="c">!  This is the STREAM version (see also [[get_current_line_from_file_sequential]]).</span>
<a name="ln-8836"></a>
<a name="ln-8837"></a>    <span class="k">subroutine </span><span class="n">get_current_line_from_file_stream</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">iunit</span><span class="p">,</span><span class="n">line</span><span class="p">)</span>
<a name="ln-8838"></a>
<a name="ln-8839"></a>    <span class="k">implicit none</span>
<a name="ln-8840"></a>
<a name="ln-8841"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8842"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">iunit</span>  <span class="c">!! file unit number</span>
<a name="ln-8843"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span>   <span class="c">!! current line</span>
<a name="ln-8844"></a>
<a name="ln-8845"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istart</span><span class="p">,</span><span class="n">iend</span><span class="p">,</span><span class="n">ios</span>
<a name="ln-8846"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-8847"></a>
<a name="ln-8848"></a>    <span class="n">istart</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">ipos</span>
<a name="ln-8849"></a>    <span class="k">do</span>
<a name="ln-8850"></a><span class="k">        if</span> <span class="p">(</span><span class="n">istart</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8851"></a><span class="k">            </span><span class="n">istart</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-8852"></a>            <span class="k">exit</span>
<a name="ln-8853"></a><span class="k">        end if</span>
<a name="ln-8854"></a><span class="k">        read</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">istart</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">c</span>
<a name="ln-8855"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">newline</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">ios</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8856"></a><span class="k">            if</span> <span class="p">(</span><span class="n">istart</span><span class="o">/=</span><span class="mi">1</span><span class="p">)</span> <span class="n">istart</span> <span class="o">=</span> <span class="n">istart</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-8857"></a>            <span class="k">exit</span>
<a name="ln-8858"></a><span class="k">        end if</span>
<a name="ln-8859"></a><span class="k">        </span><span class="n">istart</span> <span class="o">=</span> <span class="n">istart</span><span class="o">-</span><span class="mi">1</span>  <span class="c">!rewind until the beginning of the line</span>
<a name="ln-8860"></a>    <span class="k">end do</span>
<a name="ln-8861"></a><span class="k">    </span><span class="n">iend</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">ipos</span>
<a name="ln-8862"></a>    <span class="k">do</span>
<a name="ln-8863"></a><span class="k">        read</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">iend</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">c</span>
<a name="ln-8864"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">newline</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">ios</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-8865"></a><span class="k">        </span><span class="n">iend</span><span class="o">=</span><span class="n">iend</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-8866"></a>    <span class="k">end do</span>
<a name="ln-8867"></a><span class="k">    allocate</span><span class="p">(</span> <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">iend</span><span class="o">-</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">line</span> <span class="p">)</span>
<a name="ln-8868"></a>    <span class="k">read</span><span class="p">(</span><span class="n">iunit</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">istart</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">line</span>
<a name="ln-8869"></a>
<a name="ln-8870"></a>    <span class="k">end subroutine </span><span class="n">get_current_line_from_file_stream</span>
<a name="ln-8871"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8872"></a>
<a name="ln-8873"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8874"></a><span class="c">!&gt;</span>
<a name="ln-8875"></a><span class="c">!  Core parsing routine.</span>
<a name="ln-8876"></a>
<a name="ln-8877"></a>    <span class="k">recursive subroutine </span><span class="n">parse_value</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-8878"></a>
<a name="ln-8879"></a>    <span class="k">implicit none</span>
<a name="ln-8880"></a>
<a name="ln-8881"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-8882"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">unit</span>   <span class="c">!! file unit number</span>
<a name="ln-8883"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! string containing JSON data (only used if unit=0)</span>
<a name="ln-8884"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="k">value</span>  <span class="c">!! JSON data that is extracted</span>
<a name="ln-8885"></a>
<a name="ln-8886"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">eof</span> <span class="c">!! end-of-file flag</span>
<a name="ln-8887"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>   <span class="c">!! character read from file (or string)</span>
<a name="ln-8888"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-8889"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! this is a work-around for a bug</span>
<a name="ln-8890"></a>                                                 <span class="c">!! in the gfortran 4.9 compiler.</span>
<a name="ln-8891"></a><span class="cp">#endif</span>
<a name="ln-8892"></a>
<a name="ln-8893"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8894"></a>
<a name="ln-8895"></a>        <span class="c">!the routine is being called incorrectly.</span>
<a name="ln-8896"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="k">value</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-8897"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_value: value pointer not associated.&#39;</span><span class="p">)</span>
<a name="ln-8898"></a>        <span class="k">end if</span>
<a name="ln-8899"></a>
<a name="ln-8900"></a>        <span class="c">! pop the next non whitespace character off the file</span>
<a name="ln-8901"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="p">&amp;</span>
<a name="ln-8902"></a>                            <span class="n">skip_comments</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">allow_comments</span><span class="p">,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-8903"></a>
<a name="ln-8904"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-8905"></a><span class="k">            return</span>
<a name="ln-8906"></a><span class="k">        else</span>
<a name="ln-8907"></a>
<a name="ln-8908"></a><span class="k">            select case</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-8909"></a>
<a name="ln-8910"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">start_object</span><span class="p">)</span>
<a name="ln-8911"></a>
<a name="ln-8912"></a>                <span class="c">! start object</span>
<a name="ln-8913"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_object</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>    <span class="c">!allocate class</span>
<a name="ln-8914"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_object</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-8915"></a>
<a name="ln-8916"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">start_array</span><span class="p">)</span>
<a name="ln-8917"></a>
<a name="ln-8918"></a>                <span class="c">! start array</span>
<a name="ln-8919"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_array</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>    <span class="c">!allocate class</span>
<a name="ln-8920"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_array</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-8921"></a>
<a name="ln-8922"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">end_array</span><span class="p">)</span>
<a name="ln-8923"></a>
<a name="ln-8924"></a>                <span class="c">! end an empty array</span>
<a name="ln-8925"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">push_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-8926"></a>                <span class="k">nullify</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
<a name="ln-8927"></a>
<a name="ln-8928"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">quotation_mark</span><span class="p">)</span>
<a name="ln-8929"></a>
<a name="ln-8930"></a>                <span class="c">! string</span>
<a name="ln-8931"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_string</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>    <span class="c">!allocate class</span>
<a name="ln-8932"></a>
<a name="ln-8933"></a>                <span class="k">select case</span> <span class="p">(</span><span class="k">value</span><span class="p">%</span><span class="n">var_type</span><span class="p">)</span>
<a name="ln-8934"></a>                <span class="k">case</span> <span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<a name="ln-8935"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-8936"></a>                    <span class="c">! write to a tmp variable because of</span>
<a name="ln-8937"></a>                    <span class="c">! a bug in 4.9 gfortran compiler.</span>
<a name="ln-8938"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_string</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-8939"></a>                    <span class="k">value</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="n">tmp</span>
<a name="ln-8940"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span>  <span class="k">deallocate</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-8941"></a><span class="cp">#else</span>
<a name="ln-8942"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_string</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="k">value</span><span class="p">%</span><span class="n">str_value</span><span class="p">)</span>
<a name="ln-8943"></a><span class="cp">#endif</span>
<a name="ln-8944"></a>                <span class="k">end select</span>
<a name="ln-8945"></a>
<a name="ln-8946"></a><span class="k">            case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;t&#39;</span><span class="p">)</span> <span class="c">!true_str(1:1) gfortran bug work around</span>
<a name="ln-8947"></a>
<a name="ln-8948"></a>                <span class="c">!true</span>
<a name="ln-8949"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_for_chars</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">true_str</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span>
<a name="ln-8950"></a>                <span class="c">!allocate class and set value:</span>
<a name="ln-8951"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_logical</span><span class="p">(</span><span class="k">value</span><span class="p">,.</span><span class="n">true</span><span class="p">.)</span>
<a name="ln-8952"></a>
<a name="ln-8953"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="c">!false_str(1:1) gfortran bug work around</span>
<a name="ln-8954"></a>
<a name="ln-8955"></a>                <span class="c">!false</span>
<a name="ln-8956"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_for_chars</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">false_str</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span>
<a name="ln-8957"></a>                <span class="c">!allocate class and set value:</span>
<a name="ln-8958"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_logical</span><span class="p">(</span><span class="k">value</span><span class="p">,.</span><span class="n">false</span><span class="p">.)</span>
<a name="ln-8959"></a>
<a name="ln-8960"></a>            <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;n&#39;</span><span class="p">)</span> <span class="c">!null_str(1:1) gfortran bug work around</span>
<a name="ln-8961"></a>
<a name="ln-8962"></a>                <span class="c">!null</span>
<a name="ln-8963"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_for_chars</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">null_str</span><span class="p">(</span><span class="mi">2</span><span class="p">:))</span>
<a name="ln-8964"></a>                <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="k">value</span><span class="p">)</span> <span class="c">! allocate class</span>
<a name="ln-8965"></a>
<a name="ln-8966"></a>            <span class="k">case</span><span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="n">CK_</span><span class="s1">&#39;9&#39;</span><span class="p">)</span>
<a name="ln-8967"></a>
<a name="ln-8968"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">push_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-8969"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_number</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-8970"></a>
<a name="ln-8971"></a>            <span class="k">case </span><span class="n">default</span>
<a name="ln-8972"></a>
<a name="ln-8973"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_value:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8974"></a>                                     <span class="s1">&#39; Unexpected character while parsing value. &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-8975"></a>                                     <span class="n">c</span><span class="o">//</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<a name="ln-8976"></a>
<a name="ln-8977"></a>            <span class="k">end select</span>
<a name="ln-8978"></a><span class="k">        end if</span>
<a name="ln-8979"></a>
<a name="ln-8980"></a><span class="k">    end if</span>
<a name="ln-8981"></a>
<a name="ln-8982"></a><span class="k">    end subroutine </span><span class="n">parse_value</span>
<a name="ln-8983"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8984"></a>
<a name="ln-8985"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-8986"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-8987"></a><span class="c">!</span>
<a name="ln-8988"></a><span class="c">!  Allocate a [[json_value]] pointer and make it a logical(LK) variable.</span>
<a name="ln-8989"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-8990"></a><span class="c">!</span>
<a name="ln-8991"></a><span class="c">!### Example</span>
<a name="ln-8992"></a><span class="c">!````fortran</span>
<a name="ln-8993"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-8994"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-8995"></a><span class="c">!     call json%create_logical(p,&#39;value&#39;,.true.)</span>
<a name="ln-8996"></a><span class="c">!````</span>
<a name="ln-8997"></a>
<a name="ln-8998"></a>    <span class="k">subroutine </span><span class="n">json_value_create_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-8999"></a>
<a name="ln-9000"></a>    <span class="k">implicit none</span>
<a name="ln-9001"></a>
<a name="ln-9002"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9003"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9004"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! variable value</span>
<a name="ln-9005"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! variable name</span>
<a name="ln-9006"></a>
<a name="ln-9007"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9008"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_logical</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9009"></a>
<a name="ln-9010"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_logical</span>
<a name="ln-9011"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9012"></a>
<a name="ln-9013"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9014"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9015"></a><span class="c">!</span>
<a name="ln-9016"></a><span class="c">!  Wrapper for [[json_value_create_logical]] so `create_logical` method can</span>
<a name="ln-9017"></a><span class="c">!  be called with name of character kind &#39;DEFAULT&#39; or &#39;ISO_10646&#39;</span>
<a name="ln-9018"></a>
<a name="ln-9019"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9020"></a>
<a name="ln-9021"></a>    <span class="k">implicit none</span>
<a name="ln-9022"></a>
<a name="ln-9023"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9024"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9025"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9026"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9027"></a>
<a name="ln-9028"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_logical</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9029"></a>
<a name="ln-9030"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_logical</span>
<a name="ln-9031"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9032"></a>
<a name="ln-9033"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9034"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9035"></a><span class="c">!</span>
<a name="ln-9036"></a><span class="c">!  Allocate a [[json_value]] pointer and make it an integer(IK) variable.</span>
<a name="ln-9037"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9038"></a><span class="c">!</span>
<a name="ln-9039"></a><span class="c">!### Example</span>
<a name="ln-9040"></a><span class="c">!````fortran</span>
<a name="ln-9041"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9042"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9043"></a><span class="c">!     call json%create_integer(p,&#39;value&#39;,1)</span>
<a name="ln-9044"></a><span class="c">!````</span>
<a name="ln-9045"></a>
<a name="ln-9046"></a>    <span class="k">subroutine </span><span class="n">json_value_create_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9047"></a>
<a name="ln-9048"></a>    <span class="k">implicit none</span>
<a name="ln-9049"></a>
<a name="ln-9050"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9051"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9052"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9053"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9054"></a>
<a name="ln-9055"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9056"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_integer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9057"></a>
<a name="ln-9058"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_integer</span>
<a name="ln-9059"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9060"></a>
<a name="ln-9061"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9062"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9063"></a><span class="c">!</span>
<a name="ln-9064"></a><span class="c">!  A wrapper procedure for [[json_value_create_integer]] so that `create_integer`</span>
<a name="ln-9065"></a><span class="c">!  method may be called with either a &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind</span>
<a name="ln-9066"></a><span class="c">!  `name` actual argument.</span>
<a name="ln-9067"></a>
<a name="ln-9068"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9069"></a>
<a name="ln-9070"></a>    <span class="k">implicit none</span>
<a name="ln-9071"></a>
<a name="ln-9072"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9073"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9074"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9075"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9076"></a>
<a name="ln-9077"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_integer</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9078"></a>
<a name="ln-9079"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_integer</span>
<a name="ln-9080"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9081"></a>
<a name="ln-9082"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9083"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9084"></a><span class="c">!</span>
<a name="ln-9085"></a><span class="c">!  Allocate a [[json_value]] pointer and make it a real(RK) variable.</span>
<a name="ln-9086"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9087"></a><span class="c">!</span>
<a name="ln-9088"></a><span class="c">!### Example</span>
<a name="ln-9089"></a><span class="c">!````fortran</span>
<a name="ln-9090"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9091"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9092"></a><span class="c">!     call json%create_double(p,&#39;value&#39;,1.0_RK)</span>
<a name="ln-9093"></a><span class="c">!````</span>
<a name="ln-9094"></a>
<a name="ln-9095"></a>    <span class="k">subroutine </span><span class="n">json_value_create_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9096"></a>
<a name="ln-9097"></a>    <span class="k">implicit none</span>
<a name="ln-9098"></a>
<a name="ln-9099"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9100"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9101"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                 <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9102"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9103"></a>
<a name="ln-9104"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9105"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_double</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9106"></a>
<a name="ln-9107"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_double</span>
<a name="ln-9108"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9109"></a>
<a name="ln-9110"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9111"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9112"></a><span class="c">!</span>
<a name="ln-9113"></a><span class="c">!  A wrapper for [[json_value_create_double]] so that `create_double` method</span>
<a name="ln-9114"></a><span class="c">!  may be called with an actual argument corresponding to the dummy argument,</span>
<a name="ln-9115"></a><span class="c">!  `name` that may be of &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind.</span>
<a name="ln-9116"></a>
<a name="ln-9117"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9118"></a>
<a name="ln-9119"></a>    <span class="k">implicit none</span>
<a name="ln-9120"></a>
<a name="ln-9121"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9122"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9123"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9124"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9125"></a>
<a name="ln-9126"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_double</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9127"></a>
<a name="ln-9128"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_double</span>
<a name="ln-9129"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9130"></a>
<a name="ln-9131"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9132"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9133"></a><span class="c">!</span>
<a name="ln-9134"></a><span class="c">!  Allocate a json_value pointer and make it a string variable.</span>
<a name="ln-9135"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9136"></a><span class="c">!</span>
<a name="ln-9137"></a><span class="c">!### Example</span>
<a name="ln-9138"></a><span class="c">!````fortran</span>
<a name="ln-9139"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9140"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9141"></a><span class="c">!     call json%create_string(p,&#39;value&#39;,&#39;hello&#39;)</span>
<a name="ln-9142"></a><span class="c">!````</span>
<a name="ln-9143"></a>
<a name="ln-9144"></a>    <span class="k">subroutine </span><span class="n">json_value_create_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-9145"></a>
<a name="ln-9146"></a>    <span class="k">implicit none</span>
<a name="ln-9147"></a>
<a name="ln-9148"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9149"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9150"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9151"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9152"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>      <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-9153"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>   <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-9154"></a>
<a name="ln-9155"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9156"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_string</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-9157"></a>
<a name="ln-9158"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_string</span>
<a name="ln-9159"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9160"></a>
<a name="ln-9161"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9162"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9163"></a><span class="c">!</span>
<a name="ln-9164"></a><span class="c">!  Wrap [[json_value_create_string]] so that `create_string` method may be called</span>
<a name="ln-9165"></a><span class="c">!  with actual character string arguments for `name` and `val` that are BOTH of</span>
<a name="ln-9166"></a><span class="c">!  &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind.</span>
<a name="ln-9167"></a>
<a name="ln-9168"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-9169"></a>
<a name="ln-9170"></a>    <span class="k">implicit none</span>
<a name="ln-9171"></a>
<a name="ln-9172"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9173"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9174"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">val</span>
<a name="ln-9175"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9176"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>      <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-9177"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>   <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-9178"></a>
<a name="ln-9179"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_string</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">val</span><span class="p">),</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-9180"></a>
<a name="ln-9181"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_string</span>
<a name="ln-9182"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9183"></a>
<a name="ln-9184"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9185"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9186"></a><span class="c">!</span>
<a name="ln-9187"></a><span class="c">!  Allocate a json_value pointer and make it a null variable.</span>
<a name="ln-9188"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9189"></a><span class="c">!</span>
<a name="ln-9190"></a><span class="c">!### Example</span>
<a name="ln-9191"></a><span class="c">!````fortran</span>
<a name="ln-9192"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9193"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9194"></a><span class="c">!     call json%create_null(p,&#39;value&#39;)</span>
<a name="ln-9195"></a><span class="c">!````</span>
<a name="ln-9196"></a>
<a name="ln-9197"></a>    <span class="k">subroutine </span><span class="n">json_value_create_null</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9198"></a>
<a name="ln-9199"></a>    <span class="k">implicit none</span>
<a name="ln-9200"></a>
<a name="ln-9201"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9202"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9203"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9204"></a>
<a name="ln-9205"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9206"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_null</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9207"></a>
<a name="ln-9208"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_null</span>
<a name="ln-9209"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9210"></a>
<a name="ln-9211"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9212"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9213"></a><span class="c">!</span>
<a name="ln-9214"></a><span class="c">!  Wrap [[json_value_create_null]] so that `create_null` method may be called with</span>
<a name="ln-9215"></a><span class="c">!  an actual argument corresponding to the dummy argument `name` that is either</span>
<a name="ln-9216"></a><span class="c">!  of &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind.</span>
<a name="ln-9217"></a>
<a name="ln-9218"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_null</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9219"></a>
<a name="ln-9220"></a>    <span class="k">implicit none</span>
<a name="ln-9221"></a>
<a name="ln-9222"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9223"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9224"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9225"></a>
<a name="ln-9226"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_null</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9227"></a>
<a name="ln-9228"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_null</span>
<a name="ln-9229"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9230"></a>
<a name="ln-9231"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9232"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9233"></a><span class="c">!</span>
<a name="ln-9234"></a><span class="c">!  Allocate a [[json_value]] pointer and make it an object variable.</span>
<a name="ln-9235"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9236"></a><span class="c">!</span>
<a name="ln-9237"></a><span class="c">!### Example</span>
<a name="ln-9238"></a><span class="c">!````fortran</span>
<a name="ln-9239"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9240"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9241"></a><span class="c">!     call json%create_object(p,&#39;objectname&#39;)</span>
<a name="ln-9242"></a><span class="c">!````</span>
<a name="ln-9243"></a><span class="c">!</span>
<a name="ln-9244"></a><span class="c">!@note The name is not significant for the root structure or an array element.</span>
<a name="ln-9245"></a><span class="c">!      In those cases, an empty string can be used.</span>
<a name="ln-9246"></a>
<a name="ln-9247"></a>    <span class="k">subroutine </span><span class="n">json_value_create_object</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9248"></a>
<a name="ln-9249"></a>    <span class="k">implicit none</span>
<a name="ln-9250"></a>
<a name="ln-9251"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9252"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9253"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9254"></a>
<a name="ln-9255"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9256"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_object</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9257"></a>
<a name="ln-9258"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_object</span>
<a name="ln-9259"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9260"></a>
<a name="ln-9261"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9262"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9263"></a><span class="c">!</span>
<a name="ln-9264"></a><span class="c">!  Wrap [[json_value_create_object]] so that `create_object` method may be called</span>
<a name="ln-9265"></a><span class="c">!  with an actual argument corresponding to the dummy argument `name` that is of</span>
<a name="ln-9266"></a><span class="c">!  either &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind.</span>
<a name="ln-9267"></a>
<a name="ln-9268"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_object</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9269"></a>
<a name="ln-9270"></a>    <span class="k">implicit none</span>
<a name="ln-9271"></a>
<a name="ln-9272"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9273"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9274"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9275"></a>
<a name="ln-9276"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_object</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9277"></a>
<a name="ln-9278"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_object</span>
<a name="ln-9279"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9280"></a>
<a name="ln-9281"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9282"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9283"></a><span class="c">!</span>
<a name="ln-9284"></a><span class="c">!  Allocate a [[json_value]] pointer and make it an array variable.</span>
<a name="ln-9285"></a><span class="c">!  The pointer should not already be allocated.</span>
<a name="ln-9286"></a><span class="c">!</span>
<a name="ln-9287"></a><span class="c">!### Example</span>
<a name="ln-9288"></a><span class="c">!````fortran</span>
<a name="ln-9289"></a><span class="c">!     type(json_value),pointer :: p</span>
<a name="ln-9290"></a><span class="c">!     type(json_core) :: json</span>
<a name="ln-9291"></a><span class="c">!     call json%create_array(p,&#39;arrayname&#39;)</span>
<a name="ln-9292"></a><span class="c">!````</span>
<a name="ln-9293"></a>
<a name="ln-9294"></a>    <span class="k">subroutine </span><span class="n">json_value_create_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9295"></a>
<a name="ln-9296"></a>    <span class="k">implicit none</span>
<a name="ln-9297"></a>
<a name="ln-9298"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9299"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9300"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9301"></a>
<a name="ln-9302"></a>    <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9303"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_array</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9304"></a>
<a name="ln-9305"></a>    <span class="k">end subroutine </span><span class="n">json_value_create_array</span>
<a name="ln-9306"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9307"></a>
<a name="ln-9308"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9309"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a name="ln-9310"></a><span class="c">!</span>
<a name="ln-9311"></a><span class="c">!  A wrapper for [[json_value_create_array]] so that `create_array` method may be</span>
<a name="ln-9312"></a><span class="c">!  called with an actual argument, corresponding to the dummy argument `name`,</span>
<a name="ln-9313"></a><span class="c">!  that is either of &#39;DEFAULT&#39; or &#39;ISO_10646&#39; character kind.</span>
<a name="ln-9314"></a>
<a name="ln-9315"></a>    <span class="k">subroutine </span><span class="n">wrap_json_value_create_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9316"></a>
<a name="ln-9317"></a>    <span class="k">implicit none</span>
<a name="ln-9318"></a>
<a name="ln-9319"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9320"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>             <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9321"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">name</span>
<a name="ln-9322"></a>
<a name="ln-9323"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">create_array</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
<a name="ln-9324"></a>
<a name="ln-9325"></a>    <span class="k">end subroutine </span><span class="n">wrap_json_value_create_array</span>
<a name="ln-9326"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9327"></a>
<a name="ln-9328"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9329"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9330"></a><span class="c">!</span>
<a name="ln-9331"></a><span class="c">!  Change the [[json_value]] variable to a logical.</span>
<a name="ln-9332"></a>
<a name="ln-9333"></a>    <span class="k">subroutine </span><span class="n">to_logical</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9334"></a>
<a name="ln-9335"></a>    <span class="k">implicit none</span>
<a name="ln-9336"></a>
<a name="ln-9337"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9338"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9339"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>              <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! if the value is also to be set</span>
<a name="ln-9340"></a>                                                          <span class="c">!! (if not present, then .false. is used).</span>
<a name="ln-9341"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9342"></a>
<a name="ln-9343"></a>    <span class="c">!set type and value:</span>
<a name="ln-9344"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9345"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_logical</span>
<a name="ln-9346"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span><span class="p">)</span>
<a name="ln-9347"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9348"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-9349"></a>    <span class="k">else</span>
<a name="ln-9350"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">log_value</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>    <span class="c">!default value</span>
<a name="ln-9351"></a>    <span class="k">end if</span>
<a name="ln-9352"></a>
<a name="ln-9353"></a>    <span class="c">!name:</span>
<a name="ln-9354"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9355"></a>
<a name="ln-9356"></a>    <span class="k">end subroutine </span><span class="n">to_logical</span>
<a name="ln-9357"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9358"></a>
<a name="ln-9359"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9360"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9361"></a><span class="c">!</span>
<a name="ln-9362"></a><span class="c">!  Change the [[json_value]] variable to an integer.</span>
<a name="ln-9363"></a>
<a name="ln-9364"></a>    <span class="k">subroutine </span><span class="n">to_integer</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9365"></a>
<a name="ln-9366"></a>    <span class="k">implicit none</span>
<a name="ln-9367"></a>
<a name="ln-9368"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9369"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9370"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>              <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! if the value is also to be set</span>
<a name="ln-9371"></a>                                                          <span class="c">!! (if not present, then 0 is used).</span>
<a name="ln-9372"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9373"></a>
<a name="ln-9374"></a>    <span class="c">!set type and value:</span>
<a name="ln-9375"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9376"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_integer</span>
<a name="ln-9377"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span><span class="p">)</span>
<a name="ln-9378"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9379"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-9380"></a>    <span class="k">else</span>
<a name="ln-9381"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">int_value</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c">!default value</span>
<a name="ln-9382"></a>    <span class="k">end if</span>
<a name="ln-9383"></a>
<a name="ln-9384"></a>    <span class="c">!name:</span>
<a name="ln-9385"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9386"></a>
<a name="ln-9387"></a>    <span class="k">end subroutine </span><span class="n">to_integer</span>
<a name="ln-9388"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9389"></a>
<a name="ln-9390"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9391"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9392"></a><span class="c">!</span>
<a name="ln-9393"></a><span class="c">!  Change the [[json_value]] variable to a double.</span>
<a name="ln-9394"></a>
<a name="ln-9395"></a>    <span class="k">subroutine </span><span class="n">to_double</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9396"></a>
<a name="ln-9397"></a>    <span class="k">implicit none</span>
<a name="ln-9398"></a>
<a name="ln-9399"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9400"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9401"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                 <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! if the value is also to be set</span>
<a name="ln-9402"></a>                                                          <span class="c">!! (if not present, then 0.0_rk is used).</span>
<a name="ln-9403"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9404"></a>
<a name="ln-9405"></a>    <span class="c">!set type and value:</span>
<a name="ln-9406"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9407"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_double</span>
<a name="ln-9408"></a>    <span class="k">allocate</span><span class="p">(</span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span><span class="p">)</span>
<a name="ln-9409"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9410"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-9411"></a>    <span class="k">else</span>
<a name="ln-9412"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">dbl_value</span> <span class="o">=</span> <span class="mf">0.0_RK</span>    <span class="c">!default value</span>
<a name="ln-9413"></a>    <span class="k">end if</span>
<a name="ln-9414"></a>
<a name="ln-9415"></a>    <span class="c">!name:</span>
<a name="ln-9416"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9417"></a>
<a name="ln-9418"></a>    <span class="k">end subroutine </span><span class="n">to_double</span>
<a name="ln-9419"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9420"></a>
<a name="ln-9421"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9422"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9423"></a><span class="c">!</span>
<a name="ln-9424"></a><span class="c">!  Change the [[json_value]] variable to a string.</span>
<a name="ln-9425"></a><span class="c">!</span>
<a name="ln-9426"></a><span class="c">!### Modified</span>
<a name="ln-9427"></a><span class="c">!  * Izaak Beekman : 02/24/2015</span>
<a name="ln-9428"></a>
<a name="ln-9429"></a>    <span class="k">subroutine </span><span class="n">to_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">trim_str</span><span class="p">,</span><span class="n">adjustl_str</span><span class="p">)</span>
<a name="ln-9430"></a>
<a name="ln-9431"></a>    <span class="k">implicit none</span>
<a name="ln-9432"></a>
<a name="ln-9433"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9434"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>        <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9435"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">val</span>   <span class="c">!! if the value is also to be set</span>
<a name="ln-9436"></a>                                                          <span class="c">!! (if not present, then &#39;&#39; is used).</span>
<a name="ln-9437"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9438"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">trim_str</span>       <span class="c">!! if TRIM() should be called for the `val`</span>
<a name="ln-9439"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-9440"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>     <span class="kd">::</span> <span class="n">adjustl_str</span>    <span class="c">!! if ADJUSTL() should be called for the `val`</span>
<a name="ln-9441"></a>                                                          <span class="c">!! (only used if `val` is present)</span>
<a name="ln-9442"></a>                                                          <span class="c">!! (note that ADJUSTL is done before TRIM)</span>
<a name="ln-9443"></a>
<a name="ln-9444"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str</span> <span class="c">!! temp string for `trim()` and/or `adjustl()`</span>
<a name="ln-9445"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">trim_string</span>    <span class="c">!! if the string is to be trimmed</span>
<a name="ln-9446"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">adjustl_string</span> <span class="c">!! if the string is to be adjusted left</span>
<a name="ln-9447"></a>
<a name="ln-9448"></a>    <span class="c">!set type and value:</span>
<a name="ln-9449"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9450"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_string</span>
<a name="ln-9451"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">val</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9452"></a>
<a name="ln-9453"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">trim_str</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9454"></a><span class="k">            </span><span class="n">trim_string</span> <span class="o">=</span> <span class="n">trim_str</span>
<a name="ln-9455"></a>        <span class="k">else</span>
<a name="ln-9456"></a><span class="k">            </span><span class="n">trim_string</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9457"></a>        <span class="k">end if</span>
<a name="ln-9458"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">adjustl_str</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9459"></a><span class="k">            </span><span class="n">adjustl_string</span> <span class="o">=</span> <span class="n">adjustl_str</span>
<a name="ln-9460"></a>        <span class="k">else</span>
<a name="ln-9461"></a><span class="k">            </span><span class="n">adjustl_string</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9462"></a>        <span class="k">end if</span>
<a name="ln-9463"></a>
<a name="ln-9464"></a><span class="k">        if</span> <span class="p">(</span><span class="n">trim_string</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">adjustl_string</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9465"></a><span class="k">            </span><span class="n">str</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-9466"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">adjustl_string</span><span class="p">)</span> <span class="n">str</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-9467"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">trim_string</span><span class="p">)</span>    <span class="n">str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a name="ln-9468"></a>            <span class="n">p</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="n">str</span>
<a name="ln-9469"></a>        <span class="k">else</span>
<a name="ln-9470"></a><span class="k">            </span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="n">val</span>
<a name="ln-9471"></a>        <span class="k">end if</span>
<a name="ln-9472"></a>
<a name="ln-9473"></a><span class="k">    else</span>
<a name="ln-9474"></a><span class="k">        </span><span class="n">p</span><span class="p">%</span><span class="n">str_value</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>  <span class="c">! default value</span>
<a name="ln-9475"></a>    <span class="k">end if</span>
<a name="ln-9476"></a>
<a name="ln-9477"></a>    <span class="c">!name:</span>
<a name="ln-9478"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9479"></a>
<a name="ln-9480"></a>    <span class="k">end subroutine </span><span class="n">to_string</span>
<a name="ln-9481"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9482"></a>
<a name="ln-9483"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9484"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9485"></a><span class="c">!</span>
<a name="ln-9486"></a><span class="c">!  Change the [[json_value]] variable to a null.</span>
<a name="ln-9487"></a>
<a name="ln-9488"></a>    <span class="k">subroutine </span><span class="n">to_null</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9489"></a>
<a name="ln-9490"></a>    <span class="k">implicit none</span>
<a name="ln-9491"></a>
<a name="ln-9492"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9493"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9494"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9495"></a>
<a name="ln-9496"></a>    <span class="c">!set type and value:</span>
<a name="ln-9497"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9498"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_null</span>
<a name="ln-9499"></a>
<a name="ln-9500"></a>    <span class="c">!name:</span>
<a name="ln-9501"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9502"></a>
<a name="ln-9503"></a>    <span class="k">end subroutine </span><span class="n">to_null</span>
<a name="ln-9504"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9505"></a>
<a name="ln-9506"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9507"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9508"></a><span class="c">!</span>
<a name="ln-9509"></a><span class="c">!  Change the [[json_value]] variable to an object.</span>
<a name="ln-9510"></a>
<a name="ln-9511"></a>    <span class="k">subroutine </span><span class="n">to_object</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9512"></a>
<a name="ln-9513"></a>    <span class="k">implicit none</span>
<a name="ln-9514"></a>
<a name="ln-9515"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9516"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9517"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9518"></a>
<a name="ln-9519"></a>    <span class="c">!set type and value:</span>
<a name="ln-9520"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9521"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_object</span>
<a name="ln-9522"></a>
<a name="ln-9523"></a>    <span class="c">!name:</span>
<a name="ln-9524"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9525"></a>
<a name="ln-9526"></a>    <span class="k">end subroutine </span><span class="n">to_object</span>
<a name="ln-9527"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9528"></a>
<a name="ln-9529"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9530"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9531"></a><span class="c">!</span>
<a name="ln-9532"></a><span class="c">!  Change the [[json_value]] variable to an array.</span>
<a name="ln-9533"></a>
<a name="ln-9534"></a>    <span class="k">subroutine </span><span class="n">to_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9535"></a>
<a name="ln-9536"></a>    <span class="k">implicit none</span>
<a name="ln-9537"></a>
<a name="ln-9538"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9539"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>                     <span class="kd">::</span> <span class="n">p</span>
<a name="ln-9540"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">name</span>  <span class="c">!! if the name is also to be changed.</span>
<a name="ln-9541"></a>
<a name="ln-9542"></a>    <span class="c">!set type and value:</span>
<a name="ln-9543"></a>    <span class="k">call </span><span class="n">destroy_json_data</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<a name="ln-9544"></a>    <span class="n">p</span><span class="p">%</span><span class="n">var_type</span> <span class="o">=</span> <span class="n">json_array</span>
<a name="ln-9545"></a>
<a name="ln-9546"></a>    <span class="c">!name:</span>
<a name="ln-9547"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">name</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="nb">rename</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9548"></a>
<a name="ln-9549"></a>    <span class="k">end subroutine </span><span class="n">to_array</span>
<a name="ln-9550"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9551"></a>
<a name="ln-9552"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9553"></a><span class="c">!&gt;</span>
<a name="ln-9554"></a><span class="c">!  Core parsing routine.</span>
<a name="ln-9555"></a>
<a name="ln-9556"></a>    <span class="k">recursive subroutine </span><span class="n">parse_object</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
<a name="ln-9557"></a>
<a name="ln-9558"></a>    <span class="k">implicit none</span>
<a name="ln-9559"></a>
<a name="ln-9560"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9561"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">unit</span>    <span class="c">!! file unit number (if parsing from a file)</span>
<a name="ln-9562"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>     <span class="c">!! JSON string (if parsing from a string)</span>
<a name="ln-9563"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="n">parent</span>  <span class="c">!! the parsed object will be added as a child of this</span>
<a name="ln-9564"></a>
<a name="ln-9565"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">pair</span>
<a name="ln-9566"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eof</span>
<a name="ln-9567"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-9568"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-9569"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! this is a work-around for a bug</span>
<a name="ln-9570"></a>                                                 <span class="c">!! in the gfortran 4.9 compiler.</span>
<a name="ln-9571"></a><span class="cp">#endif</span>
<a name="ln-9572"></a>
<a name="ln-9573"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9574"></a>
<a name="ln-9575"></a>        <span class="c">!the routine is being called incorrectly.</span>
<a name="ln-9576"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9577"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object: parent pointer not associated.&#39;</span><span class="p">)</span>
<a name="ln-9578"></a>        <span class="k">end if</span>
<a name="ln-9579"></a>
<a name="ln-9580"></a><span class="k">        nullify</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>    <span class="c">!probably not necessary</span>
<a name="ln-9581"></a>
<a name="ln-9582"></a>        <span class="c">! pair name</span>
<a name="ln-9583"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="p">&amp;</span>
<a name="ln-9584"></a>                            <span class="n">skip_comments</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">allow_comments</span><span class="p">,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9585"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9586"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9587"></a>                                 <span class="s1">&#39; Unexpected end of file while parsing start of object.&#39;</span><span class="p">)</span>
<a name="ln-9588"></a>            <span class="k">return</span>
<a name="ln-9589"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">end_object</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9590"></a>            <span class="c">! end of an empty object</span>
<a name="ln-9591"></a>            <span class="k">return</span>
<a name="ln-9592"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">quotation_mark</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9593"></a><span class="k">            call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
<a name="ln-9594"></a><span class="cp">#if defined __GFORTRAN__</span>
<a name="ln-9595"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_string</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>   <span class="c">! write to a tmp variable because of</span>
<a name="ln-9596"></a>            <span class="n">pair</span><span class="p">%</span><span class="n">name</span> <span class="o">=</span> <span class="n">tmp</span>                        <span class="c">! a bug in 4.9 gfortran compiler.</span>
<a name="ln-9597"></a>            <span class="k">deallocate</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-9598"></a><span class="cp">#else</span>
<a name="ln-9599"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_string</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">pair</span><span class="p">%</span><span class="n">name</span><span class="p">)</span>
<a name="ln-9600"></a><span class="cp">#endif</span>
<a name="ln-9601"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9602"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
<a name="ln-9603"></a>                <span class="k">return</span>
<a name="ln-9604"></a><span class="k">            end if</span>
<a name="ln-9605"></a><span class="k">        else</span>
<a name="ln-9606"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object: Expecting string: &quot;&#39;</span><span class="o">//</span><span class="n">c</span><span class="o">//</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
<a name="ln-9607"></a>            <span class="k">return</span>
<a name="ln-9608"></a><span class="k">        end if</span>
<a name="ln-9609"></a>
<a name="ln-9610"></a>        <span class="c">! pair value</span>
<a name="ln-9611"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="p">&amp;</span>
<a name="ln-9612"></a>                            <span class="n">skip_comments</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">allow_comments</span><span class="p">,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9613"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9614"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9615"></a>                                 <span class="s1">&#39; Unexpected end of file while parsing object member.&#39;</span><span class="p">)</span>
<a name="ln-9616"></a>            <span class="k">return</span>
<a name="ln-9617"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">colon_char</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9618"></a>            <span class="c">! parse the value</span>
<a name="ln-9619"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
<a name="ln-9620"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9621"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
<a name="ln-9622"></a>                <span class="k">return</span>
<a name="ln-9623"></a><span class="k">            else</span>
<a name="ln-9624"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span>
<a name="ln-9625"></a>            <span class="k">end if</span>
<a name="ln-9626"></a><span class="k">        else</span>
<a name="ln-9627"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9628"></a>                                      <span class="s1">&#39; Expecting : and then a value: &#39;</span><span class="o">//</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9629"></a>            <span class="k">return</span>
<a name="ln-9630"></a><span class="k">        end if</span>
<a name="ln-9631"></a>
<a name="ln-9632"></a>        <span class="c">! another possible pair</span>
<a name="ln-9633"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="p">&amp;</span>
<a name="ln-9634"></a>                            <span class="n">skip_comments</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">allow_comments</span><span class="p">,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9635"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9636"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9637"></a>                                 <span class="s1">&#39;End of file encountered when parsing an object&#39;</span><span class="p">)</span>
<a name="ln-9638"></a>            <span class="k">return</span>
<a name="ln-9639"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">delimiter</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9640"></a>            <span class="c">! read the next member</span>
<a name="ln-9641"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_object</span><span class="p">(</span><span class="n">unit</span> <span class="o">=</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">)</span>
<a name="ln-9642"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">end_object</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9643"></a>            <span class="c">! end of object</span>
<a name="ln-9644"></a>            <span class="k">return</span>
<a name="ln-9645"></a><span class="k">        else</span>
<a name="ln-9646"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_object: Expecting end of object: &#39;</span><span class="o">//</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9647"></a>            <span class="k">return</span>
<a name="ln-9648"></a><span class="k">        end if</span>
<a name="ln-9649"></a>
<a name="ln-9650"></a><span class="k">    end if</span>
<a name="ln-9651"></a>
<a name="ln-9652"></a><span class="k">    end subroutine </span><span class="n">parse_object</span>
<a name="ln-9653"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9654"></a>
<a name="ln-9655"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9656"></a><span class="c">!&gt;</span>
<a name="ln-9657"></a><span class="c">!  Core parsing routine.</span>
<a name="ln-9658"></a>
<a name="ln-9659"></a>    <span class="k">recursive subroutine </span><span class="n">parse_array</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">array</span><span class="p">)</span>
<a name="ln-9660"></a>
<a name="ln-9661"></a>    <span class="k">implicit none</span>
<a name="ln-9662"></a>
<a name="ln-9663"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9664"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">unit</span>   <span class="c">!! file unit number (if parsing from a file)</span>
<a name="ln-9665"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! JSON string (if parsing from a string)</span>
<a name="ln-9666"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="k">array</span>
<a name="ln-9667"></a>
<a name="ln-9668"></a><span class="k">    type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span> <span class="kd">::</span> <span class="n">element</span>
<a name="ln-9669"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eof</span>
<a name="ln-9670"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-9671"></a>
<a name="ln-9672"></a>    <span class="k">do</span>
<a name="ln-9673"></a>
<a name="ln-9674"></a><span class="k">        if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">exit</span>
<a name="ln-9675"></a>
<a name="ln-9676"></a>        <span class="c">! try to parse an element value</span>
<a name="ln-9677"></a>        <span class="k">nullify</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-9678"></a>        <span class="k">call </span><span class="n">json_value_create</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-9679"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">parse_value</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
<a name="ln-9680"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9681"></a><span class="k">            if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">destroy</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
<a name="ln-9682"></a>            <span class="k">exit</span>
<a name="ln-9683"></a><span class="k">        end if</span>
<a name="ln-9684"></a>
<a name="ln-9685"></a>        <span class="c">! parse value will disassociate an empty array value</span>
<a name="ln-9686"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">element</span><span class="p">))</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">add</span><span class="p">(</span><span class="k">array</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
<a name="ln-9687"></a>
<a name="ln-9688"></a>        <span class="c">! popped the next character</span>
<a name="ln-9689"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="p">&amp;</span>
<a name="ln-9690"></a>                            <span class="n">skip_comments</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">allow_comments</span><span class="p">,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9691"></a>
<a name="ln-9692"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9693"></a>            <span class="c">! The file ended before array was finished:</span>
<a name="ln-9694"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_array: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9695"></a>                                 <span class="s1">&#39;End of file encountered when parsing an array.&#39;</span><span class="p">)</span>
<a name="ln-9696"></a>            <span class="k">exit</span>
<a name="ln-9697"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">delimiter</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9698"></a>            <span class="c">! parse the next element</span>
<a name="ln-9699"></a>            <span class="k">cycle</span>
<a name="ln-9700"></a><span class="k">        else if</span> <span class="p">(</span><span class="n">end_array</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9701"></a>            <span class="c">! end of array</span>
<a name="ln-9702"></a>            <span class="k">exit</span>
<a name="ln-9703"></a><span class="k">        else</span>
<a name="ln-9704"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_array: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9705"></a>                                      <span class="s1">&#39;Unexpected character encountered when parsing array.&#39;</span><span class="p">)</span>
<a name="ln-9706"></a>            <span class="k">exit</span>
<a name="ln-9707"></a><span class="k">        end if</span>
<a name="ln-9708"></a>
<a name="ln-9709"></a><span class="k">    end do</span>
<a name="ln-9710"></a>
<a name="ln-9711"></a><span class="k">    end subroutine </span><span class="n">parse_array</span>
<a name="ln-9712"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9713"></a>
<a name="ln-9714"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9715"></a><span class="c">!&gt;</span>
<a name="ln-9716"></a><span class="c">!  Parses a string while reading a JSON file.</span>
<a name="ln-9717"></a><span class="c">!</span>
<a name="ln-9718"></a><span class="c">!### History</span>
<a name="ln-9719"></a><span class="c">!  * Jacob Williams : 6/16/2014 : Added hex validation.</span>
<a name="ln-9720"></a><span class="c">!  * Jacob Williams : 12/3/2015 : Fixed some bugs.</span>
<a name="ln-9721"></a><span class="c">!  * Jacob Williams : 8/23/2015 : `string` is now returned unescaped.</span>
<a name="ln-9722"></a>
<a name="ln-9723"></a>    <span class="k">subroutine </span><span class="n">parse_string</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
<a name="ln-9724"></a>
<a name="ln-9725"></a>    <span class="k">implicit none</span>
<a name="ln-9726"></a>
<a name="ln-9727"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                   <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9728"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">unit</span>  <span class="c">!! file unit number (if parsing from a file)</span>
<a name="ln-9729"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">str</span>   <span class="c">!! JSON string (if parsing from a string)</span>
<a name="ln-9730"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">string</span> <span class="c">!! the string (unescaped if necessary)</span>
<a name="ln-9731"></a>
<a name="ln-9732"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eof</span><span class="p">,</span> <span class="n">is_hex</span><span class="p">,</span> <span class="n">escape</span>
<a name="ln-9733"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-9734"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="kd">::</span> <span class="n">hex</span>
<a name="ln-9735"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-9736"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ip</span> <span class="c">!! index to put next character,</span>
<a name="ln-9737"></a>                      <span class="c">!! to speed up by reducing the number of character string reallocations.</span>
<a name="ln-9738"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">string_unescaped</span> <span class="c">!! temp variable</span>
<a name="ln-9739"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">error_message</span> <span class="c">!! for string unescaping</span>
<a name="ln-9740"></a>
<a name="ln-9741"></a>    <span class="c">!at least return a blank string if there is a problem:</span>
<a name="ln-9742"></a>    <span class="n">string</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9743"></a>
<a name="ln-9744"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9745"></a>
<a name="ln-9746"></a>        <span class="c">!initialize:</span>
<a name="ln-9747"></a>        <span class="n">ip</span>     <span class="o">=</span> <span class="mi">1</span>
<a name="ln-9748"></a>        <span class="n">is_hex</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9749"></a>        <span class="n">escape</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9750"></a>        <span class="n">i</span>      <span class="o">=</span> <span class="mi">0</span>
<a name="ln-9751"></a>
<a name="ln-9752"></a>        <span class="k">do</span>
<a name="ln-9753"></a>
<a name="ln-9754"></a>            <span class="c">!get the next character from the file:</span>
<a name="ln-9755"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9756"></a>
<a name="ln-9757"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9758"></a>
<a name="ln-9759"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_string: Expecting end of string&#39;</span><span class="p">)</span>
<a name="ln-9760"></a>                <span class="k">return</span>
<a name="ln-9761"></a>
<a name="ln-9762"></a><span class="k">            else if</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">quotation_mark</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">escape</span><span class="p">)</span> <span class="k">then</span>  <span class="c">!end of string</span>
<a name="ln-9763"></a>
<a name="ln-9764"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">is_hex</span><span class="p">)</span> <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9765"></a>                                                 <span class="s1">&#39; incomplete hex string: \u&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">hex</span><span class="p">))</span>
<a name="ln-9766"></a>                <span class="k">exit</span>
<a name="ln-9767"></a>
<a name="ln-9768"></a><span class="k">            else</span>
<a name="ln-9769"></a>
<a name="ln-9770"></a>                <span class="c">!if the string is not big enough, then add another chunk:</span>
<a name="ln-9771"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">))</span> <span class="n">string</span> <span class="o">=</span> <span class="n">string</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9772"></a>
<a name="ln-9773"></a>                <span class="c">!append to string:</span>
<a name="ln-9774"></a>                <span class="n">string</span><span class="p">(</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-9775"></a>                <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-9776"></a>
<a name="ln-9777"></a>                <span class="c">!hex validation:</span>
<a name="ln-9778"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">is_hex</span><span class="p">)</span> <span class="k">then</span>  <span class="c">!accumulate the four characters after &#39;\u&#39;</span>
<a name="ln-9779"></a>
<a name="ln-9780"></a>                    <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a name="ln-9781"></a>                    <span class="n">hex</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-9782"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9783"></a><span class="k">                        if</span> <span class="p">(</span><span class="n">valid_json_hex</span><span class="p">(</span><span class="n">hex</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9784"></a><span class="k">                            </span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-9785"></a>                            <span class="n">hex</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-9786"></a>                            <span class="n">is_hex</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9787"></a>                        <span class="k">else</span>
<a name="ln-9788"></a><span class="k">                            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9789"></a>                                                 <span class="s1">&#39; invalid hex string: \u&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">hex</span><span class="p">))</span>
<a name="ln-9790"></a>                            <span class="k">exit</span>
<a name="ln-9791"></a><span class="k">                        end if</span>
<a name="ln-9792"></a><span class="k">                    end if</span>
<a name="ln-9793"></a>
<a name="ln-9794"></a><span class="k">                else</span>
<a name="ln-9795"></a>
<a name="ln-9796"></a>                    <span class="c">!when the &#39;\u&#39; string is encountered, then</span>
<a name="ln-9797"></a>                    <span class="c">!  start accumulating the hex string (should be the next 4 characters)</span>
<a name="ln-9798"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">escape</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9799"></a><span class="k">                        </span><span class="n">escape</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9800"></a>                        <span class="n">is_hex</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="s1">&#39;u&#39;</span><span class="p">)</span>    <span class="c">!the next four characters are the hex string</span>
<a name="ln-9801"></a>                    <span class="k">else</span>
<a name="ln-9802"></a><span class="k">                        </span><span class="n">escape</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">==</span><span class="n">backslash</span><span class="p">)</span>
<a name="ln-9803"></a>                    <span class="k">end if</span>
<a name="ln-9804"></a>
<a name="ln-9805"></a><span class="k">                end if</span>
<a name="ln-9806"></a>
<a name="ln-9807"></a><span class="k">            end if</span>
<a name="ln-9808"></a>
<a name="ln-9809"></a><span class="k">        end do</span>
<a name="ln-9810"></a>
<a name="ln-9811"></a>        <span class="c">!trim the string if necessary:</span>
<a name="ln-9812"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9813"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ip</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9814"></a><span class="k">                </span><span class="n">string</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a name="ln-9815"></a>            <span class="k">else</span>
<a name="ln-9816"></a><span class="k">                </span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ip</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-9817"></a>            <span class="k">end if</span>
<a name="ln-9818"></a><span class="k">        end if</span>
<a name="ln-9819"></a>
<a name="ln-9820"></a>        <span class="c">!string is returned unescaped:</span>
<a name="ln-9821"></a>        <span class="k">call </span><span class="n">unescape_string</span><span class="p">(</span><span class="n">string</span><span class="p">,</span><span class="n">string_unescaped</span><span class="p">,</span><span class="n">error_message</span><span class="p">)</span>
<a name="ln-9822"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error_message</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9823"></a><span class="k">            call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
<a name="ln-9824"></a>        <span class="k">else</span>
<a name="ln-9825"></a><span class="k">            </span><span class="n">string</span> <span class="o">=</span> <span class="n">string_unescaped</span>
<a name="ln-9826"></a>        <span class="k">end if</span>
<a name="ln-9827"></a>
<a name="ln-9828"></a>        <span class="c">!cleanup:</span>
<a name="ln-9829"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error_message</span><span class="p">))</span>    <span class="k">deallocate</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
<a name="ln-9830"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">string_unescaped</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">string_unescaped</span><span class="p">)</span>
<a name="ln-9831"></a>
<a name="ln-9832"></a>    <span class="k">end if</span>
<a name="ln-9833"></a>
<a name="ln-9834"></a><span class="k">    end subroutine </span><span class="n">parse_string</span>
<a name="ln-9835"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9836"></a>
<a name="ln-9837"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9838"></a><span class="c">!&gt;</span>
<a name="ln-9839"></a><span class="c">!  Core parsing routine.</span>
<a name="ln-9840"></a><span class="c">!</span>
<a name="ln-9841"></a><span class="c">!  This is used to verify the strings `true`, `false`, and `null` during parsing.</span>
<a name="ln-9842"></a>
<a name="ln-9843"></a>    <span class="k">subroutine </span><span class="n">parse_for_chars</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">chars</span><span class="p">)</span>
<a name="ln-9844"></a>
<a name="ln-9845"></a>    <span class="k">implicit none</span>
<a name="ln-9846"></a>
<a name="ln-9847"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9848"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">unit</span>   <span class="c">!! file unit number (if parsing from a file)</span>
<a name="ln-9849"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! JSON string (if parsing from a string)</span>
<a name="ln-9850"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">chars</span>  <span class="c">!! the string to check for.</span>
<a name="ln-9851"></a>
<a name="ln-9852"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">length</span>
<a name="ln-9853"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eof</span>
<a name="ln-9854"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-9855"></a>
<a name="ln-9856"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9857"></a>
<a name="ln-9858"></a><span class="k">        </span><span class="n">length</span> <span class="o">=</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">chars</span><span class="p">)</span>
<a name="ln-9859"></a>
<a name="ln-9860"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span>
<a name="ln-9861"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">false</span><span class="p">.,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9862"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9863"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_for_chars:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9864"></a>                                     <span class="s1">&#39; Unexpected end of file while parsing.&#39;</span><span class="p">)</span>
<a name="ln-9865"></a>                <span class="k">return</span>
<a name="ln-9866"></a><span class="k">            else if</span> <span class="p">(</span><span class="n">c</span> <span class="o">/=</span> <span class="n">chars</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-9867"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_for_chars:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9868"></a>                                     <span class="s1">&#39; Unexpected character: &quot;&#39;</span><span class="o">//</span><span class="n">c</span><span class="o">//</span><span class="s1">&#39;&quot; (expecting &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9869"></a>                                     <span class="n">chars</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;)&#39;</span><span class="p">)</span>
<a name="ln-9870"></a>                <span class="k">return</span>
<a name="ln-9871"></a><span class="k">            end if</span>
<a name="ln-9872"></a><span class="k">        end do</span>
<a name="ln-9873"></a>
<a name="ln-9874"></a><span class="k">    end if</span>
<a name="ln-9875"></a>
<a name="ln-9876"></a><span class="k">    end subroutine </span><span class="n">parse_for_chars</span>
<a name="ln-9877"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9878"></a>
<a name="ln-9879"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9880"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-9881"></a><span class="c">!  date: 1/20/2014</span>
<a name="ln-9882"></a><span class="c">!</span>
<a name="ln-9883"></a><span class="c">!  Read a numerical value from the file (or string).</span>
<a name="ln-9884"></a><span class="c">!  The routine will determine if it is an integer or a double, and</span>
<a name="ln-9885"></a><span class="c">!  allocate the type accordingly.</span>
<a name="ln-9886"></a><span class="c">!</span>
<a name="ln-9887"></a><span class="c">!@note Complete rewrite of the original FSON routine, which had some problems.</span>
<a name="ln-9888"></a>
<a name="ln-9889"></a>    <span class="k">subroutine </span><span class="n">parse_number</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="k">value</span><span class="p">)</span>
<a name="ln-9890"></a>
<a name="ln-9891"></a>    <span class="k">implicit none</span>
<a name="ln-9892"></a>
<a name="ln-9893"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-9894"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">unit</span>   <span class="c">!! file unit number (if parsing from a file)</span>
<a name="ln-9895"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! JSON string (if parsing from a string)</span>
<a name="ln-9896"></a>    <span class="k">type</span><span class="p">(</span><span class="n">json_value</span><span class="p">),</span><span class="k">pointer</span>            <span class="kd">::</span> <span class="k">value</span>
<a name="ln-9897"></a>
<a name="ln-9898"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>
<a name="ln-9899"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>
<a name="ln-9900"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">eof</span>
<a name="ln-9901"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rval</span>
<a name="ln-9902"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ival</span>
<a name="ln-9903"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first</span>
<a name="ln-9904"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">is_integer</span>
<a name="ln-9905"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ip</span> <span class="c">!! index to put next character</span>
<a name="ln-9906"></a>                      <span class="c">!! [to speed up by reducing the number</span>
<a name="ln-9907"></a>                      <span class="c">!! of character string reallocations]</span>
<a name="ln-9908"></a>
<a name="ln-9909"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9910"></a>
<a name="ln-9911"></a><span class="k">        </span><span class="n">tmp</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9912"></a>        <span class="n">ip</span> <span class="o">=</span> <span class="mi">1</span>
<a name="ln-9913"></a>        <span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-9914"></a>        <span class="n">is_integer</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!assume it may be an integer, unless otherwise determined</span>
<a name="ln-9915"></a>
<a name="ln-9916"></a>        <span class="c">!read one character at a time and accumulate the string:</span>
<a name="ln-9917"></a>        <span class="k">do</span>
<a name="ln-9918"></a>
<a name="ln-9919"></a>            <span class="c">!get the next character:</span>
<a name="ln-9920"></a>            <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">pop_char</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">str</span><span class="o">=</span><span class="n">str</span><span class="p">,</span> <span class="n">eof</span><span class="o">=</span><span class="n">eof</span><span class="p">,</span> <span class="n">skip_ws</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.,</span> <span class="n">popped</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9921"></a>
<a name="ln-9922"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">eof</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9923"></a><span class="k">                call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in parse_number:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-9924"></a>                                     <span class="s1">&#39; Unexpected end of file while parsing number.&#39;</span><span class="p">)</span>
<a name="ln-9925"></a>                <span class="k">return</span>
<a name="ln-9926"></a><span class="k">            else</span>
<a name="ln-9927"></a>
<a name="ln-9928"></a><span class="k">                select case</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9929"></a>                <span class="k">case</span><span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>    <span class="c">!note: allowing a &#39;+&#39; as the first character here.</span>
<a name="ln-9930"></a>
<a name="ln-9931"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">is_integer</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">first</span><span class="p">))</span> <span class="n">is_integer</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9932"></a>
<a name="ln-9933"></a>                    <span class="c">!add it to the string:</span>
<a name="ln-9934"></a>                    <span class="c">!tmp = tmp // c   !...original</span>
<a name="ln-9935"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9936"></a>                    <span class="n">tmp</span><span class="p">(</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-9937"></a>                    <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-9938"></a>
<a name="ln-9939"></a>                <span class="k">case</span><span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;e&#39;</span><span class="p">)</span>    <span class="c">!can be present in real numbers</span>
<a name="ln-9940"></a>
<a name="ln-9941"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">is_integer</span><span class="p">)</span> <span class="n">is_integer</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9942"></a>
<a name="ln-9943"></a>                    <span class="c">!add it to the string:</span>
<a name="ln-9944"></a>                    <span class="c">!tmp = tmp // c   !...original</span>
<a name="ln-9945"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9946"></a>                    <span class="n">tmp</span><span class="p">(</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-9947"></a>                    <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-9948"></a>
<a name="ln-9949"></a>                <span class="k">case</span><span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">:</span><span class="n">CK_</span><span class="s1">&#39;9&#39;</span><span class="p">)</span>    <span class="c">!valid characters for numbers</span>
<a name="ln-9950"></a>
<a name="ln-9951"></a>                    <span class="c">!add it to the string:</span>
<a name="ln-9952"></a>                    <span class="c">!tmp = tmp // c   !...original</span>
<a name="ln-9953"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ip</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">//</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">)</span>
<a name="ln-9954"></a>                    <span class="n">tmp</span><span class="p">(</span><span class="n">ip</span><span class="p">:</span><span class="n">ip</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-9955"></a>                    <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-9956"></a>
<a name="ln-9957"></a>                <span class="k">case </span><span class="n">default</span>
<a name="ln-9958"></a>
<a name="ln-9959"></a>                    <span class="c">!push back the last character read:</span>
<a name="ln-9960"></a>                    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">push_char</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a name="ln-9961"></a>
<a name="ln-9962"></a>                    <span class="c">!string to value:</span>
<a name="ln-9963"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">is_integer</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-9964"></a><span class="k">                        </span><span class="n">ival</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">string_to_int</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-9965"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_integer</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="n">ival</span><span class="p">)</span>
<a name="ln-9966"></a>                    <span class="k">else</span>
<a name="ln-9967"></a><span class="k">                        </span><span class="n">rval</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">string_to_dble</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-9968"></a>                        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">to_double</span><span class="p">(</span><span class="k">value</span><span class="p">,</span><span class="n">rval</span><span class="p">)</span>
<a name="ln-9969"></a>                    <span class="k">end if</span>
<a name="ln-9970"></a>
<a name="ln-9971"></a><span class="k">                    exit</span>    <span class="c">!finished</span>
<a name="ln-9972"></a>
<a name="ln-9973"></a>                <span class="k">end select</span>
<a name="ln-9974"></a>
<a name="ln-9975"></a><span class="k">            end if</span>
<a name="ln-9976"></a><span class="k">            if</span> <span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-9977"></a>
<a name="ln-9978"></a>        <span class="k">end do</span>
<a name="ln-9979"></a>
<a name="ln-9980"></a>        <span class="c">!cleanup:</span>
<a name="ln-9981"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
<a name="ln-9982"></a>
<a name="ln-9983"></a>    <span class="k">end if</span>
<a name="ln-9984"></a>
<a name="ln-9985"></a><span class="k">    end subroutine </span><span class="n">parse_number</span>
<a name="ln-9986"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9987"></a>
<a name="ln-9988"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-9989"></a><span class="c">!&gt;</span>
<a name="ln-9990"></a><span class="c">!  Get the next character from the file (or string).</span>
<a name="ln-9991"></a><span class="c">!</span>
<a name="ln-9992"></a><span class="c">!### See also</span>
<a name="ln-9993"></a><span class="c">!  * [[push_char]]</span>
<a name="ln-9994"></a><span class="c">!</span>
<a name="ln-9995"></a><span class="c">!@note This routine ignores non-printing ASCII characters</span>
<a name="ln-9996"></a><span class="c">!      (iachar&lt;=31) that are in strings.</span>
<a name="ln-9997"></a>
<a name="ln-9998"></a>    <span class="k">recursive subroutine </span><span class="n">pop_char</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">unit</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">skip_ws</span><span class="p">,</span><span class="n">skip_comments</span><span class="p">,</span><span class="n">eof</span><span class="p">,</span><span class="n">popped</span><span class="p">)</span>
<a name="ln-9999"></a>
<a name="ln-10000"></a>    <span class="k">implicit none</span>
<a name="ln-10001"></a>
<a name="ln-10002"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">json</span>
<a name="ln-10003"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">unit</span>          <span class="c">!! file unit number (if parsing</span>
<a name="ln-10004"></a>                                                          <span class="c">!! from a file)</span>
<a name="ln-10005"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">str</span>           <span class="c">!! JSON string (if parsing from a</span>
<a name="ln-10006"></a>                                                          <span class="c">!! string) -- only used if unit=0</span>
<a name="ln-10007"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">skip_ws</span>       <span class="c">!! to ignore whitespace [default False]</span>
<a name="ln-10008"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>      <span class="kd">::</span> <span class="n">skip_comments</span> <span class="c">!! to ignore comment lines [default False]</span>
<a name="ln-10009"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">eof</span>           <span class="c">!! true if the end of the file has</span>
<a name="ln-10010"></a>                                                          <span class="c">!! been reached.</span>
<a name="ln-10011"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">popped</span>        <span class="c">!! the popped character returned</span>
<a name="ln-10012"></a>
<a name="ln-10013"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ios</span>             <span class="c">!! `iostat` flag</span>
<a name="ln-10014"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">str_len</span>         <span class="c">!! length of `str`</span>
<a name="ln-10015"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>               <span class="c">!! a character read from the file (or string)</span>
<a name="ln-10016"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ignore</span>          <span class="c">!! if whitespace is to be ignored</span>
<a name="ln-10017"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">ignore_comments</span> <span class="c">!! if comment lines are to be ignored</span>
<a name="ln-10018"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">parsing_comment</span> <span class="c">!! if we are in the process</span>
<a name="ln-10019"></a>                                                <span class="c">!! of parsing a comment line</span>
<a name="ln-10020"></a>
<a name="ln-10021"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10022"></a>
<a name="ln-10023"></a><span class="k">        </span><span class="n">eof</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-10024"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">skip_ws</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-10025"></a><span class="k">            </span><span class="n">ignore</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-10026"></a>        <span class="k">else</span>
<a name="ln-10027"></a><span class="k">            </span><span class="n">ignore</span> <span class="o">=</span> <span class="n">skip_ws</span>
<a name="ln-10028"></a>        <span class="k">end if</span>
<a name="ln-10029"></a><span class="k">        </span><span class="n">parsing_comment</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-10030"></a>        <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">present</span><span class="p">(</span><span class="n">skip_comments</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-10031"></a><span class="k">            </span><span class="n">ignore_comments</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-10032"></a>        <span class="k">else</span>
<a name="ln-10033"></a><span class="k">            </span><span class="n">ignore_comments</span> <span class="o">=</span> <span class="n">skip_comments</span>
<a name="ln-10034"></a>        <span class="k">end if</span>
<a name="ln-10035"></a>
<a name="ln-10036"></a><span class="k">        do</span>
<a name="ln-10037"></a>
<a name="ln-10038"></a><span class="k">            if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10039"></a>
<a name="ln-10040"></a>                <span class="c">! there is a character pushed back on, most likely</span>
<a name="ln-10041"></a>                <span class="c">! from the number parsing. Note: this can only occur if</span>
<a name="ln-10042"></a>                <span class="c">! reading from a file when use_unformatted_stream=.false.</span>
<a name="ln-10043"></a>                <span class="n">c</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">pushed_char</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="p">:</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="p">)</span>
<a name="ln-10044"></a>                <span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-10045"></a>
<a name="ln-10046"></a>            <span class="k">else</span>
<a name="ln-10047"></a>
<a name="ln-10048"></a><span class="k">                if</span> <span class="p">(</span><span class="n">unit</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!read from the file</span>
<a name="ln-10049"></a>
<a name="ln-10050"></a>                    <span class="c">!read the next character:</span>
<a name="ln-10051"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">use_unformatted_stream</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10052"></a><span class="k">                        read</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">c</span>
<a name="ln-10053"></a>                    <span class="k">else</span>
<a name="ln-10054"></a><span class="k">                        read</span><span class="p">(</span><span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;(A1)&#39;</span><span class="p">,</span><span class="n">advance</span><span class="o">=</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ios</span><span class="p">)</span> <span class="n">c</span>
<a name="ln-10055"></a>                    <span class="k">end if</span>
<a name="ln-10056"></a><span class="k">                    </span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-10057"></a>
<a name="ln-10058"></a>                    <span class="c">!....note: maybe try read the file in chunks...</span>
<a name="ln-10059"></a>                    <span class="c">!.... or use asynchronous read with double buffering</span>
<a name="ln-10060"></a>                    <span class="c">!     (see Modern Fortran: Style and Usage)</span>
<a name="ln-10061"></a>
<a name="ln-10062"></a>                <span class="k">else</span>    <span class="c">!read from the string</span>
<a name="ln-10063"></a>
<a name="ln-10064"></a>                    <span class="n">str_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>   <span class="c">!length of the string</span>
<a name="ln-10065"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span><span class="o">&lt;=</span><span class="n">str_len</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10066"></a><span class="k">                        </span><span class="n">c</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span><span class="p">:</span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span><span class="p">)</span>
<a name="ln-10067"></a>                        <span class="n">ios</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-10068"></a>                    <span class="k">else</span>
<a name="ln-10069"></a><span class="k">                        </span><span class="n">ios</span> <span class="o">=</span> <span class="n">IOSTAT_END</span>  <span class="c">!end of the string</span>
<a name="ln-10070"></a>                    <span class="k">end if</span>
<a name="ln-10071"></a><span class="k">                    </span><span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-10072"></a>
<a name="ln-10073"></a>                <span class="k">end if</span>
<a name="ln-10074"></a>
<a name="ln-10075"></a><span class="k">                </span><span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">+</span> <span class="mi">1</span>    <span class="c">!character count in the current line</span>
<a name="ln-10076"></a>
<a name="ln-10077"></a>                <span class="k">if</span> <span class="p">(</span><span class="nb">IS_IOSTAT_END</span><span class="p">(</span><span class="n">ios</span><span class="p">))</span> <span class="k">then</span>  <span class="c">!end of file</span>
<a name="ln-10078"></a>
<a name="ln-10079"></a>                    <span class="c">! no character to return</span>
<a name="ln-10080"></a>                    <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-10081"></a>                    <span class="n">eof</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-10082"></a>                    <span class="n">popped</span> <span class="o">=</span> <span class="n">space</span> <span class="c">! just to set a value</span>
<a name="ln-10083"></a>                    <span class="k">exit</span>
<a name="ln-10084"></a>
<a name="ln-10085"></a><span class="k">                else if</span> <span class="p">(</span><span class="nb">IS_IOSTAT_EOR</span><span class="p">(</span><span class="n">ios</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">c</span><span class="o">==</span><span class="n">newline</span><span class="p">)</span> <span class="k">then</span>    <span class="c">!end of record</span>
<a name="ln-10086"></a>
<a name="ln-10087"></a>                    <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-10088"></a>                    <span class="n">json</span><span class="p">%</span><span class="n">line_count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">line_count</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-10089"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ignore_comments</span><span class="p">)</span> <span class="n">parsing_comment</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span> <span class="c">! done parsing this comment line</span>
<a name="ln-10090"></a>                    <span class="k">cycle</span>
<a name="ln-10091"></a>
<a name="ln-10092"></a><span class="k">                end if</span>
<a name="ln-10093"></a>
<a name="ln-10094"></a><span class="k">            end if</span>
<a name="ln-10095"></a>
<a name="ln-10096"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ignore_comments</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(</span><span class="n">parsing_comment</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">c</span> <span class="o">==</span> <span class="n">json</span><span class="p">%</span><span class="n">comment_char</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-10097"></a>
<a name="ln-10098"></a>                <span class="c">! skipping the comment</span>
<a name="ln-10099"></a>                <span class="n">parsing_comment</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>
<a name="ln-10100"></a>                <span class="k">cycle</span>
<a name="ln-10101"></a>
<a name="ln-10102"></a><span class="k">            else if</span> <span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">control_chars</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-10103"></a>
<a name="ln-10104"></a>                <span class="c">! non printing ascii characters</span>
<a name="ln-10105"></a>                <span class="k">cycle</span>
<a name="ln-10106"></a>
<a name="ln-10107"></a><span class="k">            else if</span> <span class="p">(</span><span class="n">ignore</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">c</span> <span class="o">==</span> <span class="n">space</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10108"></a>
<a name="ln-10109"></a>                <span class="c">! ignoring whitespace</span>
<a name="ln-10110"></a>                <span class="k">cycle</span>
<a name="ln-10111"></a>
<a name="ln-10112"></a><span class="k">            else</span>
<a name="ln-10113"></a>
<a name="ln-10114"></a>                <span class="c">! return the character</span>
<a name="ln-10115"></a>                <span class="n">popped</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-10116"></a>                <span class="k">exit</span>
<a name="ln-10117"></a>
<a name="ln-10118"></a><span class="k">            end if</span>
<a name="ln-10119"></a>
<a name="ln-10120"></a><span class="k">        end do</span>
<a name="ln-10121"></a>
<a name="ln-10122"></a><span class="k">    end if</span>
<a name="ln-10123"></a>
<a name="ln-10124"></a><span class="k">    end subroutine </span><span class="n">pop_char</span>
<a name="ln-10125"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10126"></a>
<a name="ln-10127"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10128"></a><span class="c">!&gt;</span>
<a name="ln-10129"></a><span class="c">!  Core routine.</span>
<a name="ln-10130"></a><span class="c">!</span>
<a name="ln-10131"></a><span class="c">!### See also</span>
<a name="ln-10132"></a><span class="c">!  * [[pop_char]]</span>
<a name="ln-10133"></a><span class="c">!</span>
<a name="ln-10134"></a><span class="c">!### History</span>
<a name="ln-10135"></a><span class="c">!  * Jacob Williams : 5/3/2015 : replaced original version of this routine.</span>
<a name="ln-10136"></a>
<a name="ln-10137"></a>    <span class="k">subroutine </span><span class="n">push_char</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<a name="ln-10138"></a>
<a name="ln-10139"></a>    <span class="k">implicit none</span>
<a name="ln-10140"></a>
<a name="ln-10141"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>      <span class="kd">::</span> <span class="n">json</span>
<a name="ln-10142"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>     <span class="c">!! to character to push</span>
<a name="ln-10143"></a>
<a name="ln-10144"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">max_numeric_str_len</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istr</span>  <span class="c">!! for error printing</span>
<a name="ln-10145"></a>
<a name="ln-10146"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">exception_thrown</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10147"></a>
<a name="ln-10148"></a><span class="k">        if</span> <span class="p">(</span><span class="n">use_unformatted_stream</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10149"></a>
<a name="ln-10150"></a>            <span class="c">!in this case, c is ignored, and we just</span>
<a name="ln-10151"></a>            <span class="c">!decrement the stream position counter:</span>
<a name="ln-10152"></a>            <span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">ipos</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-10153"></a>
<a name="ln-10154"></a>        <span class="k">else</span>
<a name="ln-10155"></a>
<a name="ln-10156"></a><span class="k">            </span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-10157"></a>
<a name="ln-10158"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="o">&gt;</span><span class="mi">0</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_char</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-10159"></a><span class="k">                </span><span class="n">json</span><span class="p">%</span><span class="n">pushed_char</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="p">:</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a name="ln-10160"></a>            <span class="k">else</span>
<a name="ln-10161"></a><span class="k">                call </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">json</span><span class="p">%</span><span class="n">pushed_index</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">istr</span><span class="p">)</span>
<a name="ln-10162"></a>                <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">throw_exception</span><span class="p">(</span><span class="s1">&#39;Error in push_char: &#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a name="ln-10163"></a>                                          <span class="s1">&#39;invalid valid of pushed_index: &#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="n">istr</span><span class="p">))</span>
<a name="ln-10164"></a>            <span class="k">end if</span>
<a name="ln-10165"></a>
<a name="ln-10166"></a><span class="k">        end if</span>
<a name="ln-10167"></a>
<a name="ln-10168"></a>        <span class="c">!character count in the current line</span>
<a name="ln-10169"></a>        <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">=</span> <span class="n">json</span><span class="p">%</span><span class="n">char_count</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-10170"></a>
<a name="ln-10171"></a>    <span class="k">end if</span>
<a name="ln-10172"></a>
<a name="ln-10173"></a><span class="k">    end subroutine </span><span class="n">push_char</span>
<a name="ln-10174"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10175"></a>
<a name="ln-10176"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10177"></a><span class="c">!&gt; author: Jacob Williams</span>
<a name="ln-10178"></a><span class="c">!</span>
<a name="ln-10179"></a><span class="c">!  Print any error message, and then clear the exceptions.</span>
<a name="ln-10180"></a><span class="c">!</span>
<a name="ln-10181"></a><span class="c">!@note This routine is used by the unit tests.</span>
<a name="ln-10182"></a><span class="c">!      It was originally in json_example.f90, and was</span>
<a name="ln-10183"></a><span class="c">!      moved here 2/26/2015 by Izaak Beekman.</span>
<a name="ln-10184"></a>
<a name="ln-10185"></a>    <span class="k">subroutine </span><span class="n">json_print_error_message</span><span class="p">(</span><span class="n">json</span><span class="p">,</span><span class="n">io_unit</span><span class="p">)</span>
<a name="ln-10186"></a>
<a name="ln-10187"></a>    <span class="k">implicit none</span>
<a name="ln-10188"></a>
<a name="ln-10189"></a><span class="k">    class</span><span class="p">(</span><span class="n">json_core</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">json</span>
<a name="ln-10190"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span> <span class="k">optional</span>  <span class="kd">::</span> <span class="n">io_unit</span>
<a name="ln-10191"></a>
<a name="ln-10192"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">error_msg</span>  <span class="c">!! error message</span>
<a name="ln-10193"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">status_ok</span> <span class="c">!! false if there were any errors thrown</span>
<a name="ln-10194"></a>
<a name="ln-10195"></a>    <span class="c">!get error message:</span>
<a name="ln-10196"></a>    <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">check_for_errors</span><span class="p">(</span><span class="n">status_ok</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
<a name="ln-10197"></a>
<a name="ln-10198"></a>    <span class="c">!print it if there is one:</span>
<a name="ln-10199"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-10200"></a><span class="k">        if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">io_unit</span><span class="p">))</span> <span class="k">then</span>
<a name="ln-10201"></a><span class="k">            write</span><span class="p">(</span><span class="n">io_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="n">error_msg</span>
<a name="ln-10202"></a>        <span class="k">else</span>
<a name="ln-10203"></a><span class="k">            write</span><span class="p">(</span><span class="n">output_unit</span><span class="p">,</span><span class="s1">&#39;(A)&#39;</span><span class="p">)</span> <span class="n">error_msg</span>
<a name="ln-10204"></a>        <span class="k">end if</span>
<a name="ln-10205"></a><span class="k">        deallocate</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>
<a name="ln-10206"></a>        <span class="k">call </span><span class="n">json</span><span class="p">%</span><span class="n">clear_exceptions</span><span class="p">()</span>
<a name="ln-10207"></a>    <span class="k">end if</span>
<a name="ln-10208"></a>
<a name="ln-10209"></a><span class="k">    end subroutine </span><span class="n">json_print_error_message</span>
<a name="ln-10210"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10211"></a>
<a name="ln-10212"></a><span class="c">!*****************************************************************************************</span>
<a name="ln-10213"></a>    <span class="k">end module </span><span class="n">json_value_module</span>
<a name="ln-10214"></a><span class="c">!*****************************************************************************************</span>
</pre></div>

    </section>
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles-1">All Source Files</a></h3></div>
  <div id="allfiles-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../sourcefile/json_file_module.f90.html">json_file_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_kinds.f90.html">json_kinds.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_module.f90.html">json_module.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_parameters.f90.html">json_parameters.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html">json_string_utilities.F90</a>
      
      <a class="list-group-item" href="../sourcefile/json_value_module.f90.html">json_value_module.F90</a>
      
    </div>
  </div>
</div>


  </section>
  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2018 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2018-06-24 04:27  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> JSON-Fortran was developed by Jacob Williams</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>