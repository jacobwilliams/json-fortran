<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="JSON-Fortran â€“ A Modern Fortran JSON API">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>json_string_utilities.F90 &ndash; JSON-Fortran</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">JSON-Fortran <small>8.2.4</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
        
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
               
        
        
            </ul>
        
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>




          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>json_string_utilities.F90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 6.2% of total for source files.">453 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/json_string_utilities.F90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">json_string_utilities.F90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_string_utilities.html">json_string_utilities</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html#src">json_string_utilities.F90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~json_string_utilities.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilejson_string_utilitiesf90EfferentGraph" width="430pt" height="52pt"
 viewBox="0.00 0.00 430.00 52.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 48)">
<title>sourcefile~~json_string_utilities.f90~~EfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-48 426,-48 426,4 -4,4"/>
<!-- sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~json_string_utilities.f90</title>
<polygon fill="none" stroke="black" points="422,-44 286,-44 286,-20 422,-20 422,-44"/>
<text text-anchor="middle" x="354" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">json_string_utilities.F90</text>
</g>
<!-- sourcefile~json_kinds.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~json_kinds.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/json_kinds.f90.html" xlink:title="json_kinds.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="90,-44 0,-44 0,-20 90,-20 90,-44"/>
<text text-anchor="middle" x="45" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_kinds.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_kinds.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_kinds.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M285.96,-32.75C273.98,-32.85 261.62,-32.94 250,-33 194.89,-33.27 181.11,-33.34 126,-33 117.61,-32.95 108.73,-32.86 100.06,-32.77"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.05,-29.27 90.01,-32.65 99.97,-36.27 100.05,-29.27"/>
</g>
<!-- sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~json_parameters.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/json_parameters.f90.html" xlink:title="json_parameters.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="250,-24 126,-24 126,0 250,0 250,-24"/>
<text text-anchor="middle" x="188" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_parameters.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_parameters.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~json_string_utilities.f90&#45;&gt;sourcefile~json_parameters.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M285.82,-23.81C277.3,-22.77 268.56,-21.7 259.98,-20.66"/>
<polygon fill="#ff0000" stroke="#ff0000" points="260.36,-17.18 250.01,-19.44 259.52,-24.13 260.36,-17.18"/>
</g>
<!-- sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_kinds.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~json_parameters.f90&#45;&gt;sourcefile~json_kinds.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M125.98,-20.66C117.4,-21.87 108.64,-23.11 100.21,-24.31"/>
<polygon fill="#00ffff" stroke="#00ffff" points="99.53,-20.87 90.12,-25.74 100.51,-27.8 99.53,-20.87"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 88.5,-24 88.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~json_string_utilities.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilejson_string_utilitiesf90AfferentGraph" width="616pt" height="72pt"
 viewBox="0.00 0.00 616.00 72.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 68)">
<title>sourcefile~~json_string_utilities.f90~~AfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-68 612,-68 612,4 -4,4"/>
<!-- sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~json_string_utilities.f90</title>
<polygon fill="none" stroke="black" points="136,-44 0,-44 0,-20 136,-20 136,-44"/>
<text text-anchor="middle" x="68" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50">json_string_utilities.F90</text>
</g>
<!-- sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~json_file_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/json_file_module.f90.html" xlink:title="json_file_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="469,-64 345,-64 345,-40 469,-40 469,-64"/>
<text text-anchor="middle" x="407" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_file_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M344.97,-48.38C289.3,-45.07 206.76,-40.18 146.46,-36.6"/>
<polygon fill="#ff0000" stroke="#ff0000" points="146.41,-33.09 136.22,-35.99 146,-40.08 146.41,-33.09"/>
</g>
<!-- sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~json_value_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/json_value_module.f90.html" xlink:title="json_value_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="309,-24 172,-24 172,0 309,0 309,-24"/>
<text text-anchor="middle" x="240.5" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_value_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~json_file_module.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M356.64,-40C339.16,-35.75 319.29,-30.92 301.05,-26.48"/>
<polygon fill="#00ffff" stroke="#00ffff" points="301.65,-23.02 291.1,-24.06 299.99,-29.83 301.65,-23.02"/>
</g>
<!-- sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_string_utilities.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~json_value_module.f90&#45;&gt;sourcefile~json_string_utilities.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M171.62,-19.96C163.21,-20.95 154.57,-21.96 146.03,-22.96"/>
<polygon fill="#ff0000" stroke="#ff0000" points="145.61,-19.49 136.09,-24.13 146.43,-26.44 145.61,-19.49"/>
</g>
<!-- sourcefile~json_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~json_module.f90</title>
<g id="a_sourcefile~~json_string_utilities.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/json_module.f90.html" xlink:title="json_module.F90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="608,-44 505,-44 505,-20 608,-20 608,-44"/>
<text text-anchor="middle" x="556.5" y="-29.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">json_module.F90</text>
</a>
</g>
</g>
<!-- sourcefile~json_module.f90&#45;&gt;sourcefile~json_file_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~json_module.f90&#45;&gt;sourcefile~json_file_module.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M504.74,-38.88C496.47,-40 487.78,-41.18 479.13,-42.35"/>
<polygon fill="#ff0000" stroke="#ff0000" points="478.47,-38.91 469.04,-43.72 479.41,-45.85 478.47,-38.91"/>
</g>
<!-- sourcefile~json_module.f90&#45;&gt;sourcefile~json_value_module.f90 -->
<g id="sourcefile~~json_string_utilities.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~json_module.f90&#45;&gt;sourcefile~json_value_module.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M504.7,-28.76C454.6,-25.57 377.33,-20.65 319.45,-16.96"/>
<polygon fill="#00ffff" stroke="#00ffff" points="319.44,-13.46 309.24,-16.31 319,-20.44 319.44,-13.46"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="202pt" height="32pt"
 viewBox="0.00 0.00 201.50 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 197.5,-28 197.5,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="193.5,-24 88.5,-24 88.5,0 193.5,0 193.5,-24"/>
<text text-anchor="middle" x="141" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/json_string_utilities.html">json_string_utilities</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/json_string_utilities.f90.html#src">json_string_utilities.F90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a id="ln-1" name="ln-1"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-2" name="ln-2"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-3" name="ln-3"></a><span class="c">!  license: BSD</span>
<a id="ln-4" name="ln-4"></a><span class="c">!</span>
<a id="ln-5" name="ln-5"></a><span class="c">!  JSON-Fortran support module for string manipulation.</span>
<a id="ln-6" name="ln-6"></a><span class="c">!</span>
<a id="ln-7" name="ln-7"></a><span class="c">!### License</span>
<a id="ln-8" name="ln-8"></a><span class="c">!  * JSON-Fortran is released under a BSD-style license.</span>
<a id="ln-9" name="ln-9"></a><span class="c">!    See the [LICENSE](https://github.com/jacobwilliams/json-fortran/blob/master/LICENSE)</span>
<a id="ln-10" name="ln-10"></a><span class="c">!    file for details.</span>
<a id="ln-11" name="ln-11"></a>
<a id="ln-12" name="ln-12"></a>    <span class="k">module </span><span class="n">json_string_utilities</span>
<a id="ln-13" name="ln-13"></a>
<a id="ln-14" name="ln-14"></a>    <span class="k">use</span><span class="p">,</span><span class="k">intrinsic</span> <span class="kd">::</span> <span class="n">ieee_arithmetic</span>
<a id="ln-15" name="ln-15"></a>    <span class="k">use </span><span class="n">json_kinds</span>
<a id="ln-16" name="ln-16"></a>    <span class="k">use </span><span class="n">json_parameters</span>
<a id="ln-17" name="ln-17"></a>
<a id="ln-18" name="ln-18"></a>    <span class="k">implicit none</span>
<a id="ln-19" name="ln-19"></a>
<a id="ln-20" name="ln-20"></a><span class="k">    private</span>
<a id="ln-21" name="ln-21"></a>
<a id="ln-22" name="ln-22"></a>    <span class="c">!******************************************************</span>
<a id="ln-23" name="ln-23"></a>    <span class="c">!&gt;</span>
<a id="ln-24" name="ln-24"></a>    <span class="c">!  Convert a &#39;DEFAULT&#39; kind character input to</span>
<a id="ln-25" name="ln-25"></a>    <span class="c">!  &#39;ISO_10646&#39; kind and return it</span>
<a id="ln-26" name="ln-26"></a>    <span class="k">interface </span><span class="n">to_unicode</span>
<a id="ln-27" name="ln-27"></a>        <span class="k">module procedure </span><span class="n">to_uni</span><span class="p">,</span> <span class="n">to_uni_vec</span>
<a id="ln-28" name="ln-28"></a>    <span class="k">end interface</span>
<a id="ln-29" name="ln-29"></a>    <span class="c">!******************************************************</span>
<a id="ln-30" name="ln-30"></a>
<a id="ln-31" name="ln-31"></a><span class="cp">#ifdef USE_UCS4</span>
<a id="ln-32" name="ln-32"></a>    <span class="c">!******************************************************</span>
<a id="ln-33" name="ln-33"></a>    <span class="c">!&gt;</span>
<a id="ln-34" name="ln-34"></a>    <span class="c">! Provide a means to convert to UCS4 while</span>
<a id="ln-35" name="ln-35"></a>    <span class="c">! concatenating UCS4 and default strings</span>
<a id="ln-36" name="ln-36"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">)</span>
<a id="ln-37" name="ln-37"></a>       <span class="k">module procedure </span><span class="n">ucs4_join_default</span><span class="p">,</span> <span class="n">default_join_ucs4</span>
<a id="ln-38" name="ln-38"></a>    <span class="k">end interface</span>
<a id="ln-39" name="ln-39"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">)</span>
<a id="ln-40" name="ln-40"></a>    <span class="c">!******************************************************</span>
<a id="ln-41" name="ln-41"></a>
<a id="ln-42" name="ln-42"></a>    <span class="c">!******************************************************</span>
<a id="ln-43" name="ln-43"></a>    <span class="c">!&gt;</span>
<a id="ln-44" name="ln-44"></a>    <span class="c">! Provide a string `==` operator that works</span>
<a id="ln-45" name="ln-45"></a>    <span class="c">! with mixed kinds</span>
<a id="ln-46" name="ln-46"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">==</span><span class="p">)</span>
<a id="ln-47" name="ln-47"></a>       <span class="k">module procedure </span><span class="n">ucs4_comp_default</span><span class="p">,</span> <span class="n">default_comp_ucs4</span>
<a id="ln-48" name="ln-48"></a>    <span class="k">end interface</span>
<a id="ln-49" name="ln-49"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">==</span><span class="p">)</span>
<a id="ln-50" name="ln-50"></a>    <span class="c">!******************************************************</span>
<a id="ln-51" name="ln-51"></a>
<a id="ln-52" name="ln-52"></a>    <span class="c">!******************************************************</span>
<a id="ln-53" name="ln-53"></a>    <span class="c">!&gt;</span>
<a id="ln-54" name="ln-54"></a>    <span class="c">! Provide a string `/=` operator that works</span>
<a id="ln-55" name="ln-55"></a>    <span class="c">! with mixed kinds</span>
<a id="ln-56" name="ln-56"></a>    <span class="k">interface </span><span class="n">operator</span><span class="p">(</span><span class="o">/=</span><span class="p">)</span>
<a id="ln-57" name="ln-57"></a>       <span class="k">module procedure </span><span class="n">ucs4_neq_default</span><span class="p">,</span> <span class="n">default_neq_ucs4</span>
<a id="ln-58" name="ln-58"></a>    <span class="k">end interface</span>
<a id="ln-59" name="ln-59"></a><span class="k">    public</span> <span class="kd">::</span> <span class="n">operator</span><span class="p">(</span><span class="o">/=</span><span class="p">)</span>
<a id="ln-60" name="ln-60"></a>    <span class="c">!******************************************************</span>
<a id="ln-61" name="ln-61"></a><span class="cp">#endif</span>
<a id="ln-62" name="ln-62"></a>
<a id="ln-63" name="ln-63"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">integer_to_string</span>
<a id="ln-64" name="ln-64"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">real_to_string</span>
<a id="ln-65" name="ln-65"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">string_to_integer</span>
<a id="ln-66" name="ln-66"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">string_to_real</span>
<a id="ln-67" name="ln-67"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">valid_json_hex</span>
<a id="ln-68" name="ln-68"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">to_unicode</span>
<a id="ln-69" name="ln-69"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">escape_string</span>
<a id="ln-70" name="ln-70"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">unescape_string</span>
<a id="ln-71" name="ln-71"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">lowercase_string</span>
<a id="ln-72" name="ln-72"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">replace_string</span>
<a id="ln-73" name="ln-73"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">decode_rfc6901</span>
<a id="ln-74" name="ln-74"></a>    <span class="k">public</span> <span class="kd">::</span> <span class="n">encode_rfc6901</span>
<a id="ln-75" name="ln-75"></a>
<a id="ln-76" name="ln-76"></a>    <span class="k">contains</span>
<a id="ln-77" name="ln-77"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-78" name="ln-78"></a>
<a id="ln-79" name="ln-79"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-80" name="ln-80"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-81" name="ln-81"></a><span class="c">!  date: 12/4/2013</span>
<a id="ln-82" name="ln-82"></a><span class="c">!</span>
<a id="ln-83" name="ln-83"></a><span class="c">!  Convert an integer to a string.</span>
<a id="ln-84" name="ln-84"></a>
<a id="ln-85" name="ln-85"></a>    <span class="k">pure subroutine </span><span class="n">integer_to_string</span><span class="p">(</span><span class="n">ival</span><span class="p">,</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a id="ln-86" name="ln-86"></a>
<a id="ln-87" name="ln-87"></a>    <span class="k">implicit none</span>
<a id="ln-88" name="ln-88"></a>
<a id="ln-89" name="ln-89"></a><span class="k">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">ival</span>    <span class="c">!! integer value.</span>
<a id="ln-90" name="ln-90"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">int_fmt</span> <span class="c">!! format for integers</span>
<a id="ln-91" name="ln-91"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>     <span class="c">!! `ival` converted to a string.</span>
<a id="ln-92" name="ln-92"></a>
<a id="ln-93" name="ln-93"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span>
<a id="ln-94" name="ln-94"></a>
<a id="ln-95" name="ln-95"></a>    <span class="k">write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">int_fmt</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">ival</span>
<a id="ln-96" name="ln-96"></a>
<a id="ln-97" name="ln-97"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-98" name="ln-98"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-99" name="ln-99"></a>    <span class="k">else</span>
<a id="ln-100" name="ln-100"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">star</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>
<a id="ln-101" name="ln-101"></a>    <span class="k">end if</span>
<a id="ln-102" name="ln-102"></a>
<a id="ln-103" name="ln-103"></a><span class="k">    end subroutine </span><span class="n">integer_to_string</span>
<a id="ln-104" name="ln-104"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-105" name="ln-105"></a>
<a id="ln-106" name="ln-106"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-107" name="ln-107"></a><span class="c">!&gt;</span>
<a id="ln-108" name="ln-108"></a><span class="c">!  Convert a string into an integer.</span>
<a id="ln-109" name="ln-109"></a><span class="c">!</span>
<a id="ln-110" name="ln-110"></a><span class="c">!# History</span>
<a id="ln-111" name="ln-111"></a><span class="c">!  * Jacob Williams : 12/10/2013 : Rewrote original `parse_integer` routine.</span>
<a id="ln-112" name="ln-112"></a><span class="c">!    Added error checking.</span>
<a id="ln-113" name="ln-113"></a><span class="c">!  * Modified by Izaak Beekman</span>
<a id="ln-114" name="ln-114"></a><span class="c">!  * Jacob Williams : 2/4/2017 : moved core logic to this routine.</span>
<a id="ln-115" name="ln-115"></a>
<a id="ln-116" name="ln-116"></a>    <span class="k">subroutine </span><span class="n">string_to_integer</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">ival</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a id="ln-117" name="ln-117"></a>
<a id="ln-118" name="ln-118"></a>    <span class="k">implicit none</span>
<a id="ln-119" name="ln-119"></a>
<a id="ln-120" name="ln-120"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>        <span class="c">!! the string to convert to an integer</span>
<a id="ln-121" name="ln-121"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">ival</span>       <span class="c">!! the integer value</span>
<a id="ln-122" name="ln-122"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">status_ok</span>  <span class="c">!! true if there were no errors</span>
<a id="ln-123" name="ln-123"></a>
<a id="ln-124" name="ln-124"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="nb">digits</span>
<a id="ln-125" name="ln-125"></a><span class="nb">    </span><span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ndigits_digits</span><span class="p">,</span><span class="n">ndigits</span><span class="p">,</span><span class="n">ierr</span>
<a id="ln-126" name="ln-126"></a>
<a id="ln-127" name="ln-127"></a>    <span class="c">! Compute how many digits we need to read</span>
<a id="ln-128" name="ln-128"></a>    <span class="n">ndigits</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len_trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-129" name="ln-129"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ndigits</span><span class="o">/=</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-130" name="ln-130"></a><span class="k">        </span><span class="n">ndigits_digits</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">(</span><span class="n">log10</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">ndigits</span><span class="p">)))</span><span class="o">+</span><span class="mi">1</span>
<a id="ln-131" name="ln-131"></a>        <span class="k">allocate</span><span class="p">(</span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="n">ndigits_digits</span><span class="p">)</span> <span class="kd">::</span> <span class="nb">digits</span><span class="p">)</span>
<a id="ln-132" name="ln-132"></a>        <span class="k">write</span><span class="p">(</span><span class="nb">digits</span><span class="p">,</span><span class="s1">&#39;(I0)&#39;</span><span class="p">)</span> <span class="n">ndigits</span> <span class="c">!gfortran will have a runtime error with * edit descriptor here</span>
<a id="ln-133" name="ln-133"></a>        <span class="c">! gfortran bug: &#39;*&#39; edit descriptor for ISO_10646 strings does bad stuff.</span>
<a id="ln-134" name="ln-134"></a>        <span class="k">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="s1">&#39;(I&#39;</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">digits</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span> <span class="n">ival</span>   <span class="c">!string to integer</span>
<a id="ln-135" name="ln-135"></a>        <span class="c">! error check:</span>
<a id="ln-136" name="ln-136"></a>        <span class="n">status_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a id="ln-137" name="ln-137"></a>    <span class="k">else</span>
<a id="ln-138" name="ln-138"></a><span class="k">        </span><span class="n">status_ok</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a id="ln-139" name="ln-139"></a>    <span class="k">end if</span>
<a id="ln-140" name="ln-140"></a><span class="k">    if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="n">ival</span> <span class="o">=</span> <span class="mi">0_IK</span>
<a id="ln-141" name="ln-141"></a>
<a id="ln-142" name="ln-142"></a>    <span class="k">end subroutine </span><span class="n">string_to_integer</span>
<a id="ln-143" name="ln-143"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-144" name="ln-144"></a>
<a id="ln-145" name="ln-145"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-146" name="ln-146"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-147" name="ln-147"></a><span class="c">!  date: 12/4/2013</span>
<a id="ln-148" name="ln-148"></a><span class="c">!</span>
<a id="ln-149" name="ln-149"></a><span class="c">!  Convert a real value to a string.</span>
<a id="ln-150" name="ln-150"></a><span class="c">!</span>
<a id="ln-151" name="ln-151"></a><span class="c">!### Modified</span>
<a id="ln-152" name="ln-152"></a><span class="c">!  * Izaak Beekman  : 02/24/2015 : added the compact option.</span>
<a id="ln-153" name="ln-153"></a><span class="c">!  * Jacob Williams : 10/27/2015 : added the star option.</span>
<a id="ln-154" name="ln-154"></a><span class="c">!  * Jacob Williams : 07/07/2019 : added null and ieee options.</span>
<a id="ln-155" name="ln-155"></a>
<a id="ln-156" name="ln-156"></a>    <span class="k">subroutine </span><span class="n">real_to_string</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span><span class="n">real_fmt</span><span class="p">,</span><span class="n">compact_real</span><span class="p">,</span><span class="n">non_normals_to_null</span><span class="p">,</span><span class="n">str</span><span class="p">)</span>
<a id="ln-157" name="ln-157"></a>
<a id="ln-158" name="ln-158"></a>    <span class="k">implicit none</span>
<a id="ln-159" name="ln-159"></a>
<a id="ln-160" name="ln-160"></a><span class="k">    </span><span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                  <span class="kd">::</span> <span class="n">rval</span>         <span class="c">!! real value.</span>
<a id="ln-161" name="ln-161"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">real_fmt</span>     <span class="c">!! format for real numbers</span>
<a id="ln-162" name="ln-162"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">compact_real</span> <span class="c">!! compact the string so that it is</span>
<a id="ln-163" name="ln-163"></a>                                                         <span class="c">!! displayed with fewer characters</span>
<a id="ln-164" name="ln-164"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>               <span class="kd">::</span> <span class="n">non_normals_to_null</span> <span class="c">!! If True, NaN, Infinity, or -Infinity are returned as `null`.</span>
<a id="ln-165" name="ln-165"></a>                                                                <span class="c">!! If False, the string value will be returned in quotes</span>
<a id="ln-166" name="ln-166"></a>                                                                <span class="c">!! (e.g., &quot;NaN&quot;, &quot;Infinity&quot;, or &quot;-Infinity&quot; )</span>
<a id="ln-167" name="ln-167"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>          <span class="c">!! `rval` converted to a string.</span>
<a id="ln-168" name="ln-168"></a>
<a id="ln-169" name="ln-169"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">istat</span> <span class="c">!! write `iostat` flag</span>
<a id="ln-170" name="ln-170"></a>
<a id="ln-171" name="ln-171"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">ieee_is_finite</span><span class="p">(</span><span class="n">rval</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">ieee_is_nan</span><span class="p">(</span><span class="n">rval</span><span class="p">))</span> <span class="k">then</span>
<a id="ln-172" name="ln-172"></a>
<a id="ln-173" name="ln-173"></a>        <span class="c">! normal real numbers</span>
<a id="ln-174" name="ln-174"></a>
<a id="ln-175" name="ln-175"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">real_fmt</span><span class="o">==</span><span class="n">star</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-176" name="ln-176"></a><span class="k">            write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">rval</span>
<a id="ln-177" name="ln-177"></a>        <span class="k">else</span>
<a id="ln-178" name="ln-178"></a><span class="k">            write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">real_fmt</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">rval</span>
<a id="ln-179" name="ln-179"></a>        <span class="k">end if</span>
<a id="ln-180" name="ln-180"></a>
<a id="ln-181" name="ln-181"></a><span class="k">        if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-182" name="ln-182"></a>            <span class="c">!in this case, the default string will be compacted,</span>
<a id="ln-183" name="ln-183"></a>            <span class="c">! so that the same value is displayed with fewer characters.</span>
<a id="ln-184" name="ln-184"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">compact_real</span><span class="p">)</span> <span class="k">call </span><span class="n">compact_real_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-185" name="ln-185"></a>        <span class="k">else</span>
<a id="ln-186" name="ln-186"></a><span class="k">            </span><span class="n">str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">star</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="c">! error</span>
<a id="ln-187" name="ln-187"></a>        <span class="k">end if</span>
<a id="ln-188" name="ln-188"></a>
<a id="ln-189" name="ln-189"></a><span class="k">    else</span>
<a id="ln-190" name="ln-190"></a>        <span class="c">! special cases for NaN, Infinity, and -Infinity</span>
<a id="ln-191" name="ln-191"></a>
<a id="ln-192" name="ln-192"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">non_normals_to_null</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-193" name="ln-193"></a>            <span class="c">! return it as a JSON null value</span>
<a id="ln-194" name="ln-194"></a>            <span class="n">str</span> <span class="o">=</span> <span class="n">null_str</span>
<a id="ln-195" name="ln-195"></a>        <span class="k">else</span>
<a id="ln-196" name="ln-196"></a>            <span class="c">! Let the compiler do the real to string conversion</span>
<a id="ln-197" name="ln-197"></a>            <span class="c">! like before, but put the result in quotes so it</span>
<a id="ln-198" name="ln-198"></a>            <span class="c">! gets printed as a string</span>
<a id="ln-199" name="ln-199"></a>            <span class="k">write</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">istat</span><span class="p">)</span> <span class="n">rval</span>
<a id="ln-200" name="ln-200"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">istat</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-201" name="ln-201"></a><span class="k">                </span><span class="n">str</span> <span class="o">=</span> <span class="n">quotation_mark</span><span class="o">//</span><span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">))</span><span class="o">//</span><span class="n">quotation_mark</span>
<a id="ln-202" name="ln-202"></a>            <span class="k">else</span>
<a id="ln-203" name="ln-203"></a><span class="k">                </span><span class="n">str</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">star</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="c">! error</span>
<a id="ln-204" name="ln-204"></a>            <span class="k">end if</span>
<a id="ln-205" name="ln-205"></a><span class="k">        end if</span>
<a id="ln-206" name="ln-206"></a>
<a id="ln-207" name="ln-207"></a><span class="k">    end if</span>
<a id="ln-208" name="ln-208"></a>
<a id="ln-209" name="ln-209"></a><span class="k">    end subroutine </span><span class="n">real_to_string</span>
<a id="ln-210" name="ln-210"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-211" name="ln-211"></a>
<a id="ln-212" name="ln-212"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-213" name="ln-213"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-214" name="ln-214"></a><span class="c">!  date: 1/19/2014</span>
<a id="ln-215" name="ln-215"></a><span class="c">!</span>
<a id="ln-216" name="ln-216"></a><span class="c">!  Convert a string into a `real(RK)`.</span>
<a id="ln-217" name="ln-217"></a><span class="c">!</span>
<a id="ln-218" name="ln-218"></a><span class="c">!# History</span>
<a id="ln-219" name="ln-219"></a><span class="c">!  * Jacob Williams, 10/27/2015 : Now using `fmt=*`, rather than</span>
<a id="ln-220" name="ln-220"></a><span class="c">!    `fmt=real_fmt`, since it doesn&#39;t work for some unusual cases</span>
<a id="ln-221" name="ln-221"></a><span class="c">!    (e.g., when `str=&#39;1E-5&#39;`).</span>
<a id="ln-222" name="ln-222"></a><span class="c">!  * Jacob Williams : 2/6/2017 : moved core logic to this routine.</span>
<a id="ln-223" name="ln-223"></a>
<a id="ln-224" name="ln-224"></a>    <span class="k">subroutine </span><span class="n">string_to_real</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">use_quiet_nan</span><span class="p">,</span><span class="n">rval</span><span class="p">,</span><span class="n">status_ok</span><span class="p">)</span>
<a id="ln-225" name="ln-225"></a>
<a id="ln-226" name="ln-226"></a>    <span class="k">implicit none</span>
<a id="ln-227" name="ln-227"></a>
<a id="ln-228" name="ln-228"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>           <span class="c">!! the string to convert to a real</span>
<a id="ln-229" name="ln-229"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">use_quiet_nan</span> <span class="c">!! if true, return NaN&#39;s as `ieee_quiet_nan`.</span>
<a id="ln-230" name="ln-230"></a>                                                         <span class="c">!! otherwise, use `ieee_signaling_nan`.</span>
<a id="ln-231" name="ln-231"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">RK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                <span class="kd">::</span> <span class="n">rval</span>          <span class="c">!! `str` converted to a real value</span>
<a id="ln-232" name="ln-232"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">status_ok</span>     <span class="c">!! true if there were no errors</span>
<a id="ln-233" name="ln-233"></a>
<a id="ln-234" name="ln-234"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>  <span class="c">!! read iostat error code</span>
<a id="ln-235" name="ln-235"></a>
<a id="ln-236" name="ln-236"></a>    <span class="k">read</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">fmt</span><span class="o">=*</span><span class="p">,</span><span class="n">iostat</span><span class="o">=</span><span class="n">ierr</span><span class="p">)</span> <span class="n">rval</span>
<a id="ln-237" name="ln-237"></a>    <span class="n">status_ok</span> <span class="o">=</span> <span class="p">(</span><span class="n">ierr</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<a id="ln-238" name="ln-238"></a>    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="n">status_ok</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-239" name="ln-239"></a><span class="k">        </span><span class="n">rval</span> <span class="o">=</span> <span class="mf">0.0_RK</span>
<a id="ln-240" name="ln-240"></a>    <span class="k">else</span>
<a id="ln-241" name="ln-241"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ieee_support_nan</span><span class="p">(</span><span class="n">rval</span><span class="p">))</span> <span class="k">then</span>
<a id="ln-242" name="ln-242"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ieee_is_nan</span><span class="p">(</span><span class="n">rval</span><span class="p">))</span> <span class="k">then</span>
<a id="ln-243" name="ln-243"></a>                <span class="c">! make sure to return the correct NaN</span>
<a id="ln-244" name="ln-244"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">use_quiet_nan</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-245" name="ln-245"></a><span class="k">                    </span><span class="n">rval</span> <span class="o">=</span> <span class="n">ieee_value</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span><span class="n">ieee_quiet_nan</span><span class="p">)</span>
<a id="ln-246" name="ln-246"></a>                <span class="k">else</span>
<a id="ln-247" name="ln-247"></a><span class="k">                    </span><span class="n">rval</span> <span class="o">=</span> <span class="n">ieee_value</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span><span class="n">ieee_signaling_nan</span><span class="p">)</span>
<a id="ln-248" name="ln-248"></a>                <span class="k">end if</span>
<a id="ln-249" name="ln-249"></a><span class="k">            end if</span>
<a id="ln-250" name="ln-250"></a><span class="k">        end if</span>
<a id="ln-251" name="ln-251"></a><span class="k">    end if</span>
<a id="ln-252" name="ln-252"></a>
<a id="ln-253" name="ln-253"></a><span class="k">    end subroutine </span><span class="n">string_to_real</span>
<a id="ln-254" name="ln-254"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-255" name="ln-255"></a>
<a id="ln-256" name="ln-256"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-257" name="ln-257"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-258" name="ln-258"></a><span class="c">!  date: 02/24/2015</span>
<a id="ln-259" name="ln-259"></a><span class="c">!</span>
<a id="ln-260" name="ln-260"></a><span class="c">!  Compact a string representing a real number, so that</span>
<a id="ln-261" name="ln-261"></a><span class="c">!  the same value is displayed with fewer characters.</span>
<a id="ln-262" name="ln-262"></a><span class="c">!</span>
<a id="ln-263" name="ln-263"></a><span class="c">!# See also</span>
<a id="ln-264" name="ln-264"></a><span class="c">!  * [[real_to_string]]</span>
<a id="ln-265" name="ln-265"></a>
<a id="ln-266" name="ln-266"></a>    <span class="k">subroutine </span><span class="n">compact_real_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-267" name="ln-267"></a>
<a id="ln-268" name="ln-268"></a>    <span class="k">implicit none</span>
<a id="ln-269" name="ln-269"></a>
<a id="ln-270" name="ln-270"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>  <span class="c">!! string representation of a real number.</span>
<a id="ln-271" name="ln-271"></a>
<a id="ln-272" name="ln-272"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">significand</span>
<a id="ln-273" name="ln-273"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">expnt</span>
<a id="ln-274" name="ln-274"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="kd">::</span> <span class="n">separator</span>
<a id="ln-275" name="ln-275"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">exp_start</span>
<a id="ln-276" name="ln-276"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">decimal_pos</span>
<a id="ln-277" name="ln-277"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">sig_trim</span>
<a id="ln-278" name="ln-278"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">exp_trim</span>
<a id="ln-279" name="ln-279"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a id="ln-280" name="ln-280"></a>
<a id="ln-281" name="ln-281"></a>    <span class="n">str</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-282" name="ln-282"></a>    <span class="n">exp_start</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;eEdD&#39;</span><span class="p">)</span>
<a id="ln-283" name="ln-283"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">exp_start</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;-+&#39;</span><span class="p">,</span><span class="n">back</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.)</span>
<a id="ln-284" name="ln-284"></a>    <span class="n">decimal_pos</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">CK_</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<a id="ln-285" name="ln-285"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">separator</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="p">:</span><span class="n">exp_start</span><span class="p">)</span>
<a id="ln-286" name="ln-286"></a>
<a id="ln-287" name="ln-287"></a>    <span class="k">if</span> <span class="p">(</span> <span class="n">exp_start</span> <span class="o">&lt;</span> <span class="n">decimal_pos</span> <span class="p">)</span> <span class="k">then</span> <span class="c">!possibly signed, exponent-less float</span>
<a id="ln-288" name="ln-288"></a>
<a id="ln-289" name="ln-289"></a>        <span class="n">significand</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-290" name="ln-290"></a>        <span class="n">sig_trim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">))</span>
<a id="ln-291" name="ln-291"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">)),</span><span class="n">decimal_pos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="c">!look from right to left at 0s</span>
<a id="ln-292" name="ln-292"></a>                                                       <span class="c">!but save one after the decimal place</span>
<a id="ln-293" name="ln-293"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-294" name="ln-294"></a><span class="k">                </span><span class="n">sig_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a id="ln-295" name="ln-295"></a>            <span class="k">else</span>
<a id="ln-296" name="ln-296"></a><span class="k">                exit</span>
<a id="ln-297" name="ln-297"></a><span class="k">            end if</span>
<a id="ln-298" name="ln-298"></a><span class="k">        end do</span>
<a id="ln-299" name="ln-299"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sig_trim</span><span class="p">))</span>
<a id="ln-300" name="ln-300"></a>
<a id="ln-301" name="ln-301"></a>    <span class="k">else if</span> <span class="p">(</span><span class="n">exp_start</span> <span class="o">&gt;</span> <span class="n">decimal_pos</span><span class="p">)</span> <span class="k">then</span> <span class="c">!float has exponent</span>
<a id="ln-302" name="ln-302"></a>
<a id="ln-303" name="ln-303"></a>        <span class="n">significand</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">exp_start</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="ln-304" name="ln-304"></a>        <span class="n">sig_trim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">))</span>
<a id="ln-305" name="ln-305"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">significand</span><span class="p">)),</span><span class="n">decimal_pos</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span> <span class="c">!look from right to left at 0s</span>
<a id="ln-306" name="ln-306"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-307" name="ln-307"></a><span class="k">                </span><span class="n">sig_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span>
<a id="ln-308" name="ln-308"></a>            <span class="k">else</span>
<a id="ln-309" name="ln-309"></a><span class="k">                exit</span>
<a id="ln-310" name="ln-310"></a><span class="k">            end if</span>
<a id="ln-311" name="ln-311"></a><span class="k">        end do</span>
<a id="ln-312" name="ln-312"></a><span class="k">        </span><span class="n">expnt</span> <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="o">+</span><span class="mi">1</span><span class="p">:))</span>
<a id="ln-313" name="ln-313"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-314" name="ln-314"></a><span class="k">            </span><span class="n">separator</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">separator</span><span class="p">))</span><span class="o">//</span><span class="n">expnt</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">)</span>
<a id="ln-315" name="ln-315"></a>            <span class="n">exp_start</span> <span class="o">=</span> <span class="n">exp_start</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-316" name="ln-316"></a>            <span class="n">expnt</span>     <span class="o">=</span> <span class="nb">adjustl</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">exp_start</span><span class="o">+</span><span class="mi">1</span><span class="p">:))</span>
<a id="ln-317" name="ln-317"></a>        <span class="k">end if</span>
<a id="ln-318" name="ln-318"></a><span class="k">        </span><span class="n">exp_trim</span> <span class="o">=</span> <span class="mi">1</span>
<a id="ln-319" name="ln-319"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="n">expnt</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c">!look at exponent leading zeros saving last</span>
<a id="ln-320" name="ln-320"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-321" name="ln-321"></a><span class="k">                </span><span class="n">exp_trim</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
<a id="ln-322" name="ln-322"></a>            <span class="k">else</span>
<a id="ln-323" name="ln-323"></a><span class="k">                exit</span>
<a id="ln-324" name="ln-324"></a><span class="k">            end if</span>
<a id="ln-325" name="ln-325"></a><span class="k">        end do</span>
<a id="ln-326" name="ln-326"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">sig_trim</span><span class="p">)))</span><span class="o">//</span> <span class="p">&amp;</span>
<a id="ln-327" name="ln-327"></a>              <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">separator</span><span class="p">))</span><span class="o">//</span> <span class="p">&amp;</span>
<a id="ln-328" name="ln-328"></a>              <span class="nb">trim</span><span class="p">(</span><span class="nb">adjustl</span><span class="p">(</span><span class="n">expnt</span><span class="p">(</span><span class="n">exp_trim</span><span class="p">:)))</span>
<a id="ln-329" name="ln-329"></a>
<a id="ln-330" name="ln-330"></a>    <span class="c">!else ! mal-formed real, BUT this code should be unreachable</span>
<a id="ln-331" name="ln-331"></a>
<a id="ln-332" name="ln-332"></a>    <span class="k">end if</span>
<a id="ln-333" name="ln-333"></a>
<a id="ln-334" name="ln-334"></a><span class="k">    end subroutine </span><span class="n">compact_real_string</span>
<a id="ln-335" name="ln-335"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-336" name="ln-336"></a>
<a id="ln-337" name="ln-337"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-338" name="ln-338"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-339" name="ln-339"></a><span class="c">!  date: 1/21/2014</span>
<a id="ln-340" name="ln-340"></a><span class="c">!</span>
<a id="ln-341" name="ln-341"></a><span class="c">!  Add the escape characters to a string for adding to JSON.</span>
<a id="ln-342" name="ln-342"></a>
<a id="ln-343" name="ln-343"></a>    <span class="k">subroutine </span><span class="n">escape_string</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span> <span class="n">str_out</span><span class="p">,</span> <span class="n">escape_solidus</span><span class="p">)</span>
<a id="ln-344" name="ln-344"></a>
<a id="ln-345" name="ln-345"></a>    <span class="k">implicit none</span>
<a id="ln-346" name="ln-346"></a>
<a id="ln-347" name="ln-347"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>              <span class="kd">::</span> <span class="n">str_in</span>
<a id="ln-348" name="ln-348"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str_out</span>
<a id="ln-349" name="ln-349"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">escape_solidus</span>  <span class="c">!! if the solidus (forward slash)</span>
<a id="ln-350" name="ln-350"></a>                                              <span class="c">!! is also to be escaped</span>
<a id="ln-351" name="ln-351"></a>
<a id="ln-352" name="ln-352"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>    <span class="c">!! counter</span>
<a id="ln-353" name="ln-353"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ipos</span> <span class="c">!! accumulated string size</span>
<a id="ln-354" name="ln-354"></a>                        <span class="c">!! (so we can allocate it in chunks for</span>
<a id="ln-355" name="ln-355"></a>                        <span class="c">!! greater runtime efficiency)</span>
<a id="ln-356" name="ln-356"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>  <span class="c">!! for reading `str_in` one character at a time.</span>
<a id="ln-357" name="ln-357"></a><span class="cp">#if defined __GFORTRAN__</span>
<a id="ln-358" name="ln-358"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span> <span class="c">!! workaround for bug in gfortran 6.1</span>
<a id="ln-359" name="ln-359"></a><span class="cp">#endif</span>
<a id="ln-360" name="ln-360"></a>    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">to_be_escaped</span> <span class="c">!! if there are characters to be escaped</span>
<a id="ln-361" name="ln-361"></a>
<a id="ln-362" name="ln-362"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">specials_no_slash</span> <span class="o">=</span> <span class="n">quotation_mark</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-363" name="ln-363"></a>                                                     <span class="n">backslash</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-364" name="ln-364"></a>                                                     <span class="n">bspace</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-365" name="ln-365"></a>                                                     <span class="n">formfeed</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-366" name="ln-366"></a>                                                     <span class="n">newline</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-367" name="ln-367"></a>                                                     <span class="n">carriage_return</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-368" name="ln-368"></a>                                                     <span class="n">horizontal_tab</span>
<a id="ln-369" name="ln-369"></a>
<a id="ln-370" name="ln-370"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">specials</span> <span class="o">=</span> <span class="n">specials_no_slash</span><span class="o">//</span><span class="n">slash</span>
<a id="ln-371" name="ln-371"></a>
<a id="ln-372" name="ln-372"></a>    <span class="c">!Do a quick scan for the special characters,</span>
<a id="ln-373" name="ln-373"></a>    <span class="c">! if any are present, then process the string,</span>
<a id="ln-374" name="ln-374"></a>    <span class="c">! otherwise, return the string as is.</span>
<a id="ln-375" name="ln-375"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">escape_solidus</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-376" name="ln-376"></a><span class="k">        </span><span class="n">to_be_escaped</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span><span class="n">specials</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<a id="ln-377" name="ln-377"></a>    <span class="k">else</span>
<a id="ln-378" name="ln-378"></a><span class="k">        </span><span class="n">to_be_escaped</span> <span class="o">=</span> <span class="nb">scan</span><span class="p">(</span><span class="n">str_in</span><span class="p">,</span><span class="n">specials_no_slash</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
<a id="ln-379" name="ln-379"></a>    <span class="k">end if</span>
<a id="ln-380" name="ln-380"></a>
<a id="ln-381" name="ln-381"></a><span class="k">    if</span> <span class="p">(</span><span class="n">to_be_escaped</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-382" name="ln-382"></a>
<a id="ln-383" name="ln-383"></a><span class="k">        </span><span class="n">str_out</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">chunk_size</span><span class="p">)</span>
<a id="ln-384" name="ln-384"></a>        <span class="n">ipos</span> <span class="o">=</span> <span class="mi">1</span>
<a id="ln-385" name="ln-385"></a>
<a id="ln-386" name="ln-386"></a>        <span class="c">!go through the string and look for special characters:</span>
<a id="ln-387" name="ln-387"></a>        <span class="k">do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">str_in</span><span class="p">)</span>
<a id="ln-388" name="ln-388"></a>
<a id="ln-389" name="ln-389"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span>    <span class="c">!get next character in the input string</span>
<a id="ln-390" name="ln-390"></a>
<a id="ln-391" name="ln-391"></a>            <span class="c">!if the string is not big enough, then add another chunk:</span>
<a id="ln-392" name="ln-392"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">+</span><span class="mi">3</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">str_out</span><span class="p">))</span> <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_out</span> <span class="o">//</span> <span class="n">blank_chunk</span>
<a id="ln-393" name="ln-393"></a>
<a id="ln-394" name="ln-394"></a>            <span class="k">select case</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="ln-395" name="ln-395"></a>            <span class="k">case</span><span class="p">(</span><span class="n">backslash</span><span class="p">)</span>
<a id="ln-396" name="ln-396"></a>
<a id="ln-397" name="ln-397"></a>                <span class="c">!test for unicode sequence: &#39;\uXXXX&#39;</span>
<a id="ln-398" name="ln-398"></a>                <span class="c">![don&#39;t add an extra &#39;\&#39; for those]</span>
<a id="ln-399" name="ln-399"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">str_in</span><span class="p">))</span> <span class="k">then</span>
<a id="ln-400" name="ln-400"></a><span class="k">                    if</span> <span class="p">(</span><span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="n">CK_</span><span class="s1">&#39;u&#39;</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">&amp;</span>
<a id="ln-401" name="ln-401"></a>                        <span class="n">valid_json_hex</span><span class="p">(</span><span class="n">str_in</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">)))</span> <span class="k">then</span>
<a id="ln-402" name="ln-402"></a><span class="k">                        </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-403" name="ln-403"></a>                        <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-404" name="ln-404"></a>                        <span class="k">cycle</span>
<a id="ln-405" name="ln-405"></a><span class="k">                    end if</span>
<a id="ln-406" name="ln-406"></a><span class="k">                end if</span>
<a id="ln-407" name="ln-407"></a>
<a id="ln-408" name="ln-408"></a><span class="k">                </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a id="ln-409" name="ln-409"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-410" name="ln-410"></a>
<a id="ln-411" name="ln-411"></a>            <span class="k">case</span><span class="p">(</span><span class="n">quotation_mark</span><span class="p">)</span>
<a id="ln-412" name="ln-412"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a id="ln-413" name="ln-413"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-414" name="ln-414"></a>            <span class="k">case</span><span class="p">(</span><span class="n">slash</span><span class="p">)</span>
<a id="ln-415" name="ln-415"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">escape_solidus</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-416" name="ln-416"></a><span class="k">                    </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">backslash</span><span class="o">//</span><span class="n">c</span>
<a id="ln-417" name="ln-417"></a>                    <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-418" name="ln-418"></a>                <span class="k">else</span>
<a id="ln-419" name="ln-419"></a><span class="k">                    </span><span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-420" name="ln-420"></a>                    <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-421" name="ln-421"></a>                <span class="k">end if</span>
<a id="ln-422" name="ln-422"></a><span class="k">            case</span><span class="p">(</span><span class="n">bspace</span><span class="p">)</span>
<a id="ln-423" name="ln-423"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\b&#39;</span>
<a id="ln-424" name="ln-424"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-425" name="ln-425"></a>            <span class="k">case</span><span class="p">(</span><span class="n">formfeed</span><span class="p">)</span>
<a id="ln-426" name="ln-426"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\f&#39;</span>
<a id="ln-427" name="ln-427"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-428" name="ln-428"></a>            <span class="k">case</span><span class="p">(</span><span class="n">newline</span><span class="p">)</span>
<a id="ln-429" name="ln-429"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\n&#39;</span>
<a id="ln-430" name="ln-430"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-431" name="ln-431"></a>            <span class="k">case</span><span class="p">(</span><span class="n">carriage_return</span><span class="p">)</span>
<a id="ln-432" name="ln-432"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\r&#39;</span>
<a id="ln-433" name="ln-433"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-434" name="ln-434"></a>            <span class="k">case</span><span class="p">(</span><span class="n">horizontal_tab</span><span class="p">)</span>
<a id="ln-435" name="ln-435"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="s1">&#39;\t&#39;</span>
<a id="ln-436" name="ln-436"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">2</span>
<a id="ln-437" name="ln-437"></a>            <span class="k">case </span><span class="n">default</span>
<a id="ln-438" name="ln-438"></a>                <span class="n">str_out</span><span class="p">(</span><span class="n">ipos</span><span class="p">:</span><span class="n">ipos</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-439" name="ln-439"></a>                <span class="n">ipos</span> <span class="o">=</span> <span class="n">ipos</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-440" name="ln-440"></a>            <span class="k">end select</span>
<a id="ln-441" name="ln-441"></a>
<a id="ln-442" name="ln-442"></a><span class="k">        end do</span>
<a id="ln-443" name="ln-443"></a>
<a id="ln-444" name="ln-444"></a>        <span class="c">!trim the string if necessary:</span>
<a id="ln-445" name="ln-445"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-446" name="ln-446"></a><span class="k">            if</span> <span class="p">(</span><span class="n">ipos</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-447" name="ln-447"></a><span class="k">                </span><span class="n">str_out</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>
<a id="ln-448" name="ln-448"></a>            <span class="k">else</span>
<a id="ln-449" name="ln-449"></a><span class="cp">#if defined __GFORTRAN__</span>
<a id="ln-450" name="ln-450"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ipos</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>      <span class="c">!workaround for bug in gfortran 6.1</span>
<a id="ln-451" name="ln-451"></a>                <span class="n">str_out</span> <span class="o">=</span> <span class="n">tmp</span>
<a id="ln-452" name="ln-452"></a><span class="cp">#else</span>
<a id="ln-453" name="ln-453"></a>                <span class="n">str_out</span> <span class="o">=</span> <span class="n">str_out</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">ipos</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c">!original</span>
<a id="ln-454" name="ln-454"></a><span class="cp">#endif</span>
<a id="ln-455" name="ln-455"></a>            <span class="k">end if</span>
<a id="ln-456" name="ln-456"></a><span class="k">        end if</span>
<a id="ln-457" name="ln-457"></a>
<a id="ln-458" name="ln-458"></a><span class="k">    else</span>
<a id="ln-459" name="ln-459"></a>
<a id="ln-460" name="ln-460"></a><span class="k">        </span><span class="n">str_out</span> <span class="o">=</span> <span class="n">str_in</span>
<a id="ln-461" name="ln-461"></a>
<a id="ln-462" name="ln-462"></a>    <span class="k">end if</span>
<a id="ln-463" name="ln-463"></a>
<a id="ln-464" name="ln-464"></a><span class="k">    end subroutine </span><span class="n">escape_string</span>
<a id="ln-465" name="ln-465"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-466" name="ln-466"></a>
<a id="ln-467" name="ln-467"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-468" name="ln-468"></a><span class="c">!&gt;</span>
<a id="ln-469" name="ln-469"></a><span class="c">!  Remove the escape characters from a JSON string and return it.</span>
<a id="ln-470" name="ln-470"></a><span class="c">!</span>
<a id="ln-471" name="ln-471"></a><span class="c">!  The escaped characters are denoted by the `\` character:</span>
<a id="ln-472" name="ln-472"></a><span class="c">!</span>
<a id="ln-473" name="ln-473"></a><span class="c">!  * `\&quot;`        - quotation mark</span>
<a id="ln-474" name="ln-474"></a><span class="c">!  * `\\`        - reverse solidus</span>
<a id="ln-475" name="ln-475"></a><span class="c">!  * `\/`        - solidus</span>
<a id="ln-476" name="ln-476"></a><span class="c">!  * `\b`        - backspace</span>
<a id="ln-477" name="ln-477"></a><span class="c">!  * `\f`        - formfeed</span>
<a id="ln-478" name="ln-478"></a><span class="c">!  * `\n`        - newline (LF)</span>
<a id="ln-479" name="ln-479"></a><span class="c">!  * `\r`        - carriage return (CR)</span>
<a id="ln-480" name="ln-480"></a><span class="c">!  * `\t`        - horizontal tab</span>
<a id="ln-481" name="ln-481"></a><span class="c">!  * `\uXXXX`    - 4 hexadecimal digits</span>
<a id="ln-482" name="ln-482"></a>
<a id="ln-483" name="ln-483"></a>    <span class="k">subroutine </span><span class="n">unescape_string</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span>
<a id="ln-484" name="ln-484"></a>
<a id="ln-485" name="ln-485"></a>    <span class="k">implicit none</span>
<a id="ln-486" name="ln-486"></a>
<a id="ln-487" name="ln-487"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>           <span class="c">!! in: string as stored</span>
<a id="ln-488" name="ln-488"></a>                                                                        <span class="c">!! in a [[json_value]].</span>
<a id="ln-489" name="ln-489"></a>                                                                        <span class="c">!! out: decoded string.</span>
<a id="ln-490" name="ln-490"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">error_message</span> <span class="c">!! will be allocated if</span>
<a id="ln-491" name="ln-491"></a>                                                                        <span class="c">!! there was an error</span>
<a id="ln-492" name="ln-492"></a>
<a id="ln-493" name="ln-493"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>   <span class="c">!! counter</span>
<a id="ln-494" name="ln-494"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">n</span>   <span class="c">!! length of `str`</span>
<a id="ln-495" name="ln-495"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">m</span>   <span class="c">!! length of `str_tmp`</span>
<a id="ln-496" name="ln-496"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="kd">::</span> <span class="n">c</span>  <span class="c">!! for scanning each character in string</span>
<a id="ln-497" name="ln-497"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_tmp</span> <span class="c">!! temp decoded string (if the input</span>
<a id="ln-498" name="ln-498"></a>                                                    <span class="c">!! string contains an escape character</span>
<a id="ln-499" name="ln-499"></a>                                                    <span class="c">!! and needs to be decoded).</span>
<a id="ln-500" name="ln-500"></a>
<a id="ln-501" name="ln-501"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">scan</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">backslash</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-502" name="ln-502"></a>
<a id="ln-503" name="ln-503"></a>        <span class="c">!there is at least one escape character, so process this string:</span>
<a id="ln-504" name="ln-504"></a>
<a id="ln-505" name="ln-505"></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-506" name="ln-506"></a>        <span class="n">str_tmp</span> <span class="o">=</span> <span class="nb">repeat</span><span class="p">(</span><span class="n">space</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="c">!size the output string (will be trimmed later)</span>
<a id="ln-507" name="ln-507"></a>        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!counter in str_tmp</span>
<a id="ln-508" name="ln-508"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!counter in str</span>
<a id="ln-509" name="ln-509"></a>
<a id="ln-510" name="ln-510"></a>        <span class="k">do</span>
<a id="ln-511" name="ln-511"></a>
<a id="ln-512" name="ln-512"></a><span class="k">            </span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-513" name="ln-513"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="n">n</span><span class="p">)</span> <span class="k">exit</span> <span class="c">! finished</span>
<a id="ln-514" name="ln-514"></a>            <span class="n">c</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="c">! get next character in the string</span>
<a id="ln-515" name="ln-515"></a>
<a id="ln-516" name="ln-516"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">backslash</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-517" name="ln-517"></a>
<a id="ln-518" name="ln-518"></a><span class="k">                if</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-519" name="ln-519"></a>
<a id="ln-520" name="ln-520"></a><span class="k">                    </span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-521" name="ln-521"></a>                    <span class="n">c</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="c">!character after the escape</span>
<a id="ln-522" name="ln-522"></a>
<a id="ln-523" name="ln-523"></a>                    <span class="k">select case</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="ln-524" name="ln-524"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">quotation_mark</span><span class="p">,</span><span class="n">backslash</span><span class="p">,</span><span class="n">slash</span><span class="p">)</span>
<a id="ln-525" name="ln-525"></a>                        <span class="c">!use d as is</span>
<a id="ln-526" name="ln-526"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-527" name="ln-527"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-528" name="ln-528"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<a id="ln-529" name="ln-529"></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">bspace</span>
<a id="ln-530" name="ln-530"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-531" name="ln-531"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-532" name="ln-532"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>
<a id="ln-533" name="ln-533"></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">formfeed</span>
<a id="ln-534" name="ln-534"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-535" name="ln-535"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-536" name="ln-536"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
<a id="ln-537" name="ln-537"></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">newline</span>
<a id="ln-538" name="ln-538"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-539" name="ln-539"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-540" name="ln-540"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<a id="ln-541" name="ln-541"></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">carriage_return</span>
<a id="ln-542" name="ln-542"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-543" name="ln-543"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-544" name="ln-544"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<a id="ln-545" name="ln-545"></a>                        <span class="n">c</span> <span class="o">=</span> <span class="n">horizontal_tab</span>
<a id="ln-546" name="ln-546"></a>                        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-547" name="ln-547"></a>                        <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-548" name="ln-548"></a>
<a id="ln-549" name="ln-549"></a>                    <span class="k">case</span> <span class="p">(</span><span class="n">CK_</span><span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="c">! expecting 4 hexadecimal digits after</span>
<a id="ln-550" name="ln-550"></a>                                  <span class="c">! the escape character    [\uXXXX]</span>
<a id="ln-551" name="ln-551"></a>
<a id="ln-552" name="ln-552"></a>                        <span class="c">!for now, we are just returning them as is</span>
<a id="ln-553" name="ln-553"></a>                        <span class="c">![not checking to see if it is a valid hex value]</span>
<a id="ln-554" name="ln-554"></a>                        <span class="c">!</span>
<a id="ln-555" name="ln-555"></a>                        <span class="c">! Example:</span>
<a id="ln-556" name="ln-556"></a>                        <span class="c">!   123456</span>
<a id="ln-557" name="ln-557"></a>                        <span class="c">!   \uXXXX</span>
<a id="ln-558" name="ln-558"></a>
<a id="ln-559" name="ln-559"></a>                        <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-560" name="ln-560"></a>
<a id="ln-561" name="ln-561"></a>                            <span class="c">! validate the hex string:</span>
<a id="ln-562" name="ln-562"></a>                            <span class="k">if</span> <span class="p">(</span><span class="n">valid_json_hex</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)))</span> <span class="k">then</span>
<a id="ln-563" name="ln-563"></a><span class="k">                                </span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-564" name="ln-564"></a>                                <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
<a id="ln-565" name="ln-565"></a>                                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">4</span>
<a id="ln-566" name="ln-566"></a>                                <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">5</span>
<a id="ln-567" name="ln-567"></a>                            <span class="k">else</span>
<a id="ln-568" name="ln-568"></a><span class="k">                                </span><span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-569" name="ln-569"></a>                                                <span class="s1">&#39; Invalid hexadecimal sequence in string &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-570" name="ln-570"></a>                                                <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot; [&#39;</span><span class="o">//</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;]&#39;</span>
<a id="ln-571" name="ln-571"></a>                                <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">)</span>
<a id="ln-572" name="ln-572"></a>                                <span class="k">return</span>
<a id="ln-573" name="ln-573"></a><span class="k">                            end if</span>
<a id="ln-574" name="ln-574"></a><span class="k">                        else</span>
<a id="ln-575" name="ln-575"></a><span class="k">                            </span><span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-576" name="ln-576"></a>                                            <span class="s1">&#39; Invalid hexadecimal sequence in string &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-577" name="ln-577"></a>                                            <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot; [&#39;</span><span class="o">//</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:)</span><span class="o">//</span><span class="s1">&#39;]&#39;</span>
<a id="ln-578" name="ln-578"></a>                            <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">)</span>
<a id="ln-579" name="ln-579"></a>                            <span class="k">return</span>
<a id="ln-580" name="ln-580"></a><span class="k">                        end if</span>
<a id="ln-581" name="ln-581"></a>
<a id="ln-582" name="ln-582"></a><span class="k">                    case </span><span class="n">default</span>
<a id="ln-583" name="ln-583"></a>
<a id="ln-584" name="ln-584"></a>                        <span class="c">!unknown escape character</span>
<a id="ln-585" name="ln-585"></a>                        <span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-586" name="ln-586"></a>                                        <span class="s1">&#39; unknown escape sequence in string &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-587" name="ln-587"></a>                                        <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot; [&#39;</span><span class="o">//</span><span class="n">backslash</span><span class="o">//</span><span class="n">c</span><span class="o">//</span><span class="s1">&#39;]&#39;</span>
<a id="ln-588" name="ln-588"></a>                        <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">)</span>
<a id="ln-589" name="ln-589"></a>                        <span class="k">return</span>
<a id="ln-590" name="ln-590"></a>
<a id="ln-591" name="ln-591"></a><span class="k">                    end select</span>
<a id="ln-592" name="ln-592"></a>
<a id="ln-593" name="ln-593"></a><span class="k">                else</span>
<a id="ln-594" name="ln-594"></a>                    <span class="c">! an escape character is the last character in</span>
<a id="ln-595" name="ln-595"></a>                    <span class="c">! the string. This is an error.</span>
<a id="ln-596" name="ln-596"></a>                    <span class="n">error_message</span> <span class="o">=</span> <span class="s1">&#39;Error in unescape_string:&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-597" name="ln-597"></a>                                    <span class="s1">&#39; invalid escape character in string &quot;&#39;</span><span class="o">//</span><span class="p">&amp;</span>
<a id="ln-598" name="ln-598"></a>                                    <span class="nb">trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">//</span><span class="s1">&#39;&quot;&#39;</span>
<a id="ln-599" name="ln-599"></a>                    <span class="k">if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">))</span> <span class="k">deallocate</span><span class="p">(</span><span class="n">str_tmp</span><span class="p">)</span>
<a id="ln-600" name="ln-600"></a>                    <span class="k">return</span>
<a id="ln-601" name="ln-601"></a><span class="k">                end if</span>
<a id="ln-602" name="ln-602"></a>
<a id="ln-603" name="ln-603"></a><span class="k">            else</span>
<a id="ln-604" name="ln-604"></a><span class="k">                </span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span>
<a id="ln-605" name="ln-605"></a>                <span class="n">str_tmp</span><span class="p">(</span><span class="n">m</span><span class="p">:</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="n">c</span>
<a id="ln-606" name="ln-606"></a>            <span class="k">end if</span>
<a id="ln-607" name="ln-607"></a>
<a id="ln-608" name="ln-608"></a><span class="k">        end do</span>
<a id="ln-609" name="ln-609"></a>
<a id="ln-610" name="ln-610"></a>        <span class="c">!trim trailing space:</span>
<a id="ln-611" name="ln-611"></a>        <span class="n">str</span> <span class="o">=</span> <span class="n">str_tmp</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">m</span><span class="p">)</span>
<a id="ln-612" name="ln-612"></a>
<a id="ln-613" name="ln-613"></a>    <span class="k">end if</span>
<a id="ln-614" name="ln-614"></a>
<a id="ln-615" name="ln-615"></a><span class="k">    end subroutine </span><span class="n">unescape_string</span>
<a id="ln-616" name="ln-616"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-617" name="ln-617"></a>
<a id="ln-618" name="ln-618"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-619" name="ln-619"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-620" name="ln-620"></a><span class="c">!  date:6/14/2014</span>
<a id="ln-621" name="ln-621"></a><span class="c">!</span>
<a id="ln-622" name="ln-622"></a><span class="c">!  Returns true if the string is a valid 4-digit hex string.</span>
<a id="ln-623" name="ln-623"></a><span class="c">!</span>
<a id="ln-624" name="ln-624"></a><span class="c">!# Examples</span>
<a id="ln-625" name="ln-625"></a><span class="c">!```fortran</span>
<a id="ln-626" name="ln-626"></a><span class="c">!    valid_json_hex(&#39;0000&#39;)  !returns true</span>
<a id="ln-627" name="ln-627"></a><span class="c">!    valid_json_hex(&#39;ABC4&#39;)  !returns true</span>
<a id="ln-628" name="ln-628"></a><span class="c">!    valid_json_hex(&#39;AB&#39;)    !returns false (&lt; 4 characters)</span>
<a id="ln-629" name="ln-629"></a><span class="c">!    valid_json_hex(&#39;WXYZ&#39;)  !returns false (invalid characters)</span>
<a id="ln-630" name="ln-630"></a><span class="c">!```</span>
<a id="ln-631" name="ln-631"></a>
<a id="ln-632" name="ln-632"></a>    <span class="k">pure function </span><span class="n">valid_json_hex</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
<a id="ln-633" name="ln-633"></a>
<a id="ln-634" name="ln-634"></a>    <span class="k">implicit none</span>
<a id="ln-635" name="ln-635"></a>
<a id="ln-636" name="ln-636"></a><span class="k">    </span><span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">valid</span>  <span class="c">!! is str a value 4-digit hex string</span>
<a id="ln-637" name="ln-637"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>    <span class="c">!! the string to check.</span>
<a id="ln-638" name="ln-638"></a>
<a id="ln-639" name="ln-639"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>  <span class="c">!! length of `str`</span>
<a id="ln-640" name="ln-640"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a id="ln-641" name="ln-641"></a>
<a id="ln-642" name="ln-642"></a>    <span class="c">!&gt; an array of the valid hex characters</span>
<a id="ln-643" name="ln-643"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span><span class="k">parameter</span> <span class="kd">::</span> <span class="n">valid_chars</span> <span class="o">=</span> <span class="p">&amp;</span>
<a id="ln-644" name="ln-644"></a>        <span class="p">[</span> <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span><span class="mi">57</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">! decimal digits</span>
<a id="ln-645" name="ln-645"></a>          <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span><span class="mi">70</span><span class="p">),</span> <span class="p">&amp;</span> <span class="c">! capital A-F</span>
<a id="ln-646" name="ln-646"></a>          <span class="p">(</span><span class="nb">achar</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">i</span><span class="o">=</span><span class="mi">97</span><span class="p">,</span><span class="mi">102</span><span class="p">)</span> <span class="p">]</span> <span class="c">! lowercase a-f</span>
<a id="ln-647" name="ln-647"></a>
<a id="ln-648" name="ln-648"></a>    <span class="c">!initialize</span>
<a id="ln-649" name="ln-649"></a>    <span class="n">valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a id="ln-650" name="ln-650"></a>
<a id="ln-651" name="ln-651"></a>    <span class="c">!check all the characters in the string:</span>
<a id="ln-652" name="ln-652"></a>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-653" name="ln-653"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-654" name="ln-654"></a><span class="k">        do </span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span>
<a id="ln-655" name="ln-655"></a>            <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">any</span><span class="p">(</span><span class="n">str</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="n">valid_chars</span><span class="p">))</span> <span class="k">return</span>
<a id="ln-656" name="ln-656"></a><span class="k">        end do</span>
<a id="ln-657" name="ln-657"></a><span class="k">        </span><span class="n">valid</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>    <span class="c">!all are in the set, so it is OK</span>
<a id="ln-658" name="ln-658"></a>    <span class="k">end if</span>
<a id="ln-659" name="ln-659"></a>
<a id="ln-660" name="ln-660"></a><span class="k">    end function </span><span class="n">valid_json_hex</span>
<a id="ln-661" name="ln-661"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-662" name="ln-662"></a>
<a id="ln-663" name="ln-663"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-664" name="ln-664"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-665" name="ln-665"></a><span class="c">!</span>
<a id="ln-666" name="ln-666"></a><span class="c">!  Convert string to unicode (CDK to CK).</span>
<a id="ln-667" name="ln-667"></a>
<a id="ln-668" name="ln-668"></a>    <span class="k">pure function </span><span class="n">to_uni</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-669" name="ln-669"></a>
<a id="ln-670" name="ln-670"></a>    <span class="k">implicit none</span>
<a id="ln-671" name="ln-671"></a>
<a id="ln-672" name="ln-672"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a id="ln-673" name="ln-673"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">))</span>       <span class="kd">::</span> <span class="n">to_uni</span>
<a id="ln-674" name="ln-674"></a>
<a id="ln-675" name="ln-675"></a>    <span class="n">to_uni</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-676" name="ln-676"></a>
<a id="ln-677" name="ln-677"></a>    <span class="k">end function </span><span class="n">to_uni</span>
<a id="ln-678" name="ln-678"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-679" name="ln-679"></a>
<a id="ln-680" name="ln-680"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-681" name="ln-681"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-682" name="ln-682"></a><span class="c">!</span>
<a id="ln-683" name="ln-683"></a><span class="c">!  Convert array of strings to unicode (CDK to CK).</span>
<a id="ln-684" name="ln-684"></a><span class="c">!</span>
<a id="ln-685" name="ln-685"></a><span class="c">!@note JW: may be able to remove this by making [[to_uni]] PURE ELEMENTAL ?</span>
<a id="ln-686" name="ln-686"></a>
<a id="ln-687" name="ln-687"></a>    <span class="k">pure function </span><span class="n">to_uni_vec</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-688" name="ln-688"></a>
<a id="ln-689" name="ln-689"></a>    <span class="k">implicit none</span>
<a id="ln-690" name="ln-690"></a>
<a id="ln-691" name="ln-691"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">str</span>
<a id="ln-692" name="ln-692"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">str</span><span class="p">))</span> <span class="kd">::</span> <span class="n">to_uni_vec</span>
<a id="ln-693" name="ln-693"></a>
<a id="ln-694" name="ln-694"></a>    <span class="n">to_uni_vec</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-695" name="ln-695"></a>
<a id="ln-696" name="ln-696"></a>    <span class="k">end function </span><span class="n">to_uni_vec</span>
<a id="ln-697" name="ln-697"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-698" name="ln-698"></a>
<a id="ln-699" name="ln-699"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-700" name="ln-700"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-701" name="ln-701"></a><span class="c">!</span>
<a id="ln-702" name="ln-702"></a><span class="c">!  `CK`//`CDK` operator.</span>
<a id="ln-703" name="ln-703"></a>
<a id="ln-704" name="ln-704"></a>    <span class="k">pure function </span><span class="n">ucs4_join_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-705" name="ln-705"></a>
<a id="ln-706" name="ln-706"></a>    <span class="k">implicit none</span>
<a id="ln-707" name="ln-707"></a>
<a id="ln-708" name="ln-708"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-709" name="ln-709"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-710" name="ln-710"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">def_str</span><span class="p">)))</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-711" name="ln-711"></a>
<a id="ln-712" name="ln-712"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">ucs4_str</span><span class="o">//</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span>
<a id="ln-713" name="ln-713"></a>
<a id="ln-714" name="ln-714"></a>    <span class="k">end function </span><span class="n">ucs4_join_default</span>
<a id="ln-715" name="ln-715"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-716" name="ln-716"></a>
<a id="ln-717" name="ln-717"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-718" name="ln-718"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-719" name="ln-719"></a><span class="c">!</span>
<a id="ln-720" name="ln-720"></a><span class="c">!  `CDK`//`CK` operator.</span>
<a id="ln-721" name="ln-721"></a>
<a id="ln-722" name="ln-722"></a>    <span class="k">pure function </span><span class="n">default_join_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-723" name="ln-723"></a>
<a id="ln-724" name="ln-724"></a>    <span class="k">implicit none</span>
<a id="ln-725" name="ln-725"></a>
<a id="ln-726" name="ln-726"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-727" name="ln-727"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-728" name="ln-728"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">)))</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-729" name="ln-729"></a>
<a id="ln-730" name="ln-730"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span><span class="o">//</span><span class="n">ucs4_str</span>
<a id="ln-731" name="ln-731"></a>
<a id="ln-732" name="ln-732"></a>    <span class="k">end function </span><span class="n">default_join_ucs4</span>
<a id="ln-733" name="ln-733"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-734" name="ln-734"></a>
<a id="ln-735" name="ln-735"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-736" name="ln-736"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-737" name="ln-737"></a><span class="c">!</span>
<a id="ln-738" name="ln-738"></a><span class="c">!  `CK`==`CDK` operator.</span>
<a id="ln-739" name="ln-739"></a>
<a id="ln-740" name="ln-740"></a>    <span class="k">pure elemental function </span><span class="n">ucs4_comp_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-741" name="ln-741"></a>
<a id="ln-742" name="ln-742"></a>    <span class="k">implicit none</span>
<a id="ln-743" name="ln-743"></a>
<a id="ln-744" name="ln-744"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-745" name="ln-745"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-746" name="ln-746"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-747" name="ln-747"></a>
<a id="ln-748" name="ln-748"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ucs4_str</span> <span class="o">==</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="p">)</span>
<a id="ln-749" name="ln-749"></a>
<a id="ln-750" name="ln-750"></a>    <span class="k">end function </span><span class="n">ucs4_comp_default</span>
<a id="ln-751" name="ln-751"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-752" name="ln-752"></a>
<a id="ln-753" name="ln-753"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-754" name="ln-754"></a><span class="c">!&gt; author: Izaak Beekman</span>
<a id="ln-755" name="ln-755"></a><span class="c">!</span>
<a id="ln-756" name="ln-756"></a><span class="c">!  `CDK`==`CK` operator.</span>
<a id="ln-757" name="ln-757"></a>
<a id="ln-758" name="ln-758"></a>    <span class="k">pure elemental function </span><span class="n">default_comp_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-759" name="ln-759"></a>
<a id="ln-760" name="ln-760"></a>    <span class="k">implicit none</span>
<a id="ln-761" name="ln-761"></a>
<a id="ln-762" name="ln-762"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-763" name="ln-763"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-764" name="ln-764"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-765" name="ln-765"></a>
<a id="ln-766" name="ln-766"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="o">==</span> <span class="n">ucs4_str</span><span class="p">)</span>
<a id="ln-767" name="ln-767"></a>
<a id="ln-768" name="ln-768"></a>    <span class="k">end function </span><span class="n">default_comp_ucs4</span>
<a id="ln-769" name="ln-769"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-770" name="ln-770"></a>
<a id="ln-771" name="ln-771"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-772" name="ln-772"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-773" name="ln-773"></a><span class="c">!</span>
<a id="ln-774" name="ln-774"></a><span class="c">!  `CK`/=`CDK` operator.</span>
<a id="ln-775" name="ln-775"></a>
<a id="ln-776" name="ln-776"></a>    <span class="k">pure elemental function </span><span class="n">ucs4_neq_default</span><span class="p">(</span><span class="n">ucs4_str</span><span class="p">,</span><span class="n">def_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-777" name="ln-777"></a>
<a id="ln-778" name="ln-778"></a>    <span class="k">implicit none</span>
<a id="ln-779" name="ln-779"></a>
<a id="ln-780" name="ln-780"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-781" name="ln-781"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-782" name="ln-782"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-783" name="ln-783"></a>
<a id="ln-784" name="ln-784"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">ucs4_str</span> <span class="o">/=</span> <span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="p">)</span>
<a id="ln-785" name="ln-785"></a>
<a id="ln-786" name="ln-786"></a>    <span class="k">end function </span><span class="n">ucs4_neq_default</span>
<a id="ln-787" name="ln-787"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-788" name="ln-788"></a>
<a id="ln-789" name="ln-789"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-790" name="ln-790"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-791" name="ln-791"></a><span class="c">!</span>
<a id="ln-792" name="ln-792"></a><span class="c">!  `CDK`/=`CK` operator.</span>
<a id="ln-793" name="ln-793"></a>
<a id="ln-794" name="ln-794"></a>    <span class="k">pure elemental function </span><span class="n">default_neq_ucs4</span><span class="p">(</span><span class="n">def_str</span><span class="p">,</span><span class="n">ucs4_str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<a id="ln-795" name="ln-795"></a>
<a id="ln-796" name="ln-796"></a>    <span class="k">implicit none</span>
<a id="ln-797" name="ln-797"></a>
<a id="ln-798" name="ln-798"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CDK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">def_str</span>
<a id="ln-799" name="ln-799"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span> <span class="nb">len</span><span class="o">=*</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ucs4_str</span>
<a id="ln-800" name="ln-800"></a>    <span class="kt">logical</span><span class="p">(</span><span class="n">LK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">res</span>
<a id="ln-801" name="ln-801"></a>
<a id="ln-802" name="ln-802"></a>    <span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_unicode</span><span class="p">(</span><span class="n">def_str</span><span class="p">)</span> <span class="o">/=</span> <span class="n">ucs4_str</span><span class="p">)</span>
<a id="ln-803" name="ln-803"></a>
<a id="ln-804" name="ln-804"></a>    <span class="k">end function </span><span class="n">default_neq_ucs4</span>
<a id="ln-805" name="ln-805"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-806" name="ln-806"></a>
<a id="ln-807" name="ln-807"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-808" name="ln-808"></a><span class="c">!&gt; author: Jacob Williams</span>
<a id="ln-809" name="ln-809"></a><span class="c">!</span>
<a id="ln-810" name="ln-810"></a><span class="c">!  Returns lowercase version of the `CK` string.</span>
<a id="ln-811" name="ln-811"></a>
<a id="ln-812" name="ln-812"></a>    <span class="k">pure function </span><span class="n">lowercase_string</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">s_lower</span><span class="p">)</span>
<a id="ln-813" name="ln-813"></a>
<a id="ln-814" name="ln-814"></a>    <span class="k">implicit none</span>
<a id="ln-815" name="ln-815"></a>
<a id="ln-816" name="ln-816"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>      <span class="c">!! input string</span>
<a id="ln-817" name="ln-817"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)))</span>   <span class="kd">::</span> <span class="n">s_lower</span>  <span class="c">!! lowercase version of the string</span>
<a id="ln-818" name="ln-818"></a>
<a id="ln-819" name="ln-819"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span>  <span class="c">!! counter</span>
<a id="ln-820" name="ln-820"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">j</span>  <span class="c">!! index of uppercase character</span>
<a id="ln-821" name="ln-821"></a>
<a id="ln-822" name="ln-822"></a>    <span class="n">s_lower</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-823" name="ln-823"></a>
<a id="ln-824" name="ln-824"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len_trim</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-825" name="ln-825"></a>        <span class="n">j</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span><span class="n">s_lower</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">))</span>
<a id="ln-826" name="ln-826"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="n">s_lower</span><span class="p">(</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">lower</span><span class="p">(</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="p">)</span>
<a id="ln-827" name="ln-827"></a>    <span class="k">end do</span>
<a id="ln-828" name="ln-828"></a>
<a id="ln-829" name="ln-829"></a><span class="k">    end function </span><span class="n">lowercase_string</span>
<a id="ln-830" name="ln-830"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-831" name="ln-831"></a>
<a id="ln-832" name="ln-832"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-833" name="ln-833"></a><span class="c">!&gt;</span>
<a id="ln-834" name="ln-834"></a><span class="c">!  Replace all occurrences of `s1` in `str` with `s2`.</span>
<a id="ln-835" name="ln-835"></a><span class="c">!</span>
<a id="ln-836" name="ln-836"></a><span class="c">!  A case-sensitive match is used.</span>
<a id="ln-837" name="ln-837"></a><span class="c">!</span>
<a id="ln-838" name="ln-838"></a><span class="c">!@note `str` must be allocated.</span>
<a id="ln-839" name="ln-839"></a>
<a id="ln-840" name="ln-840"></a>    <span class="k">pure subroutine </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">)</span>
<a id="ln-841" name="ln-841"></a>
<a id="ln-842" name="ln-842"></a>    <span class="k">implicit none</span>
<a id="ln-843" name="ln-843"></a>
<a id="ln-844" name="ln-844"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a id="ln-845" name="ln-845"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s1</span>
<a id="ln-846" name="ln-846"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">s2</span>
<a id="ln-847" name="ln-847"></a>
<a id="ln-848" name="ln-848"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">tmp</span>  <span class="c">!! temporary string for accumulating result</span>
<a id="ln-849" name="ln-849"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>      <span class="c">!! counter</span>
<a id="ln-850" name="ln-850"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">n</span>      <span class="c">!! for accumulating the string</span>
<a id="ln-851" name="ln-851"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen</span>   <span class="c">!! length of `str` string</span>
<a id="ln-852" name="ln-852"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">IK</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ilen1</span>  <span class="c">!! length of `s1` string</span>
<a id="ln-853" name="ln-853"></a>
<a id="ln-854" name="ln-854"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-855" name="ln-855"></a>
<a id="ln-856" name="ln-856"></a><span class="k">        </span><span class="n">tmp</span> <span class="o">=</span> <span class="n">CK_</span><span class="s1">&#39;&#39;</span>  <span class="c">! initialize</span>
<a id="ln-857" name="ln-857"></a>        <span class="n">ilen1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<a id="ln-858" name="ln-858"></a>
<a id="ln-859" name="ln-859"></a>        <span class="c">!     .</span>
<a id="ln-860" name="ln-860"></a>        <span class="c">! &#39;123ab789&#39;</span>
<a id="ln-861" name="ln-861"></a>
<a id="ln-862" name="ln-862"></a>        <span class="k">do</span>
<a id="ln-863" name="ln-863"></a><span class="k">            </span><span class="n">ilen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<a id="ln-864" name="ln-864"></a>            <span class="n">i</span> <span class="o">=</span> <span class="nb">index</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="n">s1</span><span class="p">)</span>
<a id="ln-865" name="ln-865"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-866" name="ln-866"></a><span class="k">                if</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">str</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a id="ln-867" name="ln-867"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">s2</span> <span class="c">! replace s1 with s2 in new string</span>
<a id="ln-868" name="ln-868"></a>                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="n">ilen1</span>   <span class="c">! start of remainder of str to keep</span>
<a id="ln-869" name="ln-869"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">&lt;=</span><span class="n">ilen</span><span class="p">)</span> <span class="k">then</span>
<a id="ln-870" name="ln-870"></a><span class="k">                    </span><span class="n">str</span> <span class="o">=</span> <span class="n">str</span><span class="p">(</span><span class="n">n</span><span class="p">:</span><span class="n">ilen</span><span class="p">)</span>
<a id="ln-871" name="ln-871"></a>                <span class="k">else</span>
<a id="ln-872" name="ln-872"></a>                    <span class="c">! done</span>
<a id="ln-873" name="ln-873"></a>                    <span class="k">exit</span>
<a id="ln-874" name="ln-874"></a><span class="k">                end if</span>
<a id="ln-875" name="ln-875"></a><span class="k">            else</span>
<a id="ln-876" name="ln-876"></a>                <span class="c">! done: get remainder of string</span>
<a id="ln-877" name="ln-877"></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">//</span><span class="n">str</span>
<a id="ln-878" name="ln-878"></a>                <span class="k">exit</span>
<a id="ln-879" name="ln-879"></a><span class="k">            end if</span>
<a id="ln-880" name="ln-880"></a><span class="k">        end do</span>
<a id="ln-881" name="ln-881"></a>
<a id="ln-882" name="ln-882"></a><span class="k">        </span><span class="n">str</span> <span class="o">=</span> <span class="n">tmp</span>
<a id="ln-883" name="ln-883"></a>
<a id="ln-884" name="ln-884"></a>    <span class="k">end if</span>
<a id="ln-885" name="ln-885"></a>
<a id="ln-886" name="ln-886"></a><span class="k">    end subroutine </span><span class="n">replace_string</span>
<a id="ln-887" name="ln-887"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-888" name="ln-888"></a>
<a id="ln-889" name="ln-889"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-890" name="ln-890"></a><span class="c">!&gt;</span>
<a id="ln-891" name="ln-891"></a><span class="c">!  Decode a string from the &quot;JSON Pointer&quot; RFC 6901 format.</span>
<a id="ln-892" name="ln-892"></a><span class="c">!</span>
<a id="ln-893" name="ln-893"></a><span class="c">!  It replaces `~1` with `/` and `~0` with `~`.</span>
<a id="ln-894" name="ln-894"></a>
<a id="ln-895" name="ln-895"></a>    <span class="k">pure function </span><span class="n">decode_rfc6901</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a id="ln-896" name="ln-896"></a>
<a id="ln-897" name="ln-897"></a>    <span class="k">implicit none</span>
<a id="ln-898" name="ln-898"></a>
<a id="ln-899" name="ln-899"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a id="ln-900" name="ln-900"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_out</span>
<a id="ln-901" name="ln-901"></a>
<a id="ln-902" name="ln-902"></a>    <span class="n">str_out</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-903" name="ln-903"></a>
<a id="ln-904" name="ln-904"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">slash</span><span class="p">)</span>
<a id="ln-905" name="ln-905"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">tilde</span><span class="p">)</span>
<a id="ln-906" name="ln-906"></a>
<a id="ln-907" name="ln-907"></a>    <span class="k">end function </span><span class="n">decode_rfc6901</span>
<a id="ln-908" name="ln-908"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-909" name="ln-909"></a>
<a id="ln-910" name="ln-910"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-911" name="ln-911"></a><span class="c">!&gt;</span>
<a id="ln-912" name="ln-912"></a><span class="c">!  Encode a string into the &quot;JSON Pointer&quot; RFC 6901 format.</span>
<a id="ln-913" name="ln-913"></a><span class="c">!</span>
<a id="ln-914" name="ln-914"></a><span class="c">!  It replaces `~` with `~0` and `/` with `~1`.</span>
<a id="ln-915" name="ln-915"></a>
<a id="ln-916" name="ln-916"></a>    <span class="k">pure function </span><span class="n">encode_rfc6901</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">str_out</span><span class="p">)</span>
<a id="ln-917" name="ln-917"></a>
<a id="ln-918" name="ln-918"></a>    <span class="k">implicit none</span>
<a id="ln-919" name="ln-919"></a>
<a id="ln-920" name="ln-920"></a><span class="k">    </span><span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=*</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span> <span class="kd">::</span> <span class="n">str</span>
<a id="ln-921" name="ln-921"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">kind</span><span class="o">=</span><span class="n">CK</span><span class="p">,</span><span class="nb">len</span><span class="o">=</span><span class="p">:),</span><span class="k">allocatable</span> <span class="kd">::</span> <span class="n">str_out</span>
<a id="ln-922" name="ln-922"></a>
<a id="ln-923" name="ln-923"></a>    <span class="n">str_out</span> <span class="o">=</span> <span class="n">str</span>
<a id="ln-924" name="ln-924"></a>
<a id="ln-925" name="ln-925"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">tilde</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<a id="ln-926" name="ln-926"></a>    <span class="k">call </span><span class="n">replace_string</span><span class="p">(</span><span class="n">str_out</span><span class="p">,</span><span class="n">slash</span><span class="p">,</span><span class="n">tilde</span><span class="o">//</span><span class="n">CK_</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<a id="ln-927" name="ln-927"></a>
<a id="ln-928" name="ln-928"></a>    <span class="k">end function </span><span class="n">encode_rfc6901</span>
<a id="ln-929" name="ln-929"></a><span class="c">!*****************************************************************************************</span>
<a id="ln-930" name="ln-930"></a>
<a id="ln-931" name="ln-931"></a>    <span class="k">end module </span><span class="n">json_string_utilities</span>
<a id="ln-932" name="ln-932"></a><span class="c">!*****************************************************************************************</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>JSON-Fortran was developed by Jacob Williams<br>&copy; 2021 
                                          </p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
             on 2021-08-16 04:17  
            
          </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>